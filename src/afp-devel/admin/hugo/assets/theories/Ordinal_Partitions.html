<div id="Library_Additions">
<div class="head">
<h1>Theory Library_Additions</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Library additions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Library_Additions
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../zfc_in_hol/theories/#Ordinal_Exp">ZFC_in_HOL.Ordinal_Exp</a>"</span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Ramsey.html">HOL-Library.Ramsey</a>"</span> <span class="quoted">"<a href="../../nash_williams/theories/#Nash_Williams">Nash_Williams.Nash_Williams</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Library_Additions-finite_enumerate_Diff_singleton"><span class="command">lemma</span></span> finite_enumerate_Diff_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>wellorder set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> card <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"enumerate <span class="free">S</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"enumerate <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> enumerate <span class="free">S</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> i
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">i</span><span class="main">≠</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">≠</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 0 <span class="quoted"><span class="quoted">‹finite <span class="free">S</span>›</span></span> finite_enumerate_in_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"0.prems"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> LeastI enumerate_0 not_less_Least<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Least_le<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enumerate_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"enumerate <span class="free">S</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> enumerate_step finite_enumerate_step less_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> cardSx<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> card <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc <span class="quoted"><span class="quoted">‹finite <span class="free">S</span>›</span></span> card_Diff_singleton_if finite_enumerate_Ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">s</span><span class="main">≠</span><span class="free">x</span> <span class="main">∧</span> enumerate <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> enumerate <span class="free">S</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
       <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Least_equality conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> LeastI Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> finite_enumerate_in_set finite_enumerate_step<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.prems not_less_Least <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> enumerate <span class="free">S</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="bound">t</span>"</span></span><span class="main">]</span> 
       <span class="quoted"><span class="quoted">‹finite <span class="free">S</span>›</span></span> finite_enumerate_in_set finite_enumerate_step <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"enumerate <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Suc.IH Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> card <span class="free">S</span>›</span></span> enumerate_Suc'' enumerate_step finite_enumerate_Suc'' finite_enumerate_step x<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">∧</span> enumerate <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="var">?r</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Least_le Suc.IH <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> card <span class="free">S</span>›</span></span> x<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_enumerate_Suc'' cardSx<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Library_Additions-hd_lex"><span class="command">lemma</span></span> hd_lex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>hd <span class="free">ms</span> <span class="main">&lt;</span> hd <span class="free">ns</span><span class="main">;</span> length <span class="free">ms</span> <span class="main">=</span> length <span class="free">ns</span><span class="main">;</span> <span class="free">ns</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ms</span><span class="main">,</span> <span class="free">ns</span><span class="main">)</span> <span class="main">∈</span> lex less_than"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hd_Cons_tl length_0_conv less_than_iff lexord_cons_cons lexord_lex<span class="main">)</span>

<span class="keyword1" id="Library_Additions-sorted_hd_le"><span class="command">lemma</span></span> sorted_hd_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> list.set <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">xs</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_imp_le<span class="main">)</span>

<span class="keyword1" id="Library_Additions-sorted_le_last"><span class="command">lemma</span></span> sorted_le_last<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> list.set <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> last <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_imp_le<span class="main">)</span>

<span class="keyword1" id="Library_Additions-hd_list_of"><span class="command">lemma</span></span> hd_list_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>sorted_list_of_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> Min <span class="free">A</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Min <span class="free">A</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>sorted_list_of_set <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> Min <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_hd_le <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Min <span class="free">A</span> <span class="main">≤</span> hd <span class="main">(</span>sorted_list_of_set <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Min_le assms hd_in_set set_sorted_list_of_set sorted_list_of_set_eq_Nil_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Library_Additions-sorted_hd_le_last"><span class="command">lemma</span></span> sorted_hd_le_last<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">xs</span> <span class="main">≤</span> last <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_hd_le<span class="main">)</span>

<span class="keyword1" id="Library_Additions-sorted_list_of_set_set_of"><span class="command">lemma</span></span> sorted_list_of_set_set_of <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="free">l</span> <span class="main">⟹</span> sorted_list_of_set <span class="main">(</span>list.set <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_sorted_equal<span class="main">)</span>

<span class="keyword1" id="Library_Additions-range_strict_mono_ext"><span class="command">lemma</span></span> range_strict_mono_ext<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>linorder"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="free">f</span> <span class="main">=</span> range <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sm<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"strict_mono <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq imageE rangeI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> less.IH neq_iff sm strict_mono_less xy<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Other material›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">strict_mono_sets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>order set<span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>order <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>order set<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">strict_mono_sets</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">⟶</span> less_sets <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Library_Additions-strict_mono_setsD"><span class="command">lemma</span></span> strict_mono_setsD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="free">A</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_mono_sets_def<span class="main">)</span>

<span class="keyword1" id="Library_Additions-strict_mono_on_o"><span class="command">lemma</span></span> strict_mono_on_o<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>strict_mono_on <span class="free">r</span> <span class="free">A</span><span class="main">;</span> strict_mono_on <span class="free">s</span> <span class="free">B</span><span class="main">;</span> <span class="free">s</span> <span class="main">`</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span> strict_mono_on <span class="main">(</span><span class="free">r</span> <span class="main">∘</span> <span class="free">s</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_subset_iff strict_mono_on_def<span class="main">)</span>

<span class="keyword1" id="Library_Additions-strict_mono_sets_imp_disjoint"><span class="command">lemma</span></span> strict_mono_sets_imp_disjoint<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linorder set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="free">A</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> disjnt <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_sets_def pairwise_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> antisym_conv3 disjnt_sym less_sets_imp_disjnt<span class="main">)</span>

<span class="keyword1" id="Library_Additions-strict_mono_sets_subset"><span class="command">lemma</span></span> strict_mono_sets_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="free">B</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="free">A</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_mono_sets_def<span class="main">)</span>

<span class="keyword1" id="Library_Additions-strict_mono_less_sets_Min"><span class="command">lemma</span></span> strict_mono_less_sets_Min<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="free">I</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Min <span class="free">I</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span>Min <span class="free">I</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_mono_sets_def less_sets_UN2 dual_order.strict_iff_order<span class="main">)</span>

<span class="keyword1" id="Library_Additions-pair_less_iff1"><span class="command">lemma</span></span> pair_less_iff1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> pair_less <span class="main">⟷</span> <span class="free">y</span><span class="main">&lt;</span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_less_def<span class="main">)</span>

<span class="keyword1" id="Library_Additions-infinite_finite_Inter"><span class="command">lemma</span></span> infinite_finite_Inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">𝒜</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">𝒜</span> <span class="main">⟹</span> infinite <span class="bound">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">A</span> <span class="main">∈</span> <span class="free">𝒜</span><span class="main">;</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free">𝒜</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free">𝒜</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="main">⋂</span><span class="free">𝒜</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms finite_Inf_in<span class="main">)</span>

<span class="keyword1" id="Library_Additions-atLeast_less_sets"><span class="command">lemma</span></span> atLeast_less_sets<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>less_sets <span class="free">A</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">;</span> <span class="free">B</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">x</span><span class="main">..}</span><span class="main">⟧</span> <span class="main">⟹</span> less_sets <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def subset_iff<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The list-of function›</span></span>

<span class="keyword1" id="Library_Additions-sorted_list_of_set_insert_cons"><span class="command">lemma</span></span> sorted_list_of_set_insert_cons<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="main">(</span>insert <span class="free">a</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">#</span> sorted_list_of_set <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span><span class="free">a</span> <span class="main">#</span> sorted_list_of_set <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms less_setsD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span><span class="free">a</span> <span class="main">#</span> sorted_list_of_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">a</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">a</span> <span class="main">#</span> sorted_list_of_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>insert <span class="free">a</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms card_insert_if less_setsD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> finite_insert sorted_list_of_set_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Library_Additions-sorted_list_of_set_Un"><span class="command">lemma</span></span> sorted_list_of_set_Un<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> sorted_list_of_set <span class="free">A</span> <span class="main">@</span> sorted_list_of_set <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>sorted_list_of_set <span class="free">A</span> <span class="main">@</span> sorted_list_of_set <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AB <span class="keyword1"><span class="command">unfolding</span></span> less_sets_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fin set_sorted_list_of_set sorted_wrt_append strict_sorted_list_of_set strict_sorted_sorted_wrt<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">+</span> card <span class="free">B</span> <span class="main">=</span> card <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_sets_imp_disjnt <span class="main">[</span><span class="operator">OF</span> AB<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms card_Un_disjoint disjnt_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms strict_sorted_equal<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Library_Additions-sorted_list_of_set_UN_lessThan"><span class="command">lemma</span></span> sorted_list_of_set_UN_lessThan<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sm<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span>sorted_list_of_set <span class="main">∘</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>sorted_list_of_set <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ls<span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sm Suc.prems<span class="main">(</span>1<span class="main">)</span> strict_mono_setsD <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_UN1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="main">{..&lt;</span>Suc <span class="skolem">k</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sorted_list_of_set <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="free">A</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_commute lessThan_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sorted_list_of_set <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> sorted_list_of_set <span class="main">(</span><span class="free">A</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sorted_list_of_set_Un<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc.prems ls<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span>sorted_list_of_set <span class="main">∘</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>sorted_list_of_set <span class="main">{..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> sorted_list_of_set <span class="main">(</span><span class="free">A</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc strict_mono_sets_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span>sorted_list_of_set <span class="main">∘</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>sorted_list_of_set <span class="main">{..&lt;</span>Suc <span class="skolem">k</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strict_mono_sets_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Library_Additions-sorted_list_of_set_UN_atMost"><span class="command">lemma</span></span> sorted_list_of_set_UN_atMost<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="main">{..</span><span class="free">k</span><span class="main">}</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span>sorted_list_of_set <span class="main">∘</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>sorted_list_of_set <span class="main">{..</span><span class="free">k</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms lessThan_Suc_atMost less_Suc_eq_le sorted_list_of_set_UN_lessThan<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Monotonic enumeration of a countably infinite set›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">enum</span> <span class="main">≡</span> enumerate"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Could be generalised to infinite countable sets of any type›</span></span>
<span class="keyword1" id="Library_Additions-nat_infinite_iff"><span class="command">lemma</span></span> nat_infinite_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">::</span>nat<span class="main">⇒</span>nat<span class="main">.</span> <span class="free">N</span> <span class="main">=</span> range <span class="bound">f</span> <span class="main">∧</span> strict_mono <span class="bound">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="free">N</span> <span class="main">=</span> range <span class="main">(</span><span class="bound">f</span><span class="main">::</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">∧</span> strict_mono <span class="bound">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_imp_surj_on bij_enumerate enumerate_mono strict_mono_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> range <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>range <span class="skolem">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> range_inj_infinite strict_mono_imp_inj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Library_Additions-enum_works"><span class="command">lemma</span></span> enum_works<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> range <span class="main">(</span>enum <span class="free">N</span><span class="main">)</span> <span class="main">∧</span> strict_mono <span class="main">(</span>enum <span class="free">N</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms bij_betw_imp_surj_on bij_enumerate enumerate_mono strict_monoI<span class="main">)</span>

<span class="keyword1" id="Library_Additions-range_enum"><span class="command">lemma</span></span> range_enum<span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>enum <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> strict_mono_enum<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono <span class="main">(</span>enum <span class="free">N</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword1"><span class="command">using</span></span> enum_works <span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Library_Additions-enum_0_eq_Inf"><span class="command">lemma</span></span> enum_0_eq_Inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"enum <span class="free">N</span> <span class="main">0</span> <span class="main">=</span> Inf <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enum <span class="free">N</span> <span class="main">0</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms range_enum <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟹</span> enum <span class="free">N</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> assms imageE le0 less_mono_imp_le_mono range_enum strict_monoD strict_mono_enum<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cInf_eq_minimum<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Library_Additions-enum_works_finite"><span class="command">lemma</span></span> enum_works_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> enum <span class="free">N</span> <span class="main">`</span> <span class="main">{..&lt;</span>card <span class="free">N</span><span class="main">}</span> <span class="main">∧</span> strict_mono_on <span class="main">(</span>enum <span class="free">N</span><span class="main">)</span> <span class="main">{..&lt;</span>card <span class="free">N</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_imp_surj_on finite_bij_enumerate finite_enumerate_mono lessThan_iff strict_mono_onI<span class="main">)</span>

<span class="keyword1" id="Library_Additions-enum_obtain_index_finite"><span class="command">lemma</span></span> enum_obtain_index_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">N</span>"</span></span> 
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">i</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> card <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> enum <span class="free">N</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">N</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">N</span>›</span></span> enum_works_finite imageE lessThan_iff<span class="main">)</span>

<span class="keyword1" id="Library_Additions-enum_0_eq_Inf_finite"><span class="command">lemma</span></span> enum_0_eq_Inf_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"enum <span class="free">N</span> <span class="main">0</span> <span class="main">=</span> Inf <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enum <span class="free">N</span> <span class="main">0</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.neq0_conv assms empty_is_image enum_works_finite image_eqI lessThan_empty_iff lessThan_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enum <span class="free">N</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> card <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> enum <span class="free">N</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">N</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">N</span>›</span></span> enum_obtain_index_finite<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.neq0_conv finite_enumerate_mono less_or_eq_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cInf_eq_minimum<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Library_Additions-greaterThan_less_enum"><span class="command">lemma</span></span> greaterThan_less_enum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">x</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> enum <span class="free">N</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms range_enum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Library_Additions-atLeast_le_enum"><span class="command">lemma</span></span> atLeast_le_enum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">x</span><span class="main">..}</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> enum <span class="free">N</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms range_enum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Library_Additions-less_sets_empty1"><span class="command">lemma</span></span> less_sets_empty1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="main">{}</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> less_sets_empty2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="free">A</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>

<span class="keyword1" id="Library_Additions-less_sets_singleton1"><span class="command">lemma</span></span> less_sets_singleton1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="free">A</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> less_sets_singleton2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="free">A</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>

<span class="keyword1" id="Library_Additions-less_sets_atMost"><span class="command">lemma</span></span> less_sets_atMost <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="main">{..</span><span class="free">a</span><span class="main">}</span> <span class="free">A</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> less_sets_alLeast <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"less_sets <span class="free">A</span> <span class="main">{</span><span class="free">a</span><span class="main">..}</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>

<span class="keyword1" id="Library_Additions-less_sets_imp_strict_mono_sets"><span class="command">lemma</span></span> less_sets_imp_strict_mono_sets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> less_sets <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> <span class="free">A</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_mono_sets UNIV <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_mono_sets_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="main">(</span><span class="free">A</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">-</span><span class="skolem">i</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_Suc Suc_inject Suc_mono assms less_Suc_eq less_sets_trans zero_less_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Library_Additions-less_sets_Suc_Max"><span class="command">lemma</span></span> less_sets_Suc_Max<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"less_sets <span class="free">A</span> <span class="main">{</span>Suc <span class="main">(</span>Max <span class="free">A</span><span class="main">)</span><span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms less_Suc_eq_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Library_Additions-infinite_nat_greaterThan"><span class="command">lemma</span></span> infinite_nat_greaterThan<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="free">N</span> <span class="main">∩</span> <span class="main">{</span><span class="free">m</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="main">-</span><span class="main">{</span><span class="free">m</span><span class="main">&lt;..}</span> <span class="main">∪</span> <span class="main">(</span><span class="free">N</span> <span class="main">∩</span> <span class="main">{</span><span class="free">m</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="free">m</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

    

</pre>
</div><div id="Partitions">
<div class="head">
<h1>Theory Partitions</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Ordinal Partitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Material from Jean A. Larson,
     A short proof of a partition theorem for the ordinal $\omega^\omega$.
     \emph{Annals of Mathematical Logic}, 6:129–-145, 1973.
Also from ``Partition Relations'' by A. Hajnal and J. A. Larson,
in \emph{Handbook of Set Theory}, edited by Matthew Foreman and Akihiro Kanamori
(Springer, 2010).›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Partitions
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Library_Additions">Library_Additions</a> <span class="quoted">"<a href="../../zfc_in_hol/theories/#ZFC_Typeclasses">ZFC_in_HOL.ZFC_Typeclasses</a>"</span> <span class="quoted">"<a href="../../zfc_in_hol/theories/#Cantor_NF">ZFC_in_HOL.Cantor_NF</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">tp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V set <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tp</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> ordertype <span class="free"><span class="bound"><span class="entity">A</span></span></span> VWF"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ordinal Partitions: Definitions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">partn_lst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">,</span> <span class="tfree">'a</span> set<span class="main">,</span> V list<span class="main">,</span> nat<span class="main">]</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">partn_lst</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">B</span></span></span>]<span class="hidden">⇗</span><sup><span class="free"><span class="bound"><span class="entity">n</span></span></span></sup><span class="hidden">⇖</span>  <span class="main">→</span>  <span class="main">{..&lt;</span>length <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">}</span><span class="main">.</span>
              <span class="main">∃</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">∧</span> ordertype <span class="bound">H</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">`</span> <span class="main">(</span>nsets <span class="bound">H</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">partn_lst_VWF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V list <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">partn_lst_VWF</span> <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="main">≡</span> partn_lst VWF <span class="main">(</span>elts <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Partitions-partn_lst_E"><span class="command">lemma</span></span> partn_lst_E<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"partn_lst <span class="free">r</span> <span class="free">B</span> <span class="free">α</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> nsets <span class="free">B</span> <span class="free">n</span> <span class="main">→</span>  <span class="main">{..&lt;</span><span class="free">l</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> length <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">i</span> <span class="free">H</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
                     <span class="quoted"><span class="quoted">"ordertype <span class="free">H</span> <span class="free">r</span> <span class="main">=</span> <span class="free">α</span><span class="main">!</span><span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="main">(</span>nsets <span class="free">H</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> partn_lst_def<span class="main">)</span>

<span class="keyword1" id="Partitions-partn_lst_VWF_nontriv"><span class="command">lemma</span></span> partn_lst_VWF_nontriv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="free">β</span> <span class="free">α</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> length <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">i</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">!</span><span class="free">i</span> <span class="main">≤</span> <span class="free">β</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="free">l</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> lessThan_empty_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> nsets <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="free">n</span>  <span class="main">→</span>  <span class="main">{..&lt;</span><span class="free">l</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Pi_eq_empty equals0I<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="skolem">H</span> <span class="main">=</span> <span class="free">α</span><span class="main">!</span><span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> partn_lst_E<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">!</span><span class="skolem">i</span> <span class="main">≤</span> <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">⊆</span> elts <span class="free">β</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> eq ordertype_le_Ord<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">l</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Partitions-partn_lst_triv0"><span class="command">lemma</span></span> partn_lst_triv0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst <span class="free">r</span> <span class="free">B</span> <span class="free">α</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> partn_lst_def assms bot_least image_empty nsets_empty_iff ordertype_empty<span class="main">)</span>

<span class="keyword1" id="Partitions-partn_lst_triv1"><span class="command">lemma</span></span> partn_lst_triv1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">!</span><span class="free">i</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst <span class="free">r</span> <span class="free">B</span> <span class="free">α</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> partn_lst_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms mem_0_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> 01<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">α</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_V_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span><span class="free">B</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>length <span class="free">α</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">{</span><span class="skolem">γ</span><span class="main">}</span> <span class="free">r</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="main">{</span><span class="skolem">γ</span><span class="main">}</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span>"</span></span>
                  <span class="quoted"><span class="quoted">"ordertype <span class="main">{}</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="main">{}</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_V_def ordertype_insert nsets_eq_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms 01 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">α</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">H</span></span><span class="main">⊆</span><span class="free">B</span><span class="main">.</span> ordertype <span class="bound">H</span> <span class="free">r</span> <span class="main">=</span> <span class="free">α</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">γ</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Partitions-partn_lst_two_swap"><span class="command">lemma</span></span> partn_lst_two_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"partn_lst <span class="free">r</span> <span class="free">B</span> <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst <span class="free">r</span> <span class="free">B</span> <span class="main">[</span><span class="free">y</span><span class="main">,</span><span class="free">x</span><span class="main">]</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> nat"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span><span class="free">B</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span><span class="free">B</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Pi_def<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">H</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>nsets <span class="skolem">H</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> partn_lst_E <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms f'<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">[</span><span class="skolem">H</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> f that <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> nsets_mono  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Pi_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">H</span> <span class="free">r</span> <span class="main">=</span> <span class="main">[</span><span class="free">y</span><span class="main">,</span><span class="free">x</span><span class="main">]</span> <span class="main">!</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="skolem">H</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">-</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_nat_numeral less_Suc_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="bound">H</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span> <span class="main">∧</span> <span class="bound">H</span><span class="main">⊆</span><span class="free">B</span> <span class="main">∧</span> ordertype <span class="bound">H</span> <span class="free">r</span> <span class="main">=</span> <span class="main">[</span><span class="free">y</span><span class="main">,</span><span class="free">x</span><span class="main">]</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_1 <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> diff_less_Suc<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> partn_lst_def eval_nat_numeral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Partitions-partn_lst_greater_resource"><span class="command">lemma</span></span> partn_lst_greater_resource<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"partn_lst <span class="free">r</span> <span class="free">B</span> <span class="free">α</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst <span class="free">r</span> <span class="free">C</span> <span class="free">α</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> partn_lst_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span><span class="free">C</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>length <span class="free">α</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span><span class="free">B</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>length <span class="free">α</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span>›</span></span> part_fn_def part_fn_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">α</span>"</span></span>
                   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">H</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="free">α</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
                   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> nsets <span class="skolem">H</span> <span class="free">n</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> M partn_lst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">α</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">H</span></span><span class="main">⊆</span><span class="free">C</span><span class="main">.</span> ordertype <span class="bound">H</span> <span class="free">r</span> <span class="main">=</span> <span class="free">α</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Partitions-partn_lst_less"><span class="command">lemma</span></span> partn_lst_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"partn_lst <span class="free">r</span> <span class="free">B</span> <span class="free">α</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">α'</span> <span class="main">=</span> length <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"List.set <span class="free">α'</span> <span class="main">⊆</span> ON"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">α</span> <span class="main">⟹</span> <span class="free">α'</span><span class="main">!</span><span class="bound">i</span> <span class="main">≤</span> <span class="free">α</span><span class="main">!</span><span class="bound">i</span> "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">B</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst <span class="free">r</span> <span class="free">B</span> <span class="free">α'</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> partn_lst_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span><span class="free">B</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>length <span class="free">α'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">α</span>"</span></span>
                   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="skolem">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">H</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="free">α</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
                   <span class="keyword2"><span class="keyword">and</span></span> fi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> nsets <span class="skolem">H</span> <span class="free">n</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> partn_lst_def smaller_than_small<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ordermap <span class="skolem">H</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">(</span>elts <span class="main">(</span><span class="free">α</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordermap_bij <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="skolem">H</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> in_mono r<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> r<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> smaller_than_small total_on_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H'</span> <span class="main">=</span> inv_into <span class="skolem">H</span> <span class="main">(</span>ordermap <span class="skolem">H</span> <span class="free">r</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>elts <span class="main">(</span><span class="free">α'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H'</span> <span class="main">⊆</span> <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">α</span>›</span></span> bij_betw_imp_surj_on le
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H'_def image_subset_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inv_into_into<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> ot<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">H'</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="free">α'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ordertype_eq_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="free">α'</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">α</span>›</span></span> subset_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="skolem">H'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H'_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="skolem">H'</span> <span class="main">(</span>elts <span class="main">(</span><span class="free">α'</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">H'</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">H'</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI ballI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ordermap <span class="skolem">H</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">H'</span> <span class="main">(</span>elts <span class="main">(</span><span class="free">α'</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">H'</span> <span class="main">⊆</span> <span class="skolem">H</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H'_def <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">α</span>›</span></span> bij bij_betw_inv_into_RIGHT bij_betw_subset le less_eq_V_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ordermap <span class="skolem">H</span> <span class="free">r</span> <span class="skolem">x</span> <span class="main">&lt;</span> ordermap <span class="skolem">H</span> <span class="free">r</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">H'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">H'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI ordermap_mono_less<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="skolem">H</span> <span class="free">r</span> <span class="skolem">x</span> <span class="main">&lt;</span> ordermap <span class="skolem">H</span> <span class="free">r</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> calculation in_mono leD ordermap_mono_le r smaller_than_small that total_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms that <span class="quoted"><span class="quoted">‹<span class="skolem">H'</span> <span class="main">⊆</span> <span class="skolem">H</span>›</span></span> <span class="quoted"><span class="quoted">‹small <span class="skolem">H</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"total_on <span class="skolem">H'</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">H'</span> <span class="main">⊆</span> <span class="skolem">H</span>›</span></span> subsetD total_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> r <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">α'</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">H</span></span><span class="main">⊆</span><span class="free">B</span><span class="main">.</span> ordertype <span class="bound">H</span> <span class="free">r</span> <span class="main">=</span> <span class="free">α'</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">α</span>›</span></span> fi assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_mono nsets_mono subset_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Holds because no $n$-sets exist!›</span></span>
<span class="keyword1" id="Partitions-partn_lst_VWF_degenerate"><span class="command">lemma</span></span> partn_lst_VWF_degenerate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst_VWF ω <span class="main">(</span>ord_of_nat <span class="free">k</span> <span class="main">#</span> <span class="free">αs</span><span class="main">)</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> partn_lst_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V set <span class="main">⇒</span> nat"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>elts <span class="main">(</span>ord_of_nat <span class="free">k</span><span class="main">)</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nsets_eq_empty assms finite_Ord_omega<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span>elts <span class="main">(</span>ord_of_nat <span class="free">k</span><span class="main">)</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">αs</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">H</span></span><span class="main">⊆</span>elts ω<span class="main">.</span> tp <span class="bound">H</span> <span class="main">=</span> <span class="main">(</span>ord_of_nat <span class="free">k</span> <span class="main">#</span> <span class="free">αs</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ordertype_eq_Ord <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="free">k</span>"</span></span><span class="main">]</span> elts_ord_of_nat less_Suc_eq_0_disj
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Partitions-partn_lst_VWF_ω_2"><span class="command">lemma</span></span> partn_lst_VWF_ω_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="main">(</span>ω <span class="main">↑</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="numeral">2</span><span class="main">,</span> ω <span class="main">↑</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">α</span><span class="main">)</span><span class="main">]</span> <span class="numeral">2</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span>  <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="var">?β</span> <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> partn_lst_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span>elts <span class="var">?β</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">H</span></span><span class="main">⊆</span>elts <span class="var">?β</span><span class="main">.</span> tp <span class="bound">H</span> <span class="main">=</span> <span class="main">[</span><span class="numeral">2</span><span class="main">,</span> <span class="var">?β</span><span class="main">]</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> elts <span class="var">?β</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> elts <span class="var">?β</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">∧</span> <span class="skolem">f</span><span class="main">{</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="var">?β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="var">?β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span> <span class="main">⊆</span> elts <span class="var">?β</span>"</span></span> <span class="quoted"><span class="quoted">"tp <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral ordertype_VWF_finite_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nth_Cons_0 zero_less_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> f <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>elts <span class="var">?β</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>elts <span class="var">?β</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="main">{</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Pi_iff <span class="keyword1"><span class="command">using</span></span> lessThan_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span>elts <span class="var">?β</span><span class="main">)</span> <span class="main">=</span> <span class="var">?β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span>elts <span class="var">?β</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span>Suc <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms nsets_2_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lessI nth_Cons_0 nth_Cons_Suc subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relating partition properties on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">VWF</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to the general case›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Two very similar proofs here!›</span></span>

<span class="keyword1" id="Partitions-partn_lst_imp_partn_lst_VWF_eq"><span class="command">lemma</span></span> partn_lst_imp_partn_lst_VWF_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> part<span class="main">:</span> <span class="quoted"><span class="quoted">"partn_lst <span class="free">r</span> <span class="free">U</span> <span class="free">α</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="free">U</span> <span class="free">r</span> <span class="main">=</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">U</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">U</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="free">β</span> <span class="free">α</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> partn_lst_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span>elts <span class="free">β</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>length <span class="free">α</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cv</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cv</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">X</span><span class="main">.</span> ordermap <span class="free">U</span> <span class="free">r</span> <span class="main">`</span> <span class="bound">X</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ordermap <span class="free">U</span> <span class="free">r</span><span class="main">)</span> <span class="free">U</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordermap_bij <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">r</span>"</span></span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bij_cv<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">cv</span> <span class="main">(</span><span class="main">[</span><span class="free">U</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">(</span><span class="main">[</span>elts <span class="free">β</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_betw_nsets cv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> func<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">cv</span> <span class="main">∈</span> <span class="main">[</span><span class="free">U</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>length <span class="free">α</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>ordermap <span class="free">U</span> <span class="free">r</span><span class="main">)</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij bij_betw_def bij_betw_apply f <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cv_part<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">cv</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">;</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="free">U</span><span class="main">;</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">cv</span> <span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">X</span> <span class="skolem">i</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cv_def nsets_def subset_image_iff inj_on_subset finite_image_iff card_image<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ot_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">cv</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> ordertype <span class="skolem">X</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
    <span class="keyword1"><span class="command">unfolding</span></span> cv_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_inc_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">U</span> <span class="free">r</span> <span class="skolem">u</span> <span class="main">&lt;</span> ordermap <span class="free">U</span> <span class="free">r</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms ordermap_mono_less subset_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ordermap <span class="free">U</span> <span class="free">r</span> <span class="skolem">u</span><span class="main">,</span> ordermap <span class="free">U</span> <span class="free">r</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"total_on <span class="skolem">X</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> total_on_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹small <span class="free">U</span>›</span></span> smaller_than_small that<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">X</span> <span class="free">r</span> <span class="main">=</span> <span class="free">α</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">cv</span><span class="main">)</span> <span class="main">`</span> <span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> part func <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> partn_lst_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">α</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">H</span></span><span class="main">⊆</span>elts <span class="free">β</span><span class="main">.</span> tp <span class="bound">H</span> <span class="main">=</span> <span class="free">α</span><span class="main">!</span><span class="bound">i</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">α</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">α</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cv</span> <span class="skolem">X</span> <span class="main">⊆</span> elts <span class="free">β</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> bij bij_betw_imp_surj_on cv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">cv</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="skolem">cv</span> <span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> X <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> cv_part <span class="keyword1"><span class="command">unfolding</span></span> image_subset_iff cv_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_apply insertCI singletonD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Partitions-partn_lst_imp_partn_lst_VWF"><span class="command">lemma</span></span> partn_lst_imp_partn_lst_VWF<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> part<span class="main">:</span> <span class="quoted"><span class="quoted">"partn_lst <span class="free">r</span> <span class="free">U</span> <span class="free">α</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="free">U</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">U</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">U</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="free">β</span> <span class="free">α</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms less_eq_V_def partn_lst_imp_partn_lst_VWF_eq partn_lst_greater_resource<span class="main">)</span>

<span class="keyword1" id="Partitions-partn_lst_VWF_imp_partn_lst_eq"><span class="command">lemma</span></span> partn_lst_VWF_imp_partn_lst_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> part<span class="main">:</span> <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="free">β</span> <span class="free">α</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="free">U</span> <span class="free">r</span> <span class="main">=</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">U</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">U</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst <span class="free">r</span> <span class="free">U</span> <span class="free">α</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> partn_lst_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span><span class="free">U</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>length <span class="free">α</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cv</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cv</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">X</span><span class="main">.</span> inv_into <span class="free">U</span> <span class="main">(</span>ordermap <span class="free">U</span> <span class="free">r</span><span class="main">)</span> <span class="main">`</span> <span class="bound">X</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ordermap <span class="free">U</span> <span class="free">r</span><span class="main">)</span> <span class="free">U</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordermap_bij <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">r</span>"</span></span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bij_cv<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">cv</span> <span class="main">(</span><span class="main">[</span>elts <span class="free">β</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">(</span><span class="main">[</span><span class="free">U</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_betw_nsets bij_betw_inv_into <span class="keyword1"><span class="command">unfolding</span></span> cv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> func<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">cv</span> <span class="main">∈</span> <span class="main">[</span>elts <span class="free">β</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>length <span class="free">α</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_betw_apply f <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>ordermap <span class="free">U</span> <span class="free">r</span><span class="main">)</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cv_part<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">cv</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">;</span> <span class="skolem">X</span> <span class="main">⊆</span> elts <span class="free">β</span><span class="main">;</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">cv</span> <span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">X</span> <span class="skolem">i</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cv_def nsets_def subset_image_iff inj_on_subset finite_image_iff card_image<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij bij_betw_def card_image inj_on_finite inj_on_inv_into subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ot_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">cv</span> <span class="skolem">X</span><span class="main">)</span> <span class="free">r</span> <span class="main">=</span> tp <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
    <span class="keyword1"><span class="command">unfolding</span></span> cv_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_inc_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> down that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv_into <span class="free">U</span> <span class="main">(</span>ordermap <span class="free">U</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">x</span><span class="main">,</span> inv_into <span class="free">U</span> <span class="main">(</span>ordermap <span class="free">U</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ordermap <span class="free">U</span> <span class="free">r</span> <span class="main">`</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> ordermap <span class="free">U</span> <span class="free">r</span> <span class="main">`</span> <span class="free">U</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> elts <span class="free">β</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> bij bij_betw_imp_surj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ordermap <span class="free">U</span> <span class="free">r</span> <span class="main">(</span>inv_into <span class="free">U</span> <span class="main">(</span>ordermap <span class="free">U</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">U</span> <span class="free">r</span> <span class="main">(</span>inv_into <span class="free">U</span> <span class="main">(</span>ordermap <span class="free">U</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> f_inv_into_f<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> elts <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> VWF_non_refl mem_imp_VWF that<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> trans_VWF trans_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> VWF_non_refl xy eq assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inv_into_into ordermap_mono r<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> r<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> total_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> r <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="skolem">X</span> <span class="main">=</span> <span class="free">α</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">cv</span><span class="main">)</span> <span class="main">`</span> <span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> part func <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> partn_lst_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">α</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">H</span></span><span class="main">⊆</span><span class="free">U</span><span class="main">.</span> ordertype <span class="bound">H</span> <span class="free">r</span> <span class="main">=</span> <span class="free">α</span><span class="main">!</span><span class="bound">i</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">α</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">α</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cv</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> elts <span class="free">β</span>›</span></span> bij bij_betw_imp_surj_on bij_betw_inv_into cv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">cv</span> <span class="skolem">X</span><span class="main">)</span> <span class="free">r</span> <span class="main">=</span> <span class="free">α</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> elts <span class="free">β</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="skolem">cv</span> <span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> X <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> elts <span class="free">β</span>›</span></span> cv_part <span class="keyword1"><span class="command">unfolding</span></span> image_subset_iff cv_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_apply insertCI singletonD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> partn_lst_VWF_imp_partn_lst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="free">β</span> <span class="free">α</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="free">U</span> <span class="free">r</span> <span class="main">≥</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">U</span>"</span></span> 
          <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">U</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst <span class="free">r</span> <span class="free">U</span> <span class="free">α</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms less_eq_V_def partn_lst_VWF_imp_partn_lst_eq partn_lst_greater_resource<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Simple consequences of the definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A restatement of the infinite Ramsey theorem using partition notation›</span></span>
<span class="keyword1" id="Partitions-Ramsey_partn"><span class="command">lemma</span></span> Ramsey_partn<span class="main">:</span> <span class="quoted"><span class="quoted">"partn_lst_VWF ω <span class="main">[</span>ω<span class="main">,</span>ω<span class="main">]</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> partn_lst_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span>elts ω]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>elts ω<span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>elts ω<span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="main">{</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">}</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def eval_nat_numeral<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> elts ω"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> teq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">H</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">H</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="main">{</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ramsey2 <span class="main">[</span><span class="operator">OF</span> infinite_ω *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">H</span> <span class="main">=</span> <span class="main">[</span>ω<span class="main">,</span> ω<span class="main">]</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_2_cases eval_nat_numeral ordertype_infinite_ω <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> <span class="bound">N</span> <span class="main">⊆</span> <span class="skolem">H</span> <span class="main">∧</span> finite <span class="bound">N</span> <span class="main">∧</span> card <span class="bound">N</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> teq card_2_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="skolem">H</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> nsets_def numeral_2_eq_2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">H</span></span><span class="main">⊆</span>elts ω<span class="main">.</span> tp <span class="bound">H</span> <span class="main">=</span> <span class="main">[</span>ω<span class="main">,</span>ω<span class="main">]</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> H <span class="quoted"><span class="quoted">‹tp <span class="skolem">H</span> <span class="main">=</span> <span class="main">[</span>ω<span class="main">,</span> ω<span class="main">]</span> <span class="main">!</span> <span class="skolem">i</span>›</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is the counterexample sketched in Hajnal and Larson, section 9.1.›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> omega_basic_counterexample<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> partn_lst_VWF <span class="free">α</span> <span class="main">[</span>succ <span class="main">(</span>vcard <span class="free">α</span><span class="main">)</span><span class="main">,</span> ω<span class="main">]</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">π</span></span> <span class="keyword2"><span class="keyword">where</span></span> funπ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">∈</span> elts <span class="free">α</span> <span class="main">→</span> elts <span class="main">(</span>vcard <span class="free">α</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> injπ<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">π</span> <span class="main">(</span>elts <span class="free">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_into_vcard <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Ordπ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="skolem">π</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord funπ that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">A</span> <span class="main">≡</span> <span class="main">@</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">π</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">π</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">π</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">π</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span>
  <span class="keyword1"><span class="command">have</span></span> f_Pi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span>elts <span class="free">α</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="main">[</span>elts <span class="free">α</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_2_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_in_Ord Ord_linear_lt assms insert_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">π</span> <span class="skolem">y</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">π</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ordπ Ord_linear_lt injπ inj_onD less_imp_not_eq2 xy<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">A</span> <span class="main">∈</span> <span class="main">{..&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A One_nat_def lessI lessThan_iff zero_less_Suc <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>›</span></span> A exE_some <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ f_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> fiff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">π</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">i</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">π</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">π</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">i</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">π</span> <span class="skolem">y</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">π</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ordπ Ord_linear_lt injπ inj_onD less_V_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def Set.doubleton_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def Set.doubleton_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
    <span class="keyword2"><span class="keyword">if</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="skolem">H</span> <span class="main">=</span> succ <span class="main">(</span>vcard <span class="free">α</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> elts <span class="free">α</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">H</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">H</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="skolem">H</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H down <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> OH<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">H</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> H Ord_in_Ord <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">π</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">using</span></span> 0 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>"</span></span><span class="main">]</span> that H fiff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_2_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> sub_vcard<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">`</span> <span class="skolem">H</span> <span class="main">⊆</span> elts <span class="main">(</span>vcard <span class="free">α</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H funπ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">H</span> <span class="main">=</span> tp <span class="main">(</span><span class="skolem">π</span> <span class="main">`</span> <span class="skolem">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_VWF_inc_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">`</span> <span class="skolem">H</span> <span class="main">⊆</span> ON"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H Ordπ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> π OH subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> vcard <span class="free">α</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H sub_vcard assms ordertype_le_Ord<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq succ_le_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
    <span class="keyword2"><span class="keyword">if</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="skolem">H</span> <span class="main">=</span> ω"</span></span> <span class="keyword2"><span class="keyword">and</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> elts <span class="free">α</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">H</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="bound">A</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">H</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="skolem">H</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H down <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">η</span> <span class="main">≡</span> inv_into <span class="skolem">H</span> <span class="main">(</span>ordermap <span class="skolem">H</span> VWF<span class="main">)</span> <span class="main">∘</span> ord_of_nat"</span></span>
    <span class="keyword1"><span class="command">have</span></span> bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ordermap <span class="skolem">H</span> VWF<span class="main">)</span> <span class="skolem">H</span> <span class="main">(</span>elts ω<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordermap_bij <span class="quoted"><span class="quoted">‹small <span class="skolem">H</span>›</span></span> eq total_on_VWF wf_VWF<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>inv_into <span class="skolem">H</span> <span class="main">(</span>ordermap <span class="skolem">H</span> VWF<span class="main">)</span><span class="main">)</span> <span class="main">(</span>elts ω<span class="main">)</span> <span class="skolem">H</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_inv_into<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> η<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">η</span> UNIV <span class="skolem">H</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> η_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ω_def bij_betw_comp_iff2 bij_betw_def elts_of_set inf inj_ord_of_nat order_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> Ordη<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="skolem">η</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> H Ord_in_Ord UNIV_I η assms bij_betw_apply subsetD<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="skolem">η</span><span class="main">)</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="skolem">η</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∉</span> VWF"</span></span>
      <span class="keyword1"><span class="command">using</span></span> wf_VWF wf_iff_no_infinite_down_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">π</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>"</span></span><span class="main">]</span> that H fiff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_2_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">η</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">η</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">η</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">,</span> <span class="skolem">η</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∈</span> VWF <span class="main">∨</span> <span class="skolem">η</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">η</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that Ordη Ord_mem_iff_lt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="skolem">H</span> VWF <span class="main">(</span><span class="skolem">η</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ordermap <span class="skolem">H</span> VWF <span class="main">(</span><span class="skolem">η</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> η <span class="quoted"><span class="quoted">‹small <span class="skolem">H</span>›</span></span> bij_betw_imp_surj_on ordermap_mono_le rangeI trans_VWF wf_VWF<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="skolem">H</span> VWF <span class="main">(</span><span class="skolem">η</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> succ <span class="main">(</span>ord_of_nat <span class="skolem">k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> η_def <span class="keyword1"><span class="command">using</span></span> bij bij_betw_inv_into_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="skolem">H</span> VWF <span class="main">(</span><span class="skolem">η</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> ord_of_nat <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> η_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bij bij_betw_inv_into_right ord_of_nat_ω<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="main">(</span>ord_of_nat <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> ord_of_nat <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_V_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">η</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">η</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ordη Ord_linear_lt dual_order.strict_implies_order eq_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="skolem">η</span><span class="main">)</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="skolem">η</span><span class="main">)</span><span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> π η bij_betw_apply <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> k
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H Ordπ UNIV_I VWF_iff_Ord_less η bij_betw_imp_surj_on image_subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partn_lst_def image_subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f_Pi less_2_cases nth_Cons_0 nth_Cons_Suc numeral_2_eq_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Specker's theorem›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">form_split</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat<span class="main">,</span>nat<span class="main">,</span>nat<span class="main">,</span>nat<span class="main">,</span>nat<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">form_split</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∨</span>
                                    <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">=</span><span class="main">1</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∨</span>
                                    <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">=</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∨</span>
                                    <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">=</span><span class="numeral">3</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">form</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span>nat<span class="main">*</span>nat<span class="main">)</span>set<span class="main">,</span> nat<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">form</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> form_split <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">scheme</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span>nat<span class="main">*</span>nat<span class="main">)</span>set<span class="main">]</span> <span class="main">⇒</span> nat set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">scheme</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≡</span> fst <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∪</span> snd <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">UU</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">*</span>nat<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">UU</span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Partitions-ordertype_UNIV_ω2"><span class="command">lemma</span></span> ordertype_UNIV_ω2<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype UNIV pair_less <span class="main">=</span> ω<span class="main">↑</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ordertype_Times <span class="main">[</span><span class="operator">of</span> <span class="quasi_keyword">concl</span><span class="main"><span class="main">:</span></span> <span class="quoted">UNIV</span> <span class="quoted">UNIV</span> <span class="quoted">less_than</span> <span class="quoted">less_than</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> total_less_than pair_less_def ordertype_nat_ω numeral_2_eq_2<span class="main">)</span>

<span class="keyword1" id="Partitions-ordertype_UU_ge_ω2"><span class="command">lemma</span></span> ordertype_UU_ge_ω2<span class="main">:</span>  <span class="quoted"><span class="quoted">"ordertype UNIV pair_less <span class="main">≤</span> ordertype UU pair_less"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_inc_le<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">π</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span> Suc <span class="main">(</span><span class="bound">m</span><span class="main">+</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">x</span><span class="main">::</span>nat <span class="main">×</span> nat<span class="main">)</span><span class="main">,</span> <span class="skolem">π</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> pair_less"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> pair_less"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> π_def pair_less_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">π</span> <span class="main">⊆</span> UU"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> π_def UU_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Partitions-ordertype_UU_ω2"><span class="command">lemma</span></span> ordertype_UU_ω2<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype UU pair_less <span class="main">=</span> ω<span class="main">↑</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_iff ordertype_UNIV_ω2 ordertype_UU_ge_ω2 ordertype_mono small top_greatest trans_pair_less wf_pair_less<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 2.3 of Jean A. Larson,
     A short proof of a partition theorem for the ordinal $\omega^\omega$.
     \emph{Annals of Mathematical Logic}, 6:129–-145, 1973.›</span></span>
<span class="keyword1" id="Partitions-lemma_2_3"><span class="command">lemma</span></span> lemma_2_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> set <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">N</span> <span class="free">js</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">u</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">k</span> <span class="main">&lt;</span> <span class="numeral">4</span><span class="main">;</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">;</span> form <span class="bound">u</span> <span class="bound">k</span><span class="main">;</span> scheme <span class="bound">u</span> <span class="main">⊆</span> <span class="free">N</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">u</span> <span class="main">=</span> <span class="free">js</span><span class="main">!</span><span class="bound">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f_less2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">{</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">}</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> UU"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> UU"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">}</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nsets_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pi_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f0</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">::</span>nat set<span class="main">.</span> <span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">&lt;</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">&lt;</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">&lt;</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f0</span> <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">}</span> <span class="main">=</span> <span class="free">f</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
    <span class="keyword1"><span class="command">unfolding</span></span> f0_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI2 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">a</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">c</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">d</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insert_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f0</span> <span class="skolem">X</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">4</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ordered_nsets_4_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f0 f_less2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> UU_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span> <span class="bound">t</span><span class="main">.</span> infinite <span class="bound">N</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>
            <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">N</span> <span class="main">∧</span> finite <span class="bound">X</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">⟶</span> <span class="skolem">f0</span> <span class="bound">X</span> <span class="main">=</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ramsey <span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span> <span class="quoted"><span class="numeral">4</span></span> <span class="quoted"><span class="skolem">f0</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N0</span></span> <span class="skolem"><span class="skolem">j0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">N0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> N0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">N0</span>]<span class="hidden">⇗</span><sup><span class="numeral">4</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> <span class="skolem">f0</span> <span class="bound">A</span> <span class="main">=</span> <span class="skolem">j0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">::</span>nat set<span class="main">.</span> <span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">&lt;</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">&lt;</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">&lt;</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">}</span> <span class="main">=</span> <span class="free">f</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
    <span class="keyword1"><span class="command">unfolding</span></span> f1_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI2 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">a</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">c</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">d</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insert_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="skolem">X</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">4</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ordered_nsets_4_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 f_less2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> UU_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">N</span> <span class="main">⊆</span> <span class="skolem">N0</span> <span class="main">∧</span> infinite <span class="bound">N</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>
            <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">N</span> <span class="main">∧</span> finite <span class="bound">X</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">⟶</span> <span class="skolem">f1</span> <span class="bound">X</span> <span class="main">=</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N0</span>›</span></span> Ramsey <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">N0</span></span> <span class="quoted"><span class="numeral">4</span></span> <span class="quoted"><span class="skolem">f1</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N1</span></span> <span class="skolem"><span class="skolem">j1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N1</span> <span class="main">⊆</span> <span class="skolem">N0</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">N1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j1</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> N1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">N1</span>]<span class="hidden">⇗</span><sup><span class="numeral">4</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> <span class="skolem">f1</span> <span class="bound">A</span> <span class="main">=</span> <span class="skolem">j1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">::</span>nat set<span class="main">.</span> <span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">&lt;</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">&lt;</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">&lt;</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span> <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">}</span> <span class="main">=</span> <span class="free">f</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
    <span class="keyword1"><span class="command">unfolding</span></span> f2_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI2 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">a</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">d</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">c</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insert_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span> <span class="skolem">X</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">4</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ordered_nsets_4_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 f_less2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> UU_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">N</span> <span class="main">⊆</span> <span class="skolem">N1</span> <span class="main">∧</span> infinite <span class="bound">N</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>
            <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">N</span> <span class="main">∧</span> finite <span class="bound">X</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">⟶</span> <span class="skolem">f2</span> <span class="bound">X</span> <span class="main">=</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N1</span>›</span></span> Ramsey <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">N1</span></span> <span class="quoted"><span class="numeral">4</span></span> <span class="quoted"><span class="skolem">f2</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N2</span></span> <span class="skolem"><span class="skolem">j2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N2</span> <span class="main">⊆</span> <span class="skolem">N1</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">N2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j2</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> N2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">N2</span>]<span class="hidden">⇗</span><sup><span class="numeral">4</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> <span class="skolem">f2</span> <span class="bound">A</span> <span class="main">=</span> <span class="skolem">j2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">::</span>nat set<span class="main">.</span> <span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">&lt;</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">&lt;</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">}</span> <span class="main">=</span> <span class="free">f</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
    <span class="keyword1"><span class="command">unfolding</span></span> f3_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI2 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">a</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">a</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">c</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insert_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> f3'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">}</span> <span class="main">=</span> <span class="free">f</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
    <span class="keyword1"><span class="command">using</span></span> f3 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="skolem">X</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">3</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ordered_nsets_3_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f3 f_less2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> UU_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">N</span> <span class="main">⊆</span> <span class="skolem">N2</span> <span class="main">∧</span> infinite <span class="bound">N</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>
            <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">N</span> <span class="main">∧</span> finite <span class="bound">X</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">⟶</span> <span class="skolem">f3</span> <span class="bound">X</span> <span class="main">=</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N2</span>›</span></span> Ramsey <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">N2</span></span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="skolem">f3</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N3</span></span> <span class="skolem"><span class="skolem">j3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N3</span> <span class="main">⊆</span> <span class="skolem">N2</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">N3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j3</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> N3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">N3</span>]<span class="hidden">⇗</span><sup><span class="numeral">3</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> <span class="skolem">f3</span> <span class="bound">A</span> <span class="main">=</span> <span class="skolem">j3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">u</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="numeral">4</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"form <span class="skolem">u</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"scheme <span class="skolem">u</span> <span class="main">⊆</span> <span class="skolem">N3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> UU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>0<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">j0</span><span class="main">,</span><span class="skolem">j1</span><span class="main">,</span><span class="skolem">j2</span><span class="main">,</span><span class="skolem">j3</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N3</span> <span class="main">⊆</span> <span class="skolem">N0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N1</span> <span class="main">⊆</span> <span class="skolem">N0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N2</span> <span class="main">⊆</span> <span class="skolem">N1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N3</span> <span class="main">⊆</span> <span class="skolem">N2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> u 0
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> form_def form_split_def scheme_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> f0<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> N0<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N3</span> <span class="main">⊆</span> <span class="skolem">N1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N2</span> <span class="main">⊆</span> <span class="skolem">N1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N3</span> <span class="main">⊆</span> <span class="skolem">N2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> u 1
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> form_def form_split_def scheme_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> f1<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> N1<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> u <span class="quoted"><span class="quoted">‹<span class="skolem">N3</span> <span class="main">⊆</span> <span class="skolem">N2</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> form_def form_split_def scheme_def nsets_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> f2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> N2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 3
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">d</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">N3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">N3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="skolem">N3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> UU_def nsets_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">j3</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> *
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> neq_iff <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> f3 f3'<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> N3<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> u UU 3
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> form_def form_split_def scheme_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N3</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 2.4 of Jean A. Larson, ibid.›</span></span>
<span class="keyword1" id="Partitions-lemma_2_4"><span class="command">lemma</span></span> lemma_2_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="numeral">4</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">M</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="free">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> form <span class="bound">u</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="free">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> scheme <span class="bound">u</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> UNIV <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bij_enumerate enumerate_mono strict_monoI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">f</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_mono_eq strict_mono_less<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> bij_betw_apply <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">f</span> UNIV <span class="free">N</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M0</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span> <span class="skolem">f</span><span class="main">(</span>Suc<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">f</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">f</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">m</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M3</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">,</span> <span class="skolem">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>0<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">=</span><span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span><span class="main">,</span> <span class="skolem">f</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M0</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M0_def nsets_def card_image UU_def image_subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">::</span><span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> set<span class="main">)</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M0</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">M0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">M0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_2_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ueq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">i</span><span class="main">)</span><span class="main">,</span> <span class="skolem">f</span><span class="main">(</span>Suc<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">j</span><span class="main">)</span><span class="main">,</span> <span class="skolem">f</span><span class="main">(</span>Suc<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M0_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> insert_commute less_linear<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>›</span></span> less_imp_le_nat<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"form <span class="skolem">u</span> <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 0 form_def form_split_def nsets_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"scheme <span class="skolem">u</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ueq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scheme_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">f</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M1</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M1_def nsets_def card_image UU_def image_subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">::</span><span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> set<span class="main">)</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M1</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">M1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">M1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_2_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ueq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">,</span> <span class="skolem">f</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">j</span><span class="main">,</span> <span class="skolem">f</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M1_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> insert_commute less_linear<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"form <span class="skolem">u</span> <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 form_def form_split_def nsets_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iff<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nat_add_left_cancel_less nat_less_le trans_less_add1<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"scheme <span class="skolem">u</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ueq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scheme_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">f</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">m</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M2</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M2_def nsets_def card_image UU_def image_subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">::</span><span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> set<span class="main">)</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M2</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">M2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">M2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_2_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ueq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">,</span> <span class="skolem">f</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">m</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">j</span><span class="main">,</span> <span class="skolem">f</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">m</span><span class="main">-</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M2_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> insert_commute less_linear<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"form <span class="skolem">u</span> <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 2 form_def form_split_def nsets_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_imp_le_nat<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"scheme <span class="skolem">u</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ueq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scheme_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">,</span> <span class="skolem">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M3</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M3_def nsets_def card_image UU_def image_subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">::</span><span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> set<span class="main">)</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M3</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">M3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">M3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_2_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ueq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">,</span> <span class="skolem">f</span><span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">,</span> <span class="skolem">f</span><span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M3_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> insert_commute less_linear<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"form <span class="skolem">u</span> <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 3 form_def form_split_def nsets_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"scheme <span class="skolem">u</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ueq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scheme_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 2.5 of Jean A. Larson, ibid.›</span></span>
<span class="keyword1" id="Partitions-lemma_2_5"><span class="command">lemma</span></span> lemma_2_5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">X</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> UU"</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">X</span> pair_less <span class="main">=</span> ω<span class="main">↑</span><span class="numeral">2</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="free">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">.</span> form <span class="bound">u</span> <span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> scheme <span class="bound">u</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> dis<span class="main">:</span> <span class="quoted"><span class="quoted">"pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> disjnt <span class="main">(</span><span class="skolem">C</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">C</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">C</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> infC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> infinite <span class="main">(</span><span class="skolem">C</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms infinite_infinite_partition <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">φ</span><span class="main">::</span>nat <span class="main">⇒</span> nat<span class="main">.</span> inj <span class="bound">φ</span> <span class="main">∧</span> range <span class="bound">φ</span> <span class="main">=</span> <span class="skolem">C</span> <span class="skolem">i</span> <span class="main">∧</span> strict_mono <span class="bound">φ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_imp_inj_on bij_betw_imp_surj_on bij_enumerate enumerate_mono infC strict_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">φ</span></span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat<span class="main">,</span>nat<span class="main">]</span> <span class="main">⇒</span> nat"</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> φ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> inj <span class="main">(</span><span class="skolem">φ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> range <span class="main">(</span><span class="skolem">φ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">C</span> <span class="bound">i</span> <span class="main">∧</span> strict_mono <span class="main">(</span><span class="skolem">φ</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> π_in_C <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="skolem">i'</span> <span class="main">⟷</span> <span class="skolem">i'</span><span class="main">=</span><span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">i'</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">using</span></span> dis <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pairwise_def disjnt_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> less_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">i</span> <span class="skolem">j'</span> <span class="main">&lt;</span> <span class="skolem">φ</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">⟷</span> <span class="skolem">j'</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j'</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> φ strict_mono_less<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="var">?a</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span> <span class="bound">b</span><span class="main">.</span> <span class="var">?a</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> UU"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> X_def UU_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">X</span> pair_less <span class="main">=</span> ω<span class="main">↑</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">X</span> pair_less <span class="main">≤</span> ordertype UU pair_less"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> UU›</span></span> ordertype_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">X</span> pair_less <span class="main">≤</span> ω<span class="main">↑</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ordertype_UU_ω2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">π</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="var">?a</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">φ</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="skolem">φ</span> <span class="main">0</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">φ</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">φ</span> <span class="main">0</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> φ le_less_trans less_iff strict_mono_imp_increasing<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> subX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">`</span> UU <span class="main">⊆</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> UU_def π_def X_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">π</span> <span class="main">`</span> UU<span class="main">)</span> pair_less <span class="main">≤</span> ordertype <span class="skolem">X</span> pair_less"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordertype_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">π</span> <span class="main">`</span> UU<span class="main">)</span> pair_less <span class="main">=</span> ordertype UU pair_less"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_inc_eq<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">π</span> <span class="skolem">x</span><span class="main">,</span> <span class="skolem">π</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> pair_less"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> UU"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> UU"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> pair_less"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> UU_def π_def pair_less_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="numeral">2</span> <span class="main">≤</span> ordertype <span class="skolem">X</span> pair_less"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ordertype_UU_ω2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ueq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> inX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def subset_iff eval_nat_numeral card_Suc_eq Set.doubleton_eq_iff<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span>  nat_le_linear<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">.</span> form <span class="skolem">U</span> <span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> scheme <span class="skolem">U</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"scheme <span class="skolem">U</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inX N φ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scheme_def Ueq X_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">c</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">c</span>›</span></span> ne nat_less_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">.</span> form <span class="skolem">U</span> <span class="bound">k</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&lt;</span> <span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> inX <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> X_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">c</span><span class="main">;</span> <span class="skolem">c</span> <span class="main">&lt;</span> <span class="skolem">b</span><span class="main">;</span> <span class="main">¬</span> <span class="skolem">d</span> <span class="main">&lt;</span> <span class="skolem">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">b</span> <span class="main">&lt;</span> <span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> inX <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> X_def not_less<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> φ π_in_C imageE nat.inject nat_less_le<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>k0<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span> <span class="main">|</span> <span class="main">(</span>k1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span> <span class="main">|</span> <span class="main">(</span>k2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">d</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 less_linear <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">case</span></span> k0
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"form <span class="skolem">U</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> form_def form_split_def <span class="keyword1"><span class="command">using</span></span> Ueq <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> k1
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"form <span class="skolem">U</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> form_def form_split_def <span class="keyword1"><span class="command">using</span></span> Ueq <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> k2
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"form <span class="skolem">U</span> <span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> form_def form_split_def <span class="keyword1"><span class="command">using</span></span> Ueq <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"form_split <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="numeral">3</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> form_split_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Ueq form_def leI <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 2.1 of Jean A. Larson, ibid.›</span></span>
<span class="keyword1" id="Partitions-Specker_aux"><span class="command">lemma</span></span> Specker_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts ω"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst pair_less UU <span class="main">[</span>ω<span class="main">↑</span><span class="numeral">2</span><span class="main">,</span><span class="free">α</span><span class="main">]</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> partn_lst_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">X</span></span> <span class="main">⊆</span> UU<span class="main">.</span> ordertype <span class="bound">X</span> pair_less <span class="main">=</span> ω<span class="main">↑</span><span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">M</span></span> <span class="main">⊆</span> UU<span class="main">.</span> ordertype <span class="bound">M</span> pair_less <span class="main">=</span> <span class="free">α</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P0</span> <span class="main">∨</span> <span class="var">?P1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjCI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> not1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">M</span> <span class="main">⊆</span> UU<span class="main">;</span> ordertype <span class="bound">M</span> pair_less <span class="main">=</span> <span class="free">α</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">[</span><span class="bound">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">≠</span> Suc <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> ord_of_nat <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms elts_ω <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="skolem">m</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">[</span><span class="skolem">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span>
      <span class="keyword1"><span class="command">using</span></span> not1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">]</span> finite_ordertype_eq_card <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span> <span class="quoted">pair_less</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> f
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def eval_nat_numeral Pi_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_Suc0 not_less_less_Suc_eq subset_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="skolem"><span class="skolem">js</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">u</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">k</span> <span class="main">&lt;</span> <span class="numeral">4</span><span class="main">;</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">;</span> form <span class="bound">u</span> <span class="bound">k</span><span class="main">;</span> scheme <span class="bound">u</span> <span class="main">⊆</span> <span class="skolem">N</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="bound">u</span> <span class="main">=</span> <span class="skolem">js</span><span class="main">!</span><span class="bound">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f lemma_2_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M0</span></span> <span class="keyword2"><span class="keyword">where</span></span> M0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M0</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="skolem">m</span></sup><span class="hidden">⇖</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M0</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> form <span class="bound">u</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M0</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> scheme <span class="bound">u</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lemma_2_4 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M1</span></span> <span class="keyword2"><span class="keyword">where</span></span> M1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M1</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="skolem">m</span></sup><span class="hidden">⇖</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M1</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> form <span class="bound">u</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M1</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> scheme <span class="bound">u</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lemma_2_4 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M2</span></span> <span class="keyword2"><span class="keyword">where</span></span> M2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M2</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="skolem">m</span></sup><span class="hidden">⇖</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M2</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> form <span class="bound">u</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M2</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> scheme <span class="bound">u</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lemma_2_4 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M3</span></span> <span class="keyword2"><span class="keyword">where</span></span> M3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M3</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="skolem">m</span></sup><span class="hidden">⇖</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M3</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> form <span class="bound">u</span> <span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M3</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> scheme <span class="bound">u</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lemma_2_4 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">js</span><span class="main">!</span><span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="main">]</span> M0 f_eq_0 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def eval_nat_numeral<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">js</span><span class="main">!</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> M1 f_eq_0 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def eval_nat_numeral<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">js</span><span class="main">!</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="main">]</span> M2 f_eq_0 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def eval_nat_numeral<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">js</span><span class="main">!</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="main">]</span> M3 f_eq_0 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M3</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def eval_nat_numeral<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> js0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">js</span><span class="main">!</span><span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="numeral">4</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_nat_numeral less_Suc_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> UU"</span></span> <span class="keyword2"><span class="keyword">and</span></span> otX<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">X</span> pair_less <span class="main">=</span> ω<span class="main">↑</span><span class="numeral">2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">.</span> form <span class="bound">u</span> <span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> scheme <span class="bound">u</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span> lemma_2_5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_subset_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> u_UU2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">[</span>UU]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> UU›</span></span> nsets_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> X u N <span class="main">[</span><span class="operator">OF</span> _ u_UU2<span class="main">]</span> js0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">X</span></span> <span class="main">⊆</span> UU<span class="main">.</span> ordertype <span class="bound">X</span> pair_less <span class="main">=</span> ω<span class="main">↑</span><span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">H</span></span><span class="main">⊆</span>UU<span class="main">.</span> ordertype <span class="bound">H</span> pair_less <span class="main">=</span> <span class="main">[</span>ω<span class="main">↑</span><span class="numeral">2</span><span class="main">,</span> <span class="free">α</span><span class="main">]</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nth_Cons_0 numeral_2_eq_2 pos2<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P1</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def lessI nth_Cons_0 nth_Cons_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Specker<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts ω <span class="main">⟹</span> partn_lst_VWF <span class="main">(</span>ω<span class="main">↑</span><span class="numeral">2</span><span class="main">)</span> <span class="main">[</span>ω<span class="main">↑</span><span class="numeral">2</span><span class="main">,</span><span class="free">α</span><span class="main">]</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> partn_lst_imp_partn_lst_VWF_eq <span class="main">[</span><span class="operator">OF</span> Specker_aux<span class="main">]</span> ordertype_UU_ω2 wf_pair_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Erdos_Milner">
<div class="head">
<h1>Theory Erdos_Milner</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Erdos_Milner
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Partitions">Partitions</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Erdős-Milner theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹P. Erdős and E. C. Milner, A Theorem in the Partition Calculus.
Canadian Math. Bull. 15:4 (1972), 501-505.
Corrigendum, Canadian Math. Bull. 17:2 (1974), 305.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The paper defines strong types as satisfying the criteria below.
      It remarks that ordinals satisfy those criteria. Here is a (too complicated) proof.›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> strong_ordertype_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">⊆</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">L</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>List.set <span class="free">L</span><span class="main">)</span> <span class="main">=</span> <span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> List.set <span class="free">L</span> <span class="main">⟹</span> indecomposable <span class="main">(</span>tp <span class="bound">X</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">M</span> <span class="main">⊆</span> <span class="free">D</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> List.set <span class="free">L</span> <span class="main">⟹</span> tp <span class="main">(</span><span class="bound">M</span> <span class="main">∩</span> <span class="bound">X</span><span class="main">)</span> <span class="main">≥</span> tp <span class="bound">X</span><span class="main">⟧</span> <span class="main">⟹</span> tp <span class="bound">M</span> <span class="main">=</span> tp <span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">≡</span> inv_into <span class="free">D</span> <span class="main">(</span>ordermap <span class="free">D</span> VWF<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bij_φ<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">φ</span> <span class="main">(</span>elts <span class="main">(</span>tp <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="free">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> D bij_betw_inv_into down ordermap_bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> φ_cancel_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">⟹</span> <span class="skolem">φ</span> <span class="main">(</span>ordermap <span class="free">D</span> VWF <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="bound">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D φ_def bij_betw_inv_into_left down ordermap_bij total_on_VWF wf_VWF<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> φ_cancel_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">γ</span><span class="main">.</span> <span class="bound">γ</span> <span class="main">∈</span> elts <span class="main">(</span>tp <span class="free">D</span><span class="main">)</span> <span class="main">⟹</span> ordermap <span class="free">D</span> VWF <span class="main">(</span><span class="skolem">φ</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> φ_def f_inv_into_f ordermap_surj subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">⊆</span> ON"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms down elts_subset_ON <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">β</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> φ_less_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">γ</span> <span class="bound">δ</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">γ</span> <span class="main">∈</span> elts <span class="main">(</span>tp <span class="free">D</span><span class="main">)</span><span class="main">;</span> <span class="bound">δ</span> <span class="main">∈</span> elts <span class="main">(</span>tp <span class="free">D</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">φ</span> <span class="bound">γ</span> <span class="main">&lt;</span> <span class="skolem">φ</span> <span class="bound">δ</span> <span class="main">⟷</span> <span class="bound">γ</span> <span class="main">&lt;</span> <span class="bound">δ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> φ_def inv_ordermap_VWF_mono_iff inv_ordermap_mono_eq less_V_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">αs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"List.set <span class="skolem">αs</span> <span class="main">⊆</span> ON"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ω_dec <span class="skolem">αs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> tpD_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="free">D</span> <span class="main">=</span> ω_sum <span class="skolem">αs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_ordertype ω_nf_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>                <span class="comment1">― ‹Cantor normal form of the ordertype›</span>
  <span class="keyword1"><span class="command">have</span></span> ord <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="skolem">αs</span> <span class="main">!</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω_sum <span class="main">(</span>take <span class="skolem">k</span> <span class="skolem">αs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">αs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹list.set <span class="skolem">αs</span> <span class="main">⊆</span> ON›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dual_order.trans set_take_subset <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> ON_imp_Ord<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">k</span><span class="main">.</span> lift <span class="main">(</span>ω_sum <span class="main">(</span>take <span class="bound">k</span> <span class="skolem">αs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ω<span class="main">↑</span><span class="main">(</span><span class="skolem">αs</span><span class="main">!</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">≡</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">φ</span> <span class="main">`</span> <span class="main">(</span>elts <span class="main">(</span><span class="skolem">E</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">αs</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">L</span> <span class="main">=</span> length <span class="skolem">αs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> in_elts_E_less<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="skolem">E</span> <span class="skolem">k'</span><span class="main">)</span> <span class="main">≪</span> elts <span class="main">(</span><span class="skolem">E</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span><span class="main">&lt;</span><span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">αs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">k'</span>
    <span class="comment1">― ‹The ordinals have been partitioned into disjoint intervals›</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> ordω<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω <span class="main">↑</span> <span class="skolem">αs</span> <span class="main">!</span> <span class="skolem">k'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> that id_take_nth_drop <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k'</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">k</span> <span class="skolem">αs</span>"</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">k</span> <span class="skolem">αs</span> <span class="main">=</span> take <span class="skolem">k'</span> <span class="skolem">αs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">αs</span><span class="main">!</span><span class="skolem">k'</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> E_def lift_def less_sets_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> OrdmemD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ordω<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> elts_E<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="skolem">E</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">⊆</span> elts <span class="main">(</span>ω_sum <span class="skolem">αs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">αs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">↑</span> <span class="main">(</span><span class="skolem">αs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> ω_sum <span class="main">(</span>drop <span class="skolem">k</span> <span class="skolem">αs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> that Cons_nth_drop_Suc ω_sum_Cons add_le_cancel_left0<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span> <span class="main">(</span>ω_sum <span class="main">(</span>take <span class="skolem">k</span> <span class="skolem">αs</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="main">(</span>ω <span class="main">↑</span> <span class="main">(</span><span class="skolem">αs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> elts <span class="main">(</span>ω_sum <span class="main">(</span>take <span class="skolem">k</span> <span class="skolem">αs</span><span class="main">)</span> <span class="main">+</span> ω_sum <span class="main">(</span>drop <span class="skolem">k</span> <span class="skolem">αs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> elts <span class="main">(</span>ω_sum <span class="skolem">αs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ω_sum_take_drop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_def E_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> ω_sum_in_tpD<span class="main">:</span> <span class="quoted"><span class="quoted">"ω_sum <span class="main">(</span>take <span class="skolem">k</span> <span class="skolem">αs</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>tp <span class="free">D</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω <span class="main">↑</span> <span class="skolem">αs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">αs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">γ</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> elts_E lift_def that tpD_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> E_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Ord_φ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="skolem">φ</span> <span class="main">(</span>ω_sum <span class="main">(</span>take <span class="skolem">k</span> <span class="skolem">αs</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω <span class="main">↑</span> <span class="skolem">αs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">αs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">γ</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> ω_sum_in_tpD <span class="quoted"><span class="quoted">‹<span class="free">D</span> <span class="main">⊆</span> ON›</span></span> bij_φ bij_betw_imp_surj_on that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">π</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> odiff <span class="bound">y</span> <span class="main">(</span>ω_sum <span class="main">(</span>take <span class="bound">k</span> <span class="skolem">αs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> ordermap <span class="free">D</span> VWF<span class="main">)</span>"</span></span>
      <span class="comment1">― ‹mapping the segments of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">D</span></span><span class="antiquote">}</span></span> into some power of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">ω</span><span class="antiquote">}</span></span>›</span>
  <span class="keyword1"><span class="command">have</span></span> bij_π<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="skolem">π</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">φ</span> <span class="main">`</span> elts <span class="main">(</span><span class="skolem">E</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span>ω <span class="main">↑</span> <span class="main">(</span><span class="skolem">αs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">αs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def π_def E_def inj_on_def lift_def image_comp ω_sum_in_tpD φ_cancel_right that<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> π_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="skolem">k</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">π</span> <span class="skolem">k</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">φ</span> <span class="main">`</span> elts <span class="main">(</span><span class="skolem">E</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">φ</span> <span class="main">`</span> elts <span class="main">(</span><span class="skolem">E</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">αs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> π_def E_def lift_def ω_sum_in_tpD φ_cancel_right Ord_φ φ_less_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> tp_E_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">φ</span> <span class="main">`</span> elts <span class="main">(</span><span class="skolem">E</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ω<span class="main">↑</span><span class="main">(</span><span class="skolem">αs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">αs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω Ord_oexp π_iff bij_π ord<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ordertype_VWF_eq_iff replacement small_elts that<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> tp_L_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">L</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> ω<span class="main">↑</span><span class="main">(</span><span class="skolem">αs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">αs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L_def that<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> UL_eq_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>list.set <span class="skolem">L</span><span class="main">)</span> <span class="main">=</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>list.set <span class="skolem">L</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">D</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> L_def tpD_eq bij_betw_apply <span class="main"><span class="main">[</span></span><span class="operator">OF</span> bij_φ<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> elts_E<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>list.set <span class="skolem">L</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">δ</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">D</span> VWF <span class="skolem">δ</span> <span class="main">∈</span> elts <span class="main">(</span>ω_sum <span class="skolem">αs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹small <span class="free">D</span>›</span></span> ordermap_in_ordertype tpD_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>list.set <span class="skolem">L</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">δ</span> <span class="main">∈</span> <span class="free">D</span>›</span></span> φ_cancel_left in_elts_ω_sum
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> L_def E_def image_iff lift_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"indecomposable <span class="main">(</span>tp <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> list.set <span class="skolem">L</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> L_def indecomposable_ω_power<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">⊆</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> list.set <span class="skolem">L</span> <span class="main">⟹</span> tp <span class="bound">X</span> <span class="main">≤</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="main">∩</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">M</span> <span class="main">=</span> tp <span class="free">D</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">M</span> <span class="main">≤</span> tp <span class="free">D</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">⊆</span> <span class="free">D</span>›</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">D</span>›</span></span> ordertype_VWF_mono<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">X</span><span class="main">.</span> inv_into <span class="main">(</span><span class="skolem">M</span> <span class="main">∩</span> <span class="bound">X</span><span class="main">)</span> <span class="main">(</span>ordermap <span class="main">(</span><span class="skolem">M</span> <span class="main">∩</span> <span class="bound">X</span><span class="main">)</span> VWF<span class="main">)</span>"</span></span>
                              <span class="comment1">― ‹The bijection from an <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">ω</span><span class="antiquote">}</span></span>-power into the appropriate segment of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">M</span></span><span class="antiquote">}</span></span>›</span>
      <span class="keyword1"><span class="command">have</span></span> bij_σ<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="skolem">σ</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span>tp <span class="main">(</span><span class="skolem">M</span> <span class="main">∩</span> <span class="skolem">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">M</span> <span class="main">∩</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
        <span class="keyword1"><span class="command">unfolding</span></span> σ_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">⊆</span> <span class="free">D</span>›</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">D</span>›</span></span> bij_betw_inv_into inf_le1 ordermap_bij smaller_than_small total_on_VWF wf_VWF<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> Ord_σ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="skolem">σ</span> <span class="skolem">X</span> <span class="skolem">α</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> elts <span class="main">(</span>tp <span class="main">(</span><span class="skolem">M</span> <span class="main">∩</span> <span class="skolem">X</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span> <span class="skolem">X</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">D</span> <span class="main">⊆</span> ON›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">⊆</span> <span class="free">D</span>›</span></span> bij_betw_apply <span class="main">[</span><span class="operator">OF</span> bij_σ<span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> σ_cancel_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">γ</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">γ</span> <span class="main">∈</span> elts <span class="main">(</span>tp <span class="main">(</span><span class="skolem">M</span> <span class="main">∩</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> ordermap <span class="main">(</span><span class="skolem">M</span> <span class="main">∩</span> <span class="bound">X</span><span class="main">)</span> VWF <span class="main">(</span><span class="skolem">σ</span> <span class="bound">X</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="bound">γ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> σ_def f_inv_into_f ordermap_surj subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> smM<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">M</span> <span class="main">∩</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">⊆</span> <span class="free">D</span>›</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">D</span>›</span></span> inf_le1 subset_iff_less_eq_V<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> length <span class="skolem">αs</span><span class="main">.</span> <span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span><span class="skolem">E</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>tp <span class="free">D</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">γ</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> set <span class="skolem">L</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">γ</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UL_eq_D γ Union_iff φ_def in_mono inv_into_into ordermap_surj<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> length <span class="skolem">αs</span><span class="main">.</span> <span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span><span class="skolem">E</span> <span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">φ</span> <span class="main">`</span> elts <span class="main">(</span><span class="skolem">E</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> L_def<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> γ φ_cancel_right elts_E in_mono tpD_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">K</span></span> <span class="keyword2"><span class="keyword">where</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">γ</span><span class="main">.</span> <span class="bound">γ</span> <span class="main">∈</span> elts <span class="main">(</span>tp <span class="free">D</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">K</span> <span class="bound">γ</span> <span class="main">&lt;</span> length <span class="skolem">αs</span> <span class="main">∧</span> <span class="bound">γ</span> <span class="main">∈</span> elts <span class="main">(</span><span class="skolem">E</span> <span class="main">(</span><span class="skolem">K</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  <span class="comment1">― ‹The index from <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"tp <span class="free">D</span>"</span><span class="antiquote">}</span></span> to the appropriate segment number›</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ψ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ψ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="main">(</span>ordermap <span class="free">D</span> VWF <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="main">(</span>ordermap <span class="free">D</span> VWF <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tp <span class="free">D</span> <span class="main">≤</span> tp <span class="skolem">M</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_inc_le<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="skolem">M</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">⊆</span> <span class="free">D</span>›</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">D</span>›</span></span> subset_iff_less_eq_V <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d'</span> <span class="skolem">d</span>
        <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">∈</span> <span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d'</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">&lt;</span> <span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ON_imp_Ord <span class="quoted"><span class="quoted">‹<span class="free">D</span> <span class="main">⊆</span> ON›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">γ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ'</span> <span class="main">≡</span> ordermap <span class="free">D</span> VWF <span class="skolem">d'</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">≡</span> ordermap <span class="free">D</span> VWF <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> len'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="skolem">γ'</span> <span class="main">&lt;</span> length <span class="skolem">αs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> elts'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ'</span> <span class="main">∈</span> elts <span class="main">(</span><span class="skolem">E</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="skolem">γ</span> <span class="main">&lt;</span> length <span class="skolem">αs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> elts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span><span class="skolem">E</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> K <span class="quoted"><span class="quoted">‹<span class="skolem">d'</span> <span class="main">∈</span> <span class="free">D</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> <span class="free">D</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> γ'_def γ_def <span class="quoted"><span class="quoted">‹small <span class="free">D</span>›</span></span> ordermap_in_ordertype<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span> <span class="bound">w</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">X</span> <span class="main">∈</span> list.set <span class="skolem">L</span><span class="main">;</span> <span class="bound">w</span> <span class="main">∈</span> elts <span class="main">(</span>tp <span class="bound">X</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∈</span> elts <span class="main">(</span>tp <span class="main">(</span><span class="skolem">M</span> <span class="main">∩</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> Ord_σL<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="skolem">σ</span> <span class="main">(</span><span class="skolem">L</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">π</span> <span class="skolem">k</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="skolem">φ</span> <span class="main">`</span> elts <span class="main">(</span><span class="skolem">E</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">αs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">d</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"**"</span> Ord_σ <span class="quoted"><span class="quoted">‹length <span class="skolem">L</span> <span class="main">=</span> length <span class="skolem">αs</span>›</span></span> bij_π bij_betw_imp_surj_on imageI nth_mem that tp_L_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ'</span> <span class="main">&lt;</span> <span class="skolem">γ</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> γ'_def γ_def <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> VWF›</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">D</span>›</span></span> ordermap_mono_less xy<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="skolem">γ'</span> <span class="main">≤</span> <span class="skolem">K</span> <span class="skolem">γ</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> elts' elts in_elts_E_less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> leI len' less_asym less_sets_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>less<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="skolem">γ'</span> <span class="main">&lt;</span> <span class="skolem">K</span> <span class="skolem">γ</span>"</span></span> <span class="main">|</span> <span class="main">(</span>equal<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="skolem">γ'</span> <span class="main">=</span> <span class="skolem">K</span> <span class="skolem">γ</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="skolem">γ'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ'</span><span class="main">)</span> <span class="skolem">d'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">case</span></span> less
          <span class="keyword3"><span class="command">obtain</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="skolem">γ'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ'</span><span class="main">)</span> <span class="skolem">d'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">M</span> <span class="main">∩</span> <span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="skolem">γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">M</span> <span class="main">∩</span> <span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="skolem">γ</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> elts' elts len' len
            <span class="keyword1"><span class="command">unfolding</span></span> γ'_def γ_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"**"</span> <span class="quoted"><span class="quoted">‹length <span class="skolem">L</span> <span class="main">=</span> length <span class="skolem">αs</span>›</span></span> φ_cancel_left bij_π bij_σ bij_betw_imp_surj_on imageI nth_mem tp_L_eq xy<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">D</span> VWF <span class="main">(</span><span class="skolem">σ</span> <span class="main">(</span><span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="skolem">γ'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ'</span><span class="main">)</span> <span class="skolem">d'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> elts <span class="main">(</span><span class="skolem">E</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">D</span> VWF <span class="main">(</span><span class="skolem">σ</span> <span class="main">(</span><span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> elts <span class="main">(</span><span class="skolem">E</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> len' len elts_E tpD_eq
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> L_def γ'_def γ_def φ_cancel_right<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">D</span> VWF <span class="main">(</span><span class="skolem">σ</span> <span class="main">(</span><span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="skolem">γ'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ'</span><span class="main">)</span> <span class="skolem">d'</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> ordermap <span class="free">D</span> VWF <span class="main">(</span><span class="skolem">σ</span> <span class="main">(</span><span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> in_elts_E_less len less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_sets_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="skolem">γ'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ'</span><span class="main">)</span> <span class="skolem">d'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">⊆</span> <span class="free">D</span>›</span></span> † <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹small <span class="free">D</span>›</span></span> φ_cancel_left φ_less_iff ordermap_in_ordertype<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> equal
          <span class="keyword1"><span class="command">have</span></span> σ_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span> <span class="bound">γ</span> <span class="bound">δ</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">γ</span> <span class="main">&lt;</span> <span class="bound">δ</span><span class="main">;</span> <span class="bound">γ</span> <span class="main">∈</span> elts <span class="main">(</span>tp <span class="main">(</span><span class="skolem">M</span> <span class="main">∩</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="bound">δ</span> <span class="main">∈</span> elts <span class="main">(</span>tp <span class="main">(</span><span class="skolem">M</span> <span class="main">∩</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span>
                          <span class="main">⟹</span> <span class="skolem">σ</span> <span class="bound">X</span> <span class="bound">γ</span> <span class="main">&lt;</span> <span class="skolem">σ</span> <span class="bound">X</span> <span class="bound">δ</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">D</span> <span class="main">⊆</span> ON›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">⊆</span> <span class="free">D</span>›</span></span> σ_def dual_order.trans inv_ordermap_VWF_strict_mono_iff le_infI1 smM<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span> <span class="skolem">d'</span> <span class="main">&lt;</span> <span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span> <span class="skolem">d</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equal γ'_def γ_def <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> VWF›</span></span> φ_cancel_left π_iff elts elts' imageI len xy<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> equal
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"**"</span> γ'_def γ_def <span class="quoted"><span class="quoted">‹length <span class="skolem">L</span> <span class="main">=</span> length <span class="skolem">αs</span>›</span></span> φ_cancel_left σ_less bij_π 
                 bij_betw_imp_surj_on elts elts' image_eqI len local.equal nth_mem tp_L_eq xy<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="skolem">σ</span> <span class="main">(</span><span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="skolem">γ'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ'</span><span class="main">)</span> <span class="skolem">d'</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Ord_σL γ'_def φ_cancel_left elts' len' xy<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="skolem">σ</span> <span class="main">(</span><span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Ord_σL γ_def φ_cancel_left elts len xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ψ</span> <span class="skolem">d'</span><span class="main">,</span> <span class="skolem">ψ</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ψ_def γ'_def γ_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ψ</span> <span class="main">`</span> <span class="free">D</span> <span class="main">⊆</span> <span class="skolem">M</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ψ_def<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">≡</span> ordermap <span class="free">D</span> VWF <span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="skolem">γ</span> <span class="main">&lt;</span> length <span class="skolem">αs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> elts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span><span class="skolem">E</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> K <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> <span class="free">D</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> γ_def <span class="quoted"><span class="quoted">‹small <span class="free">D</span>›</span></span> ordermap_in_ordertype<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">∈</span> elts <span class="main">(</span>tp <span class="main">(</span><span class="skolem">L</span><span class="main">!</span> <span class="main">(</span><span class="skolem">K</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> bij_π <span class="main">[</span><span class="operator">OF</span> len<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> <span class="free">D</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> γ_def φ_cancel_left bij_betw_apply elts imageI len tp_L_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="skolem">L</span> <span class="main">!</span> <span class="skolem">K</span> <span class="main">(</span>ordermap <span class="free">D</span> VWF <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">K</span> <span class="main">(</span>ordermap <span class="free">D</span> VWF <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> γ_def <span class="quoted"><span class="quoted">‹length <span class="skolem">L</span> <span class="main">=</span> length <span class="skolem">αs</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span> Int_iff bij_σ bij_betw_apply len nth_mem vsubsetD<span class="main">)</span> 
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UL_eq_D<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The ``remark'' of Erdős and E. C. Milner, Canad. Math. Bull. Vol. 17 (2), 1974›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> indecomposable_imp_Ex_less_sets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> indec<span class="main">:</span> <span class="quoted"><span class="quoted">"indecomposable <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="free">A</span> <span class="main">=</span> <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> ON"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="free">A1</span> <span class="main">=</span> <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A1</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">A2</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"tp <span class="free">A2</span> <span class="main">=</span> <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A2</span> <span class="main">⊆</span> <span class="free">A1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">≪</span> <span class="free">A2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> indec indecomposable_imp_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Limit <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms indecomposable_imp_Limit<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">≡</span> inv_into <span class="free">A</span> <span class="main">(</span>ordermap <span class="free">A</span> VWF<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bij_φ<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">φ</span> <span class="main">(</span>elts <span class="free">α</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A bij_betw_inv_into down ordermap_bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> bij_om<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ordermap <span class="free">A</span> VWF<span class="main">)</span> <span class="free">A</span> <span class="main">(</span>elts <span class="free">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A down ordermap_bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">≡</span> ordermap <span class="free">A</span> VWF <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> γ_def <span class="keyword1"><span class="command">using</span></span> A <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> down <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">≡</span> <span class="skolem">φ</span> <span class="main">`</span> <span class="main">(</span>elts <span class="main">(</span>succ <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> ordermap <span class="free">A</span> VWF <span class="bound">y</span> <span class="main">≤</span> ordermap <span class="free">A</span> VWF <span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B_def γ_def image_iff φ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear Ord_ordermap OrdmemD bij_betw_inv_into_left bij_om leD<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> A1 smaller_than_small<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="free">A1</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">≤</span> tp <span class="free">A1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordertype_VWF_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="free">A1</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">≥</span> <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">α</span> <span class="main">≤</span> tp <span class="skolem">B</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> B_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ordertype_VWF_inc_eq<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>succ  <span class="skolem">γ</span><span class="main">)</span> <span class="main">⊆</span> ON"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> γ_def ordertype_VWF_inc_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Ord_in_Ord<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>succ  <span class="skolem">γ</span><span class="main">)</span> <span class="main">⊆</span> elts <span class="free">α</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Ord_trans γ <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">`</span> elts <span class="main">(</span>succ  <span class="skolem">γ</span><span class="main">)</span> <span class="main">⊆</span> ON"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊆</span> ON›</span></span> bij_φ bij_betw_imp_surj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="skolem">γ</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> γ Limit_def <span class="quoted"><span class="quoted">‹Limit <span class="free">α</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> A sub <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">u</span> <span class="main">&lt;</span> <span class="skolem">φ</span> <span class="skolem">v</span>"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="main">(</span>succ  <span class="skolem">γ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="main">(</span>succ  <span class="skolem">γ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">&lt;</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ON_imp_Ord Ord_linear2 φ_def inv_into_ordermap inv_ordermap_VWF_mono_le leD subset_iff that<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">α</span> <span class="main">≤</span> tp <span class="main">(</span>elts <span class="main">(</span>succ  <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit_def Ord_succ γ <span class="quoted"><span class="quoted">‹Limit <span class="free">α</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">γ</span>›</span></span> mem_not_refl ordertype_eq_Ord vsubsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> indecomposable_ordertype_ge <span class="main">[</span><span class="operator">OF</span> indec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A1</span></span> <span class="quoted"><span class="skolem">B</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹small <span class="free">A1</span>›</span></span> A1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="free">A1</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">≪</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms B 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def  φ_def subset_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_not_le VWF_iff_Ord_less less_V_def order_refl ordermap_mono_less trans_VWF wf_VWF<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A1</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">≪</span> <span class="main">(</span><span class="free">A1</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹the main theorem, from which they derive the headline result›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Erdos_Milner_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> part<span class="main">:</span> <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="free">α</span> <span class="main">[</span><span class="free">k</span><span class="main">,</span> <span class="free">γ</span><span class="main">]</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> indec<span class="main">:</span> <span class="quoted"><span class="quoted">"indecomposable <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> elts ω1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">[</span>ord_of_nat <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">)</span><span class="main">,</span> min <span class="free">γ</span> <span class="main">(</span>ω<span class="main">*</span><span class="free">β</span><span class="main">)</span><span class="main">]</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">≤</span><span class="main">1</span> <span class="main">∨</span> <span class="free">β</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> indec indecomposable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">β</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min <span class="free">γ</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partn_lst_triv0 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> i<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>0<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">=</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_0 OrdmemD True <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> mem_0_Ord one_V_def order.antisym succ_le_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">with</span></span> part <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partn_lst_def nsets_empty_iff less_Suc_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ON_imp_Ord Ord_ω1 True β elts_subset_ON<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>ord_of_nat <span class="free">k</span><span class="main">,</span> <span class="free">γ</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">α</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> partn_lst_VWF_nontriv <span class="main">[</span><span class="operator">OF</span> part<span class="main">]</span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">α</span><span class="main">=</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_Suc_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min <span class="free">γ</span> <span class="main">(</span>ω<span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_1 Ord_ω Ord_linear_le Ord_mult <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> min_def order_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="free">β</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> True <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">β</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">α</span><span class="main">=</span><span class="main">1</span>›</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> partn_lst_triv1 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> i<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_1 Ord_not_le indec indecomposable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≥</span> ω"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indec indecomposable_imp_Limit omega_le_Limit<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> False Ord_ω1 Ord_in_Ord β mem_0_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> partn_lst_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span>elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span>elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> ord <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ord_ω1 Ord_in_Ord β indec indecomposable_imp_Ord Ord_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted">False</span>
      <span class="keyword2"><span class="keyword">if</span></span> i <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">H</span><span class="main">.</span> tp <span class="bound">H</span> <span class="main">=</span> ord_of_nat <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">H</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> ii <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">H</span><span class="main">.</span> tp <span class="bound">H</span> <span class="main">=</span> <span class="free">γ</span> <span class="main">⟶</span> <span class="bound">H</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> iii <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">H</span><span class="main">.</span> tp <span class="bound">H</span> <span class="main">=</span> <span class="main">(</span>ω<span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">H</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> Ak0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">A</span>]<span class="hidden">⇗</span><sup><span class="free">k</span></sup><span class="hidden">⇖</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="comment1">―‹remark (8) about <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">S</span>"</span><span class="antiquote">}</span></span>›</span>
        <span class="keyword2"><span class="keyword">if</span></span> A_αβ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ot<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A</span> <span class="main">≥</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"inv_into <span class="skolem">A</span> <span class="main">(</span>ordermap <span class="skolem">A</span> VWF<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="skolem">A</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> down that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> inj_g<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?g</span> <span class="main">(</span>elts <span class="free">α</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inj_on_inv_into less_eq_V_def ordermap_surj ot subset_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> om_A_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">;</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">⟧</span> <span class="main">⟹</span> ordermap <span class="skolem">A</span> VWF <span class="bound">x</span> <span class="main">&lt;</span> ordermap <span class="skolem">A</span> VWF <span class="bound">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ord
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> A_αβ Ord_in_Ord VWF_iff_Ord_less <span class="quoted"><span class="quoted">‹small <span class="skolem">A</span>›</span></span> in_mono ordermap_mono_less trans_VWF wf_VWF<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> α_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="free">α</span> <span class="main">⊆</span> ordermap <span class="skolem">A</span> VWF <span class="main">`</span> <span class="skolem">A</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹small <span class="skolem">A</span>›</span></span> elts_of_set less_eq_V_def ordertype_def ot replacement<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">∈</span> elts <span class="free">α</span> <span class="main">→</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> A_αβ Pi_I' α_sub inv_into_into subset_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="var">?g</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="main">[</span>elts <span class="free">α</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nsets_compose_image_funcset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> f _ inj_g<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> elts <span class="free">α</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> ot_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="skolem">H</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">]</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="var">?g</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>nsets <span class="skolem">H</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ii partn_lst_E <span class="main">[</span><span class="operator">OF</span> part fg<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>0<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">case</span></span> 0
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span>inv_into <span class="skolem">A</span> <span class="main">(</span>ordermap <span class="skolem">A</span> VWF<span class="main">)</span> <span class="main">`</span> <span class="skolem">H</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ot_eq <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">⊆</span> elts <span class="free">α</span>›</span></span> α_sub <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> inj_on_inv_into <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nset_image_obtains<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">H</span> <span class="main">∧</span> card <span class="skolem">H</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 0 ot_eq <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">⊆</span> elts <span class="free">α</span>›</span></span> down <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_ordertype_eq_card<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="skolem">A</span> <span class="main">(</span>ordermap <span class="skolem">A</span> VWF<span class="main">)</span> <span class="main">`</span> <span class="skolem">H</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">A</span>]<span class="hidden">⇗</span><sup><span class="free">k</span></sup><span class="hidden">⇖</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">⊆</span> elts <span class="free">α</span>›</span></span> α_sub <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> card_image inj_on_inv_into inv_into_into<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> 1
          <span class="keyword1"><span class="command">have</span></span> gH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">`</span> <span class="skolem">H</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A_αβ α_sub <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">⊆</span> elts <span class="free">α</span>›</span></span> image_subsetI inv_into_into subset_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> g_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="var">?g</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
            <span class="keyword1"><span class="command">using</span></span> Pi_mem <span class="main">[</span><span class="operator">OF</span> g<span class="main">]</span> ord that
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> A_αβ Ord_in_Ord Ord_not_le <span class="quoted"><span class="quoted">‹small <span class="skolem">A</span>›</span></span> dual_order.trans elts_subset_ON inv_ordermap_VWF_mono_le ot vsubsetD<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="var">?g</span> <span class="main">`</span> <span class="skolem">H</span><span class="main">)</span> <span class="main">=</span> tp <span class="skolem">H</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">⊆</span> elts <span class="free">α</span>›</span></span> ord down dual_order.trans elts_subset_ON gH g_less ordertype_VWF_inc_eq subsetD<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> ii <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">`</span> <span class="skolem">H</span>"</span></span><span class="main">]</span> subset_inj_on <span class="main">[</span><span class="operator">OF</span> inj_g <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">⊆</span> elts <span class="free">α</span>›</span></span><span class="main">]</span> ot_eq 1 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gH <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nset_image_obtains<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">K</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">i</span> <span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">∧</span> <span class="skolem">f</span><span class="main">{</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">}</span> <span class="main">=</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> small_K<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">K</span> <span class="skolem">i</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> K_def<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">KI</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">KI</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">i</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">⋂</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">K</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> KI_disj_self<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">KI</span> <span class="skolem">i</span> <span class="skolem">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">X</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> KI_def K_def<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">D</span> <span class="bound">𝔄</span> <span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">ν</span><span class="main">::</span>V<span class="main">.</span> <span class="bound">ν</span> <span class="main">∈</span> <span class="bound">D</span> <span class="main">∧</span> tp <span class="main">(</span><span class="skolem">K</span> <span class="main">1</span> <span class="bound">x</span> <span class="main">∩</span> <span class="bound">𝔄</span> <span class="bound">ν</span><span class="main">)</span> <span class="main">≥</span> <span class="free">α</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> M_sub_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> small_M <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"small <span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def that<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> tp <span class="skolem">D</span><span class="main">}</span> <span class="main">≥</span> <span class="free">α</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="var">?AD</span> <span class="main">_</span> <span class="main">≥</span> <span class="free">α</span>"</span></span><span class="main">)</span>
        <span class="keyword2"><span class="keyword">if</span></span> inD<span class="main">:</span> <span class="quoted"><span class="quoted">"indecomposable <span class="main">(</span>tp <span class="skolem">D</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> tpA<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> 𝔄<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="main">→</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">∧</span> tp <span class="bound">X</span> <span class="main">=</span> <span class="free">α</span><span class="main">}</span>"</span></span>  <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">D</span> <span class="skolem">A</span> <span class="skolem">𝔄</span>
          <span class="comment1">―‹remark (9), assuming an indecomposable order type›</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">¬</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> tp <span class="skolem">D</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> small <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="skolem">D</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> A D down <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> small_𝔄<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">𝔄</span> <span class="skolem">δ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">∈</span> <span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">δ</span>
          <span class="keyword1"><span class="command">using</span></span> that 𝔄 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Pi_iff subset_iff_less_eq_V<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> not_α_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">α</span> <span class="main">≤</span> tp <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> tp <span class="skolem">D</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"small <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="skolem">A'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A'_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> A'_def A down <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">-</span> <span class="var">?AD</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> A'_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A'</span> <span class="main">≥</span> <span class="free">α</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> dual_order.refl indec indecomposable_ordertype_eq mem_Collect_eq subsetI tpA<span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">A'</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fX0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Ak0 <span class="main">[</span><span class="operator">OF</span> A'_sub A'_ge<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ‡<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≥</span> tp <span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A'_def<span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">X</span> <span class="main">=</span> <span class="free">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">D</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="main">`</span> <span class="skolem">X</span><span class="main">.</span> tp <span class="skolem">D</span> <span class="main">≤</span> tp <span class="bound">X</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> indecomposable_ordertype_finite_ge <span class="main"><span class="main">[</span></span><span class="operator">OF</span> inD<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="main">`</span> <span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> A'_def A'_ge not not_α_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="main">`</span> <span class="skolem">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_imp_small<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">X</span>›</span></span> not <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ‡<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ν</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ν<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">𝒜</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒜</span> <span class="main">≡</span> <span class="main">{</span><span class="skolem">KI</span> <span class="main">0</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="skolem">ν</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="skolem">K</span> <span class="main">1</span> <span class="bound">x</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="skolem">ν</span><span class="main">,</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="skolem">ν</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> αβ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="skolem">ν</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> A'_sub <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">A'</span>›</span></span> 𝔄 <span class="quoted"><span class="quoted">‹<span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">D</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">KI</span> <span class="main">0</span> <span class="skolem">X</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="skolem">K</span> <span class="main">1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">=</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> K_def KI_def Pi_iff less_2_cases_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> αβ <span class="keyword1"><span class="command">have</span></span> 𝔄ν_𝒜<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">𝒜</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="skolem">ν</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="skolem">𝒜</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒜_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> tp <span class="main">(</span><span class="skolem">K</span> <span class="main">1</span> <span class="skolem">x</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">≥</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">D</span>›</span></span> ν <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">X</span> <span class="main">=</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> sm_K1<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="skolem">K</span> <span class="main">1</span> <span class="bound">x</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="skolem">ν</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Finite_V Int_lower2 <span class="quoted"><span class="quoted">‹<span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">D</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">X</span>›</span></span> small_𝔄 small_UN smaller_than_small<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> not1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> tp <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="skolem">K</span> <span class="main">1</span> <span class="bound">x</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">≥</span> <span class="free">α</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> indecomposable_ordertype_finite_ge <span class="main">[</span><span class="operator">OF</span> indec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">K</span> <span class="main">1</span> <span class="bound">x</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">X</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> tp <span class="main">(</span><span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">≥</span> <span class="free">α</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">α</span> <span class="main">≥</span> ω›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_Int mem_not_refl ordertype_VWF_ω vsubsetD<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> tp <span class="main">(</span><span class="skolem">𝔄</span> <span class="skolem">ν</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 𝔄 <span class="quoted"><span class="quoted">‹<span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">D</span>›</span></span> small_𝔄 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="main">⋃</span> <span class="skolem">𝒜</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">D</span>›</span></span> small_𝔄 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒜_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> smaller_than_small sm_K1<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> K0𝔄_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">KI</span> <span class="main">0</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">≥</span> <span class="free">α</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> indecomposable_ordertype_finite_ge <span class="main">[</span><span class="operator">OF</span> indec 𝔄ν_𝒜<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒜_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> 𝔄ν<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="skolem">ν</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">𝔄</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">D</span>›</span></span> 𝔄 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ysub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">KI</span> <span class="main">0</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="skolem">ν</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">Y</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fY0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="skolem">Y</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Ak0 <span class="main">[</span><span class="operator">OF</span> _ K0𝔄_ge<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Ysub KI_disj_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="free">k</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">X</span> <span class="main">=</span> <span class="free">k</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">Y</span> <span class="main">=</span> <span class="free">k</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y</span>›</span></span> card_Un_disjoint<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> A'_sub <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">A'</span>›</span></span> 𝔄ν<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">KI</span> <span class="main">0</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="skolem">ν</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> fX0 fY0 Ysub <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> † nsets_disjoint_2 image_Un image_UN KI_def K_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> i <span class="quoted"><span class="quoted">‹finite <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y</span>›</span></span> ordertype_VWF_finite_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> IX<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> tp <span class="skolem">D</span><span class="main">}</span> <span class="main">≥</span> <span class="free">α</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> tpA<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> 𝔄<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="main">→</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">∧</span> tp <span class="bound">X</span> <span class="main">=</span> <span class="free">α</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">D</span> <span class="skolem">A</span> <span class="skolem">𝔄</span>
          <span class="comment1">―‹remark (9) for any order type›</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> UL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>List.set <span class="skolem">L</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">D</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> indL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> List.set <span class="skolem">L</span> <span class="main">⟹</span> indecomposable <span class="main">(</span>tp <span class="bound">X</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> eqL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">M</span> <span class="main">⊆</span> <span class="skolem">D</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> List.set <span class="skolem">L</span> <span class="main">⟹</span> tp <span class="main">(</span><span class="bound">M</span> <span class="main">∩</span> <span class="bound">X</span><span class="main">)</span> <span class="main">≥</span> tp <span class="bound">X</span><span class="main">⟧</span> <span class="main">⟹</span> tp <span class="bound">M</span> <span class="main">=</span> tp <span class="skolem">D</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ord <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> strong_ordertype_eq D order_refl<span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A''</span></span> <span class="keyword2"><span class="keyword">where</span></span> A''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A''</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A''</span> <span class="main">≥</span> <span class="free">α</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">X</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A''</span><span class="main">;</span> <span class="bound">X</span> <span class="main">∈</span> List.set <span class="skolem">L</span><span class="main">⟧</span> <span class="main">⟹</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="bound">x</span> <span class="main">∩</span> <span class="bound">X</span><span class="main">)</span> <span class="main">≥</span> tp <span class="bound">X</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> UL indL
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">L</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">thesis</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">X</span> <span class="skolem">L</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A''</span></span> <span class="keyword2"><span class="keyword">where</span></span> A''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A''</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A''</span> <span class="main">≥</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">D</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> ge_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">X</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A''</span><span class="main">;</span> <span class="bound">X</span> <span class="main">∈</span> List.set <span class="skolem">L</span><span class="main">⟧</span> <span class="main">⟹</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="bound">x</span> <span class="main">∩</span> <span class="bound">X</span><span class="main">)</span> <span class="main">≥</span> tp <span class="bound">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tp_A''<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A''</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A antisym down ordertype_VWF_mono tpA<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> ge_α<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A''</span><span class="main">.</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="skolem">X</span> <span class="skolem">𝔄</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> tp <span class="skolem">X</span><span class="main">}</span> <span class="main">≥</span> <span class="free">α</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 9<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> A A'' tp_A'' Cons.prems <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">⊆</span> elts <span class="free">β</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">D</span>›</span></span> 𝔄 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A''</span><span class="main">.</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="bound">x</span> <span class="main">∩</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">≥</span> tp <span class="skolem">X</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> M_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="skolem">x</span> <span class="main">∩</span> <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">M</span> <span class="skolem">X</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A''</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">D</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> tp <span class="var">?A</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> ge_α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_eq <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> conj_cong<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">Y</span> <span class="main">≤</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="skolem">x</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> list.set <span class="main">(</span><span class="skolem">X</span> <span class="main">#</span> <span class="skolem">L</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">Y</span>
              <span class="keyword1"><span class="command">using</span></span> that ge_X <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> A'' <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> tpA <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tp_M_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≥</span> tp <span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A''</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">using</span></span> eqL that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> tp <span class="skolem">A''</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A''<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> tp <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A''</span><span class="main">.</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> tp <span class="skolem">D</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> tp_M_ge eq_iff mem_Collect_eq subsetI<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> tp <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> tp <span class="skolem">D</span> <span class="main">≤</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="skolem">D</span> <span class="skolem">𝔄</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_mono<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> A'' A down <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> IX'<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A'</span><span class="main">.</span> tp <span class="main">(</span><span class="skolem">K</span> <span class="main">1</span> <span class="bound">x</span> <span class="main">∩</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">≥</span> <span class="free">α</span><span class="main">}</span> <span class="main">≥</span> <span class="free">α</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A</span> <span class="main">=</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A'</span> <span class="main">=</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="skolem">A'</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> ‡<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> tp <span class="main">(</span><span class="skolem">K</span> <span class="main">1</span> <span class="skolem">t</span> <span class="main">∩</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> tp <span class="main">{</span><span class="bound">ν</span><span class="main">.</span> <span class="bound">ν</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">α</span> <span class="main">≤</span> tp <span class="main">(</span><span class="skolem">K</span> <span class="main">1</span> <span class="skolem">t</span> <span class="main">∩</span> <span class="skolem">A</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
          <span class="keyword1"><span class="command">using</span></span> that
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_empty_eq less_eq_V_0_iff ordertype_empty zero_neq_one<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tp <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A'</span><span class="main">.</span> <span class="main">1</span> <span class="main">≤</span> tp <span class="main">{</span><span class="bound">ν</span><span class="main">.</span> <span class="bound">ν</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">α</span> <span class="main">≤</span> tp <span class="main">(</span><span class="skolem">K</span> <span class="main">1</span> <span class="bound">x</span> <span class="main">∩</span> <span class="skolem">A</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>
            <span class="main">≤</span> tp <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A'</span><span class="main">.</span> <span class="free">α</span> <span class="main">≤</span> tp <span class="main">(</span><span class="skolem">K</span> <span class="main">1</span> <span class="bound">x</span> <span class="main">∩</span> <span class="skolem">A</span><span class="main">)</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_mono<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted">"‡"</span> A' <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> down›</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> IX <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">A'</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">A</span>"</span></span><span class="main">]</span> that <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∈</span> elts <span class="free">β</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x0</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">g</span> <span class="main">∈</span> elts <span class="free">β</span> <span class="main">→</span> elts <span class="free">β</span><span class="main">.</span> strict_mono_on <span class="bound">g</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ν</span> <span class="main">∈</span> <span class="skolem">F</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">ν</span> <span class="main">=</span> <span class="bound">ν</span><span class="main">)</span>
                                      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ν</span> <span class="main">∈</span> elts <span class="free">β</span><span class="main">.</span> tp <span class="main">(</span><span class="skolem">K</span> <span class="main">1</span> <span class="bound">x0</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">ν</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="free">α</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">⊆</span> elts <span class="free">β</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> 𝔄<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="main">∈</span> elts <span class="free">β</span> <span class="main">→</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">∧</span> tp <span class="bound">X</span> <span class="main">=</span> <span class="free">α</span><span class="main">}</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">A</span> <span class="skolem">𝔄</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≡</span> card <span class="skolem">F</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">where</span></span> bijι<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">ι</span> <span class="main">{..</span><span class="skolem">p</span><span class="main">}</span> <span class="main">(</span>insert <span class="free">β</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> monι<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_on <span class="skolem">ι</span> <span class="main">{..</span><span class="skolem">p</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ZFC_Cardinals.ex_bij_betw_strict_mono_card <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="free">β</span> <span class="skolem">F</span>"</span></span><span class="main">]</span> elts_subset_ON <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> F
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_def lessThan_Suc_atMost<span class="main">)</span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> less_ι_I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">ι</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">l</span>
          <span class="keyword1"><span class="command">using</span></span> monι that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_mono_on_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> less_ι_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">ι</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">l</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_asym linorder_neqE_nat that<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> Ord_ι<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="skolem">ι</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ON_imp_Ord atMost_iff insert_subset mem_Collect_eq order_trans  <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">⊆</span> elts <span class="free">β</span>›</span></span> bijι bij_betwE elts_subset_ON <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> that<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> le_ι0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">⟹</span> <span class="skolem">ι</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ι</span> <span class="bound">j</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_refl leI le_0_eq less_ι_I less_imp_le<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> le_ι<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">ι</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> le_ι0 that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i'</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Suc_pred le_less less_Suc_eq less_Suc_eq_0_disj less_ι_I not_less_eq that<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="skolem">p</span> <span class="main">=</span> <span class="free">β</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> atMost_iff bijι bij_betw_iff_bijections insertI1<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> bijι ord k that<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> OrdmemD atMost_iff bij_betw_iff_bijections insert_iff leD less_ι_D order_refl subsetD<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">have</span></span> F_imp_Ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">.</span> <span class="skolem">ξ</span> <span class="main">=</span> <span class="skolem">ι</span> <span class="bound">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ξ</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> <span class="skolem">ι</span> <span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ξ</span> <span class="main">∈</span> <span class="skolem">F</span>›</span></span> atMost_iff bijι bij_betw_def imageE insert_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">β</span> <span class="main">∉</span> <span class="skolem">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ι</span> <span class="skolem">p</span> <span class="main">=</span> <span class="free">β</span>›</span></span> le_imp_less_or_eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> F_imp_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">≥</span> <span class="skolem">ι</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ξ</span>
          <span class="keyword1"><span class="command">using</span></span> F_imp_Ex <span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.order_iff_strict le0 less_ι_I<span class="main">)</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">{..&lt;</span><span class="skolem">ι</span> <span class="main">0</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="skolem">ι</span> <span class="main">(</span><span class="bound">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">&lt;..&lt;</span><span class="skolem">ι</span> <span class="bound">k</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> elts <span class="free">β</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> Dβ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="skolem">k</span> <span class="main">⊆</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> small_D <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">D</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> down<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> M_Int_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span> <span class="main">∩</span> <span class="skolem">D</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">M</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">k</span>
          <span class="keyword1"><span class="command">using</span></span> Dβ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> ι_le_if_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">μ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">μ</span> <span class="skolem">k</span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_def order.order_iff_strict<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> mono_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="skolem">i</span> <span class="main">≪</span> <span class="skolem">D</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j'</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_sets_def D_def Ball_def<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def diff_Suc_1 le_ι less_le_trans less_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disjnt_DD<span class="main">:</span> <span class="quoted"><span class="quoted">"disjnt <span class="main">(</span><span class="skolem">D</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> disjnt_sym less_linear less_sets_imp_disjnt that<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> UN_D_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">l</span> <span class="main">≤</span> <span class="skolem">k</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">{..&lt;</span><span class="skolem">ι</span> <span class="skolem">k</span><span class="main">}</span> <span class="main">∩</span> <span class="main">(</span>elts <span class="free">β</span> <span class="main">-</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
          <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> 0
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def F_imp_ge leD<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{..&lt;</span><span class="skolem">ι</span> <span class="skolem">k</span><span class="main">}</span> <span class="main">∩</span> <span class="main">(</span>elts <span class="free">β</span> <span class="main">-</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">{..&lt;</span><span class="skolem">ι</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">}</span> <span class="main">∩</span> <span class="main">(</span>elts <span class="free">β</span> <span class="main">-</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
            <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⊆</span> <span class="var">?rhs</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Suc.prems
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def if_split_mem2 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_ι_I less_trans <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> less_ι_D F_imp_Ex<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">ι</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="free">β</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∉</span> <span class="skolem">F</span><span class="main">;</span> <span class="skolem">ι</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">ι</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="bound">x</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">⊆</span> elts <span class="free">β</span>›</span></span> bijι le_imp_less_or_eq
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_iff_bijections<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">⊆</span> <span class="var">?lhs</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def Ord_not_less Ord_in_Ord <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span><span class="main"><span class="main">]</span></span> Ord_ι if_split_mem2<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atMost_Suc<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> β_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="free">β</span> <span class="main">=</span> <span class="skolem">F</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">k</span> <span class="main">≤</span> <span class="skolem">p</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">⊆</span> elts <span class="free">β</span>›</span></span> OrdmemD <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> UN_D_eq<span class="main">)</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">βidx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">βidx</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">ν</span><span class="main">.</span> <span class="main">@</span><span class="bound">k</span><span class="main">.</span> <span class="bound">ν</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> βidx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">βidx</span> <span class="skolem">ν</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span> <span class="main">-</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ν</span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> βidx_def β_decomp <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> someI_ex <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> any_imp_βidx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">βidx</span> <span class="skolem">ν</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">ν</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> non<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="skolem">βidx</span> <span class="skolem">ν</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that UN_D_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> disjnt_DD <span class="main">[</span><span class="operator">OF</span> non<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Dβ Diff_iff βidx disjnt_iff subsetD that<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A'</span><span class="main">.</span> <span class="bound">A'</span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">∧</span> tp <span class="bound">A'</span> <span class="main">=</span> <span class="free">α</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">A'</span><span class="main">.</span> <span class="skolem">F</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> F
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">ν</span> <span class="skolem">F</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A'</span> <span class="main">=</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> FN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A'</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="bound">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> A<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A''</span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A'</span><span class="main">.</span> <span class="free">α</span> <span class="main">≤</span> tp <span class="main">(</span><span class="skolem">K</span> <span class="main">1</span> <span class="bound">x</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="skolem">ν</span><span class="main">)</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">⊆</span> elts <span class="free">β</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">note</span></span> ordertype_eq_Ord <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A''</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A'</span> <span class="main">⊆</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A''_def<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A''</span> <span class="main">≤</span> <span class="free">α</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A''</span> <span class="main">⊆</span> <span class="skolem">A</span>›</span></span> down ordertype_VWF_mono A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="skolem">ν</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">𝔄</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 𝔄 <span class="quoted"><span class="quoted">‹<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> tp <span class="skolem">A''</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> IX' <span class="main">[</span><span class="operator">OF</span> _ _ A'<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A''_def<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A''</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">M</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A''</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> A''_def FN that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">M</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def A''_def<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">A''</span><span class="main">.</span> insert <span class="skolem">ν</span> <span class="skolem">F</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="bound">x</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> A <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A'</span> <span class="main">=</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> FN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A'</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="bound">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
          <span class="keyword2"><span class="keyword">if</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x0</span> <span class="bound">g</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x0</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">;</span> <span class="bound">g</span> <span class="main">∈</span> elts <span class="free">β</span> <span class="main">→</span> elts <span class="free">β</span><span class="main">;</span> strict_mono_on <span class="bound">g</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span><span class="main">⟧</span>
                   <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ν</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">ν</span> <span class="main">≠</span> <span class="bound">ν</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ν</span><span class="main">∈</span>elts <span class="free">β</span><span class="main">.</span> tp <span class="main">(</span><span class="skolem">K</span> <span class="main">1</span> <span class="bound">x0</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">ν</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>       <span class="comment1">― ‹construction of the monotone map <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">g</span></span><span class="antiquote">}</span></span> mentioned above›</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A'</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> A' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">∧</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="main">(</span><span class="skolem">D</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> tp <span class="main">(</span><span class="skolem">D</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">D</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_linear2 Ord_ordertype that<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">D</span> <span class="skolem">k</span> <span class="main">→</span> <span class="skolem">M</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>strict_mono_on <span class="bound">f</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
                <span class="keyword1"><span class="command">using</span></span> le <span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> that VWF_iff_Ord_less
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ordertype_le_ordertype strict_mono_on_def<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Dβ M_sub_D Ord_in_Ord PiE VWF_iff_Ord_less ord<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetD<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> fun_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">⟹</span> <span class="skolem">h</span> <span class="bound">k</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="bound">k</span> <span class="main">→</span> <span class="skolem">M</span> <span class="main">(</span><span class="skolem">D</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword2"><span class="keyword">and</span></span> inj_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">⟹</span> inj_on <span class="main">(</span><span class="skolem">h</span> <span class="bound">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">D</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
                <span class="keyword2"><span class="keyword">and</span></span> mono_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">⟹</span> strict_mono_on <span class="main">(</span><span class="skolem">h</span> <span class="bound">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">D</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fun_hD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">⟹</span> <span class="skolem">h</span> <span class="bound">k</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="bound">k</span> <span class="main">→</span> <span class="skolem">D</span> <span class="bound">k</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> h_increasing<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">≤</span> <span class="skolem">h</span> <span class="skolem">k</span> <span class="skolem">ν</span>"</span></span>
                <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ν<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">ν</span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Ord_mono_imp_increasing<span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">k</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="skolem">k</span> <span class="main">→</span> <span class="skolem">D</span> <span class="skolem">k</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_hD that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="skolem">k</span> <span class="main">⊆</span> ON"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> Dβ elts_subset_ON ord<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> that mono_h<span class="main">)</span>
              <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">ν</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">ν</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="keyword1">then</span> <span class="bound">ν</span> <span class="keyword1">else</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="bound">ν</span><span class="main">)</span> <span class="bound">ν</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">ν</span> <span class="main">=</span> <span class="skolem">ν</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ν</span>
                <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> fun_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> elts <span class="free">β</span> <span class="main">→</span> elts <span class="free">β</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Pi_I<span class="main">)</span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">βidx</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> βidx<span class="main">)</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> fun_h  Dβ M_sub_D <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> elts <span class="free">β</span>›</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">have</span></span> h_in_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ν</span>
                <span class="keyword1"><span class="command">using</span></span> βidx fun_hD that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span>
                <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ν<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">ν</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">ν</span>
                <span class="keyword1"><span class="command">using</span></span> that h_in_D <span class="main">[</span><span class="operator">OF</span> ν<span class="main">]</span> βidx
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> h_increasing <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">μ</span><span class="main">)</span> <span class="skolem">μ</span> <span class="main">&lt;</span> <span class="skolem">ι</span> <span class="skolem">k</span>"</span></span>
                <span class="keyword2"><span class="keyword">if</span></span> μ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">&lt;</span> <span class="skolem">ι</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">μ</span> <span class="skolem">k</span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">βidx</span> <span class="skolem">μ</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">βidx</span> <span class="skolem">μ</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">βidx</span> <span class="skolem">μ</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
                    <span class="keyword1"><span class="command">using</span></span> ι_le_if_D βidx
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff Suc_pred le0 leD le_ι le_less_trans μ <span class="quoted"><span class="quoted">‹<span class="skolem">μ</span> <span class="main">&lt;</span> <span class="skolem">ι</span> <span class="skolem">k</span>›</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> that h_in_D <span class="main">[</span><span class="operator">OF</span> μ<span class="main">]</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Int_lower1 UN_D_eq UN_I atMost_iff lessThan_iff less_imp_le subset_eq<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">μ</span><span class="main">)</span> <span class="skolem">μ</span> <span class="main">&lt;</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span>
                <span class="keyword2"><span class="keyword">if</span></span> μ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ν<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">&lt;</span> <span class="skolem">ν</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">μ</span> <span class="skolem">ν</span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">βidx</span> <span class="skolem">μ</span> <span class="main">≤</span> <span class="skolem">βidx</span> <span class="skolem">ν</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">μ</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">μ</span><span class="main">)</span> <span class="skolem">μ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">&lt;</span> <span class="skolem">ι</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 2 that Diff_iff βidx μ ν <span class="quoted"><span class="quoted">‹<span class="skolem">μ</span> <span class="main">&lt;</span> <span class="skolem">ν</span>›</span></span> dual_order.strict_implies_order dual_order.strict_trans1 h_increasing leI le_ι less_asym<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">0</span> <span class="skolem">μ</span> <span class="main">&lt;</span> <span class="skolem">h</span> <span class="main">0</span> <span class="skolem">ν</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">βidx</span> <span class="skolem">μ</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">βidx</span> <span class="skolem">ν</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> that mono_h <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_on_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff βidx μ ν <span class="quoted"><span class="quoted">‹<span class="skolem">μ</span> <span class="main">&lt;</span> <span class="skolem">ν</span>›</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">0</span> <span class="skolem">μ</span> <span class="main">&lt;</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span>
                  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">βidx</span> <span class="skolem">ν</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">0</span> <span class="skolem">μ</span> <span class="main">&lt;</span> <span class="skolem">ι</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> DiffI βidx ν le_ι le_less_trans less_le_not_le that<span class="main">)</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">βidx</span> <span class="skolem">ν</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">βidx</span> <span class="skolem">μ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">0</span> <span class="skolem">ν</span> <span class="main">&lt;</span> <span class="skolem">ι</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">μ</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">μ</span><span class="main">)</span> <span class="skolem">μ</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> le le_0_eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">μ</span><span class="main">)</span> <span class="skolem">μ</span> <span class="main">&lt;</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span>
                  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">μ</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">μ</span><span class="main">)</span> <span class="skolem">μ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">&lt;</span> <span class="skolem">ι</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span><span class="main">)</span>"</span></span>
                    <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">μ</span><span class="main">)</span> <span class="skolem">μ</span> <span class="main">&lt;</span> <span class="skolem">ι</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">μ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span><span class="main">)</span> <span class="skolem">ν</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> mono_h <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_on_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le Diff_iff βidx μ ν <span class="quoted"><span class="quoted">‹<span class="skolem">μ</span> <span class="main">&lt;</span> <span class="skolem">ν</span>›</span></span> le_ι le_less le_less_trans that<span class="main">)</span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> h_in_D <span class="main">[</span><span class="operator">OF</span> μ<span class="main">]</span> h_in_D <span class="main">[</span><span class="operator">OF</span> ν<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> sm_g<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_on <span class="skolem">g</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def strict_mono_on_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> F_imp_Ex<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
                <span class="keyword1"><span class="command">using</span></span> * <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> fun_g sm_g<span class="main">]</span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ν</span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ν<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">K</span> <span class="main">1</span> <span class="skolem">x</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">ν</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">α</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> FM<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> FN <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A'</span>›</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">K</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> that FM <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">K</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">ν</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">∈</span> <span class="skolem">M</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">(</span><span class="skolem">βidx</span> <span class="skolem">ν</span><span class="main">)</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> fun_h βidx <span class="quoted"><span class="quoted">‹<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ν</span> <span class="main">∉</span> <span class="skolem">F</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
                    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def g_def leD<span class="main">)</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
                  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>›</span></span> ν <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> β_decomp<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">∧</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span> <span class="main">∩</span> <span class="skolem">D</span> <span class="bound">l</span><span class="main">)</span> <span class="main">&lt;</span> tp <span class="main">(</span><span class="skolem">D</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> M_Int_D <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> lp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A'</span><span class="main">⟹</span> <span class="skolem">l</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> lless<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A'</span><span class="main">⟹</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="bound">x</span> <span class="main">∩</span> <span class="skolem">D</span> <span class="main">(</span><span class="skolem">l</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> tp <span class="main">(</span><span class="skolem">D</span> <span class="main">(</span><span class="skolem">l</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A''</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A''</span> <span class="main">⊆</span> <span class="skolem">A'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A''</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A''</span> <span class="main">=</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A''</span> <span class="main">⟹</span> <span class="skolem">l</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">L</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">p</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A'</span><span class="main">.</span> <span class="skolem">l</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> lp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A'</span><span class="main">.</span> <span class="skolem">l</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..</span><span class="skolem">p</span><span class="main">}</span><span class="main">.</span> <span class="free">α</span> <span class="main">≤</span> tp <span class="bound">X</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> indecomposable_ordertype_finite_ge <span class="main"><span class="main">[</span></span><span class="operator">OF</span> indec<span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">p</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A'</span><span class="main">.</span> <span class="skolem">l</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> A<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eq down smaller_than_small<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> A' eq <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A''</span>
              <span class="keyword3"><span class="command">assume</span></span> A''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A''</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A'</span><span class="main">.</span> <span class="skolem">l</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..</span><span class="skolem">p</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> tp <span class="skolem">A''</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A''</span> <span class="main">⟹</span> <span class="skolem">l</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">L</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A''</span> <span class="main">⊆</span> <span class="skolem">A'</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> A'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A''</span> <span class="main">≤</span> tp <span class="skolem">A'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> A' A down order_trans ordertype_VWF_mono<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">α</span> <span class="main">≤</span> tp <span class="skolem">A''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A''</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> A'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A''</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> A' A <span class="quoted"><span class="quoted">‹<span class="skolem">A''</span> <span class="main">⊆</span> <span class="skolem">A'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span>
                <span class="keyword1"><span class="command">using</span></span> L that <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">A''</span> <span class="main">⊆</span> <span class="skolem">A'</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 𝔄D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="skolem">L</span> <span class="main">→</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">∧</span> tp <span class="bound">X</span> <span class="main">=</span> <span class="free">α</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 𝔄 Dβ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span> <span class="main">∩</span> <span class="skolem">D</span> <span class="skolem">L</span> <span class="main">=</span> <span class="skolem">M</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">L</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
            <span class="keyword1"><span class="command">using</span></span> Dβ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">M</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">L</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> tp <span class="main">(</span><span class="skolem">D</span> <span class="skolem">L</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A''</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
            <span class="keyword1"><span class="command">using</span></span> lless that <span class="quoted"><span class="quoted">‹<span class="skolem">A''</span> <span class="main">⊆</span> <span class="skolem">A'</span>›</span></span> lL <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A''</span><span class="main">.</span> tp <span class="main">(</span><span class="skolem">D</span> <span class="skolem">L</span><span class="main">)</span> <span class="main">≤</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">L</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> leD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> tp <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A''</span><span class="main">.</span> tp <span class="main">(</span><span class="skolem">D</span> <span class="skolem">L</span><span class="main">)</span> <span class="main">≤</span> tp <span class="main">(</span><span class="skolem">M</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">L</span><span class="main">)</span> <span class="skolem">𝔄</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> IX <span class="main">[</span><span class="operator">OF</span> Dβ A'' 𝔄D<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"†"</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="free">α</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_linear2 Ord_ordertype <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?U</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> nat set"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">μ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">≡</span> fst <span class="main">∘</span> from_nat_into <span class="main">(</span>elts <span class="free">β</span> <span class="main">×</span> <span class="var">?U</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≡</span> to_nat_on <span class="main">(</span>elts <span class="free">β</span> <span class="main">×</span> <span class="var">?U</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> co_βU<span class="main">:</span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>elts <span class="free">β</span> <span class="main">×</span> <span class="var">?U</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> β less_ω1_imp_countable<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="free">β</span> <span class="main">×</span> <span class="var">?U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∈</span> elts <span class="free">β</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>from_nat_into <span class="main">(</span>elts <span class="free">β</span> <span class="main">×</span> <span class="var">?U</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>elts <span class="free">β</span> <span class="main">×</span> <span class="var">?U</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> range_from_nat_into<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> μ_in_β <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="skolem">i</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SigmaE μ_def comp_apply fst_conv range_eqI<span class="main">)</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Ord_μ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> inf_βU<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>elts <span class="free">β</span> <span class="main">×</span> <span class="var">?U</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∈</span> elts <span class="free">β</span>›</span></span> finite_cartesian_productD2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> 11 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">(</span><span class="skolem">ν</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ν</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ν</span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> μ_def q_def that co_βU<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> range_μ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="skolem">μ</span> <span class="main">=</span> elts <span class="free">β</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> 11<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">KI</span> <span class="skolem">i</span> <span class="main">{}</span> <span class="main">=</span> UNIV"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">KI</span> <span class="skolem">i</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">K</span> <span class="skolem">i</span> <span class="skolem">a</span> <span class="main">∩</span> <span class="skolem">KI</span> <span class="skolem">i</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">a</span> <span class="skolem">X</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> KI_def<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">λ</span><span class="bound">𝔄</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ν</span> <span class="main">∈</span> elts <span class="free">β</span><span class="main">.</span> <span class="bound">𝔄</span> <span class="bound">ν</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">∧</span> tp <span class="main">(</span><span class="bound">𝔄</span> <span class="bound">ν</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="bound">n</span><span class="main">}</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>
                                         <span class="main">∧</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">ν</span> <span class="main">∈</span> elts <span class="free">β</span><span class="main">.</span> <span class="bound">𝔄</span> <span class="bound">ν</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">KI</span> <span class="main">1</span> <span class="main">(</span><span class="bound">x</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> strict_mono_sets <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="bound">𝔄</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Ψ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ψ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">λ</span><span class="bound">g</span> <span class="bound">𝔄</span> <span class="bound">𝔄'</span> <span class="bound">xn</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> elts <span class="free">β</span> <span class="main">→</span> elts <span class="free">β</span> <span class="main">∧</span> strict_mono_on <span class="bound">g</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="bound">g</span> <span class="main">(</span><span class="skolem">μ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="bound">i</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ν</span> <span class="main">∈</span> elts <span class="free">β</span><span class="main">.</span> <span class="bound">𝔄'</span> <span class="bound">ν</span> <span class="main">⊆</span> <span class="skolem">K</span> <span class="main">1</span> <span class="bound">xn</span> <span class="main">∩</span> <span class="bound">𝔄</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">ν</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="main">{</span><span class="bound">xn</span><span class="main">}</span> <span class="main">≪</span> <span class="main">(</span><span class="bound">𝔄'</span> <span class="main">(</span><span class="skolem">μ</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">xn</span> <span class="main">∈</span> <span class="bound">𝔄</span> <span class="main">(</span><span class="skolem">μ</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?𝔄0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">ν</span><span class="main">.</span> plus <span class="main">(</span><span class="free">α</span> <span class="main">*</span> <span class="bound">ν</span><span class="main">)</span> <span class="main">`</span> elts <span class="free">α</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="main">0</span> <span class="var">?𝔄0</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Φ_def add_mult_less add_mult_less_add_mult ordertype_image_plus strict_mono_sets_def less_sets_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"Ex <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">𝔄'</span><span class="main">,</span><span class="bound">xn</span><span class="main">)</span><span class="main">.</span> <span class="skolem">Ψ</span> <span class="skolem">n</span> <span class="bound">g</span> <span class="skolem">𝔄</span> <span class="bound">𝔄'</span> <span class="bound">xn</span> <span class="main">∧</span> <span class="skolem">Φ</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="bound">𝔄'</span> <span class="main">(</span><span class="skolem">x</span><span class="main">(</span><span class="skolem">n</span><span class="main">:=</span><span class="bound">xn</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="skolem">n</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> 𝔄<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ν</span><span class="main">.</span> <span class="bound">ν</span> <span class="main">∈</span> elts <span class="free">β</span> <span class="main">⟹</span> <span class="skolem">𝔄</span> <span class="bound">ν</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">∧</span> tp <span class="main">(</span><span class="skolem">𝔄</span> <span class="bound">ν</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="skolem">𝔄</span> <span class="main">`</span> elts <span class="free">β</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">KI</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> sm<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="skolem">𝔄</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Φ_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> μβ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">`</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">⊆</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 𝔄sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝔄<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> 𝔄fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="main">∈</span> elts <span class="free">β</span> <span class="main">→</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">∧</span> tp <span class="bound">X</span> <span class="main">=</span> <span class="free">α</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 𝔄<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> xn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xn</span> <span class="main">∈</span> <span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> elts <span class="free">β</span> <span class="main">→</span> elts <span class="free">β</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> sm_g<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_on <span class="skolem">g</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g_μ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ν</span> <span class="main">∈</span> <span class="skolem">μ</span><span class="main">`</span><span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">ν</span> <span class="main">=</span> <span class="bound">ν</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> g_α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ν</span> <span class="main">∈</span> elts <span class="free">β</span><span class="main">.</span> <span class="free">α</span> <span class="main">≤</span> tp <span class="main">(</span><span class="skolem">K</span> <span class="main">1</span> <span class="skolem">xn</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">ν</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 10 <span class="main">[</span><span class="operator">OF</span> _ μβ 𝔄sub _ 𝔄fun<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝔄<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> tp1<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">K</span> <span class="main">1</span> <span class="skolem">xn</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">ν</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ν</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">K</span> <span class="main">1</span> <span class="skolem">xn</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">ν</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> tp <span class="main">(</span><span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">ν</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_VWF_mono<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">ν</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PiE 𝔄 down g that<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 𝔄 g that <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">K</span> <span class="main">1</span> <span class="skolem">xn</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">ν</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">α</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> that g_α <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> tp2<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝔄<span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> ON"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> 𝔄sub ord down elts_subset_ON subset_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A2</span></span> <span class="keyword2"><span class="keyword">where</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="skolem">A2</span> <span class="main">=</span> <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A2</span> <span class="main">⊆</span> <span class="skolem">K</span> <span class="main">1</span> <span class="skolem">xn</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">xn</span><span class="main">}</span> <span class="main">≪</span> <span class="skolem">A2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> indecomposable_imp_Ex_less_sets <span class="main">[</span><span class="operator">OF</span> indec <span class="quoted"><span class="quoted">‹<span class="free">α</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> tp2<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> μ_in_β atMost_iff image_eqI inf_le2 le_refl xn tp1 g_μ<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A2_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A2</span> <span class="main">⊆</span> <span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?𝔄</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">ν</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">ν</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="skolem">n</span> <span class="keyword1">then</span> <span class="skolem">A2</span> <span class="keyword1">else</span> <span class="skolem">K</span> <span class="main">1</span> <span class="skolem">xn</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">ν</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{..&lt;</span>Suc <span class="skolem">n</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">xn</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>elts <span class="free">β</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">ν</span><span class="main">.</span> <span class="bound">ν</span> <span class="main">≠</span> <span class="skolem">μ</span> <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">KI</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sub g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> KI_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A2</span> <span class="main">⊆</span> <span class="skolem">KI</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A2</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 𝔄sub sub A2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xn</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 𝔄sub xn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="var">?𝔄</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sm sm_g g g_μ A2_sub
          <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_sets_def strict_mono_on_def less_sets_def Pi_iff subset_iff Ball_def Bex_def image_iff
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_split_mem2<span class="main">)</span> <span class="main">(</span><span class="operator">smt</span> order_refl<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="var">?𝔄</span> <span class="main">(</span><span class="skolem">x</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="skolem">xn</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> tp1 x A2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Φ_def K_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> A2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span><span class="main">,</span><span class="var">?𝔄</span><span class="main">,</span><span class="skolem">xn</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ψ_def g sm_g g_μ xn<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span> <span class="bound">𝔄</span> <span class="bound">x</span><span class="main">.</span> <span class="main">@</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">𝔄'</span><span class="main">,</span><span class="bound">x'</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">xn</span><span class="main">.</span> <span class="skolem">Ψ</span> <span class="bound">n</span> <span class="bound">g</span> <span class="bound">𝔄</span> <span class="bound">𝔄'</span> <span class="bound">xn</span> <span class="main">∧</span> <span class="bound">x'</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">(</span><span class="bound">n</span><span class="main">:=</span><span class="bound">xn</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">Φ</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="bound">𝔄'</span> <span class="bound">x'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> GΦ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">𝔄'</span><span class="main">,</span><span class="bound">x'</span><span class="main">)</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="bound">𝔄'</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">G</span> <span class="skolem">n</span> <span class="skolem">𝔄</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> GΨ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">𝔄'</span><span class="main">,</span><span class="bound">x'</span><span class="main">)</span><span class="main">.</span> <span class="skolem">Ψ</span> <span class="skolem">n</span> <span class="bound">g</span> <span class="skolem">𝔄</span> <span class="bound">𝔄'</span> <span class="main">(</span><span class="bound">x'</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">G</span> <span class="skolem">n</span> <span class="skolem">𝔄</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="skolem">n</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">using</span></span> step <span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> some_eq_imp<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">≡</span> rec_nat <span class="main">(</span>id<span class="main">,</span><span class="var">?𝔄0</span><span class="main">,</span>undefined<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="main">(</span><span class="bound">g0</span><span class="main">,</span><span class="bound">𝔄</span><span class="main">,</span><span class="bound">x0</span><span class="main">)</span><span class="main">.</span> <span class="skolem">G</span> <span class="bound">n</span> <span class="bound">𝔄</span> <span class="bound">x0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> H_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">H</span> <span class="skolem">n</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">g0</span><span class="main">,</span> <span class="bound">xa</span><span class="main">,</span> <span class="bound">xb</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">G</span> <span class="skolem">n</span> <span class="bound">xa</span> <span class="bound">xb</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">𝔄</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="skolem">n</span> <span class="bound">𝔄</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def base<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> GΦ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H_Suc<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> H_imp_Φ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="skolem">n</span> <span class="skolem">𝔄</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">𝔄</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span> <span class="skolem">𝔄</span> <span class="skolem">x</span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> case_prodD that<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> H_imp_Ψ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">𝔄'</span><span class="main">,</span><span class="bound">x'</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">g0</span><span class="main">,</span><span class="bound">𝔄</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">H</span> <span class="skolem">n</span> <span class="keyword1">in</span> <span class="skolem">Ψ</span> <span class="skolem">n</span> <span class="bound">g</span> <span class="bound">𝔄</span> <span class="bound">𝔄'</span> <span class="main">(</span><span class="bound">x'</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> GΨ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H_Suc <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">𝔄</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">n</span> <span class="main">∈</span> elts <span class="free">β</span> <span class="main">→</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sm_g<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_on <span class="main">(</span><span class="skolem">g</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">≤</span><span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">μ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> H_imp_Ψ <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def Ψ_def<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">𝔄</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">𝔄</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">𝔄</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">𝔄</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> 14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">⊆</span> <span class="skolem">K</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">x</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">n</span> <span class="skolem">ν</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ν</span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> H_imp_Ψ <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ψ_def 𝔄_def x_def g_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ν</span> <span class="main">⊆</span> <span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">n</span> <span class="skolem">ν</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ν</span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> 15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">≪</span> <span class="main">(</span><span class="skolem">𝔄</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> H_imp_Ψ <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ψ_def 𝔄_def x_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> 𝔄_αβ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="skolem">ν</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ν</span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> H_imp_Φ <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Φ_def 𝔄_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="main">(</span><span class="skolem">𝔄</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> H_imp_Φ <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Φ_def 𝔄_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> tp_𝔄<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="skolem">ν</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ν</span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> H_imp_Φ <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Φ_def 𝔄_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"range <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> S_dec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="skolem">k</span><span class="main">)</span> <span class="main">`</span> elts <span class="free">β</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span><span class="skolem">𝔄</span> <span class="skolem">m</span> <span class="main">`</span> elts <span class="free">β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">m</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> 14 g <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">fastforce</span><span class="keyword3">+</span>›</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">K</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">x</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">ν</span> <span class="main">∈</span> elts <span class="free">β</span><span class="main">.</span> <span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="bound">ν</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted">"15"</span> UN_I μ_in_β<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">ν</span> <span class="main">∈</span> elts <span class="free">β</span><span class="main">.</span> <span class="skolem">𝔄</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="bound">ν</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> S_dec <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">m</span>"</span></span><span class="main">]</span> less_iff_Suc_add that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="skolem">K</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">x</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">{</span><span class="skolem">x</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">x</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> K_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Z_K1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="var">?Z</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_2_eq<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> insert_commute less_linear<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> Z_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Z</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"15"</span> 𝔄_αβ μ_in_β <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tp <span class="var">?Z</span> <span class="main">≥</span> ω <span class="main">*</span> <span class="free">β</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">𝔤</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔤</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">x</span><span class="main">.</span> wfrec <span class="main">(</span>measure <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">j</span><span class="main">-</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">𝔤</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span><span class="main">&lt;</span><span class="bound">j</span> <span class="keyword1">then</span> <span class="skolem">g</span> <span class="bound">k</span> <span class="main">(</span><span class="bound">𝔤</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">i</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> 𝔤<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔤</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span> <span class="keyword1">then</span> <span class="skolem">g</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">𝔤</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">j</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 𝔤_def wfrec cut_apply<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> 17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔤</span> <span class="skolem">k</span> <span class="skolem">j</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
          <span class="keyword1"><span class="command">using</span></span> wf_measure <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">j</span><span class="main">-</span><span class="bound">k</span>"</span></span><span class="main">]</span> that
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"13"</span> 𝔤 le_imp_less_Suc<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> 𝔤_in_β<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔤</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">ν</span>  <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">ν</span>
          <span class="keyword1"><span class="command">using</span></span> wf_measure <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">j</span><span class="main">-</span><span class="bound">k</span>"</span></span><span class="main">]</span> that
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">i</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> g <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝔤 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 𝔤_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔤</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">∈</span> elts <span class="free">β</span> <span class="main">→</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> sm_𝔤<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_on <span class="main">(</span><span class="skolem">𝔤</span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
          <span class="keyword1"><span class="command">using</span></span> wf_measure <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">j</span><span class="main">-</span><span class="bound">k</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">i</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> sm_g <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝔤 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="main">]</span></span> strict_mono_on_def 𝔤_in_β<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="skolem">j</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">𝔄</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">𝔤</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
          <span class="keyword1"><span class="command">using</span></span> wf_measure <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">j</span><span class="main">-</span><span class="bound">k</span>"</span></span><span class="main">]</span> that
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">i</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">-</span> Suc <span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Suc_diff_Suc lessI<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> less 𝔤_in_β <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 𝔤 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> 17 Suc_lessI μ_in_β order_refl order_trans x14<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔤</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">μ</span> <span class="skolem">i</span> <span class="main">⟷</span> <span class="skolem">μ</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">μ</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
          <span class="keyword1"><span class="command">using</span></span> sm_𝔤 <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_on_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"17"</span> Ord_in_Ord Ord_linear2 μ_in_β leD le_refl less_V_def <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔤</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">μ</span> <span class="skolem">i</span> <span class="main">⟷</span> <span class="skolem">μ</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">μ</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"17"</span> μ_in_β less_V_def order_refl sm_𝔤 strict_mono_on_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔤</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="skolem">i</span> <span class="main">⟷</span> <span class="skolem">μ</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_refl le less less_le<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> 18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="skolem">m</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⟷</span> <span class="skolem">μ</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">μ</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> less
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="skolem">m</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">𝔄</span> <span class="skolem">m</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="skolem">m</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span> <span class="quoted">"15"</span> eq less less_V_def less_sets_def less_sets_weaken2 that<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">𝔄</span> <span class="skolem">m</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">μ</span> <span class="skolem">m</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> that 12 15 * <span class="main">[</span><span class="operator">OF</span> less<span class="main">]</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def strict_mono_sets_def<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_in_Ord Ord_linear2 𝔤_in_β μ_in_β <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> le leD less_asym subsetD<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">μ</span> <span class="skolem">n</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_in_Ord Ord_linear_lt μ_in_β <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">μ</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">𝔤</span> <span class="skolem">n</span> <span class="skolem">m</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"12"</span> 𝔤_in_β μ_in_β eq le less_V_def strict_mono_sets_def<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="skolem">m</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> *<span class="main"><span class="main">[</span></span><span class="operator">OF</span> less<span class="main"><span class="main">]</span></span> less_sets_weaken1<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> equal
          <span class="keyword1"><span class="command">with</span></span> 15 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> greater
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="skolem">m</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">𝔄</span> <span class="skolem">m</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="skolem">m</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span> <span class="quoted">"15"</span> disjnt_iff eq greater in_mono less_sets_imp_disjnt that<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">𝔄</span> <span class="skolem">m</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">μ</span> <span class="skolem">m</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> that 12 15 * <span class="main">[</span><span class="operator">OF</span> greater<span class="main">]</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def strict_mono_sets_def<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> 𝔤_in_β μ_in_β in_mono less less_asym<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">μ</span> <span class="skolem">n</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_μ Ord_linear_lt<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">μ</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="skolem">m</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≪</span> <span class="main">(</span><span class="skolem">𝔄</span> <span class="skolem">m</span> <span class="main">(</span><span class="skolem">𝔤</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> 12 Ord_in_Ord Ord_linear2 𝔤_in_β μ_in_β le leD ord<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> strict_mono_sets_def<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="skolem">m</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted">"*"</span> greater less_sets_weaken2<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> 𝔄_increasing_μ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">𝔄</span> <span class="skolem">m</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span> <span class="quoted">"17"</span> dual_order.order_iff_strict that<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> INF<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">μ</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">q</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">m</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> q_def
            <span class="keyword1"><span class="command">using</span></span> to_nat_on_infinite <span class="main">[</span><span class="operator">OF</span> co_βU inf_βU<span class="main">]</span> finite_image_iff
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_image_iff inj_on_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">q</span> <span class="main">(</span><span class="skolem">μ</span> <span class="skolem">m</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">μ</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 11 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="skolem">m</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">μ</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">μ</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="bound">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_nat_set_iff_bounded Bex_def not_less<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?eqv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="skolem">μ</span> <span class="bound">m</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> sm_x<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_on <span class="skolem">x</span> <span class="main">(</span><span class="var">?eqv</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_mono_on_def<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">p</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> 16 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="skolem">p</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span> <span class="quoted">"15"</span> <span class="quoted">"17"</span> Suc_lessI le_SucI subsetD<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> inj_x<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">x</span> <span class="main">(</span><span class="var">?eqv</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
          <span class="keyword1"><span class="command">using</span></span> strict_mono_on_imp_inj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ZA</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ZA</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="var">?Z</span> <span class="main">∩</span> <span class="skolem">𝔄</span> <span class="bound">m</span> <span class="main">(</span><span class="skolem">μ</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> small_ZA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">ZA</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ZA_def inf_le1 small_image_nat smaller_than_small<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> 19<span class="main">:</span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span><span class="skolem">ZA</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≥</span> ω"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">`</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="skolem">μ</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">μ</span> <span class="bound">n</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">ZA</span> <span class="skolem">m</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> ZA_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"15"</span> 𝔄_increasing_μ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="skolem">ZA</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> INF <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> finite_image_iff <span class="main">[</span><span class="operator">OF</span> inj_x<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_subset<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordertype_infinite_ge_ω<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span> <span class="main">∈</span> elts ω <span class="main">→</span> <span class="skolem">ZA</span> <span class="skolem">m</span><span class="main">.</span> strict_mono_on <span class="bound">f</span> <span class="main">(</span>elts ω<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">⊆</span> <span class="skolem">ZA</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">Z</span> <span class="main">=</span> ω"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> 19 Ord_ω le_ordertype_obtains_subset small_ZA<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ZA</span> <span class="skolem">m</span> <span class="main">⊆</span> ON"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord 𝔄_αβ μ_in_β <span class="keyword1"><span class="command">unfolding</span></span> ZA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> strict_mono_on_ordertype Pi_mono small_ZA smaller_than_small subset_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> φ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">φ</span> <span class="bound">m</span> <span class="main">∈</span> elts ω <span class="main">→</span> <span class="skolem">ZA</span> <span class="bound">m</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> sm_φ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> strict_mono_on <span class="main">(</span><span class="skolem">φ</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span>elts ω<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ex<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">ν</span><span class="main">)</span><span class="main">.</span> <span class="bound">ν</span> <span class="main">∈</span> elts <span class="free">β</span> <span class="main">∧</span> <span class="skolem">γ</span> <span class="main">=</span> ω <span class="main">*</span> <span class="bound">ν</span> <span class="main">+</span> ord_of_nat <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω <span class="main">*</span> <span class="free">β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">γ</span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">ω</span> <span class="quoted"><span class="free">β</span></span><span class="main"><span class="main">]</span></span> lift_def elts_ω<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">split</span></span> <span class="keyword2"><span class="keyword">where</span></span> split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">γ</span><span class="main">.</span> <span class="bound">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω <span class="main">*</span> <span class="free">β</span><span class="main">)</span> <span class="main">⟹</span>
             <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">ν</span><span class="main">)</span><span class="main">.</span> <span class="bound">ν</span> <span class="main">∈</span> elts <span class="free">β</span> <span class="main">∧</span> <span class="bound">γ</span> <span class="main">=</span> ω <span class="main">*</span> <span class="bound">ν</span> <span class="main">+</span> ord_of_nat <span class="bound">m</span><span class="main">)</span><span class="main">(</span><span class="skolem">split</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
        <span class="keyword1"><span class="command">have</span></span> split_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">split</span> <span class="main">(</span>ω <span class="main">*</span> <span class="skolem">ν</span> <span class="main">+</span> ord_of_nat <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">m</span><span class="main">,</span><span class="skolem">ν</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ν</span> <span class="skolem">m</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ω <span class="main">*</span> <span class="skolem">ν</span> <span class="main">+</span> ord_of_nat <span class="skolem">m</span> <span class="main">=</span> ω <span class="main">*</span> <span class="skolem">ξ</span> <span class="main">+</span> ord_of_nat <span class="skolem">n</span> <span class="main">⟷</span> <span class="skolem">ξ</span> <span class="main">=</span> <span class="skolem">ν</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ξ</span> <span class="skolem">n</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω that Ord_mem_iff_less_TC mult_cancellation_lemma ord_of_nat_ω ord_of_nat_inject<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> split <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ω<span class="main">*</span><span class="skolem">ν</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">ω</span> <span class="quoted"><span class="free">β</span></span><span class="main"><span class="main">]</span></span> lift_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> conj_cong<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">π</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">ν</span><span class="main">)</span><span class="main">.</span> <span class="skolem">φ</span> <span class="main">(</span><span class="skolem">q</span><span class="main">(</span><span class="bound">ν</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">m</span><span class="main">)</span><span class="main">(</span><span class="skolem">split</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> π_Pi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">∈</span> elts <span class="main">(</span>ω <span class="main">*</span> <span class="free">β</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">ZA</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> φ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> π_def mult <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">ω</span> <span class="quoted"><span class="free">β</span></span><span class="main"><span class="main">]</span></span> lift_def elts_ω<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">ZA</span> <span class="bound">m</span><span class="main">)</span> <span class="main">⊆</span> ON"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> ZA_def <span class="keyword1"><span class="command">using</span></span> 𝔄_αβ μ_in_β elts_subset_ON <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> Ord_π_Pi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">∈</span> elts <span class="main">(</span>ω <span class="main">*</span> <span class="free">β</span><span class="main">)</span> <span class="main">→</span> ON"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tp <span class="var">?Z</span> <span class="main">≥</span> ω <span class="main">*</span> <span class="free">β</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">ZA</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="var">?Z</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"15"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ZA_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tp <span class="main">(</span>elts <span class="main">(</span>ω <span class="main">*</span> <span class="free">β</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> tp <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">ZA</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_inc_le<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">`</span> elts <span class="main">(</span>ω <span class="main">*</span> <span class="free">β</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">ZA</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> π_Pi <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
            <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="main">(</span>ω <span class="main">*</span> <span class="free">β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="main">(</span>ω <span class="main">*</span> <span class="free">β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">&lt;</span><span class="skolem">v</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ω Ord_in_Ord Ord_mult VWF_iff_Ord_less ord<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">ν</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">ξ</span></span> <span class="keyword2"><span class="keyword">where</span></span> ueq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> ω <span class="main">*</span> <span class="skolem">ν</span> <span class="main">+</span> ord_of_nat <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ν<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> veq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> ω <span class="main">*</span> <span class="skolem">ξ</span> <span class="main">+</span> ord_of_nat <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  mult <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">ω</span> <span class="quoted"><span class="free">β</span></span><span class="main"><span class="main">]</span></span> lift_def elts_ω<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">≤</span> <span class="skolem">ξ</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ω Ord_in_Ord Ord_linear2 <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> add_mult_less_add_mult less_asym ord_of_nat_ω<span class="main">)</span>
            <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>eq<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">=</span> <span class="skolem">ξ</span>"</span></span> <span class="main">|</span> <span class="main">(</span>lt<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">&lt;</span> <span class="skolem">ξ</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ν</span> <span class="main">≤</span> <span class="skolem">ξ</span>›</span></span> le_neq_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="skolem">u</span> <span class="main">&lt;</span> <span class="skolem">π</span> <span class="skolem">v</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
              <span class="keyword3"><span class="command">case</span></span> eq
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> ueq veq <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">&lt;</span><span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">(</span><span class="skolem">ξ</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">φ</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">(</span><span class="skolem">ξ</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> sm_φ strict_mono_onD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> eq ueq veq ν <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> π_def<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> lt
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">(</span><span class="skolem">q</span><span class="main">(</span><span class="skolem">ν</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">q</span><span class="main">(</span><span class="skolem">ν</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">μ</span><span class="main">(</span><span class="skolem">q</span><span class="main">(</span><span class="skolem">ν</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">(</span><span class="skolem">ξ</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">𝔄</span> <span class="main">(</span><span class="skolem">q</span><span class="main">(</span><span class="skolem">ξ</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">μ</span><span class="main">(</span><span class="skolem">q</span><span class="main">(</span><span class="skolem">ξ</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> φ <span class="keyword1"><span class="command">unfolding</span></span> ZA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> lt ueq veq ν ξ 18 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">(</span><span class="skolem">ν</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">(</span><span class="skolem">ξ</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> π_def less_sets_def<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">π</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">π</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span>
              <span class="keyword1"><span class="command">using</span></span> π_Pi
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_π_Pi PiE VWF_iff_Ord_less x y mem_Collect_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> † <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">⊆</span> <span class="var">?Z</span>"</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">Z</span> <span class="main">=</span> ω <span class="main">*</span> <span class="free">β</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ω Ord_mult ord Z_sub down le_ordertype_obtains_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> iii <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Z</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans image_mono nsets_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword2"><span class="keyword">if</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">H</span><span class="main">.</span> tp <span class="bound">H</span> <span class="main">=</span> ord_of_nat <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">H</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">H</span><span class="main">.</span> tp <span class="bound">H</span> <span class="main">=</span> min <span class="free">γ</span> <span class="main">(</span>ω <span class="main">*</span> <span class="free">β</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">H</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ω<span class="main">*</span><span class="free">β</span> <span class="main">≤</span> <span class="free">γ</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">H'</span></span><span class="main">⊆</span><span class="skolem">H</span><span class="main">.</span> tp <span class="bound">H'</span> <span class="main">=</span> ω <span class="main">*</span> <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">H</span> <span class="main">=</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="skolem">H</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">H</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω Ord_ω1 Ord_in_Ord Ord_mult β le_ordertype_obtains_subset that<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="free">γ</span> <span class="main">(</span>ω<span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">=</span> ω<span class="main">*</span><span class="free">β</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_absorb2 that True<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> 1 True
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">meson</span> † down image_mono nsets_mono subset_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">H'</span></span><span class="main">⊆</span><span class="skolem">H</span><span class="main">.</span> tp <span class="bound">H'</span> <span class="main">=</span> <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"tp <span class="skolem">H</span> <span class="main">=</span> ω <span class="main">*</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="skolem">H</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">H</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear_le Ord_ordertype <span class="quoted"><span class="quoted">‹Ord <span class="free">γ</span>›</span></span> le_ordertype_obtains_subset that<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">≤</span> ω<span class="main">*</span><span class="free">β</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ω Ord_ω1 Ord_in_Ord Ord_linear_le Ord_mult β <span class="quoted"><span class="quoted">‹Ord <span class="free">γ</span>›</span></span> False<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="free">γ</span> <span class="main">(</span>ω<span class="main">*</span><span class="free">β</span><span class="main">)</span> <span class="main">=</span> <span class="free">γ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_absorb1<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> 1 False
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">meson</span> † down image_mono nsets_mono subset_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">H</span></span><span class="main">⊆</span>elts <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">β</span><span class="main">)</span><span class="main">.</span> tp <span class="bound">H</span> <span class="main">=</span> <span class="main">[</span>ord_of_nat <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">)</span><span class="main">,</span> min <span class="free">γ</span> <span class="main">(</span>ω<span class="main">*</span><span class="free">β</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> Erdos_Milner<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ν<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="main">∈</span> elts ω1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="main">(</span>ω<span class="main">↑</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ν</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>ord_of_nat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">,</span> ω<span class="main">↑</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ν</span><span class="main">)</span><span class="main">]</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> partn_lst_VWF_degenerate <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">ν</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_ω1 Ord_in_Ord assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">+</span><span class="free">ν</span> <span class="main">≤</span> <span class="free">ν</span><span class="main">+</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">ν</span>›</span></span> one_V_def plus_Ord_le<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="main">(</span>ω <span class="main">↑</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ν</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ω <span class="main">*</span> ω <span class="main">↑</span> <span class="free">ν</span><span class="main">)</span> <span class="main">=</span> ω <span class="main">↑</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ν</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">ν</span>›</span></span> oexp_add min_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"indecomposable <span class="main">(</span>ω <span class="main">↑</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ν</span> <span class="main">*</span> ord_of_nat <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">ν</span>›</span></span> indecomposable_ω_power<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> partn_lst_VWF_ω_2 <span class="quoted"><span class="quoted">‹Ord <span class="free">ν</span>›</span></span> one_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> less_2_cases not_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="main">(</span>ω <span class="main">↑</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ν</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> ω <span class="main">↑</span> <span class="free">ν</span><span class="main">)</span> <span class="main">[</span>ord_of_nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span><span class="main">,</span> ω <span class="main">↑</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ν</span><span class="main">)</span><span class="main">]</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Erdos_Milner_aux <span class="main">[</span><span class="operator">OF</span> Suc ind<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> β <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="free">ν</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹Ord <span class="free">ν</span>›</span></span> ν
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> countable_oexp<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">ν</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_succ mult.assoc oexp_add<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">corollary</span></span> remark_3<span class="main">:</span> <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="main">(</span>ω<span class="main">↑</span><span class="main">(</span>Suc<span class="main">(</span><span class="numeral">4</span><span class="main">*</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="numeral">4</span><span class="main">,</span> ω<span class="main">↑</span><span class="main">(</span>Suc<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Erdos_Milner <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="free">k</span>"</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> ord_of_nat_mult ord_of_nat.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_V_def<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 3.2 of Jean A. Larson, ibid.›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> Theorem_3_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="free">n</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="main">(</span>ω<span class="main">↑</span><span class="main">(</span><span class="free">n</span><span class="main">*</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>ω<span class="main">↑</span><span class="free">n</span><span class="main">,</span> ord_of_nat <span class="free">k</span><span class="main">]</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">k</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> partn_lst_triv0 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> i<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span> partn_lst_triv1 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> i<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> PV<span class="main">:</span> <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="main">(</span>ω <span class="main">↑</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ord_of_nat <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ord_of_nat <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>ord_of_nat <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> ω <span class="main">↑</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ord_of_nat <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Erdos_Milner <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> Ord_ω1 Ord_mem_iff_lt less_imp_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">+</span><span class="free">n</span> <span class="main">≤</span> Suc <span class="main">(</span>Suc<span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> Suc<span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Suc <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span><span class="main">*</span><span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> ord_of_nat <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ord_of_nat <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ord_of_nat<span class="main">(</span><span class="free">n</span><span class="main">*</span><span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def one_V_def ord_of_nat.simps ord_of_nat_add ord_of_nat_mono_iff ord_of_nat_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"ω <span class="main">↑</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ord_of_nat <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ord_of_nat <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ω<span class="main">↑</span><span class="main">(</span><span class="free">n</span><span class="main">*</span><span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> oexp_mono_le<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="main">(</span>ω<span class="main">↑</span><span class="main">(</span><span class="free">n</span><span class="main">*</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>ω <span class="main">↑</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ord_of_nat <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> ord_of_nat <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PV partn_lst_two_swap Partitions.partn_lst_greater_resource less_eq_V_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"partn_lst_VWF <span class="main">(</span>ω<span class="main">↑</span><span class="main">(</span><span class="free">n</span><span class="main">*</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>ω <span class="main">↑</span> <span class="free">n</span><span class="main">,</span> ord_of_nat <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ord_of_minus_1 <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_V_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> power_gt_expt <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_Suc_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> partn_lst_less<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Omega_Omega">
<div class="head">
<h1>Theory Omega_Omega</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹An ordinal partition theorem by Jean A. Larson›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Jean A. Larson,
     A short proof of a partition theorem for the ordinal $\omega^\omega$.
     \emph{Annals of Mathematical Logic}, 6:129–145, 1973.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Omega_Omega
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Product_Lexorder.html">HOL-Library.Product_Lexorder</a>"</span> <a href="#Erdos_Milner">Erdos_Milner</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">list_of</span> <span class="main">≡</span> sorted_list_of_set"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cantor normal form for ordinals below <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ω<span class="main"><span class="main">↑</span></span>ω"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Unlike <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Cantor_sum</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, there is no list of ordinal exponents,
which are instead taken as consecutive. We obtain an order-isomorphism between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ω<span class="main"><span class="main">↑</span></span>ω"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
and increasing lists of natural numbers (ordered lexicographically).›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">omega_sum_aux</span>  <span class="keyword2"><span class="keyword">where</span></span>
  Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">omega_sum_aux</span> <span class="main">0</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">omega_sum_aux</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">omega_sum_aux</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ω<span class="main">↑</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ord_of_nat <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="free">omega_sum_aux</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">omega_sum</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">omega_sum</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="main">≡</span> omega_sum_aux <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A normal expansion has no leading zeroes›</span></span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">normal</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  normal_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">normal</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> normal_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">normal</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Omega_Omega-omega_sum_0_iff"><span class="command">lemma</span></span> omega_sum_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"normal <span class="free">ns</span> <span class="main">⟹</span> omega_sum <span class="free">ns</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">ns</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ns</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-Ord_omega_sum_aux"><span class="command">lemma</span></span> Ord_omega_sum_aux <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>omega_sum_aux <span class="free">k</span> <span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> omega_sum_aux.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-Ord_omega_sum"><span class="command">lemma</span></span> Ord_omega_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>omega_sum <span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Omega_Omega-omega_sum_less_ωω"><span class="command">lemma</span></span> omega_sum_less_ωω <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"omega_sum <span class="free">ms</span> <span class="main">&lt;</span> ω<span class="main">↑</span>ω"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_less_Limit<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">↑</span> <span class="main">(</span>length <span class="skolem">ms</span><span class="main">)</span> <span class="main">*</span> ord_of_nat <span class="skolem">m</span> <span class="main">∈</span> elts <span class="main">(</span>ω <span class="main">↑</span> Suc <span class="main">(</span>length <span class="skolem">ms</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_mem_iff_lt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="main">(</span>length <span class="skolem">ms</span><span class="main">)</span> <span class="main">*</span> ord_of_nat <span class="skolem">m</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span>ω<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_ord_of_nat oexp_mono_le omega_nonzero ord_of_nat_le_omega <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_succ OrdmemD oexp_less indecomposableD indecomposable_ω_power<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Omega_Omega-omega_sum_aux_less"><span class="command">lemma</span></span> omega_sum_aux_less<span class="main">:</span> <span class="quoted"><span class="quoted">"omega_sum_aux <span class="free">k</span> <span class="free">ms</span> <span class="main">&lt;</span> ω <span class="main">↑</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> omega_sum_aux.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">n</span> <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" ω<span class="main">↑</span><span class="skolem">n</span> <span class="main">*</span> ord_of_nat <span class="skolem">m</span> <span class="main">+</span> ω<span class="main">↑</span><span class="skolem">n</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">n</span> <span class="main">*</span> ω"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ord_of_nat ω_power_succ_gtr mult_succ oexp_succ ord_of_nat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> dual_order.strict_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-omega_sum_less"><span class="command">lemma</span></span> omega_sum_less<span class="main">:</span> <span class="quoted"><span class="quoted">"omega_sum <span class="free">ms</span> <span class="main">&lt;</span> ω <span class="main">↑</span> <span class="main">(</span>length <span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> omega_sum_aux_less<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-omega_sum_ge"><span class="command">lemma</span></span> omega_sum_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> ω <span class="main">↑</span> <span class="main">(</span>length <span class="free">ms</span><span class="main">)</span> <span class="main">≤</span> omega_sum <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ord_of_nat add_le_cancel_left0 le_mult Nat.neq0_conv ord_of_eq_0_iff vsubsetD<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-omega_sum_length_less"><span class="command">lemma</span></span> omega_sum_length_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ms</span> <span class="main">&lt;</span> length <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"normal <span class="free">ns</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"omega_sum <span class="free">ms</span> <span class="main">&lt;</span> omega_sum <span class="free">ns</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ns</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">n</span> <span class="skolem">ns'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">↑</span> length <span class="free">ms</span> <span class="main">≤</span> ω <span class="main">↑</span> length <span class="skolem">ns'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms local.Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> oexp_mono_le<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> omega_sum <span class="main">(</span><span class="skolem">n</span><span class="main">#</span><span class="skolem">ns'</span><span class="main">)</span> <span class="main">≤</span> omega_sum <span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> omega_sum_ge <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">ns'</span></span><span class="main">]</span> omega_sum_less <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹normal <span class="free">ns</span>›</span></span> local.Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear2 Ord_omega_sum local.Cons<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Omega_Omega-omega_sum_length_leD"><span class="command">lemma</span></span> omega_sum_length_leD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"omega_sum <span class="free">ms</span> <span class="main">≤</span> omega_sum <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"normal <span class="free">ms</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ms</span> <span class="main">≤</span> length <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms leD leI omega_sum_length_less<span class="main">)</span>


<span class="keyword1" id="Omega_Omega-omega_sum_less_eqlen_iff_cases"><span class="command">lemma</span></span> omega_sum_less_eqlen_iff_cases <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ms</span> <span class="main">=</span> length <span class="free">ns</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"omega_sum <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">&lt;</span> omega_sum <span class="main">(</span><span class="free">n</span><span class="main">#</span><span class="free">ns</span><span class="main">)</span>
          <span class="main">⟷</span> <span class="free">m</span><span class="main">&lt;</span><span class="free">n</span> <span class="main">∨</span> <span class="free">m</span><span class="main">=</span><span class="free">n</span> <span class="main">∧</span> omega_sum <span class="free">ms</span> <span class="main">&lt;</span> omega_sum <span class="free">ns</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Suc <span class="free">n</span> <span class="main">&lt;</span> Suc <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> omega_sum_less <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span> omega_sum_less <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ns</span></span><span class="main">]</span> L assms mult_nat_less_add_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">≤</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> L assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_nat_less_add_less omega_sum_aux_less assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Omega_Omega-omega_sum_lex_less_iff_cases"><span class="command">lemma</span></span> omega_sum_lex_less_iff_cases<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="free">ms</span><span class="main">,</span> omega_sum <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>length <span class="free">ns</span><span class="main">,</span> omega_sum <span class="main">(</span><span class="free">n</span><span class="main">#</span><span class="free">ns</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> less_than <span class="keyword1">&lt;*lex*&gt;</span> VWF
   <span class="main">⟷</span> length <span class="free">ms</span> <span class="main">&lt;</span> length <span class="free">ns</span>
            <span class="main">∨</span> length <span class="free">ms</span> <span class="main">=</span> length <span class="free">ns</span> <span class="main">∧</span> <span class="free">m</span><span class="main">&lt;</span><span class="free">n</span>
            <span class="main">∨</span> <span class="free">m</span><span class="main">=</span><span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>length <span class="free">ms</span><span class="main">,</span> omega_sum <span class="free">ms</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>length <span class="free">ns</span><span class="main">,</span> omega_sum <span class="free">ns</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> less_than <span class="keyword1">&lt;*lex*&gt;</span> VWF"</span></span>
  <span class="keyword1"><span class="command">using</span></span> omega_sum_less_eqlen_iff_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Omega_Omega-omega_sum_less_iff_cases"><span class="command">lemma</span></span> omega_sum_less_iff_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"omega_sum <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">&lt;</span> omega_sum <span class="main">(</span><span class="free">n</span><span class="main">#</span><span class="free">ns</span><span class="main">)</span>
          <span class="main">⟷</span> length <span class="free">ms</span> <span class="main">&lt;</span> length <span class="free">ns</span>
            <span class="main">∨</span> length <span class="free">ms</span> <span class="main">=</span> length <span class="free">ns</span> <span class="main">∧</span> <span class="free">m</span><span class="main">&lt;</span><span class="free">n</span>
            <span class="main">∨</span> length <span class="free">ms</span> <span class="main">=</span> length <span class="free">ns</span> <span class="main">∧</span> <span class="free">m</span><span class="main">=</span><span class="free">n</span> <span class="main">∧</span> omega_sum <span class="free">ms</span> <span class="main">&lt;</span> omega_sum <span class="free">ns</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ms</span> <span class="main">≤</span> length <span class="free">ns</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> omega_sum_length_leD <span class="main">[</span><span class="operator">OF</span> less_imp_le <span class="main"><span class="main">[</span></span><span class="operator">OF</span> L<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">≤</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ms</span> <span class="main">=</span> length <span class="free">ns</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> L omega_sum_less_eqlen_iff_cases that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"omega_sum <span class="main">(</span><span class="free">m</span> <span class="main">#</span> <span class="free">ms</span><span class="main">)</span> <span class="main">&lt;</span> omega_sum <span class="main">(</span><span class="free">n</span> <span class="main">#</span> <span class="free">ns</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ms</span> <span class="main">&lt;</span> length <span class="free">ns</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_mono <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> length_Cons normal_Suc omega_sum_length_less<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> omega_sum_less_eqlen_iff_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Omega_Omega-omega_sum_less_iff"><span class="command">lemma</span></span> omega_sum_less_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="free">ms</span><span class="main">,</span> omega_sum <span class="free">ms</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>length <span class="free">ns</span><span class="main">,</span> omega_sum <span class="free">ns</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> less_than <span class="keyword1">&lt;*lex*&gt;</span> VWF
   <span class="main">⟷</span> <span class="main">(</span><span class="free">ms</span><span class="main">,</span><span class="free">ns</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ns</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">ns</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">n</span> <span class="skolem">ns'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> omega_sum_lex_less_iff_cases <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ms</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">ns'</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> Cons.prems
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons_lenlex_iff lenlex_length order.not_eq_order_implies_strict nat_less_le<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Omega_Omega-eq_omega_sum_less_iff"><span class="command">lemma</span></span> eq_omega_sum_less_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ms</span> <span class="main">=</span> length <span class="free">ns</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>omega_sum <span class="free">ms</span><span class="main">,</span> omega_sum <span class="free">ns</span><span class="main">)</span> <span class="main">∈</span> VWF <span class="main">⟷</span> <span class="main">(</span><span class="free">ms</span><span class="main">,</span><span class="free">ns</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms in_lex_prod less_not_refl less_than_iff omega_sum_less_iff<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-eq_omega_sum_eq_iff"><span class="command">lemma</span></span> eq_omega_sum_eq_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ms</span> <span class="main">=</span> length <span class="free">ns</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"omega_sum <span class="free">ms</span> <span class="main">=</span> omega_sum <span class="free">ns</span> <span class="main">⟷</span> <span class="free">ms</span><span class="main">=</span><span class="free">ns</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"omega_sum <span class="free">ms</span> <span class="main">=</span> omega_sum <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>omega_sum <span class="free">ms</span><span class="main">,</span> omega_sum <span class="free">ns</span><span class="main">)</span> <span class="main">∉</span> VWF"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>omega_sum <span class="free">ns</span><span class="main">,</span> omega_sum <span class="free">ms</span><span class="main">)</span> <span class="main">∉</span> VWF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ms</span><span class="main">,</span><span class="free">ns</span><span class="main">)</span> <span class="main">∉</span> lenlex less_than"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ns</span><span class="main">,</span><span class="free">ms</span><span class="main">)</span> <span class="main">∉</span> lenlex less_than"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms eq_omega_sum_less_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"total <span class="main">(</span>lenlex less_than<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> total_lenlex total_less_than<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ms</span><span class="main">=</span><span class="free">ns</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I total_on_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-inj_omega_sum"><span class="command">lemma</span></span> inj_omega_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on omega_sum <span class="main">{</span><span class="bound">l</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">using</span></span> eq_omega_sum_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Omega_Omega-Ex_omega_sum"><span class="command">lemma</span></span> Ex_omega_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">ns</span><span class="main">.</span> <span class="free">γ</span> <span class="main">=</span> omega_sum <span class="bound">ns</span> <span class="main">∧</span> length <span class="bound">ns</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">γ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω <span class="main">↑</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> kmin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k'</span><span class="main">.</span> <span class="bound">k'</span><span class="main">&lt;</span><span class="skolem">k</span> <span class="main">⟹</span> <span class="skolem">γ</span> <span class="main">∉</span> elts <span class="main">(</span>ω <span class="main">↑</span> <span class="skolem">n</span> <span class="main">*</span> <span class="bound">k'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ord_of_nat elts_mult_ωE oexp_succ ord_of_nat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">δ</span></span> <span class="keyword2"><span class="keyword">where</span></span> δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> <span class="main">(</span>ω <span class="main">↑</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">k'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">δ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lessI mult_succ ord_of_nat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> k kmin mem_plus_V_E<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> δin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">∈</span> elts <span class="main">(</span>ω <span class="main">↑</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc k mult_succ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">=</span> omega_sum <span class="skolem">ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"omega_sum <span class="skolem">ns</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> OrdmemD ns δin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">k'</span><span class="main">#</span><span class="skolem">ns</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> δ<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> k <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Omega_Omega-omega_sum_drop"><span class="command">lemma</span></span> omega_sum_drop <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"omega_sum <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="free">ns</span><span class="main">)</span> <span class="main">=</span> omega_sum <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ns</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-normal_drop"><span class="command">lemma</span></span> normal_drop <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"normal <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="free">ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ns</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-omega_sum_ωω"><span class="command">lemma</span></span> omega_sum_ωω<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span>ω<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> omega_sum <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"normal <span class="free">ns</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ms</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> omega_sum <span class="skolem">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Ex_omega_sum <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> oexp_Limit elts_ω<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> omega_sum <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="skolem">ms</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">γ</span> <span class="main">=</span> omega_sum <span class="skolem">ms</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"normal <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="skolem">ms</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Cantor_ωω</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> nat list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Cantor_ωω</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">ns</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> omega_sum <span class="bound">ns</span> <span class="main">∧</span> normal <span class="bound">ns</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span>ω<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> Cantor_ωω<span class="main">:</span> <span class="quoted"><span class="quoted">"omega_sum <span class="main">(</span>Cantor_ωω <span class="free">γ</span><span class="main">)</span> <span class="main">=</span> <span class="free">γ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> normal_Cantor_ωω<span class="main">:</span> <span class="quoted"><span class="quoted">"normal <span class="main">(</span>Cantor_ωω <span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Cantor_ωω_def assms omega_sum_ωω someI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Larson's set $W(n)$›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">WW</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">WW</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">l</span><span class="main">.</span> strict_sorted <span class="bound">l</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">into_WW</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list <span class="main">⇒</span> nat list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">into_WW</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">into_WW</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free">into_WW</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">from_WW</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list <span class="main">⇒</span> nat list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">from_WW</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">from_WW</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free">from_WW</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span>"</span></span>

<span class="keyword1" id="Omega_Omega-from_into_WW"><span class="command">lemma</span></span> from_into_WW <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"from_WW <span class="free">k</span> <span class="main">(</span>into_WW <span class="free">k</span> <span class="free">ns</span><span class="main">)</span> <span class="main">=</span> <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-inj_into_WW"><span class="command">lemma</span></span> inj_into_WW<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>into_WW <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_into_WW injI<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-into_from_WW_aux"><span class="command">lemma</span></span> into_from_WW_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>strict_sorted <span class="free">ns</span><span class="main">;</span> <span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>list.set <span class="free">ns</span><span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">⟧</span> <span class="main">⟹</span> into_WW <span class="free">k</span> <span class="main">(</span>from_WW <span class="free">k</span> <span class="free">ns</span><span class="main">)</span> <span class="main">=</span> <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_leI<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-into_from_WW"><span class="command">lemma</span></span> into_from_WW <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="free">ns</span> <span class="main">⟹</span> into_WW <span class="main">0</span> <span class="main">(</span>from_WW <span class="main">0</span> <span class="free">ns</span><span class="main">)</span> <span class="main">=</span> <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> into_from_WW_aux<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-into_WW_imp_ge"><span class="command">lemma</span></span> into_WW_imp_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> List.set <span class="main">(</span>into_WW <span class="free">x</span> <span class="free">ns</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Omega_Omega-strict_sorted_into_WW"><span class="command">lemma</span></span> strict_sorted_into_WW<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>into_WW <span class="free">x</span> <span class="free">ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> into_WW_imp_ge<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-length_into_WW"><span class="command">lemma</span></span> length_into_WW<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>into_WW <span class="free">x</span> <span class="free">ns</span><span class="main">)</span> <span class="main">=</span> length <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-WW_eq_range_into"><span class="command">lemma</span></span> WW_eq_range_into<span class="main">:</span> <span class="quoted"><span class="quoted">"WW <span class="main">=</span> range <span class="main">(</span>into_WW <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> WW_def equalityI image_subset_iff into_from_WW mem_Collect_eq rangeI strict_sorted_into_WW subset_iff<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-into_WW_lenlex_iff"><span class="command">lemma</span></span> into_WW_lenlex_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>into_WW <span class="free">k</span> <span class="free">ms</span><span class="main">,</span> into_WW <span class="free">k</span> <span class="free">ns</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than <span class="main">⟷</span> <span class="main">(</span><span class="free">ms</span><span class="main">,</span> <span class="free">ns</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ns</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> length_0_conv length_into_WW<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">ns</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Cons_lenlex_iff length_into_WW<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Omega_Omega-wf_llt"><span class="command">lemma</span></span> wf_llt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>lenlex less_than<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Omega_Omega-trans_llt"><span class="command">lemma</span></span> trans_llt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>lenlex less_than<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Omega_Omega-total_llt"><span class="command">lemma</span></span> total_llt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="main">(</span>lenlex less_than<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I total_lenlex total_less_than total_on_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-omega_sum_1_less"><span class="command">lemma</span></span> omega_sum_1_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ms</span><span class="main">,</span><span class="free">ns</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"omega_sum <span class="main">(</span><span class="main">1</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">&lt;</span> omega_sum <span class="main">(</span><span class="main">1</span><span class="main">#</span><span class="free">ns</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"omega_sum <span class="main">(</span><span class="main">1</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">&lt;</span> omega_sum <span class="main">(</span><span class="main">1</span><span class="main">#</span><span class="free">ns</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ms</span> <span class="main">&lt;</span> length <span class="free">ns</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> omega_sum_less_iff_cases that zero_less_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_succ <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> omega_sum_less_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Omega_Omega-ordertype_WW_1"><span class="command">lemma</span></span> ordertype_WW_1<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype WW <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">≤</span> ordertype UNIV <span class="main">(</span>lenlex less_than<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-ordertype_WW_2"><span class="command">lemma</span></span> ordertype_WW_2<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype UNIV <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">≤</span> ω<span class="main">↑</span>ω"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_inc_le_Ord<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">λ</span><span class="bound">ms</span><span class="main">.</span> omega_sum <span class="main">(</span><span class="main">1</span><span class="main">#</span><span class="bound">ms</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> elts <span class="main">(</span>ω<span class="main">↑</span>ω<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ω Ord_mem_iff_lt Ord_oexp Ord_omega_sum image_subset_iff omega_sum_less_ωω<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> omega_sum_1_less <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Omega_Omega-ordertype_WW_3"><span class="command">lemma</span></span> ordertype_WW_3<span class="main">:</span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span>ω <span class="main">≤</span> ordertype WW <span class="main">(</span>lenlex less_than<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">π</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">≡</span> into_WW <span class="main">0</span> <span class="main">∘</span> Cantor_ωω"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ωω<span class="main">:</span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span>ω <span class="main">=</span> tp <span class="main">(</span>elts <span class="main">(</span>ω<span class="main">↑</span>ω<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ordertype WW <span class="main">(</span>lenlex less_than<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_inc_le<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">α</span> <span class="skolem">β</span>
    <span class="keyword3"><span class="command">assume</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span>ω<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span>ω<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">α</span><span class="main">,</span> <span class="skolem">β</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span><span class="main">&lt;</span><span class="skolem">β</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_in_Ord Ord_ordertype VWF_iff_Ord_less ωω<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>Cantor_ωω <span class="skolem">α</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span>Cantor_ωω <span class="skolem">β</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> α β <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cantor_ωω normal_Cantor_ωω omega_sum_length_leD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> α β * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Cantor_ωω <span class="skolem">α</span><span class="main">,</span> Cantor_ωω <span class="skolem">β</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Cantor_ωω <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> omega_sum_less_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">π</span> <span class="skolem">α</span><span class="main">,</span> <span class="skolem">π</span> <span class="skolem">β</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> π_def into_WW_lenlex_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">`</span> elts <span class="main">(</span>ω<span class="main">↑</span>ω<span class="main">)</span> <span class="main">⊆</span> WW"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> π_def WW_def strict_sorted_into_WW<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span>ω <span class="main">≤</span> ordertype WW <span class="main">(</span>lenlex less_than<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Omega_Omega-ordertype_WW"><span class="command">lemma</span></span> ordertype_WW<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype WW <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">=</span> ω<span class="main">↑</span>ω"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ordertype_UNIV_ωω<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype UNIV <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">=</span> ω<span class="main">↑</span>ω"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ordertype_WW_1 ordertype_WW_2 ordertype_WW_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Omega_Omega-ordertype_ωω"><span class="command">lemma</span></span> ordertype_ωω<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> ordertype <span class="main">(</span><span class="free">F</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">=</span> ω<span class="main">↑</span><span class="bound">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="main">⋃</span><span class="bound">j</span><span class="main">.</span> <span class="free">F</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">=</span> ω<span class="main">↑</span>ω"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">≤</span> ω <span class="main">↑</span> ω"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordertype_UNIV_ωω ordertype_mono small top_greatest trans_llt wf_llt<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> ω <span class="main">↑</span> ord_of_nat <span class="bound">n</span> <span class="main">≤</span> ordertype <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TC_small Union_upper assms ordertype_mono rangeI trans_llt wf_llt<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">↑</span> ω <span class="main">≤</span> ordertype <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> oexp_ω_Limit ZFC_in_HOL.SUP_le_iff elts_ω<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="entity">WW_seg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">WW_seg</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> WW<span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Omega_Omega-WW_seg_subset_WW"><span class="command">lemma</span></span> WW_seg_subset_WW<span class="main">:</span> <span class="quoted"><span class="quoted">"WW_seg <span class="free">n</span> <span class="main">⊆</span> WW"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WW_seg_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-WW_eq_UN_WW_seg"><span class="command">lemma</span></span> WW_eq_UN_WW_seg<span class="main">:</span> <span class="quoted"><span class="quoted">"WW <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">n</span><span class="main">.</span> WW_seg <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WW_seg_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-ordertype_list_seg"><span class="command">lemma</span></span> ordertype_list_seg<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="main">{</span><span class="bound">l</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">=</span> ω<span class="main">↑</span><span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw omega_sum <span class="main">{</span><span class="bound">l</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">(</span>elts <span class="main">(</span>ω<span class="main">↑</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> WW_seg_def bij_betw_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_omega_sum Ord_mem_iff_lt omega_sum_less <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Ex_omega_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ordertype_eq_iff <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> eq_omega_sum_less_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Omega_Omega-ordertype_WW_seg"><span class="command">lemma</span></span> ordertype_WW_seg<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>WW_seg <span class="free">n</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">=</span> ω<span class="main">↑</span><span class="free">n</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="var">?W</span> <span class="var">?R</span> <span class="main">=</span> ω<span class="main">↑</span><span class="free">n</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">{</span><span class="bound">l</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="var">?R</span> <span class="main">=</span> ordertype <span class="var">?W</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ordertype_eq_ordertype<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="main">{</span><span class="bound">l</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="var">?W</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">l</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="bound">l</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>into_WW <span class="main">0</span><span class="main">)</span> <span class="main">{</span><span class="bound">l</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_into_WW inj_onI<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>into_WW <span class="main">0</span><span class="main">)</span> <span class="main">{</span><span class="bound">l</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="var">?W</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def WW_seg_def WW_eq_range_into length_into_WW<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> into_WW_lenlex_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ordertype_list_seg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions required for the lemmas›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Larson's "$&lt;$"-relation on ordered lists›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> list <span class="main">::</span> <span class="main">(</span><span class="quoted">ord</span><span class="main">)</span><span class="quoted">ord</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> last <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">&lt;</span> hd <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">xs</span> <span class="free">ys</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">xs</span> <span class="free">ys</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Omega_Omega-less_Nil"><span class="command">lemma</span></span> less_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">&lt;</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">&lt;</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_list_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-less_sets_imp_list_less"><span class="command">lemma</span></span> less_sets_imp_list_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"list.set <span class="free">xs</span> <span class="main">≪</span> list.set <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">&lt;</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms last_in_set less_list_def less_sets_def list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Omega_Omega-less_sets_imp_sorted_list_of_set"><span class="command">lemma</span></span> less_sets_imp_sorted_list_of_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≪</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_of <span class="free">A</span> <span class="main">&lt;</span> list_of <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms less_sets_imp_list_less<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-sorted_list_of_set_imp_less_sets"><span class="command">lemma</span></span> sorted_list_of_set_imp_less_sets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">&lt;</span> <span class="free">ys</span>"</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list.set <span class="free">xs</span> <span class="main">≪</span> list.set <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sorted_hd_le sorted_le_last
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_list_def less_sets_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order.trans<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-less_list_iff_less_sets"><span class="command">lemma</span></span> less_list_iff_less_sets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">&lt;</span> <span class="free">ys</span> <span class="main">⟷</span> list.set <span class="free">xs</span> <span class="main">≪</span> list.set <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sorted_hd_le sorted_le_last
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_list_def less_sets_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order.trans<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-sorted_trans"><span class="command">lemma</span></span> sorted_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">&lt;</span> <span class="free">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">&lt;</span> <span class="free">zs</span>"</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">&lt;</span> <span class="free">zs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> less_list_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.strict_trans last_in_set leD neqE sorted_hd_le<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-strict_sorted_imp_append_less"><span class="command">lemma</span></span> strict_sorted_imp_append_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">&lt;</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def sorted_wrt_append strict_sorted_sorted_wrt<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-strict_sorted_append_iff"><span class="command">lemma</span></span> strict_sorted_append_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">xs</span> <span class="main">&lt;</span> <span class="free">ys</span> <span class="main">∧</span> strict_sorted <span class="free">xs</span> <span class="main">∧</span> strict_sorted <span class="free">ys</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sorted_wrt_append strict_sorted_sorted_wrt less_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> R<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> list.set <span class="free">xs</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> list.set <span class="free">ys</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_setsD sorted_list_of_set_imp_less_sets strict_sorted_imp_sorted <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> R <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sorted_wrt_append strict_sorted_sorted_wrt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Omega_Omega-singleton_less_list_iff"><span class="command">lemma</span></span> singleton_less_list_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">]</span> <span class="main">&lt;</span> <span class="free">xs</span> <span class="main">⟷</span> <span class="main">{..</span><span class="free">n</span><span class="main">}</span> <span class="main">∩</span> list.set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def set_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff less_le_trans list.set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> not_le sorted_hd_le<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-less_last_iff"><span class="command">lemma</span></span> less_last_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">&lt;</span> <span class="free">ys</span> <span class="main">⟷</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">&lt;</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-less_Cons_iff"><span class="command">lemma</span></span> less_Cons_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">[]</span> <span class="free">ys</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">#</span><span class="free">ys</span> <span class="main">⟷</span> <span class="free">xs</span> <span class="main">&lt;</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-less_hd_imp_less"><span class="command">lemma</span></span> less_hd_imp_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">&lt;</span> <span class="main">[</span>hd <span class="free">ys</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">&lt;</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-last_less_imp_less"><span class="command">lemma</span></span> last_less_imp_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>last <span class="free">xs</span><span class="main">]</span> <span class="main">&lt;</span> <span class="free">ys</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">&lt;</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-strict_sorted_concat_I"><span class="command">lemma</span></span> strict_sorted_concat_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> list.set <span class="free">xs</span> <span class="main">⟹</span> strict_sorted <span class="bound">x</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> Suc <span class="bound">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="free">xs</span><span class="main">!</span><span class="bound">n</span> <span class="main">&lt;</span> <span class="free">xs</span><span class="main">!</span>Suc <span class="bound">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> concat <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Compl_iff hd_concat insertI1 length_greater_0_conv length_pos_if_in_set list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lists.cases nth_Cons_0<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_sorted_append_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Nash Williams for lists›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Thin sets of lists›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">initial_segment</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">initial_segment</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">thin</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">∧</span> initial_segment <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Omega_Omega-initial_segment_ne"><span class="command">lemma</span></span> initial_segment_ne<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"initial_segment <span class="free">xs</span> <span class="free">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd <span class="free">ys</span> <span class="main">=</span> hd <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> initial_segment.cases<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-take_initial_segment"><span class="command">lemma</span></span> take_initial_segment<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"initial_segment <span class="free">xs</span> <span class="free">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"take <span class="free">k</span> <span class="free">xs</span> <span class="main">=</span> take <span class="free">k</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_eq_conv_conj assms initial_segment.cases min_def take_take<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-initial_segment_length_eq"><span class="command">lemma</span></span> initial_segment_length_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"initial_segment <span class="free">xs</span> <span class="free">ys</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms initial_segment.cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Omega_Omega-initial_segment_Nil"><span class="command">lemma</span></span> initial_segment_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"initial_segment <span class="main">[]</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> initial_segment.simps<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-initial_segment_Cons"><span class="command">lemma</span></span> initial_segment_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"initial_segment <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">ys</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">=</span><span class="free">y</span> <span class="main">∧</span> initial_segment <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons initial_segment.simps list.inject<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-init_segment_iff_initial_segment"><span class="command">lemma</span></span> init_segment_iff_initial_segment<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"init_segment <span class="main">(</span>list.set <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>list.set <span class="free">ys</span><span class="main">)</span> <span class="main">⟷</span> initial_segment <span class="free">xs</span> <span class="free">ys</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> S'<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="free">ys</span> <span class="main">=</span> list.set <span class="free">xs</span> <span class="main">∪</span> <span class="skolem">S'</span>"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="free">xs</span> <span class="main">≪</span> <span class="skolem">S'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_segment_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> List.finite_set finite_Un<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> list_of <span class="skolem">S'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> S' <span class="quoted"><span class="quoted">‹strict_sorted <span class="free">xs</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹strict_sorted <span class="free">ys</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> list_of <span class="skolem">S'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> List.finite_set <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span> append_Cons assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sorted_list_of_set_Un sorted_list_of_set_set_of<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> initial_segment.intros <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ys</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> sorted_list_of_set_imp_less_sets strict_sorted_imp_sorted
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_segment_def strict_sorted_append_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Nash_Williams_WW<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> List.set <span class="bound">l</span> <span class="main">⊆</span> <span class="free">M</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"thin <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> WW"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">i</span> <span class="free">N</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> List.set <span class="bound">l</span> <span class="main">⊆</span> <span class="free">N</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">AM</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">AM</span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> List.set <span class="bound">l</span> <span class="main">⊆</span> <span class="free">M</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"thin_set <span class="main">(</span>list.set <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹thin <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊆</span> WW›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> thin_def thin_set_def WW_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_iff init_segment_iff_initial_segment<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"thin_set <span class="main">(</span>list.set <span class="main">`</span> <span class="skolem">AM</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AM_def image_subset_iff thin_set_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ramsey <span class="main">(</span>list.set <span class="main">`</span> <span class="skolem">AM</span><span class="main">)</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Nash_Williams_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span> <span class="main">∘</span> list_of<span class="main">)</span> <span class="main">∈</span> list.set <span class="main">`</span> <span class="skolem">AM</span> <span class="main">→</span> <span class="main">{..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> AM_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">l</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> WW_def <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊆</span> WW›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">(</span>list_of <span class="main">(</span>list.set <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> h <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹list.set <span class="skolem">l</span> <span class="main">⊆</span> <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">j</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">;</span> <span class="skolem">i</span><span class="main">≠</span><span class="bound">j</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> list_of<span class="main">)</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span> <span class="main">∩</span> <span class="main">(</span>list.set <span class="main">`</span> <span class="skolem">AM</span><span class="main">)</span> <span class="main">∩</span> Pow <span class="skolem">N</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Ramsey_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹infinite <span class="free">M</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> N_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span> <span class="main">∘</span> list_of<span class="main">)</span> <span class="main">-`</span> <span class="main">{</span><span class="main">1</span><span class="main">-</span><span class="skolem">i</span><span class="main">}</span> <span class="main">∩</span> <span class="main">(</span>list.set <span class="main">`</span> <span class="skolem">AM</span><span class="main">)</span> <span class="main">∩</span> Pow <span class="skolem">N</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def diff_less_Suc not_less_eq numeral_2_eq_2 zero_less_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> list.set <span class="bound">l</span> <span class="main">⊆</span> <span class="skolem">N</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">l</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="skolem">l</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> h <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">&lt;</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="skolem">l</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">⟹</span> <span class="free">h</span> <span class="skolem">l</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_nat_numeral less_Suc_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊆</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> WW_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">(</span>list_of <span class="main">(</span>list.set <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span>list.set <span class="skolem">l</span> <span class="main">⊆</span> <span class="skolem">N</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N_disjoint <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> AM_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="skolem">l</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹list.set <span class="skolem">l</span> <span class="main">⊆</span> <span class="skolem">N</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vimage_def set_eq_iff AM_def WW_def subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">&lt;</span><span class="numeral">2</span>›</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Specialised functions on lists›</span></span>

<span class="keyword1" id="Omega_Omega-mem_lists_non_Nil"><span class="command">lemma</span></span> mem_lists_non_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xss</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> list.set <span class="free">xss</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">acc_lengths</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> list list <span class="main">⇒</span> nat list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">acc_lengths</span> <span class="free"><span class="bound"><span class="entity">acc</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">acc_lengths</span> <span class="free"><span class="bound"><span class="entity">acc</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">acc</span></span></span> <span class="main">+</span> length <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free">acc_lengths</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">acc</span></span></span> <span class="main">+</span> length <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span>"</span></span>

<span class="keyword1" id="Omega_Omega-length_acc_lengths"><span class="command">lemma</span></span> length_acc_lengths <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>acc_lengths <span class="free">acc</span> <span class="free">ls</span><span class="main">)</span> <span class="main">=</span> length <span class="free">ls</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ls</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">acc</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-acc_lengths_eq_Nil_iff"><span class="command">lemma</span></span> acc_lengths_eq_Nil_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"acc_lengths <span class="free">acc</span> <span class="free">ls</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">ls</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv length_acc_lengths<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-set_acc_lengths"><span class="command">lemma</span></span> set_acc_lengths<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ls</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>acc_lengths <span class="free">acc</span> <span class="free">ls</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">acc</span><span class="main">&lt;..}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ls</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> acc_lengths.induct<span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Useful because <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">acc_lengths.simps</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> will later be deleted from the simpset.›</span></span>
<span class="keyword1" id="Omega_Omega-hd_acc_lengths"><span class="command">lemma</span></span> hd_acc_lengths <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>acc_lengths <span class="free">acc</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">acc</span> <span class="main">+</span> length <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Omega_Omega-last_acc_lengths"><span class="command">lemma</span></span> last_acc_lengths <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ls</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> last <span class="main">(</span>acc_lengths <span class="free">acc</span> <span class="free">ls</span><span class="main">)</span> <span class="main">=</span> <span class="free">acc</span> <span class="main">+</span> sum_list <span class="main">(</span>map length <span class="free">ls</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">acc</span></span> <span class="quoted"><span class="free">ls</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> acc_lengths.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-nth_acc_lengths"><span class="command">lemma</span></span> nth_acc_lengths <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">ls</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="free">k</span> <span class="main">&lt;</span> length <span class="free">ls</span><span class="main">⟧</span> <span class="main">⟹</span> acc_lengths <span class="free">acc</span> <span class="free">ls</span> <span class="main">!</span> <span class="free">k</span> <span class="main">=</span> <span class="free">acc</span> <span class="main">+</span> sum_list <span class="main">(</span>map length <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">ls</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">acc</span></span> <span class="quoted"><span class="free">ls</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> acc_lengths.induct<span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_Suc_eq nth_Cons'<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Omega_Omega-acc_lengths_plus"><span class="command">lemma</span></span> acc_lengths_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"acc_lengths <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="free">as</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(+)</span><span class="free">m</span><span class="main">)</span> <span class="main">(</span>acc_lengths <span class="free">n</span> <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> acc_lengths.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-acc_lengths_shift"><span class="command">lemma</span></span> acc_lengths_shift<span class="main">:</span> <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">0</span> <span class="free">acc</span> <span class="main">⟹</span> acc_lengths <span class="free">acc</span> <span class="free">as</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(+)</span><span class="free">acc</span><span class="main">)</span> <span class="main">(</span>acc_lengths <span class="main">0</span> <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> acc_lengths_plus add.comm_neutral<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-length_concat_acc_lengths"><span class="command">lemma</span></span> length_concat_acc_lengths<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ls</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">+</span> length <span class="main">(</span>concat <span class="free">ls</span><span class="main">)</span> <span class="main">∈</span> list.set <span class="main">(</span>acc_lengths <span class="free">k</span> <span class="free">ls</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> acc_lengths_eq_Nil_iff last_acc_lengths last_in_set length_concat<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-strict_sorted_acc_lengths"><span class="command">lemma</span></span> strict_sorted_acc_lengths<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ls</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>acc_lengths <span class="free">acc</span> <span class="free">ls</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ls</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> acc_lengths.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">acc</span> <span class="skolem">l</span> <span class="skolem">ls</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>acc_lengths <span class="main">(</span><span class="skolem">acc</span> <span class="main">+</span> length <span class="skolem">l</span><span class="main">)</span> <span class="skolem">ls</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> set_acc_lengths <span class="quoted">"2.prems"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-acc_lengths_append"><span class="command">lemma</span></span> acc_lengths_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acc_lengths <span class="free">acc</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>
   <span class="main">=</span> acc_lengths <span class="free">acc</span> <span class="free">xs</span> <span class="main">@</span> acc_lengths <span class="main">(</span><span class="free">acc</span> <span class="main">+</span> sum_list <span class="main">(</span>map length <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">acc</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> acc_lengths.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>


<span class="keyword1"><span class="command">declare</span></span> acc_lengths.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword">del</span></span><span class="main">]</span>

<span class="keyword1" id="Omega_Omega-length_concat_ge"><span class="command">lemma</span></span> length_concat_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>concat <span class="free">as</span><span class="main">)</span> <span class="main">≥</span> length <span class="free">as</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">as</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">a</span> <span class="main">≥</span> Suc <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main">∈</span> list.set <span class="skolem">as</span> <span class="main">⟹</span> length <span class="bound">l</span> <span class="main">≥</span> Suc <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_leI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">interact</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list list <span class="main">⇒</span> <span class="tfree">'a</span> list list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">interact</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> concat <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">interact</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">[]</span> <span class="main">=</span> concat <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">interact</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">@</span> <span class="free">interact</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> monoid_add<span class="main">)</span> length_interact<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>interact <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">(</span>map length <span class="free">xs</span><span class="main">)</span> <span class="main">+</span> sum_list <span class="main">(</span>map length <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> interact.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> length_concat<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-length_interact_ge"><span class="command">lemma</span></span> length_interact_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>interact <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">≥</span> length <span class="free">xs</span> <span class="main">+</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mem_lists_non_Nil add_mono assms length_concat length_concat_ge length_interact<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-set_interact"><span class="command">lemma</span></span> set_interact <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>interact <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> list.set <span class="main">(</span>concat <span class="free">xs</span><span class="main">)</span> <span class="main">∪</span> list.set <span class="main">(</span>concat <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> interact.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-interact_eq_Nil_iff"><span class="command">lemma</span></span> interact_eq_Nil_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interact <span class="free">xs</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">xs</span><span class="main">=</span><span class="main">[]</span> <span class="main">∧</span> <span class="free">ys</span><span class="main">=</span><span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> length_interact_ge <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Omega_Omega-interact_sing"><span class="command">lemma</span></span> interact_sing <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"interact <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="free">ys</span> <span class="main">=</span> <span class="free">x</span> <span class="main">@</span> concat <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> concat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> interact.simps neq_Nil_conv<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-hd_interact"><span class="command">lemma</span></span> hd_interact<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> hd <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span> hd <span class="main">(</span>interact <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span>hd <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> concat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_append2 interact.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> interact.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.exhaust list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Omega_Omega-acc_lengths_concat_injective"><span class="command">lemma</span></span> acc_lengths_concat_injective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"concat <span class="free">as'</span> <span class="main">=</span> concat <span class="free">as</span>"</span></span> <span class="quoted"><span class="quoted">"acc_lengths <span class="free">n</span> <span class="free">as'</span> <span class="main">=</span> acc_lengths <span class="free">n</span> <span class="free">as</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">as'</span> <span class="main">=</span> <span class="free">as</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">as'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> acc_lengths_eq_Nil_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as'</span> <span class="main">=</span> <span class="skolem">a'</span><span class="main">#</span><span class="skolem">bs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_length_conv length_acc_lengths<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> acc_lengths.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Omega_Omega-acc_lengths_interact_injective"><span class="command">lemma</span></span> acc_lengths_interact_injective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"interact <span class="free">as'</span> <span class="free">bs'</span> <span class="main">=</span> interact <span class="free">as</span> <span class="free">bs</span>"</span></span> <span class="quoted"><span class="quoted">"acc_lengths <span class="free">a</span> <span class="free">as'</span> <span class="main">=</span> acc_lengths <span class="free">a</span> <span class="free">as</span>"</span></span> <span class="quoted"><span class="quoted">"acc_lengths <span class="free">b</span> <span class="free">bs'</span> <span class="main">=</span> acc_lengths <span class="free">b</span> <span class="free">bs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">as'</span> <span class="main">=</span> <span class="free">as</span> <span class="main">∧</span> <span class="free">bs'</span> <span class="main">=</span> <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">as'</span></span> <span class="quoted"><span class="free">bs'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> interact.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">cs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as'</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> acc_lengths_eq_Nil_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> acc_lengths_concat_injective <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> acc_lengths_concat_injective acc_lengths_eq_Nil_iff interact.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.exhaust<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as'</span> <span class="main">=</span> <span class="skolem">a'</span><span class="main">#</span><span class="skolem">us</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs'</span> <span class="main">=</span> <span class="skolem">b'</span><span class="main">#</span><span class="skolem">vs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_Suc_conv length_acc_lengths<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> acc_lengths.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Omega_Omega-strict_sorted_interact_I"><span class="command">lemma</span></span> strict_sorted_interact_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="free">ys</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> list.set <span class="free">xs</span> <span class="main">⟹</span> strict_sorted <span class="bound">x</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> list.set <span class="free">ys</span> <span class="main">⟹</span> strict_sorted <span class="bound">y</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> length <span class="free">ys</span> <span class="main">⟹</span> <span class="free">xs</span><span class="main">!</span><span class="bound">n</span> <span class="main">&lt;</span> <span class="free">ys</span><span class="main">!</span><span class="bound">n</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> Suc <span class="bound">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="free">ys</span><span class="main">!</span><span class="bound">n</span> <span class="main">&lt;</span> <span class="free">xs</span><span class="main">!</span>Suc <span class="bound">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>interact <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> interact.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>interact <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> Suc_less_eq nth_Cons_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> interact <span class="skolem">xs</span> <span class="skolem">ys</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"interact <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">y</span> <span class="main">&lt;</span> hd <span class="main">(</span>interact <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.strict_trans1 hd_interact length_greater_0_conv less_list_def list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lists.simps mem_lists_non_Nil nth_Cons' nth_mem<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_sorted_append_iff less_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Forms and interactions›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Forms›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">Form_Body</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat<span class="main">,</span> nat<span class="main">,</span> nat list<span class="main">,</span> nat list<span class="main">,</span> nat list<span class="main">]</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Form_Body</span> <span class="free"><span class="bound"><span class="entity">ka</span></span></span> <span class="free"><span class="bound"><span class="entity">kb</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> concat <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> concat <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ka</span></span></span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">kb</span></span></span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">zs</span></span></span> <span class="main">=</span> concat <span class="main">[</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">]</span> <span class="main">@</span> interact <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span>"</span></span>
          <span class="quoted"><span class="quoted">"strict_sorted <span class="free"><span class="bound"><span class="entity">zs</span></span></span>"</span></span>


<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">Form</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat<span class="main">,</span> nat list set<span class="main">]</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Form</span> <span class="main">0</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>
      <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Form</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Form_Body <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Form</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>   <span class="main">{</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Form_Body <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> Form_0_cases_raw<span class="main">:</span> <span class="quoted"><span class="quoted">"Form <span class="main">0</span> <span class="free">u</span>"</span></span>

<span class="keyword1" id="Omega_Omega-Form_elim_upair"><span class="command">lemma</span></span> Form_elim_upair<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Form <span class="free">l</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">xs</span> <span class="free">ys</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="free">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">=</span> <span class="main">{</span><span class="free">xs</span><span class="main">,</span><span class="free">ys</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">≤</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> Form.cases Form_Body.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> dual_order.order_iff_strict less_not_refl<span class="main">)</span>


<span class="keyword1" id="Omega_Omega-Form_Body_WW"><span class="command">lemma</span></span> Form_Body_WW<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Form_Body <span class="free">ka</span> <span class="free">kb</span> <span class="free">xs</span> <span class="free">ys</span> <span class="free">zs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">zs</span> <span class="main">∈</span> WW"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Form_Body.cases <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WW_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-Form_Body_nonempty"><span class="command">lemma</span></span> Form_Body_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Form_Body <span class="free">ka</span> <span class="free">kb</span> <span class="free">xs</span> <span class="free">ys</span> <span class="free">zs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">zs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Form_Body.cases <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-Form_Body_length"><span class="command">lemma</span></span> Form_Body_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Form_Body <span class="free">ka</span> <span class="free">kb</span> <span class="free">xs</span> <span class="free">ys</span> <span class="free">zs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&lt;</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Form_Body.cases assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Omega_Omega-form_cases"><span class="command">lemma</span></span> form_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">l</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>zero<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>nz<span class="main">)</span> <span class="free">ka</span> <span class="free">kb</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="free">ka</span><span class="main">+</span><span class="free">kb</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">kb</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">kb</span> <span class="main">≤</span> <span class="free">ka</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ka</span> <span class="main">≤</span> Suc <span class="free">kb</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ka</span> <span class="bound">kb</span><span class="main">.</span> <span class="free">l</span> <span class="main">=</span> <span class="bound">ka</span><span class="main">+</span><span class="bound">kb</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">kb</span> <span class="main">∧</span> <span class="bound">kb</span> <span class="main">≤</span> <span class="bound">ka</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">≤</span> Suc <span class="bound">kb</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">using</span></span> nz zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Interactions›</span></span>

<span class="keyword1" id="Omega_Omega-interact"><span class="command">lemma</span></span> interact<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Form <span class="free">l</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ka</span> <span class="free">kb</span> <span class="free">xs</span> <span class="free">ys</span> <span class="free">zs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="free">ka</span><span class="main">+</span><span class="free">kb</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">=</span> <span class="main">{</span><span class="free">xs</span><span class="main">,</span><span class="free">ys</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"Form_Body <span class="free">ka</span> <span class="free">kb</span> <span class="free">xs</span> <span class="free">ys</span> <span class="free">zs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">kb</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">kb</span> <span class="main">≤</span> <span class="free">ka</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ka</span> <span class="main">≤</span> Suc <span class="free">kb</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> form_cases <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">case</span></span> zero
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Form_0_cases_raw assms that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>nz <span class="skolem">ka</span> <span class="skolem">kb</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> xys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> <span class="skolem">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">xs</span><span class="main">,</span><span class="skolem">ys</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">≤</span> length <span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Form_elim_upair assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">=</span> <span class="skolem">kb</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Form.cases <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Form <span class="free">l</span> <span class="free">U</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">k</span> <span class="skolem">xs'</span> <span class="skolem">ys'</span> <span class="skolem">zs'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">∧</span> <span class="skolem">ys'</span> <span class="main">=</span> <span class="skolem">ys</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Form_Body_length Set.doubleton_eq_iff leD xys<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> xys<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">ka</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 True nz <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 True nz<span class="main">(</span>1<span class="main">)</span> nz<span class="main">(</span>4<span class="main">)</span> that xys<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> True nz <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">presburger</span><span class="keyword3">+</span>›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Form.cases <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Form <span class="free">l</span> <span class="free">U</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">k</span> <span class="skolem">xs'</span> <span class="skolem">ys'</span> <span class="skolem">zs'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">∧</span> <span class="skolem">ys'</span> <span class="main">=</span> <span class="skolem">ys</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Form_Body_length Set.doubleton_eq_iff leD xys<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> xys<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">kb</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 False nz
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 False nz <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">≠</span> <span class="skolem">ys</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_SucE le_antisym that<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> False nz <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">presburger</span><span class="keyword3">+</span>›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inter_scheme</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list set <span class="main">⇒</span> nat list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">inter_scheme</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">≡</span> 
           <span class="keyword1">SOME</span> <span class="bound">zs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">k</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span>
                         <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">xs</span><span class="main">,</span><span class="bound">ys</span><span class="main">}</span> <span class="main">∧</span> Form_Body <span class="bound">k</span> <span class="bound">k</span> <span class="bound">xs</span> <span class="bound">ys</span> <span class="bound">zs</span>
                        <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">k</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">xs</span><span class="main">,</span><span class="bound">ys</span><span class="main">}</span> <span class="main">∧</span> Form_Body <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="bound">k</span> <span class="bound">xs</span> <span class="bound">ys</span> <span class="bound">zs</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="Omega_Omega-inter_scheme"><span class="command">lemma</span></span> inter_scheme<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Form <span class="free">l</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ka</span> <span class="free">kb</span> <span class="free">xs</span> <span class="free">ys</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="free">ka</span><span class="main">+</span><span class="free">kb</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">=</span> <span class="main">{</span><span class="free">xs</span><span class="main">,</span><span class="free">ys</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"Form_Body <span class="free">ka</span> <span class="free">kb</span> <span class="free">xs</span> <span class="free">ys</span> <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">kb</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">kb</span> <span class="main">≤</span> <span class="free">ka</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ka</span> <span class="main">≤</span> Suc <span class="free">kb</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> interact <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Form <span class="free">l</span> <span class="free">U</span>›</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">ka</span> <span class="skolem">kb</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">zs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ka</span> <span class="bound">kb</span> <span class="bound">zs</span><span class="main">.</span> <span class="main">¬</span> Form_Body <span class="bound">ka</span> <span class="bound">kb</span> <span class="skolem">ys</span> <span class="skolem">xs</span> <span class="bound">zs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Form_Body_length less_asym' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Form_Body <span class="skolem">ka</span> <span class="skolem">kb</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">=</span> <span class="skolem">kb</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="free">l</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">*</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">kb</span> <span class="main">+</span> <span class="skolem">kb</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">=</span> <span class="bound">k</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">⟷</span> <span class="bound">k</span><span class="main">=</span><span class="skolem">kb</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> inter_scheme_def <span class="keyword1"><span class="command">using</span></span> 2 l True
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> § <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> Set.doubleton_eq_iff conj_disj_distribR ex_disj_distrib <span class="dynamic"><span class="dynamic">algebra_simps</span></span> some_eq_ex<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="free">l</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">=</span> Suc <span class="skolem">kb</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">kb</span> <span class="main">+</span> <span class="skolem">kb</span> <span class="main">=</span> <span class="bound">k</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">⟷</span> <span class="bound">k</span><span class="main">=</span><span class="skolem">kb</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> inter_scheme_def <span class="keyword1"><span class="command">using</span></span> 2 l False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> § <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> Set.doubleton_eq_iff conj_disj_distribR ex_disj_distrib <span class="dynamic"><span class="dynamic">algebra_simps</span></span> some_eq_ex<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 2 that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Omega_Omega-inter_scheme_simple"><span class="command">lemma</span></span> inter_scheme_simple<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Form <span class="free">l</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inter_scheme <span class="free">l</span> <span class="free">U</span> <span class="main">∈</span> WW <span class="main">∧</span> length <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="free">U</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inter_scheme <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Form_Body_WW Form_Body_nonempty<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-inter_scheme_strict_sorted"><span class="command">lemma</span></span> inter_scheme_strict_sorted<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Form <span class="free">l</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inter_scheme_simple <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WW_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Injectivity of interactions›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> inter_scheme_injective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Form <span class="free">l</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"Form <span class="free">l</span> <span class="free">U'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"inter_scheme <span class="free">l</span> <span class="free">U'</span> <span class="main">=</span> inter_scheme <span class="free">l</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">U'</span> <span class="main">=</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ka</span></span> <span class="skolem"><span class="skolem">kb</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="skolem">ka</span><span class="main">+</span><span class="skolem">kb</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">xs</span><span class="main">,</span><span class="skolem">ys</span><span class="main">}</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> FB<span class="main">:</span> <span class="quoted"><span class="quoted">"Form_Body <span class="skolem">ka</span> <span class="skolem">kb</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">kb</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kb</span> <span class="main">≤</span> <span class="skolem">ka</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">≤</span> Suc <span class="skolem">kb</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms inter_scheme <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">bs</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ka</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">bs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">kb</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">bs</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Ueq<span class="main">:</span> <span class="quoted"><span class="quoted">"inter_scheme <span class="free">l</span> <span class="free">U</span> <span class="main">=</span> concat <span class="main">[</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">a</span><span class="main">,</span> <span class="skolem">d</span><span class="main">,</span> <span class="skolem">b</span><span class="main">]</span> <span class="main">@</span> interact <span class="skolem">as</span> <span class="skolem">bs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Form_Body.simps<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ka'</span></span> <span class="skolem"><span class="skolem">kb'</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="skolem"><span class="skolem">ys'</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> l'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="skolem">ka'</span><span class="main">+</span><span class="skolem">kb'</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U'</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">xs'</span><span class="main">,</span><span class="skolem">ys'</span><span class="main">}</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> FB'<span class="main">:</span> <span class="quoted"><span class="quoted">"Form_Body <span class="skolem">ka'</span> <span class="skolem">kb'</span> <span class="skolem">xs'</span> <span class="skolem">ys'</span> <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="free">U'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">kb'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kb'</span> <span class="main">≤</span> <span class="skolem">ka'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ka'</span> <span class="main">≤</span> Suc <span class="skolem">kb'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms inter_scheme <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">as'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">bs'</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">d'</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> xs'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">a'</span><span class="main">#</span><span class="skolem">as'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">b'</span><span class="main">#</span><span class="skolem">bs'</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> len'<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">a'</span><span class="main">#</span><span class="skolem">as'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ka'</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">b'</span><span class="main">#</span><span class="skolem">bs'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">kb'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">#</span><span class="skolem">as'</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> d'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">b'</span><span class="main">#</span><span class="skolem">bs'</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Ueq'<span class="main">:</span> <span class="quoted"><span class="quoted">"inter_scheme <span class="free">l</span> <span class="free">U'</span> <span class="main">=</span> concat <span class="main">[</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">a'</span><span class="main">,</span> <span class="skolem">d'</span><span class="main">,</span> <span class="skolem">b'</span><span class="main">]</span> <span class="main">@</span> interact <span class="skolem">as'</span> <span class="skolem">bs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Form_Body.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ka'</span> <span class="main">=</span> <span class="skolem">ka</span> <span class="main">∧</span> <span class="skolem">kb'</span> <span class="main">=</span> <span class="skolem">kb</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> l l' <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">≤</span> Suc <span class="skolem">kb</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka'</span> <span class="main">≤</span> Suc <span class="skolem">kb'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">kb</span> <span class="main">≤</span> <span class="skolem">ka</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">kb'</span> <span class="main">≤</span> <span class="skolem">ka'</span>›</span></span> le_SucE le_antisym mult_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">c</span> <span class="main">=</span> length <span class="skolem">c'</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">d</span> <span class="main">=</span> length <span class="skolem">d'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c c' d d' len' len <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> c_off<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">@</span> <span class="skolem">d'</span> <span class="main">@</span> <span class="skolem">b'</span> <span class="main">@</span> interact <span class="skolem">as'</span> <span class="skolem">bs'</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">@</span> <span class="skolem">d</span> <span class="main">@</span> <span class="skolem">b</span> <span class="main">@</span> interact <span class="skolem">as</span> <span class="skolem">bs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ueq Ueq'<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> len_a<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">a'</span> <span class="main">=</span> length <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> acc_lengths.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> add.left_neutral c c' nth_Cons_0<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> c_off <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">@</span> interact <span class="skolem">as'</span> <span class="skolem">bs'</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">@</span> interact <span class="skolem">as</span> <span class="skolem">bs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>interact <span class="skolem">as'</span> <span class="skolem">bs'</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>interact <span class="skolem">as</span> <span class="skolem">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> acc_lengths.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> add_left_cancel append_eq_append_conv d d' list.inject<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> § <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"interact <span class="skolem">as'</span> <span class="skolem">bs'</span> <span class="main">=</span> interact <span class="skolem">as</span> <span class="skolem">bs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acc_lengths <span class="main">0</span> <span class="skolem">as'</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="skolem">as</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c' c acc_lengths.simps acc_lengths_shift<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acc_lengths <span class="main">0</span> <span class="skolem">bs'</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="skolem">bs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">=</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d'</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d' d acc_lengths.simps acc_lengths_shift<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as'</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">∧</span> <span class="skolem">bs'</span> <span class="main">=</span> <span class="skolem">bs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> acc_lengths_interact_injective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span> U U' <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">=</span> <span class="skolem">b</span>›</span></span> xs xs' ys ys'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Omega_Omega-strict_sorted_interact_imp_concat"><span class="command">lemma</span></span> strict_sorted_interact_imp_concat<span class="main">:</span>
    <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>interact <span class="free">as</span> <span class="free">bs</span><span class="main">)</span> <span class="main">⟹</span> strict_sorted <span class="main">(</span>concat <span class="free">as</span><span class="main">)</span> <span class="main">∧</span> strict_sorted <span class="main">(</span>concat <span class="free">bs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> interact.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3"</span> strict_sorted_append_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">[]</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> Nil 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_sorted_append_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Un_iff set_interact sorted_wrt_append strict_sorted_append_iff strict_sorted_sorted_wrt<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(&lt;)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">@</span> interact <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted">"3.prems"</span> interact.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> local.Cons strict_sorted_sorted_wrt<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> concat <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> last <span class="skolem">list</span> <span class="main">&lt;</span> hd <span class="main">(</span>concat <span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Un_iff hd_in_set last_ConsR last_in_set list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> set_append set_interact sorted_wrt_append<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span> <span class="main">&lt;</span> concat <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> less_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> § append.assoc last.simps less_list_def list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> strict_sorted_append_iff strict_sorted_sorted_wrt<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> Cons1 <span class="main">=</span> Cons
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_wrt_append strict_sorted_sorted_wrt<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a'</span> <span class="skolem">list'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span><span class="skolem">list'</span> <span class="main">@</span> concat <span class="skolem">ys</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_sorted_sorted_wrt<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"3.IH"</span> <span class="quoted">"§"</span> Un_iff append_Cons local.Cons set_interact sorted_wrt_append strict_sorted.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> strict_sorted_sorted_wrt<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> concat <span class="skolem">ys</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"§"</span> Un_iff hd_in_set last_in_set less_list_def set_interact sorted_wrt_append<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 <span class="quoted"><span class="quoted">‹<span class="skolem">list</span> <span class="main">&lt;</span> concat <span class="skolem">xs</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Cons1 strict_sorted_append_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>




<span class="keyword1" id="Omega_Omega-strict_sorted_interact_hd"><span class="command">lemma</span></span> strict_sorted_interact_hd<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>strict_sorted <span class="main">(</span>interact <span class="free">cs</span> <span class="free">ds</span><span class="main">)</span><span class="main">;</span> <span class="free">cs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="free">ds</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> hd <span class="free">cs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> hd <span class="free">ds</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span>
       <span class="main">⟹</span> hd <span class="main">(</span>hd <span class="free">cs</span><span class="main">)</span> <span class="main">&lt;</span> hd <span class="main">(</span>hd <span class="free">ds</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_is_append_conv hd_append2 hd_in_set interact.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.exhaust_sel sorted_wrt_append strict_sorted_sorted_wrt<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹the lengths of the two lists can differ by one›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> interaction_scheme_unique_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"concat <span class="free">as</span> <span class="main">=</span> concat <span class="free">as'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys'<span class="main">:</span> <span class="quoted"><span class="quoted">"concat <span class="free">bs</span> <span class="main">=</span> concat <span class="free">bs'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ss_zs<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>interact <span class="free">as</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">bs</span> <span class="main">≤</span> length <span class="free">as</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">as</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ne'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">as'</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs'</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ss_zs'<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>interact <span class="free">as'</span> <span class="free">bs'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">bs'</span> <span class="main">≤</span> length <span class="free">as'</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">as'</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="free">bs'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">as</span> <span class="main">=</span> length <span class="free">as'</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">bs</span> <span class="main">=</span> length <span class="free">bs'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="free">as'</span> <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> <span class="free">bs'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">as</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">as'</span></span> <span class="quoted"><span class="free">bs'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">as</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">a'</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹length <span class="skolem">as</span> <span class="main">=</span> length <span class="skolem">as'</span>›</span></span> length_0_conv length_Suc_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.prems
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_Suc_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> concat.simps length_0_conv length_Suc_conv self_append_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">ds</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">#</span><span class="skolem">cs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">#</span><span class="skolem">ds</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.prems
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> le0 list.exhaust list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> not_less_eq_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">as'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">(</span>2<span class="main">)</span> Suc.prems<span class="main">(</span>1<span class="main">)</span> Suc.prems<span class="main">(</span>3<span class="main">)</span> interact_eq_Nil_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">cs'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">ds'</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as'</span> <span class="main">=</span> <span class="skolem">a'</span><span class="main">#</span><span class="skolem">cs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs'</span> <span class="main">=</span> <span class="skolem">b'</span><span class="main">#</span><span class="skolem">ds'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> eq<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> length_0_conv list.exhaust<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> length <span class="skolem">cs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="skolem">ds</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq <span class="quoted"><span class="quoted">‹Suc <span class="skolem">k</span> <span class="main">=</span> length <span class="skolem">as</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">bs</span> <span class="main">≤</span> length <span class="skolem">as</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">as</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="skolem">bs</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq eq'<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">b'</span> <span class="main">=</span> hd <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> concat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_append2<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> ss_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="skolem">as</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="skolem">bs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> strict_sorted_interact_imp_concat Suc.prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> append.assoc interact.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> strict_sorted_append_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> sw_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(&lt;)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">@</span> <span class="skolem">b</span> <span class="main">@</span> interact <span class="skolem">cs</span> <span class="skolem">ds</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> eq interact.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> strict_sorted_sorted_wrt<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">b</span> <span class="main">∉</span> list.set <span class="main">(</span>concat <span class="skolem">cs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> not_less_iff_gr_or_eq set_interact sorted_wrt_append<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&lt;</span> concat <span class="skolem">cs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq <span class="quoted"><span class="quoted">‹strict_sorted <span class="main">(</span>interact <span class="skolem">as</span> <span class="skolem">bs</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_sorted_append_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff sw_ab last_in_set less_list_def list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_interact sorted_wrt_append<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span><span class="skolem">a</span> <span class="main">@</span> concat <span class="skolem">cs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq<span class="main">(</span>1<span class="main">)</span> ss_ab<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b_cs<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span><span class="skolem">b</span> <span class="main">@</span> concat <span class="skolem">cs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&lt;</span> concat <span class="skolem">cs</span>›</span></span> strict_sorted_append_iff strict_sorted_sorted_wrt sw_ab<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">a</span> <span class="main">=</span> list.set <span class="main">(</span>concat <span class="skolem">as</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{..&lt;</span> hd <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> list.set <span class="skolem">a</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> hd <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> list.set <span class="skolem">cs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> list.set <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">l</span>
        <span class="keyword1"><span class="command">using</span></span> b_cs sorted_hd_le strict_sorted_imp_sorted that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> sw_ab <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_sorted_append_iff sorted_wrt_append eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> ss_ab'<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="skolem">as'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="skolem">bs'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> strict_sorted_interact_imp_concat Suc.prems<span class="main">(</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">&lt;</span> <span class="skolem">b'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq' Suc.prems<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> append.assoc interact.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> strict_sorted_append_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> sw_ab'<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(&lt;)</span> <span class="main">(</span><span class="skolem">a'</span> <span class="main">@</span> <span class="skolem">b'</span> <span class="main">@</span> interact <span class="skolem">cs'</span> <span class="skolem">ds'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> eq' interact.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> strict_sorted_sorted_wrt<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">b'</span> <span class="main">∉</span> list.set <span class="main">(</span>concat <span class="skolem">cs'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> not_less_iff_gr_or_eq set_interact sorted_wrt_append<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">&lt;</span> concat <span class="skolem">cs'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq' <span class="quoted"><span class="quoted">‹strict_sorted <span class="main">(</span>interact <span class="skolem">as'</span> <span class="skolem">bs'</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_sorted_append_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff last_in_set less_list_def list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_interact sorted_wrt_append sw_ab'<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span><span class="skolem">a'</span> <span class="main">@</span> concat <span class="skolem">cs'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq'<span class="main">(</span>1<span class="main">)</span> ss_ab'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b_cs'<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span><span class="skolem">b'</span> <span class="main">@</span> concat <span class="skolem">cs'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">&lt;</span> concat <span class="skolem">cs'</span>›</span></span> eq'<span class="main">(</span>2<span class="main">)</span> ss_ab'<span class="main">(</span>2<span class="main">)</span> strict_sorted_append_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">a'</span> <span class="main">=</span> list.set <span class="main">(</span>concat <span class="skolem">as'</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{..&lt;</span> hd <span class="skolem">b'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> list.set <span class="skolem">a'</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> hd <span class="skolem">b'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> list.set <span class="skolem">cs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> list.set <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">l</span>
        <span class="keyword1"><span class="command">using</span></span> b_cs' sorted_hd_le strict_sorted_imp_sorted that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> sw_ab' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_sorted_append_iff sorted_wrt_append eq'<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">a'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹hd <span class="skolem">b'</span> <span class="main">=</span> hd <span class="skolem">b</span>›</span></span> sorted_wrt_append strict_sorted_equal strict_sorted_sorted_wrt sw_ab sw_ab'<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> ccat_cs_cs'<span class="main">:</span> <span class="quoted"><span class="quoted">"concat <span class="skolem">cs</span> <span class="main">=</span> concat <span class="skolem">cs'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a'</span>›</span></span> eq'<span class="main">(</span>1<span class="main">)</span> eq<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="skolem">b'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ds'</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>14<span class="main">)</span> Suc.prems<span class="main">(</span>2<span class="main">)</span> eq'<span class="main">(</span>2<span class="main">)</span> eq<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ds'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> concat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ss_ab'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> strict_sorted_append_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> k local.Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">cs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">ds</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>3<span class="main">)</span> Suc.prems<span class="main">(</span>4<span class="main">)</span> eq list.set_sel<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ds</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> mem_lists_non_Nil<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concat <span class="skolem">cs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cs</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> hd_in_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>concat <span class="skolem">cs</span><span class="main">)</span> <span class="main">&lt;</span> hd <span class="main">(</span>concat <span class="skolem">ds</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> strict_sorted_interact_hd
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">cs</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ds</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="quoted"><span class="quoted">‹hd <span class="skolem">cs</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="quoted"><span class="quoted">‹hd <span class="skolem">ds</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> hd_concat strict_sorted_append_iff strict_sorted_sorted_wrt sw_ab<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">b</span> <span class="main">=</span> list.set <span class="main">(</span>concat <span class="skolem">bs</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{..&lt;</span> hd <span class="main">(</span>concat <span class="skolem">cs</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ss_ab
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_sorted_append_iff eq<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&lt;</span> concat <span class="skolem">cs</span>›</span></span> <span class="quoted"><span class="quoted">‹concat <span class="skolem">cs</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> hd_in_set sorted_wrt_append strict_sorted_append_iff strict_sorted_sorted_wrt<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> strict_sorted_iff UN_I dual_order.strict_trans2 order.asym set_concat sorted_hd_le<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> k local.Suc <span class="quoted"><span class="quoted">‹concat <span class="skolem">cs</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> ccat_cs_cs' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">cs'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">ds'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>8<span class="main">,</span>9<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ds'</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> eq'<span class="main">(</span>1<span class="main">)</span> eq'<span class="main">(</span>2<span class="main">)</span> list.set_sel<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concat <span class="skolem">cs'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cs'</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> hd_in_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>concat <span class="skolem">cs'</span><span class="main">)</span> <span class="main">&lt;</span> hd <span class="main">(</span>concat <span class="skolem">ds'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> strict_sorted_interact_hd
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">cs'</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ds'</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="quoted"><span class="quoted">‹hd <span class="skolem">cs'</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="quoted"><span class="quoted">‹hd <span class="skolem">ds'</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> hd_concat strict_sorted_append_iff strict_sorted_sorted_wrt sw_ab'<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">b'</span> <span class="main">=</span> list.set <span class="main">(</span>concat <span class="skolem">bs'</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{..&lt;</span> hd <span class="main">(</span>concat <span class="skolem">cs'</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ss_ab'
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_sorted_append_iff eq'<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> strict_sorted_iff <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">&lt;</span> concat <span class="skolem">cs'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="quoted"><span class="quoted">‹concat <span class="skolem">cs'</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> dual_order.strict_trans2 less_list_def sorted_le_last<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> strict_sorted_iff UN_I dual_order.strict_trans2 order.asym set_concat sorted_hd_le<span class="main">)</span>

      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ccat_cs_cs' strict_sorted_append_iff strict_sorted_equal strict_sorted_sorted_wrt sw_ab'<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="skolem">cs'</span> <span class="main">∧</span> <span class="skolem">ds</span> <span class="main">=</span> <span class="skolem">ds'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> length <span class="skolem">cs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq Suc.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"concat <span class="skolem">ds</span> <span class="main">=</span> concat <span class="skolem">ds'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b'</span>›</span></span> eq'<span class="main">(</span>2<span class="main">)</span> eq<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>interact <span class="skolem">cs</span> <span class="skolem">ds</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq Suc.prems<span class="main">(</span>5<span class="main">)</span> strict_sorted_append_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ds</span> <span class="main">≤</span> length <span class="skolem">cs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">cs</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="skolem">ds</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq Suc.hyps<span class="main">(</span>2<span class="main">)</span> Suc.prems<span class="main">(</span>6<span class="main">)</span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>interact <span class="skolem">cs'</span> <span class="skolem">ds'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq' Suc.prems<span class="main">(</span>10<span class="main">)</span> strict_sorted_append_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">cs</span> <span class="main">=</span> length <span class="skolem">cs'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">(</span>2<span class="main">)</span> Suc.prems<span class="main">(</span>13<span class="main">)</span> eq'<span class="main">(</span>1<span class="main">)</span> k<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> ccat_cs_cs' eq eq' Suc.prems <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b'</span>›</span></span> eq eq'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">proposition</span></span> Form_Body_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Form_Body <span class="free">ka</span> <span class="free">kb</span> <span class="free">xs</span> <span class="free">ys</span> <span class="free">zs</span>"</span></span> <span class="quoted"><span class="quoted">"Form_Body <span class="free">ka</span> <span class="free">kb</span> <span class="free">xs</span> <span class="free">ys</span> <span class="free">zs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">kb</span> <span class="main">≤</span> <span class="free">ka</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ka</span> <span class="main">≤</span> Suc <span class="free">kb</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">zs'</span> <span class="main">=</span> <span class="free">zs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">bs</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">#</span><span class="skolem">bs</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span> <span class="main">=</span> <span class="free">ka</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">bs</span><span class="main">)</span> <span class="main">=</span> <span class="free">kb</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">bs</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> Ueq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">zs</span> <span class="main">=</span> concat <span class="main">[</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">a</span><span class="main">,</span> <span class="skolem">d</span><span class="main">,</span> <span class="skolem">b</span><span class="main">]</span> <span class="main">@</span> interact <span class="skolem">as</span> <span class="skolem">bs</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> ss_zs<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="free">zs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Form_Body.cases <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">as'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">bs'</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">d'</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> xs'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">a'</span><span class="main">#</span><span class="skolem">as'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">b'</span><span class="main">#</span><span class="skolem">bs'</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> ne'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">#</span><span class="skolem">as'</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">#</span><span class="skolem">bs'</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> len'<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">a'</span><span class="main">#</span><span class="skolem">as'</span><span class="main">)</span> <span class="main">=</span> <span class="free">ka</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">b'</span><span class="main">#</span><span class="skolem">bs'</span><span class="main">)</span> <span class="main">=</span> <span class="free">kb</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">#</span><span class="skolem">as'</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> d'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">b'</span><span class="main">#</span><span class="skolem">bs'</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> Ueq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">zs'</span> <span class="main">=</span> concat <span class="main">[</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">a'</span><span class="main">,</span> <span class="skolem">d'</span><span class="main">,</span> <span class="skolem">b'</span><span class="main">]</span> <span class="main">@</span> interact <span class="skolem">as'</span> <span class="skolem">bs'</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> ss_zs'<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="free">zs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Form_Body.cases <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">c</span> <span class="main">=</span> length <span class="skolem">c'</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">d</span> <span class="main">=</span> length <span class="skolem">d'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c c' d d' len' len <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ss_zs <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ueq strict_sorted_append_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> strict_sorted_iff append.assoc d length_0_conv length_acc_lengths list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> strict_sorted_append_iff sorted_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">&lt;</span> <span class="skolem">b'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ss_zs' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ueq' strict_sorted_append_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> strict_sorted_iff append.assoc d' length_0_conv length_acc_lengths list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> strict_sorted_append_iff sorted_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span> <span class="main">=</span> <span class="skolem">a'</span><span class="main">#</span><span class="skolem">as'</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">#</span><span class="skolem">bs</span> <span class="main">=</span> <span class="skolem">b'</span><span class="main">#</span><span class="skolem">bs'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> interaction_scheme_unique_aux<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">a'</span> <span class="main">#</span> <span class="skolem">as'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xs xs' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">b'</span> <span class="main">#</span> <span class="skolem">bs'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ys ys' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ne <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>interact <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ss_zs <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ueq strict_sorted_append_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> strict_sorted_iff append.assoc append.left_neutral strict_sorted_append_iff sorted_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">b'</span> <span class="main">#</span> <span class="skolem">bs'</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span><span class="skolem">a'</span> <span class="main">#</span> <span class="skolem">as'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">kb</span> <span class="main">≤</span> <span class="free">ka</span>›</span></span> len len' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ka</span> <span class="main">≤</span> Suc <span class="free">kb</span>›</span></span> len <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">a'</span> <span class="main">#</span> <span class="skolem">as'</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="main">(</span><span class="skolem">b'</span> <span class="main">#</span> <span class="skolem">bs'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> len len' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">#</span> <span class="skolem">as'</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">#</span> <span class="skolem">bs'</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ne' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>interact <span class="main">(</span><span class="skolem">a'</span> <span class="main">#</span> <span class="skolem">as'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b'</span> <span class="main">#</span> <span class="skolem">bs'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ss_zs' <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">&lt;</span> <span class="skolem">b'</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ueq' strict_sorted_append_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> strict_sorted_iff append.assoc append.left_neutral strict_sorted_append_iff sorted_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">a'</span> <span class="main">#</span> <span class="skolem">as'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> len'<span class="main">(</span>1<span class="main">)</span> len<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">b'</span> <span class="main">#</span> <span class="skolem">bs'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> len'<span class="main">(</span>2<span class="main">)</span> len<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Ueq Ueq' c c' d d' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Omega_Omega-Form_Body_imp_inter_scheme"><span class="command">lemma</span></span> Form_Body_imp_inter_scheme<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Form_Body <span class="free">ka</span> <span class="free">kb</span> <span class="free">xs</span> <span class="free">ys</span> <span class="free">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">kb</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">kb</span> <span class="main">≤</span> <span class="free">ka</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ka</span> <span class="main">≤</span> Suc <span class="free">kb</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">zs</span> <span class="main">=</span> inter_scheme <span class="main">(</span><span class="main">(</span><span class="free">ka</span><span class="main">+</span><span class="free">kb</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">{</span><span class="free">xs</span><span class="main">,</span><span class="free">ys</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&lt;</span> length <span class="free">ys</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Form_Body_length assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">⟷</span> <span class="skolem">a</span><span class="main">=</span><span class="skolem">b</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">a</span><span class="main">=</span><span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ka</span> <span class="main">=</span> <span class="free">kb</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> inter_scheme_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> some_equality <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms True mult_2 not_gr0 one_is_add <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹length <span class="free">xs</span> <span class="main">&lt;</span> length <span class="free">ys</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> True mult_2 Set.doubleton_eq_iff Form_Body_unique <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Form_Body_length<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ka</span> <span class="main">=</span> Suc <span class="free">kb</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> inter_scheme_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> some_equality <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms False mult_2 one_is_add eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹length <span class="free">xs</span> <span class="main">&lt;</span> length <span class="free">ys</span>›</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq mult_2 Set.doubleton_eq_iff Form_Body_unique <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Form_Body_length<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹For Lemma 3.8 AND PROBABLY 3.7›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">grab</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set <span class="main">⇒</span> nat <span class="main">⇒</span> nat set <span class="main">×</span> nat set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">grab</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∩</span> enumerate <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∩</span> <span class="main">{</span>enumerate <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">..}</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Omega_Omega-grab_0"><span class="command">lemma</span></span> grab_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"grab <span class="free">N</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">{}</span><span class="main">,</span> <span class="free">N</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> grab_def enumerate_0 Least_le<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-less_sets_grab"><span class="command">lemma</span></span> less_sets_grab<span class="main">:</span>
  <span class="quoted"><span class="quoted">"infinite <span class="free">N</span> <span class="main">⟹</span> fst <span class="main">(</span>grab <span class="free">N</span> <span class="free">n</span><span class="main">)</span> <span class="main">≪</span> snd <span class="main">(</span>grab <span class="free">N</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> grab_def less_sets_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> enumerate_mono less_le_trans<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-finite_grab"><span class="command">lemma</span></span> finite_grab <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>fst <span class="main">(</span>grab <span class="free">N</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> grab_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-card_grab"><span class="command">lemma</span></span> card_grab <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>fst <span class="main">(</span>grab <span class="free">N</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∩</span> enumerate <span class="free">N</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> enumerate <span class="free">N</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enumerate_in_set<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image grab_def strict_mono_enum strict_mono_imp_inj_on<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Omega_Omega-fst_grab_subset"><span class="command">lemma</span></span> fst_grab_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>grab <span class="free">N</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> grab_def range_enum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Omega_Omega-snd_grab_subset"><span class="command">lemma</span></span> snd_grab_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>grab <span class="free">N</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> grab_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-grab_Un_eq"><span class="command">lemma</span></span> grab_Un_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>grab <span class="free">N</span> <span class="free">n</span><span class="main">)</span> <span class="main">∪</span> snd <span class="main">(</span>grab <span class="free">N</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> fst <span class="main">(</span>grab <span class="free">N</span> <span class="free">n</span><span class="main">)</span> <span class="main">∪</span> snd <span class="main">(</span>grab <span class="free">N</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> grab_def
    <span class="keyword1"><span class="command">using</span></span> assms enumerate_Ex le_less_linear strict_mono_enum strict_mono_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> grab_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-finite_grab_iff"><span class="command">lemma</span></span> finite_grab_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>snd <span class="main">(</span>grab <span class="free">N</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> finite <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_grab grab_Un_eq infinite_Un infinite_super snd_grab_subset<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-grab_eqD"><span class="command">lemma</span></span> grab_eqD<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span>grab <span class="free">N</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">M</span><span class="main">)</span><span class="main">;</span> infinite <span class="free">N</span><span class="main">⟧</span>
    <span class="main">⟹</span> <span class="free">A</span> <span class="main">≪</span> <span class="free">M</span> <span class="main">∧</span> finite <span class="free">A</span> <span class="main">∧</span> card <span class="free">A</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> infinite <span class="free">M</span> <span class="main">∧</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∧</span> <span class="free">M</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> card_grab grab_def less_sets_grab finite_grab_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-less_sets_fst_grab"><span class="command">lemma</span></span> less_sets_fst_grab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≪</span> <span class="free">N</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">≪</span> fst <span class="main">(</span>grab <span class="free">N</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst_grab_subset less_sets_weaken2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Possibly redundant, given <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">grab</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nxt</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nxt</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">N</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">n</span><span class="main">&lt;..}</span>"</span></span>

<span class="keyword1" id="Omega_Omega-infinite_nxtN"><span class="command">lemma</span></span> infinite_nxtN<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span> <span class="main">⟹</span> infinite <span class="main">(</span>nxt <span class="free">N</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_nat_greaterThan nxt_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-nxt_subset"><span class="command">lemma</span></span> nxt_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"nxt <span class="free">N</span> <span class="free">n</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nxt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Omega_Omega-nxt_subset_greaterThan"><span class="command">lemma</span></span> nxt_subset_greaterThan<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> nxt <span class="free">N</span> <span class="free">n</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">m</span><span class="main">&lt;..}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nxt_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-nxt_subset_atLeast"><span class="command">lemma</span></span> nxt_subset_atLeast<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> nxt <span class="free">N</span> <span class="free">n</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">m</span><span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nxt_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-enum_nxt_ge"><span class="command">lemma</span></span> enum_nxt_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> enum <span class="main">(</span>nxt <span class="free">N</span> <span class="free">a</span><span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atLeast_le_enum infinite_nxtN nxt_subset_atLeast<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-inj_enum_nxt"><span class="command">lemma</span></span> inj_enum_nxt<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span> <span class="main">⟹</span> inj_on <span class="main">(</span>enum <span class="main">(</span>nxt <span class="free">N</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_nxtN strict_mono_enum strict_mono_imp_inj_on<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Larson's Lemma 3.11›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Again from Jean A. Larson,
     A short proof of a partition theorem for the ordinal $\omega^\omega$.
     \emph{Annals of Mathematical Logic}, 6:129–145, 1973.›</span></span>

<span class="keyword1" id="Omega_Omega-lemma_3_11"><span class="command">lemma</span></span> lemma_3_11<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"thin <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="main">`</span> <span class="main">{</span><span class="bound">U</span><span class="main">.</span> Form <span class="free">l</span> <span class="bound">U</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> form_cases <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">case</span></span> zero
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>nz <span class="skolem">ka</span> <span class="skolem">kb</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> thin_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="skolem">U'</span>
    <span class="keyword3"><span class="command">assume</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"inter_scheme <span class="free">l</span> <span class="skolem">U</span> <span class="main">≠</span> inter_scheme <span class="free">l</span> <span class="skolem">U'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> init<span class="main">:</span> <span class="quoted"><span class="quoted">"initial_segment <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Form <span class="free">l</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">kp</span></span> <span class="skolem"><span class="skolem">kq</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="skolem">kp</span><span class="main">+</span><span class="skolem">kq</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">xs</span><span class="main">,</span><span class="skolem">ys</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"Form_Body <span class="skolem">kp</span> <span class="skolem">kq</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">kq</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kq</span> <span class="main">≤</span> <span class="skolem">kp</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kp</span> <span class="main">≤</span> Suc <span class="skolem">kq</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms inter_scheme <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kp</span> <span class="main">=</span> <span class="skolem">ka</span> <span class="main">∧</span> <span class="skolem">kq</span> <span class="main">=</span> <span class="skolem">kb</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">bs</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ka</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">bs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">kb</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">bs</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> Ueq<span class="main">:</span> <span class="quoted"><span class="quoted">"inter_scheme <span class="free">l</span> <span class="skolem">U</span> <span class="main">=</span> concat <span class="main">[</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">a</span><span class="main">,</span> <span class="skolem">d</span><span class="main">,</span> <span class="skolem">b</span><span class="main">]</span> <span class="main">@</span> interact <span class="skolem">as</span> <span class="skolem">bs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> U <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Form_Body.simps<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Form <span class="free">l</span> <span class="skolem">U'</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">kp'</span></span> <span class="skolem"><span class="skolem">kq'</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="skolem"><span class="skolem">ys'</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="skolem">kp'</span><span class="main">+</span><span class="skolem">kq'</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U'</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">xs'</span><span class="main">,</span><span class="skolem">ys'</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U'<span class="main">:</span> <span class="quoted"><span class="quoted">"Form_Body <span class="skolem">kp'</span> <span class="skolem">kq'</span> <span class="skolem">xs'</span> <span class="skolem">ys'</span> <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">kq'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kq'</span> <span class="main">≤</span> <span class="skolem">kp'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kp'</span> <span class="main">≤</span> Suc <span class="skolem">kq'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms inter_scheme <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kp'</span> <span class="main">=</span> <span class="skolem">ka</span> <span class="main">∧</span> <span class="skolem">kq'</span> <span class="main">=</span> <span class="skolem">kb</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">as'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">bs'</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">d'</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> xs'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">a'</span><span class="main">#</span><span class="skolem">as'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">b'</span><span class="main">#</span><span class="skolem">bs'</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> len'<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">a'</span><span class="main">#</span><span class="skolem">as'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ka</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">b'</span><span class="main">#</span><span class="skolem">bs'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">kb</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">#</span><span class="skolem">as'</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> d'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">b'</span><span class="main">#</span><span class="skolem">bs'</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> Ueq'<span class="main">:</span> <span class="quoted"><span class="quoted">"inter_scheme <span class="free">l</span> <span class="skolem">U'</span> <span class="main">=</span> concat <span class="main">[</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">a'</span><span class="main">,</span> <span class="skolem">d'</span><span class="main">,</span> <span class="skolem">b'</span><span class="main">]</span> <span class="main">@</span> interact <span class="skolem">as'</span> <span class="skolem">bs'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> U' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Form_Body.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">bs'</span> <span class="main">=</span> length <span class="skolem">bs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">as'</span> <span class="main">=</span> length <span class="skolem">as</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> len len' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inter_scheme <span class="free">l</span> <span class="skolem">U</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"inter_scheme <span class="free">l</span> <span class="skolem">U'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Form_Body_nonempty U U' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">≡</span> hd <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> u1_eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">=</span> hd <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inter_scheme <span class="free">l</span> <span class="skolem">U</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> init u1_def initial_segment_ne <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> au1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">=</span> length <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u1_def Ueq c acc_lengths.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> au1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">=</span> length <span class="skolem">a'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u1_eq' Ueq' c' acc_lengths.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> len_eqk<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">ka</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">d'</span> <span class="main">=</span> <span class="skolem">kb</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">ka</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">d'</span> <span class="main">=</span> <span class="skolem">kb</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c d len c' d' len' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> take<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span><span class="skolem">ka</span> <span class="main">+</span> <span class="skolem">u1</span> <span class="main">+</span> <span class="skolem">kb</span><span class="main">)</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">@</span> <span class="skolem">a</span> <span class="main">@</span> <span class="skolem">d</span> <span class="main">@</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">@</span> <span class="skolem">a</span> <span class="main">@</span> <span class="skolem">d</span>"</span></span>
               <span class="quoted"><span class="quoted">"take <span class="main">(</span><span class="skolem">ka</span> <span class="main">+</span> <span class="skolem">u1</span> <span class="main">+</span> <span class="skolem">kb</span><span class="main">)</span> <span class="main">(</span><span class="skolem">c'</span> <span class="main">@</span> <span class="skolem">a'</span> <span class="main">@</span> <span class="skolem">d'</span> <span class="main">@</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c'</span> <span class="main">@</span> <span class="skolem">a'</span> <span class="main">@</span> <span class="skolem">d'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">l</span>
      <span class="keyword1"><span class="command">using</span></span> c d c' d' len <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> au1 au1'<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> leU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">+</span> <span class="skolem">u1</span> <span class="main">+</span> <span class="skolem">kb</span> <span class="main">≤</span> length <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c d len <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> au1 Ueq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span><span class="skolem">ka</span> <span class="main">+</span> <span class="skolem">u1</span> <span class="main">+</span> <span class="skolem">kb</span><span class="main">)</span> <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> take <span class="main">(</span><span class="skolem">ka</span> <span class="main">+</span> <span class="skolem">u1</span> <span class="main">+</span> <span class="skolem">kb</span><span class="main">)</span> <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> take_initial_segment init <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">@</span> <span class="skolem">a</span> <span class="main">@</span> <span class="skolem">d</span> <span class="main">=</span> <span class="skolem">c'</span> <span class="main">@</span> <span class="skolem">a'</span> <span class="main">@</span> <span class="skolem">d'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ueq Ueq' append.assoc concat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> take<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ka</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">@</span> <span class="skolem">a</span> <span class="main">@</span> <span class="skolem">d</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">ka</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">kb</span> <span class="main">+</span> last <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ueq c d length_interact nth_append <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> len<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ka</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">c'</span> <span class="main">@</span> <span class="skolem">a'</span> <span class="main">@</span> <span class="skolem">d'</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">ka</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">kb</span> <span class="main">+</span> last <span class="skolem">d'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ueq' c' d' length_interact nth_append <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> len'<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">d</span> <span class="main">=</span> last <span class="skolem">d'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"§"</span> c d d' len'<span class="main">(</span>1<span class="main">)</span> len_eqk<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> §<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> init initial_segment_length_eq ne <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Larson's Lemma 3.6›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> lemma_3_6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list set <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">N</span> <span class="free">j</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">u</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">k</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">;</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">;</span> Form <span class="bound">k</span> <span class="bound">u</span><span class="main">;</span> <span class="main">[</span>enum <span class="free">N</span> <span class="bound">k</span><span class="main">]</span> <span class="main">&lt;</span> inter_scheme <span class="bound">k</span> <span class="bound">u</span><span class="main">;</span> List.set <span class="main">(</span>inter_scheme <span class="bound">k</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">=</span> <span class="free">j</span> <span class="bound">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">λ</span><span class="bound">M</span><span class="main">.</span> infinite <span class="bound">M</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">&lt;</span> Inf <span class="bound">M</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Ψ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ψ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">m</span> <span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">λ</span><span class="bound">M</span> <span class="bound">N</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="bound">m</span> <span class="main">∧</span> <span class="bound">N</span> <span class="main">⊆</span> <span class="bound">M</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∈</span> <span class="bound">M</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">U</span><span class="main">.</span> Form <span class="bound">l</span> <span class="bound">U</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">⊆</span> WW <span class="main">∧</span> <span class="main">[</span><span class="bound">n</span><span class="main">]</span> <span class="main">&lt;</span> inter_scheme <span class="bound">l</span> <span class="bound">U</span> <span class="main">∧</span> list.set <span class="main">(</span>inter_scheme <span class="bound">l</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="bound">N</span> <span class="main">⟶</span> <span class="free">g</span> <span class="bound">U</span> <span class="main">=</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">m</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="skolem">m</span> <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"inter_scheme <span class="skolem">l</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">U</span></span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">.</span> Form <span class="skolem">l</span> <span class="bound">U</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">zs</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span>inv_into <span class="main">{</span><span class="bound"><span class="bound">U</span></span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">.</span> Form <span class="skolem">l</span> <span class="bound">U</span><span class="main">}</span> <span class="main">(</span>inter_scheme <span class="skolem">l</span><span class="main">)</span> <span class="bound">zs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"thin <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> lemma_3_11 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> thin_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> WW"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inter_scheme_simple <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">l</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> <span class="var">?A</span><span class="main">.</span> List.set <span class="bound">l</span> <span class="main">⊆</span> <span class="skolem">M</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> g inv_into_into<span class="main">[</span><span class="operator">of</span> <span class="quasi_keyword">concl</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">U</span></span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">.</span> Form <span class="skolem">l</span> <span class="bound">U</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"inter_scheme <span class="skolem">l</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def Pi_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> <span class="var">?A</span><span class="main">.</span> List.set <span class="bound">l</span> <span class="main">⊆</span> <span class="skolem">N</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Φ</span> <span class="skolem">m</span> <span class="skolem">M</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Φ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Nash_Williams_WW <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≡</span> Inf <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Φ</span> <span class="skolem">m</span> <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n_def Φ_def Inf_nat_def infinite_nat_iff_unbounded
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LeastI_ex <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">M</span>›</span></span> le_less_trans not_less not_less_Least subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">U</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Form <span class="skolem">l</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> WW"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">n</span><span class="main">]</span> <span class="main">&lt;</span> inter_scheme <span class="skolem">l</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>inter_scheme <span class="skolem">l</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">N</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> xys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> <span class="skolem">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">xs</span><span class="main">,</span><span class="skolem">ys</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Form_elim_upair <span class="quoted"><span class="quoted">‹Form <span class="skolem">l</span> <span class="skolem">U</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>inter_scheme <span class="skolem">l</span><span class="main">)</span> <span class="main">{</span><span class="bound"><span class="bound">U</span></span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">.</span> Form <span class="skolem">l</span> <span class="bound">U</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> inter_scheme_injective <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">l</span>›</span></span> inj_onI mem_Collect_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>inv_into <span class="main">{</span><span class="bound"><span class="bound">U</span></span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">.</span> Form <span class="skolem">l</span> <span class="bound">U</span><span class="main">}</span> <span class="main">(</span>inter_scheme <span class="skolem">l</span><span class="main">)</span> <span class="main">(</span>inter_scheme <span class="skolem">l</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hj that xys
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def image_subset_iff image_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Diff_subset doubleton_in_nsets_2 dual_order.trans<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> Inf <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> n_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff Inf_nat_def Inf_nat_def1 <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span> finite.emptyI infinite_remove linorder_neqE_nat not_less_Least singletonI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_nat_def1 <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span> finite.emptyI n_def subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">Ψ</span> <span class="skolem">l</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">M</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Φ</span> <span class="skolem">m</span> <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Φ_def Ψ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">N</span> <span class="bound">j</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="bound">n</span> <span class="bound">N</span> <span class="main">∧</span> <span class="skolem">Ψ</span> <span class="skolem">l</span> <span class="skolem">m</span> <span class="bound">n</span> <span class="skolem">M</span> <span class="bound">N</span> <span class="bound">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="main">0</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Φ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> infinite_Ioi Inf_nat_def1 greaterThan_iff greaterThan_non_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"Ex <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">N</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="bound">n</span> <span class="bound">N</span> <span class="main">∧</span> <span class="skolem">Ψ</span> <span class="skolem">l</span> <span class="skolem">m</span> <span class="bound">n</span> <span class="skolem">M</span> <span class="bound">N</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="skolem">m</span> <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">M</span> <span class="skolem">l</span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">M</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Φ_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">m</span> <span class="bound">M</span><span class="main">.</span> <span class="main">@</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">N</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="bound">n</span> <span class="bound">N</span> <span class="main">∧</span> <span class="skolem">Ψ</span> <span class="main">(</span>Suc <span class="bound">l</span><span class="main">)</span> <span class="bound">m</span> <span class="bound">n</span> <span class="bound">M</span> <span class="bound">N</span> <span class="bound">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> GΦ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">N</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="bound">n</span> <span class="bound">N</span><span class="main">)</span> <span class="main">(</span><span class="skolem">G</span> <span class="skolem">l</span> <span class="skolem">m</span> <span class="skolem">M</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> GΨ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">N</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">Ψ</span> <span class="main">(</span>Suc <span class="skolem">l</span><span class="main">)</span> <span class="skolem">m</span> <span class="bound">n</span> <span class="skolem">M</span> <span class="bound">N</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">G</span> <span class="skolem">l</span> <span class="skolem">m</span> <span class="skolem">M</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="skolem">m</span> <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">l</span> <span class="skolem">m</span> <span class="skolem">M</span>
    <span class="keyword1"><span class="command">using</span></span> step <span class="main">[</span><span class="operator">OF</span> that<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">l</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> some_eq_imp<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> G_increasing<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">N</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="bound">N</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∈</span> <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">G</span> <span class="skolem">l</span> <span class="skolem">m</span> <span class="skolem">M</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="skolem">m</span> <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">l</span> <span class="skolem">m</span> <span class="skolem">M</span>
    <span class="keyword1"><span class="command">using</span></span> GΨ <span class="main">[</span><span class="operator">OF</span> that<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ψ_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">≡</span> rec_nat <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">M</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">G</span> <span class="bound">l</span> <span class="bound">m</span> <span class="bound">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> H_simps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span><span class="main">.</span> <span class="skolem">H</span> <span class="main">(</span>Suc <span class="bound">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">H</span> <span class="bound">l</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">M</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">G</span> <span class="bound">l</span> <span class="bound">m</span> <span class="bound">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> HΦ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">N</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="bound">n</span> <span class="bound">N</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">l</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">with</span></span> base <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H_simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> GΦ <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H_simps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split prod.split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ν</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="keyword1">case</span> <span class="skolem">H</span> <span class="bound">l</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">M</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> H_inc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="skolem">l</span> <span class="main">≥</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">l</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> HΦ G_increasing <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="skolem">l</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H_simps ν_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split prod.split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_leI Suc_le_mono case_prod_conv dual_order.trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?N</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"range <span class="skolem">ν</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="keyword1">case</span> <span class="skolem">H</span> <span class="bound">l</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">M</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> H_increasing_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="skolem">H</span> <span class="skolem">k</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="bound">N</span><span class="main">,</span> <span class="bound">j'</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">N</span><span class="main">)</span> <span class="main">⊇</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">H</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="bound">N</span><span class="main">,</span> <span class="bound">j'</span><span class="main">)</span> <span class="main">⇒</span> insert <span class="bound">n</span> <span class="bound">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> HΦ <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H_simps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> G_increasing <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> H_increasing_superset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="skolem">H</span> <span class="skolem">k</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="bound">N</span><span class="main">,</span> <span class="bound">j'</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">N</span><span class="main">)</span> <span class="main">⊇</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">H</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="bound">N</span><span class="main">,</span> <span class="bound">j'</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> H_increasing_Suc <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="skolem">k</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> H_increasing_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="skolem">H</span> <span class="skolem">k</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="bound">N</span><span class="main">,</span> <span class="bound">j'</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">N</span><span class="main">)</span> <span class="main">⊇</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">H</span> <span class="skolem">l</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="bound">N</span><span class="main">,</span> <span class="bound">j'</span><span class="main">)</span> <span class="main">⇒</span> insert <span class="bound">n</span> <span class="bound">N</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span><span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">l</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> H_increasing_Suc add.commute less_imp_Suc_add order_trans that<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">ν</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> HΦ <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> ν_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H_simps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> G_increasing <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> strict_mono_ν<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">ν</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_mono_Suc_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> enum_N<span class="main">:</span> <span class="quoted"><span class="quoted">"enum <span class="var">?N</span> <span class="main">=</span> <span class="skolem">ν</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> enum_works nat_infinite_iff range_strict_mono_ext<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">n</span><span class="main">&lt;..}</span> <span class="main">⊆</span> <span class="skolem">N'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span> <span class="skolem">N'</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">N'</span> <span class="skolem">k</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">ν</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that strict_monoD <span class="main">[</span><span class="operator">OF</span> strict_mono_ν<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="skolem">k</span></span> <span class="main">]</span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ν_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> Mj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ν</span> <span class="skolem">l</span><span class="main">,</span><span class="skolem">M</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ν_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> case_prod_conv old.prod.exhaust<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="skolem">l</span> <span class="main">∈</span> <span class="skolem">N'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that H_increasing_less <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">&lt;</span><span class="skolem">l</span>›</span></span><span class="main">]</span> Mj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="var">?N</span><span class="main">::</span>nat set<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H_inc infinite_nat_iff_unbounded_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">U</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> interU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>enum <span class="var">?N</span> <span class="skolem">l</span><span class="main">]</span> <span class="main">&lt;</span> inter_scheme <span class="skolem">l</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"Form <span class="skolem">l</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>inter_scheme <span class="skolem">l</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?N</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">l</span>›</span></span> gr0_conv_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> WW"</span></span>
      <span class="keyword1"><span class="command">using</span></span> U <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">U</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">m</span><span class="main">,</span> <span class="skolem">M</span><span class="main">,</span> <span class="skolem">j0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="skolem">k</span> <span class="skolem">m</span> <span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span> <span class="skolem">N'</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">M</span> <span class="skolem">j0</span> <span class="skolem">n</span> <span class="skolem">N'</span> <span class="skolem">v</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ν_def H_simps<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span>enum <span class="main">(</span>range <span class="skolem">ν</span><span class="main">)</span> <span class="skolem">l</span><span class="main">}</span> <span class="main">∩</span> list.set <span class="main">(</span>inter_scheme <span class="skolem">l</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inter_scheme_strict_sorted <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">l</span>›</span></span> interU singleton_less_list_iff strict_sorted_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>inter_scheme <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">N'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that sub ** <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">N'</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> Suc_le_eq not_less_eq_eq
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  k n enum_N H_simps<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> that interU <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">⊆</span> WW›</span></span> GΨ <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">M</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> HΦ <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ψ_def k enum_N H_simps n<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">U</span> <span class="main">=</span> <span class="skolem">j</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> k j_def H_simps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Larson's Lemma 3.7›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Analogous to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] ordered_nsets_2_eq<span class="antiquote"><span class="antiquote">}</span></span></span></span>, but without type classes›</span></span>
<span class="keyword1" id="Omega_Omega-total_order_nsets_2_eq"><span class="command">lemma</span></span> total_order_nsets_2_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tot<span class="main">:</span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irrefl <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nsets <span class="free">A</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">}</span> <span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">}</span>"</span></span>
     <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nsets <span class="free">A</span> <span class="numeral">2</span> <span class="main">⊆</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> numeral_nat
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nsets_def card_Suc_eq Set.doubleton_eq_iff not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> tot total_on_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">⊆</span> nsets <span class="free">A</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> irr <span class="keyword1"><span class="command">unfolding</span></span> numeral_nat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def card_Suc_eq irrefl_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Omega_Omega-lenlex_nsets_2_eq"><span class="command">lemma</span></span> lenlex_nsets_2_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"nsets <span class="free">A</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">}</span> <span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> total_order_nsets_2_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> total_order_nsets_2_eq irrefl_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-sum_sorted_list_of_set_map"><span class="command">lemma</span></span> sum_sorted_list_of_set_map<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span> <span class="main">⟹</span> sum_list <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>list_of <span class="free">I</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sum <span class="free">f</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"card <span class="free">I</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">I</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">I</span> <span class="main">-</span> <span class="main">{</span>Min <span class="skolem">I</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sum <span class="free">f</span> <span class="main">(</span><span class="skolem">I</span> <span class="main">-</span> <span class="main">{</span>Min <span class="skolem">I</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems sum.remove <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">I</span></span> <span class="quoted"><span class="quoted">"Min <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_list_of_set_nonempty Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Omega_Omega-sorted_list_of_set_UN_eq_concat"><span class="command">lemma</span></span> sorted_list_of_set_UN_eq_concat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="free">I</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> finite <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span>list_of <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>list_of <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> I
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"card <span class="free">I</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">I</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Iexp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> insert <span class="main">(</span>Min <span class="skolem">I</span><span class="main">)</span> <span class="main">(</span><span class="skolem">I</span> <span class="main">-</span> <span class="main">{</span>Min <span class="skolem">I</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Min_in Suc.hyps<span class="main">(</span>2<span class="main">)</span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">I</span> <span class="main">-</span> <span class="main">{</span>Min <span class="skolem">I</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span>list_of <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">I</span> <span class="main">-</span> <span class="main">{</span>Min <span class="skolem">I</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffE Min_in <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> card_Diff_singleton diff_Suc_1 finite_Diff strict_mono_sets_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> list_of <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">(</span>insert <span class="main">(</span>Min <span class="skolem">I</span><span class="main">)</span> <span class="main">(</span><span class="skolem">I</span> <span class="main">-</span> <span class="main">{</span>Min <span class="skolem">I</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Iexp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> list_of <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Min <span class="skolem">I</span><span class="main">)</span> <span class="main">∪</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">I</span> <span class="main">-</span> <span class="main">{</span>Min <span class="skolem">I</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Union_image_insert<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> list_of <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Min <span class="skolem">I</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> list_of <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">I</span> <span class="main">-</span> <span class="main">{</span>Min <span class="skolem">I</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sorted_list_of_set_Un<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Min <span class="skolem">I</span><span class="main">)</span> <span class="main">≪</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">I</span> <span class="main">-</span> <span class="main">{</span>Min <span class="skolem">I</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> strict_mono_less_sets_Min <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">I</span> <span class="main">-</span> <span class="main">{</span>Min <span class="skolem">I</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">I</span>›</span></span> fin<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> fin <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> list_of <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Min <span class="skolem">I</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> concat <span class="main">(</span>map <span class="main">(</span>list_of <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">I</span> <span class="main">-</span> <span class="main">{</span>Min <span class="skolem">I</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span>list_of <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>list_of <span class="skolem">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> sorted_list_of_set_nonempty<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Lemma 3.7 of Jean A. Larson, ibid.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Possibly should be redone using grab›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> lemma_3_7<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">M</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">∈</span> <span class="main">[</span><span class="free">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> Form <span class="free">l</span> <span class="bound">U</span> <span class="main">∧</span> List.set <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> WW"</span></span>
    <span class="keyword1"><span class="command">using</span></span> WW_def strict_sorted_into_WW <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free">m</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="skolem">w</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def nsets_def w<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def nsets_def w <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> subset_singletonD<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> M that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> nonz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>enum <span class="free">N</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> le_enumerate less_le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">note</span></span> infinite_nxtN <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹infinite <span class="free">N</span>›</span></span><span class="main">,</span> <span class="operator">iff</span><span class="main">]</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">n</span><span class="main">&lt;..&lt;</span>Suc <span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">DF</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DF</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">k</span><span class="main">.</span> rec_nat <span class="main">(</span><span class="main">(</span>enum <span class="free">N</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span>Suc <span class="bound">k</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">D</span><span class="main">.</span> enum <span class="main">(</span>nxt <span class="free">N</span> <span class="main">(</span>enum <span class="main">(</span>nxt <span class="free">N</span> <span class="main">(</span>Max <span class="bound">D</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Inf <span class="bound">D</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span>Suc <span class="bound">k</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> DF_simps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DF</span> <span class="skolem">k</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span>enum <span class="free">N</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span>Suc <span class="skolem">k</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">DF</span> <span class="skolem">k</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> enum <span class="main">(</span>nxt <span class="free">N</span> <span class="main">(</span>enum <span class="main">(</span>nxt <span class="free">N</span> <span class="main">(</span>Max <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Inf <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span>Suc <span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DF_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> card_DF<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>enum <span class="free">N</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">{..&lt;</span>Suc <span class="skolem">k</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_inj_on strict_mono_enum strict_mono_imp_inj_on<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> card_image DF_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="free">N</span>›</span></span> DF_simps card_image infinite_nxtN strict_mono_enum strict_mono_imp_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> DF_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_DF card_lessThan lessThan_empty_iff nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> DF_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="free">N</span>›</span></span> range_enum nonz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DF_simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> DF_simps image_subset_iff
      <span class="keyword1"><span class="command">using</span></span> infinite_nxtN <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹infinite <span class="free">N</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff enumerate_in_set greaterThan_iff not_gr0 not_less0 nxt_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> DF_gt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Inf <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> DF_ne Inf_nat_def1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> finite_DF<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DF_simps<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> sm_enum_DF<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_on <span class="main">(</span>enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">{..</span><span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_DF enum_works_finite finite_DF lessThan_Suc_atMost<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> DF_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span> <span class="main">≪</span> <span class="skolem">DF</span> <span class="skolem">k</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_sets_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_DF DF_simps
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> greaterThan_less_enum nxt_subset_greaterThan atLeast_le_enum nxt_subset_atLeast infinite_nxtN <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹infinite <span class="free">N</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> DF_DF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span> <span class="main">≪</span> <span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> DF_Suc DF_ne UNIV_I less_sets_imp_strict_mono_sets strict_mono_setsD that<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sm_DF<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_sets UNIV <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_mono_sets_def<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">AF</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">AF</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">k</span> <span class="bound">i</span><span class="main">.</span> enum <span class="main">(</span>nxt <span class="free">N</span> <span class="main">(</span>Max <span class="main">(</span><span class="skolem">DF</span> <span class="bound">k</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span>Inf <span class="main">(</span><span class="skolem">DF</span> <span class="bound">k</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> AF_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> AF_def lessThan_empty_iff DF_gt0<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> finite_AF <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> card_AF<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AF_def <span class="quoted"><span class="quoted">‹infinite <span class="free">N</span>›</span></span> card_image inj_enum_nxt<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> DF_AF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span> <span class="main">≪</span> <span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_sets_def AF_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_DF <span class="quoted"><span class="quoted">‹infinite <span class="free">N</span>›</span></span> greaterThan_less_enum nxt_subset_greaterThan<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> AF_DF_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">i</span> <span class="main">≪</span> <span class="skolem">DF</span> <span class="skolem">k</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DF_simps less_sets_def AF_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> strict_monoD <span class="main">[</span><span class="operator">OF</span> strict_mono_enum<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DF_gt0 Suc_pred assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dual_order.order_iff_strict greaterThan_less_enum
        infinite_nxtN linorder_neqE_nat not_less_eq nxt_subset_greaterThan<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> AF_DF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span> <span class="main">≪</span> <span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">&lt;</span><span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">p</span> <span class="skolem">q</span>
    <span class="keyword1"><span class="command">using</span></span> AF_DF_Suc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DF_ne Suc_lessI UNIV_I less_sets_trans sm_DF strict_mono_sets_def that<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> AF_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">i</span> <span class="main">≪</span> <span class="skolem">AF</span> <span class="skolem">k</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> AF_DF_Suc DF_AF DF_ne less_sets_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sm_AF<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_sets UNIV <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AF_ne less_sets_imp_strict_mono_sets<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">del</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">del</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">k</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> enum <span class="main">(</span><span class="skolem">DF</span> <span class="bound">k</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span> <span class="main">-</span> enum <span class="main">(</span><span class="skolem">DF</span> <span class="bound">k</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">QF</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">≡</span> wfrec pair_less <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span>
       <span class="keyword1">if</span> <span class="bound">j</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">AF</span> <span class="skolem">k</span> <span class="bound">i</span>
       <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">m</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span>
                enum <span class="main">(</span>nxt <span class="free">N</span> <span class="main">(</span>Suc <span class="main">(</span>Max <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span> <span class="skolem">del</span> <span class="skolem">k</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">j</span><span class="main">=</span><span class="skolem">k</span> <span class="keyword1">then</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="bound">i</span> <span class="keyword1">else</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">note</span></span> cut_apply <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

  <span class="keyword1"><span class="command">have</span></span> finite_QF <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">QF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> wf_pair_less
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> def_wfrec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> QF_def<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> del_gt_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">j</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">del</span> <span class="skolem">k</span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_DF del_def finite_DF<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> QF_ne <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> wf_pair_less j
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> less
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> def_wfrec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> QF_def<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span> AF_ne lessThan_empty_iff del_gt_0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> QF_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> def_wfrec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> QF_def<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> QF_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> enum <span class="main">(</span>nxt <span class="free">N</span> <span class="main">(</span>Suc <span class="main">(</span>Max <span class="main">(</span><span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span>
                       <span class="main">{..&lt;</span> <span class="skolem">del</span> <span class="skolem">k</span> <span class="main">(</span><span class="keyword1">if</span> Suc <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">then</span> <span class="free">m</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> def_wfrec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> QF_def<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="skolem">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_less_def cut_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">have</span></span> QF_Suc_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">,</span> Suc <span class="skolem">i</span><span class="main">)</span>
                  <span class="main">=</span> enum <span class="main">(</span>nxt <span class="free">N</span> <span class="main">(</span>Suc <span class="main">(</span>Max <span class="main">(</span><span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span> <span class="skolem">del</span> <span class="skolem">k</span> <span class="main">(</span><span class="keyword1">if</span> Suc <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">then</span> <span class="free">m</span> <span class="main">-</span> Suc<span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">else</span> Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> def_wfrec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> QF_def<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="skolem">j</span><span class="main">,</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> less_QF1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> def_wfrec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> QF_def<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="skolem">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span> pair_lessI1 <span class="quoted"><span class="quoted">‹infinite <span class="free">N</span>›</span></span> enum_nxt_ge
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> less_sets_weaken2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> less_sets_Suc_Max<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> less_QF2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span> Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> def_wfrec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> QF_def<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">,</span> Suc <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span> pair_lessI2 <span class="quoted"><span class="quoted">‹infinite <span class="free">N</span>›</span></span> enum_nxt_ge
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_sets_weaken2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> less_sets_Suc_Max<span class="main"><span class="main">]</span></span> strict_mono_setsD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> sm_AF<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> less_QF_same<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i'</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> strict_mono_setsD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> less_sets_imp_strict_mono_sets <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">QF</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">j</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span> Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_QF2<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> le_imp_less_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> less_QF_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">,</span> <span class="skolem">i'</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">i'</span> <span class="skolem">i</span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> less_QF1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">,</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_QF1 that Suc_pred<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">,</span> <span class="skolem">i'</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">=</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> less_QF1' <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> False that less_sets_trans <span class="main">[</span><span class="operator">OF</span> less_QF_same less_QF1' QF_ne<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> QF_ne less_QF_same less_Suc_eq_le less_sets_trans <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> zero_less_iff_neq_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> less_QF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j'</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j'</span> <span class="skolem">j</span> <span class="skolem">i'</span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> j
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">-</span><span class="skolem">j'</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">j'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j'</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span> <span class="skolem">i'</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less_sets_trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ less_QF_step QF_ne<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> Suc i <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j'</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j'</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.hyps <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> less_QF_step i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> sm_QF<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="main">(</span><span class="main">{..</span><span class="skolem">k</span><span class="main">}</span> <span class="main">×</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">QF</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_sets_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">{..</span><span class="skolem">k</span><span class="main">}</span> <span class="main">×</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="main">{..</span><span class="skolem">k</span><span class="main">}</span> <span class="main">×</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j'</span></span> <span class="skolem"><span class="skolem">i'</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j'</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> surj_pair <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> surj_pair <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j'</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">∨</span> <span class="skolem">j'</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">∧</span> <span class="skolem">i'</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="skolem">p</span> <span class="main">≪</span> <span class="skolem">QF</span> <span class="skolem">k</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> conjE disjE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j'</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="skolem">p</span> <span class="main">≪</span> <span class="skolem">QF</span> <span class="skolem">k</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> § <span class="quoted"><span class="quoted">‹<span class="skolem">j'</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> less_QF that<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> § <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main">:</span> that less_QF_same›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sm_QF1<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="main">{..&lt;</span><span class="skolem">ka</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">≥</span> <span class="skolem">ka</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">≥</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ka</span> <span class="skolem">k</span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="skolem">ka</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">k</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lessThan_Suc_atMost lessThan_subset_iff <span class="quoted"><span class="quoted">‹Suc <span class="skolem">k</span> <span class="main">≥</span> <span class="skolem">ka</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_QF strict_mono_sets_def subset_iff that<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> disjoint_QF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span><span class="main">=</span><span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">j'</span><span class="main">=</span><span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> disjnt <span class="main">(</span><span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span> <span class="skolem">i'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j'</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i'</span> <span class="skolem">i</span> <span class="skolem">j'</span> <span class="skolem">j</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> that strict_mono_sets_imp_disjoint <span class="main">[</span><span class="operator">OF</span> sm_QF<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pairwise_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> card_QF<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">del</span> <span class="skolem">k</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">then</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="skolem">i</span> <span class="keyword1">else</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AF_def card_image <span class="quoted"><span class="quoted">‹infinite <span class="free">N</span>›</span></span> inj_enum_nxt<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc QF_Suc QF_Suc_Suc card_image <span class="quoted"><span class="quoted">‹infinite <span class="free">N</span>›</span></span> inj_enum_nxt<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> AF_non_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AF_ne<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> QF_non_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> AF_subset_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">i</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">unfolding</span></span> AF_def image_subset_iff
    <span class="keyword1"><span class="command">using</span></span> nxt_subset enumerate_in_set infinite_nxtN <span class="quoted"><span class="quoted">‹infinite <span class="free">N</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> QF_subset_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">with</span></span> AF_subset_N <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> nxt_subset enumerate_in_set <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹(<span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main">:</span> QF_Suc QF_Suc_Suc)<span class="keyword3">+</span>›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ka</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> kka<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">ka</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">≤</span> Suc <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ka</span><span class="main">+</span><span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> diff_add_inverse form_cases le0 le_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dual_order.strict_trans1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> ka_k_or_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">∨</span> <span class="skolem">ka</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kka <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">have</span></span> lessThan_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="skolem">k</span><span class="main">}</span> <span class="main">=</span> insert <span class="main">0</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sorted_list_of_set_k<span class="main">:</span> <span class="quoted"><span class="quoted">"list_of <span class="main">{..&lt;</span><span class="skolem">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span> <span class="main">#</span> list_of <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword1"><span class="command">using</span></span> sorted_list_of_set_insert_cons <span class="main">[</span><span class="operator">of</span> <span class="quasi_keyword">concl</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">k</span><span class="main">}</span>"</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">RF</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RF</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">j</span> <span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">then</span> <span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">QF</span> <span class="skolem">k</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> RF_subset_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RF</span> <span class="skolem">j</span> <span class="skolem">i</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">using</span></span> that QF_subset_N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> RF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> finite_RF <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">RF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> RF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> RF_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RF</span> <span class="main">0</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> RF_def <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> disjoint_RF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span><span class="main">=</span><span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">j'</span><span class="main">=</span><span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> disjnt <span class="main">(</span><span class="skolem">RF</span> <span class="skolem">j'</span> <span class="skolem">i'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">RF</span> <span class="skolem">j</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j'</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i'</span> <span class="skolem">i</span> <span class="skolem">j'</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">using</span></span> disjoint_QF that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> RF_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> disjoint_QF<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> sum_card_RF <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> DF_ne <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> finite_DF <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> RF_def AF_def card_image <span class="quoted"><span class="quoted">‹infinite <span class="free">N</span>›</span></span> inj_enum_nxt enum_0_eq_Inf_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">0</span> <span class="main">≤</span> enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">∧</span> enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">≤</span> enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sm_enum_DF <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_mono_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_leD dual_order.order_iff_strict le0<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> RF_def card_QF del_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> DF_in_N<span class="main">:</span> <span class="quoted"><span class="quoted">"enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">using</span></span> DF_N <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> card_DF finite_enumerate_in_set finite_DF that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.boundedE le_imp_less_Suc subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Inf_DF_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">using</span></span> DF_N DF_ne Inf_nat_def1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> RF_in_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DF_in_N that<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kka<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sum_card_RF' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">ka</span><span class="main">.</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ka</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> sum_card_RF <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_pred <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ka</span>›</span></span> lessThan_Suc_atMost that<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> enum_DF_le_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">≤</span> enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i'</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">⟷</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">i'</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i'</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">i'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_DF finite_enumerate_in_set finite_DF le_imp_less_Suc <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i'</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> card_DF finite_enumerate_in_set finite_DF le_imp_less_Suc that<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i'</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">&lt;</span> enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sm_DF <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I less_sets_def strict_mono_setsD that<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> not_less that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">i'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sm_DF <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> that <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> card_DF finite_enumerate_in_set finite_DF le_eq_less_or_eq
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_mono_sets_def less_sets_def finite_enumerate_in_set<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> enum_DF_eq_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">=</span> enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i'</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">⟷</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">i'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i'</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_antisym order_refl that<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> enum_DF_less_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">&lt;</span> enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i'</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">⟷</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">i'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i'</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> enum_DF_le_iff not_less that<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> card_AF_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">ka</span><span class="main">}</span><span class="main">.</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ka</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">ka</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">≤</span> Suc <span class="skolem">k</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lessThan_k RF_0 <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> sum_card_RF'<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> sorted_list_of_set_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"list_of <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="skolem">k</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">k</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> atLeastSucLessThan_greaterThanLessThan <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="comment1">―‹proof of main result›</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> list_of <span class="main">(</span><span class="main">⋃</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">ka</span><span class="main">.</span> <span class="skolem">RF</span> <span class="bound">j</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="main">⋃</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">ka</span><span class="main">.</span> <span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> list_of <span class="main">(</span><span class="main">⋃</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">ka</span><span class="main">.</span> <span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">ka</span><span class="main">.</span> <span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">ka</span><span class="main">.</span> <span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_list_of_set_inject<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">RF</span> <span class="main">0</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> AF_ne QF_0 <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> Inf_nat_def1 <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">ka</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> RF_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> eq <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j'</span> <span class="main">&lt;</span> <span class="skolem">ka</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">RF</span> <span class="skolem">j'</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> disjoint_QF <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">j'</span></span><span class="main">]</span> n <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">≤</span> Suc <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> RF_def disjnt_iff <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> QF_0 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> list_of <span class="main">(</span><span class="main">⋃</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">ka</span><span class="main">.</span> <span class="skolem">RF</span> <span class="bound">j</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">M</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">M</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">ka</span>›</span></span> card_image inj<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">⊆</span> WW"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def WW_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nsets_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> sm_RF<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="main">{..&lt;</span><span class="skolem">ka</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> sm_QF1 that kka
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_QF RF_def strict_mono_sets_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> RF_non_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">RF</span> <span class="skolem">j</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> RF_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> less_RF_same<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RF</span> <span class="skolem">j</span> <span class="skolem">i'</span> <span class="main">≪</span> <span class="skolem">RF</span> <span class="skolem">j</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i'</span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_QF_same RF_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> less_RF_same_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RF</span> <span class="skolem">k</span> <span class="skolem">i'</span> <span class="main">≪</span> <span class="skolem">RF</span> <span class="skolem">k</span> <span class="skolem">i</span>"</span></span> <span class="comment1">―‹reversed version for <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">k</span></span><span class="antiquote">}</span></span>›</span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">i'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i'</span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_QF_same RF_def<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Form <span class="free">l</span> <span class="skolem">U</span> <span class="main">∧</span> list.set <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lenlex_nsets_2_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> list_of <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">RF</span> <span class="bound">j</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> list_of <span class="main">(</span><span class="main">⋃</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">ka</span><span class="main">.</span> <span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> list_of <span class="main">(</span><span class="main">⋃</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">ka</span><span class="main">.</span> <span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">&lt;</span><span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">&lt;</span> length <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xy <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">ka</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">≤</span> Suc <span class="skolem">k</span>›</span></span> lexl_not_refl <span class="main">[</span><span class="operator">OF</span> irrefl_less_than<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lenlex_def sm_RF sorted_list_of_set_UN_lessThan length_concat sum_sorted_list_of_set_map<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span><span class="var">?R</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{..&lt;</span><span class="skolem">ka</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x sorted_list_of_set_UN_eq_concat <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">ka</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">≤</span> Suc <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> sm_RF<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> yc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span><span class="var">?R</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{..&lt;</span><span class="skolem">ka</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y sorted_list_of_set_UN_eq_concat <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">ka</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">≤</span> Suc <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> sm_RF<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> enum_DF_AF<span class="main">:</span> <span class="quoted"><span class="quoted">"enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ka</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> hd <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> less_setsD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> DF_AF<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ka</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">≤</span> Suc <span class="skolem">k</span>›</span></span> card_DF finite_DF <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_enumerate_in_set<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> AF_non_Nil finite_AF hd_in_set set_sorted_list_of_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> less_RF_RF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RF</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="main">≪</span> <span class="skolem">RF</span> <span class="skolem">n</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">&lt;</span><span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_RF_same<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> less_RF_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RF</span> <span class="skolem">n</span> <span class="skolem">q</span> <span class="main">≪</span> <span class="skolem">RF</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> RF_def less_QF<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> less_RF_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RF</span> <span class="skolem">k</span> <span class="skolem">q</span> <span class="main">≪</span> <span class="skolem">RF</span> <span class="skolem">k</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> less_RF_same_k <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">&lt;</span><span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> less_RF_k_ka<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RF</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">≪</span> <span class="skolem">RF</span> <span class="main">(</span><span class="skolem">ka</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ka_k_or_Suc less_RF_RF
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def RF_def <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> diff_Suc_1 diff_Suc_less less_QF_step<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> Inf_DF_eq_enum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_nat_def enumerate_0<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> Inf_DF_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span><span class="main">&lt;</span><span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i'</span> <span class="skolem">i</span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DF_ne enum_0_eq_Inf enum_0_eq_Inf_finite enum_DF_less_iff le0 that<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> AF_Inf_DF_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">i</span> <span class="main">⟹</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span><span class="main">≤</span><span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i'</span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">using</span></span> less_setsD <span class="main">[</span><span class="operator">OF</span> DF_AF<span class="main">]</span> DF_ne that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_DF_less Inf_nat_def1 dual_order.order_iff_strict dual_order.strict_trans<span class="main">)</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">1</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> kka <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">case</span></span> 1
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">#</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span>
                              <span class="main">@</span> card <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">#</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> zs<span class="main">:</span> <span class="quoted"><span class="quoted">"Form_Body <span class="skolem">ka</span> <span class="skolem">k</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">zs</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> that exI conjI Form_Body.intros <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span> <span class="main">&lt;</span> length <span class="skolem">y</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> concat <span class="main">(</span><span class="main">[</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> concat <span class="main">(</span><span class="main">[</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x y 1 lessThan_Suc RF_0<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span> <span class="main">≪</span> insert <span class="main">(</span><span class="main">⨅</span> <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AF_DF DF_ne Inf_nat_def1 RF_0 <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> insert_iff less_RF_RF less_sets_def pq<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">@</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">#</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_sorted_append_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_sets_imp_list_less AF_Inf_DF_less<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span> <span class="main">⟹</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">x</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> AF_Inf_DF_less less_imp_le_nat <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="skolem">zs</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> True Inf_DF_less DF_AF DF_ne
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zs_def less_sets_def card_AF AF_Inf_DF_less<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Inf_nat_def1<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">=</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span><span class="main">=</span><span class="main">1</span>›</span></span> acc_lengths.simps zs_def AF_ne<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> zs_N<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">zs</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> AF_subset_N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zs_def card_AF Inf_DF_N <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">=</span><span class="main">1</span>›</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> kka <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">=</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span><span class="main">=</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Form <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">1</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> Form.intros<span class="main">(</span>2<span class="main">)</span> True zs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Form <span class="free">l</span> <span class="skolem">U</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">=</span> <span class="main">1</span>›</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> kka zs zs_N <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">=</span><span class="main">1</span>›</span></span> Form_Body_imp_inter_scheme <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> 2
          <span class="keyword1"><span class="command">note</span></span> True <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="keyword1"><span class="command">note</span></span> 2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="numeral">2</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>Suc <span class="main">0</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> enum_DF1_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"enum <span class="main">(</span><span class="skolem">DF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
            <span class="keyword1"><span class="command">using</span></span> card_AF_sum that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> card_RF<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> enum <span class="main">(</span><span class="skolem">DF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">-</span> enum <span class="main">(</span><span class="skolem">DF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> RF_def card_QF del_def<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> list_of_AF_RF<span class="main">:</span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> RF_def <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> less_QF_step <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sorted_list_of_set_Un<span class="main">)</span>

          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>card <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">#</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span>
                  <span class="main">@</span> <span class="main">(</span>card <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="main">1</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">1</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> zs<span class="main">:</span> <span class="quoted"><span class="quoted">"Form_Body <span class="skolem">ka</span> <span class="skolem">k</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">zs</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> that exI conjI Form_Body.intros <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span> <span class="main">&lt;</span> length <span class="skolem">y</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">0</span> <span class="skolem">p</span> <span class="main">∪</span> <span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x eval_nat_numeral lessThan_Suc RF_0 Un_commute<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">0</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> RF_def True <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> less_QF_step
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sorted_list_of_set_Un<span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> concat <span class="main">(</span><span class="main">[</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span><span class="main">,</span>list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> RF_0<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> concat <span class="main">[</span>list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">1</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">q</span><span class="main">)</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y eval_nat_numeral lessThan_Suc RF_0<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> concat <span class="main">[</span><span class="main">[</span>card <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span><span class="main">,</span> card <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span><span class="main">,</span>
                              <span class="main">[</span>card <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="main">1</span> <span class="skolem">q</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">1</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">q</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> interact <span class="main">[</span>list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> list_of_AF_RF <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zs_def Un_commute<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="skolem">zs</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">&lt;</span><span class="free">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&lt;</span><span class="free">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">&lt;</span><span class="skolem">q</span>›</span></span> zs_def strict_sorted_append_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI strip<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">&lt;</span><span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_RF card_DF finite_DF<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">&lt;</span><span class="skolem">q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&lt;</span><span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_DF_less card_AF trans_less_add1<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
                <span class="keyword1"><span class="command">using</span></span> that
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_AF<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AF_ne DF_AF DF_ne less_RF_RF less_RF_Suc less_RF_k Inf_nat_def1 One_nat_def RF_0 RF_non_Nil True finite_RF lessI less_setsD less_sets_trans sorted_list_of_set_eq_Nil_iff<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> enum_DF1_eq enum_DF_less_iff le_refl<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
                <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> enum_DF1_eq<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AF_ne DF_AF less_RF_RF less_RF_Suc less_RF_k One_nat_def RF_0 RF_non_Nil Suc_mono True <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> card_DF finite_enumerate_in_set finite_DF less_setsD less_sets_trans sorted_list_of_set_empty<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> list_of <span class="main">{</span>enum <span class="main">(</span><span class="skolem">DF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> less_sets_imp_sorted_list_of_set<span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">≪</span> <span class="main">{</span>enum <span class="main">(</span><span class="skolem">DF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> AF_DF DF_ne Inf_nat_def1 <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> card_AF enum_DF1_eq less_setsD less_sets_singleton2 pq<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> trans_less_add1<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>card <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def enum_DF1_eq<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
                <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> enum_DF1_eq<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AF_ne DF_AF less_RF_Suc less_RF_k One_nat_def RF_0 RF_non_Nil True card_DF finite_enumerate_in_set finite_DF finite_RF lessI less_setsD less_sets_trans sorted_list_of_set_eq_Nil_iff<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> less_sets_imp_sorted_list_of_set<span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">≪</span> <span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_RF_Suc One_nat_def RF_0 True <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">AF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> RF_non_Nil <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_list_def<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> less_sets_imp_sorted_list_of_set<span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">≪</span> <span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_RF_k One_nat_def True<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span><span class="main">,</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span><span class="main">]</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> RF_non_Nil <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> acc_lengths.simps zs_def AF_ne<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>card <span class="main">(</span><span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="main">1</span> <span class="skolem">q</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">[</span>list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">1</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="skolem">AF</span> <span class="main">1</span> <span class="skolem">q</span><span class="main">)</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> list_of_AF_RF
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> acc_lengths.simps zs_def AF_ne sup_commute<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> acc_lengths.simps zs_def AF_ne<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> zs_N<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">zs</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> DF_in_N  enum_DF1_eq <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zs_def card_AF AF_subset_N RF_subset_N Inf_DF_N<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Form <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">1</span><span class="main">)</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"2"</span> Form.simps Suc_1 True zero_less_one zs<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> kka <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Form <span class="free">l</span> <span class="skolem">U</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>›</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>inter_scheme <span class="free">l</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> kka zs zs_N <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">=</span><span class="main">1</span>›</span></span> Form_Body_imp_inter_scheme <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> kka <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k_minus_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">PP</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PP</span> <span class="main">≡</span> map <span class="main">(</span><span class="var">?R</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">ka</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">QQ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">QQ</span> <span class="main">≡</span> map <span class="main">(</span><span class="var">?R</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">k</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="main">[</span>list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="skolem">RF</span> <span class="main">(</span><span class="skolem">ka</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?INT</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"interact <span class="skolem">PP</span> <span class="skolem">QQ</span>"</span></span>
        <span class="comment1">―‹No separate sets A and B as in the text, but instead we treat both cases as once›</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">PP</span> <span class="main">=</span> <span class="skolem">ka</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PP_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">QQ</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> QQ_def<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> PP_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">PP</span> <span class="main">!</span> <span class="skolem">n</span> <span class="main">=</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">ka</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
          <span class="keyword1"><span class="command">using</span></span> that kka <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PP_def nth_sorted_list_of_set_greaterThanLessThan<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> QQ_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QQ</span> <span class="main">!</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span>
                              <span class="keyword1">else</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="skolem">RF</span> <span class="main">(</span><span class="skolem">ka</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">k</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
          <span class="keyword1"><span class="command">using</span></span> that kka <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> QQ_def nth_append nth_sorted_list_of_set_greaterThanLessThan<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> QQ_n_same<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QQ</span> <span class="main">!</span> <span class="skolem">n</span> <span class="main">=</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="skolem">ka</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
          <span class="keyword1"><span class="command">using</span></span> that kka Suc_diff_Suc
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> QQ_def nth_append nth_sorted_list_of_set_greaterThanLessThan<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> split_nat_interval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> insert <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> split_list_interval<span class="main">:</span> <span class="quoted"><span class="quoted">"list_of<span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> list_of<span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">}</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sorted_list_of_set_unique <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">}</span> <span class="main">&lt;</span> <span class="main">[</span><span class="skolem">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_sets_imp_list_less<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>list_of <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">}</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_sorted_append_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> list_of_RF_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="skolem">RF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_RF_Suc Suc_pred <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> diff_Suc_less finite_RF sorted_list_of_set_Un<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> card_AF_sum_QQ<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> sum_list <span class="main">(</span>map length <span class="skolem">QQ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">ka</span><span class="main">.</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RF</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∩</span> <span class="skolem">RF</span> <span class="skolem">k</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> less_RF_Suc <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="skolem">RF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Un_disjoint<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> QQ_def True <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> RF_0<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lessThan_k split_nat_interval sum_sorted_list_of_set_map<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> kka <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span><span class="main">=</span><span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="numeral">2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> QQ_def lessThan_k split_nat_interval sum_sorted_list_of_set_map <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> RF_0<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">LENS</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LENS</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">i</span><span class="main">.</span> acc_lengths <span class="main">0</span> <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="bound">i</span><span class="main">)</span> <span class="main">#</span> map <span class="main">(</span><span class="var">?R</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">ka</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> LENS_subset_N<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span><span class="skolem">LENS</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">#</span> map <span class="main">(</span><span class="var">?R</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">ka</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span><span class="var">?R</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{..&lt;</span><span class="skolem">ka</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> RF_0 <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ka</span>›</span></span> sorted_list_of_set_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rec_nat <span class="main">[</span>card <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span>Suc <span class="bound">n</span><span class="main">.</span> card <span class="main">(</span><span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"acc_lengths <span class="main">0</span> <span class="main">(</span>map <span class="main">(</span><span class="var">?R</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{..</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> RF_0 acc_lengths.simps acc_lengths_append sum_sorted_list_of_set_map<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span><span class="var">?f</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span>
            <span class="keyword1"><span class="command">using</span></span> that
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> 0
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DF_N DF_ne Inf_nat_def1 Int_subset_iff card_AF subsetD<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">v</span><span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enum <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DF_N Int_subset_iff card_DF finite_enumerate_in_set finite_DF in_mono le_imp_less_Suc<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> Suc <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sum.atMost_Suc<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> LENS_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"3"</span> Suc_pred <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ka</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> eq f lessThan_Suc_atMost<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">LENS_QQ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LENS_QQ</span> <span class="main">≡</span> acc_lengths <span class="main">0</span> <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">QQ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> LENS_QQ_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">LENS_QQ</span> <span class="main">⊆</span> list.set <span class="main">(</span><span class="skolem">LENS</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> QQ_def LENS_QQ_def LENS_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_of_RF_Un split_list_interval acc_lengths.simps acc_lengths_append<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span><span class="main">=</span><span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> kka <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> QQ_def LENS_QQ_def LENS_def split_list_interval<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> ss_INT<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="var">?INT</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> strict_sorted_interact_I<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">QQ</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">k</span><span class="main">-</span><span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> n that <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">&lt;</span><span class="skolem">q</span>›</span></span> n <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PP</span> <span class="main">!</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">QQ</span> <span class="main">!</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">ka</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">≤</span> Suc <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">&lt;</span><span class="skolem">q</span>›</span></span> n
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PP_n QQ_n less_RF_same less_sets_imp_sorted_list_of_set less_sets_Un2 less_RF_RF less_RF_k_ka<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
          <span class="keyword1"><span class="command">have</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Suc <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">ka</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> One_nat_def RF_def Suc_leI <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> diff_Suc_1 finite_RF less_QF_step less_le_trans less_sets_imp_sorted_list_of_set nat_neq_iff zero_less_Suc<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RF</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span>  Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">≪</span> <span class="skolem">RF</span> <span class="skolem">k</span> <span class="skolem">p</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_RF_Suc less_RF_k RF_non_Nil Suc_pred <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> finite_RF lessI less_sets_trans sorted_list_of_set_eq_Nil_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> kka <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RF</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="skolem">RF</span> <span class="main">(</span><span class="skolem">ka</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">≪</span> <span class="skolem">RF</span> <span class="skolem">k</span> <span class="skolem">p</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_RF_k One_nat_def less_sets_Un1 antisym_conv2 diff_Suc_1 le_less_Suc_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> VI<span class="main">:</span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∪</span> <span class="skolem">RF</span> <span class="main">(</span><span class="skolem">ka</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less_sets_imp_sorted_list_of_set<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">PP</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">≤</span> Suc <span class="skolem">k</span>›</span></span> VI
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">QQ</span> <span class="main">!</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">PP</span> <span class="main">!</span> Suc <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PP_n QQ_n less_RF_same less_sets_imp_sorted_list_of_set less_sets_Un1 less_sets_Un2 less_RF_RF less_RF_k_ka V<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_less_eq Suc_pred <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> diff_Suc_1 k_minus_1 ka_k_or_Suc less_SucE<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PP</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> RF_non_Nil kka
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PP_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> RF_non_Nil less_le_trans<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">QQ</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> RF_non_Nil kka
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> QQ_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> RF_non_Nil Suc_pred <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> less_SucI<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> kka PP_def QQ_def <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss_QQ<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="skolem">QQ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> strict_sorted_interact_imp_concat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> zs<span class="main">:</span> <span class="quoted"><span class="quoted">"Form_Body <span class="skolem">ka</span> <span class="skolem">k</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zs_N<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">zs</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> that exI conjI Form_Body.intros <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span> <span class="main">&lt;</span> length <span class="skolem">y</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> concat <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">PP</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PP_def RF_0 xc sorted_list_of_set_k<span class="main">)</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?YR</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="main">(</span>list_of <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">ka</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concat <span class="var">?YR</span> <span class="main">=</span> concat <span class="skolem">QQ</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> strict_sorted_equal <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ss_QQ<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="var">?YR</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> strict_sorted_concat_I<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">ka</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>list_of <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">ka</span><span class="main">}</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;</span> list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>list_of <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">ka</span><span class="main">}</span> <span class="main">!</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_RF_Suc Suc_lessD <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> add.left_neutral finite_RF less_le_trans less_sets_imp_sorted_list_of_set nth_sorted_list_of_set_greaterThanLessThan<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?YR</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> RF_non_Nil <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">≤</span> Suc <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mem_lists_non_Nil<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>concat <span class="var">?YR</span><span class="main">)</span> <span class="main">=</span> list.set <span class="main">(</span>concat <span class="skolem">QQ</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> ka_k_or_Suc
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span>list_of <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">ka</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> list.set <span class="main">(</span>concat <span class="skolem">QQ</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_nat_interval QQ_def<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span>list_of <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">RF</span> <span class="bound">j</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">ka</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> list.set <span class="main">(</span>concat <span class="skolem">QQ</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> QQ_def split_nat_interval<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> concat <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">QQ</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> RF_0 yc sorted_list_of_set_k<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">PP</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">QQ</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span>  RF_non_Nil kka <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> AF_ne PP_def QQ_def eq_commute <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span><span class="main">(</span><span class="skolem">LENS</span> <span class="skolem">p</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">LENS_QQ</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">@</span> <span class="var">?INT</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> AF_subset_N RF_subset_N LENS_subset_N <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> LENS_QQ_subset
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_iff PP_def QQ_def<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">PP</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ka</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">QQ</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ka</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LENS</span> <span class="skolem">p</span> <span class="main">=</span> acc_lengths <span class="main">0</span> <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">PP</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> LENS_def PP_def<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span><span class="skolem">LENS</span> <span class="skolem">p</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">LENS_QQ</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">@</span> <span class="var">?INT</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> strict_sorted_append_iff
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI ss_INT<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LENS</span> <span class="skolem">p</span> <span class="main">&lt;</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">LENS_QQ</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">@</span> <span class="var">?INT</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> AF_non_Nil <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">ka</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">≤</span> Suc <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> card_AF_sum enum_DF_AF
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enum_DF_AF less_list_def card_AF_sum LENS_def sum_sorted_list_of_set_map<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span><span class="skolem">LENS</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> LENS_def
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> strict_sorted_acc_lengths<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> RF_non_Nil AF_non_Nil kka <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> in_lists_conv_set›</span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="skolem">LENS_QQ</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> LENS_QQ_def QQ_def
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> strict_sorted_acc_lengths<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> RF_non_Nil AF_non_Nil kka <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> in_lists_conv_set›</span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> last_AF_DF<span class="main">:</span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> AF_DF <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> AF_non_Nil <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> DF_ne <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_nat_def1 finite_AF last_in_set less_sets_def set_sorted_list_of_set<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">LENS_QQ</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">@</span> <span class="var">?INT</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def card_AF LENS_QQ_def<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LENS_QQ</span> <span class="main">&lt;</span> list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">@</span> <span class="var">?INT</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> AF_non_Nil <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> card_AF_sum enum_DF_AF card_AF_sum_QQ
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_list_def AF_ne hd_append card_AF_sum LENS_QQ_def<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;</span> <span class="var">?INT</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span> <span class="main">≪</span> <span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> RF_def less_QF <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> QF_0<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> hd <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> less_setsD<span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">AF</span> <span class="skolem">k</span> <span class="skolem">q</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> AF_non_Nil finite_AF last_in_set set_sorted_list_of_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">RF</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> RF_non_Nil Suc_mono <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> finite_RF hd_in_set set_sorted_list_of_set<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ka</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> RF_non_Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hd_interact less_list_def sorted_list_of_set_greaterThanLessThan PP_def QQ_def<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> LENS_QQ_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ka</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> kka<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mult_2<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Form.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Form_Body_imp_inter_scheme True <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span>›</span></span> kka zs zs_N<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> kka <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False Form.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Form_Body_imp_inter_scheme <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span>›</span></span> antisym kka le_SucE zs zs_N<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Larson's Lemma 3.8›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Primitives needed for the inductive construction of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">IJ</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">IJ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">k</span><span class="main">.</span> Sigma <span class="main">{..</span><span class="bound">k</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">{..&lt;</span><span class="bound">j</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Omega_Omega-IJ_iff"><span class="command">lemma</span></span> IJ_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> IJ <span class="free">k</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span> <span class="bound">i</span><span class="main">.</span> <span class="free">u</span> <span class="main">=</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span><span class="main">&lt;</span><span class="bound">j</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">≤</span><span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> IJ_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-finite_IJ"><span class="command">lemma</span></span> finite_IJ<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>IJ <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> IJ_def<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">prev</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prev</span> <span class="main">0</span> <span class="main">0</span> <span class="main">=</span> None"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">prev</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> None"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">prev</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">prev</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Omega_Omega-prev_eq_None_iff"><span class="command">lemma</span></span> prev_eq_None_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"prev <span class="free">j</span> <span class="free">i</span> <span class="main">=</span> None <span class="main">⟷</span> <span class="free">j</span> <span class="main">≤</span> Suc <span class="main">0</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_Suc_eq <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> prev.elims<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-prev_pair_less"><span class="command">lemma</span></span> prev_pair_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prev <span class="free">j</span> <span class="free">i</span> <span class="main">=</span> Some <span class="free">ji'</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ji'</span><span class="main">,</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> pair_less"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pair_lessI1 <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> prev.elims<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-prev_Some_less"><span class="command">lemma</span></span> prev_Some_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>prev <span class="free">j</span> <span class="free">i</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">j'</span><span class="main">,</span><span class="free">i'</span><span class="main">)</span><span class="main">;</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">j</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">i'</span> <span class="main">&lt;</span> <span class="free">j'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> prev.elims<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-prev_maximal"><span class="command">lemma</span></span> prev_maximal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>prev <span class="free">j</span> <span class="free">i</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">j'</span><span class="main">,</span><span class="free">i'</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="free">ji''</span><span class="main">,</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> pair_less<span class="main">;</span> <span class="free">ji''</span> <span class="main">∈</span> IJ <span class="free">k</span><span class="main">⟧</span>
   <span class="main">⟹</span> <span class="main">(</span><span class="free">ji''</span><span class="main">,</span> <span class="main">(</span><span class="free">j'</span><span class="main">,</span><span class="free">i'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> pair_less <span class="main">∨</span> <span class="free">ji''</span> <span class="main">=</span> <span class="main">(</span><span class="free">j'</span><span class="main">,</span><span class="free">i'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> IJ_def pair_less_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> prev.elims<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-pair_less_prev"><span class="command">lemma</span></span> pair_less_prev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> pair_less"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> IJ <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prev <span class="free">j</span> <span class="free">i</span> <span class="main">=</span> Some <span class="free">u</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> pair_less <span class="main">∧</span> prev <span class="free">j</span> <span class="free">i</span> <span class="main">=</span> Some <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"prev <span class="free">j</span> <span class="free">i</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> None
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pair <span class="skolem">j'</span> <span class="skolem">i'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms None <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prev_eq_None_iff pair_less_def IJ_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms prev_maximal prod.exhaust_sel<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Special primitives for the ordertype proof›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">USigma</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">USigma</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">X</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">𝒜</span></span></span><span class="main">.</span> <span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="bound">X</span><span class="main">.</span> <span class="main">{</span>insert <span class="bound">y</span> <span class="bound">X</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">usplit</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">usplit</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="main">{</span>Max <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>Max <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Omega_Omega-USigma_empty"><span class="command">lemma</span></span> USigma_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"USigma <span class="main">{}</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> USigma_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-USigma_iff"><span class="command">lemma</span></span> USigma_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">I</span> <span class="main">∈</span> <span class="free">ℐ</span> <span class="main">⟹</span> <span class="bound">I</span> <span class="main">≪</span> <span class="free">J</span> <span class="bound">I</span> <span class="main">∧</span> finite <span class="bound">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> USigma <span class="free">ℐ</span> <span class="free">J</span> <span class="main">⟷</span> usplit <span class="main">(</span><span class="main">λ</span><span class="bound">I</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">I</span><span class="main">∈</span><span class="free">ℐ</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">∈</span><span class="free">J</span> <span class="bound">I</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> insert <span class="bound">j</span> <span class="bound">I</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">j</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">I</span> <span class="main">∈</span> <span class="free">ℐ</span><span class="main">;</span> <span class="bound">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="bound">I</span><span class="main">⟧</span> <span class="main">⟹</span> Max <span class="main">(</span>insert <span class="bound">j</span> <span class="bound">I</span><span class="main">)</span> <span class="main">=</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Max_insert2 assms less_imp_le less_sets_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="main">∈</span> <span class="free">ℐ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">∈</span> <span class="free">ℐ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">I</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_empty Diff_insert0 assms less_irrefl less_sets_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="main">(</span><span class="skolem">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">∈</span> <span class="free">ℐ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">I</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_empty Diff_insert0 assms less_irrefl less_setsD<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">I</span><span class="main">∈</span><span class="free">ℐ</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span><span class="main">∈</span><span class="free">J</span> <span class="bound">I</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> insert <span class="bound">j</span> <span class="bound">I</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="free">x</span><span class="main">}</span> <span class="main">∈</span> <span class="free">ℐ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Max <span class="free">x</span> <span class="main">∈</span> <span class="free">J</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Max_in assms infinite_remove insert_Diff<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> USigma_def usplit_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Omega_Omega-ordertype_append_image_IJ"><span class="command">lemma</span></span> ordertype_append_image_IJ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lenB <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">ℐ</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="bound">i</span> <span class="main">⟹</span> length <span class="main">(</span><span class="free">B</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">ℐ</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="free">A</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">B</span> <span class="bound">j</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> IJ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">ℐ</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">≪</span> <span class="free">J</span> <span class="bound">i</span> <span class="main">∧</span> finite <span class="bound">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">ℐ</span> <span class="main">⟹</span> ordertype <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">J</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">=</span> <span class="free">β</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">A</span> <span class="free">ℐ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>usplit <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span> <span class="main">@</span> <span class="free">B</span> <span class="bound">j</span><span class="main">)</span> <span class="main">`</span> USigma <span class="free">ℐ</span> <span class="free">J</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span>
       <span class="main">=</span> <span class="free">β</span> <span class="main">*</span> ordertype <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="free">ℐ</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="var">?AB</span> <span class="var">?R</span> <span class="main">=</span> <span class="main">_</span> <span class="main">*</span> <span class="var">?α</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ℐ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> β False wf_Ord_ordertype <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ordertype_eq_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">split</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">split</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">l</span><span class="main">::</span>nat list<span class="main">.</span> <span class="main">(</span>take <span class="main">(</span>length <span class="bound">l</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="bound">l</span><span class="main">,</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="bound">l</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> oB<span class="main">:</span> <span class="quoted"><span class="quoted">"ordermap <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">J</span> <span class="skolem">i</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">B</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">⊏</span> <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="skolem">i</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">using</span></span> β less_TC_iff that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="free">β</span> <span class="main">*</span> <span class="var">?α</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> wf_Ord_ordertype Ord_mult<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">split</span> <span class="bound">u</span> <span class="keyword1">in</span> <span class="keyword1">let</span> <span class="bound">i</span> <span class="main">=</span> inv_into <span class="free">ℐ</span> <span class="free">A</span> <span class="bound">x</span> <span class="keyword1">in</span>
                        <span class="free">β</span> <span class="main">*</span> ordermap <span class="main">(</span><span class="free">A</span><span class="main">`</span><span class="free">ℐ</span><span class="main">)</span> <span class="var">?R</span> <span class="bound">x</span> <span class="main">+</span> ordermap <span class="main">(</span><span class="free">B</span><span class="main">`</span><span class="free">J</span> <span class="bound">i</span><span class="main">)</span> <span class="var">?R</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> inv_into_IA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inv_into <span class="free">ℐ</span> <span class="free">A</span> <span class="main">(</span><span class="free">A</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">ℐ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A that<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="var">?AB</span> <span class="main">(</span>elts <span class="main">(</span><span class="free">β</span> <span class="main">*</span> <span class="var">?α</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?AB</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="var">?AB</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI strip<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="var">?AB</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def inj_on_def split_def USigma_iff IJ usplit_def<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
        <span class="keyword3"><span class="command">assume</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">*</span> ordermap <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="free">ℐ</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">A</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> ordermap <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">J</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">B</span> <span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">=</span> <span class="free">β</span> <span class="main">*</span> ordermap <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="free">ℐ</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">A</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> ordermap <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">J</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">B</span> <span class="main">(</span>Max <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span> <span class="main">∈</span> <span class="free">ℐ</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span> <span class="main">∈</span> <span class="free">ℐ</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> mx<span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="skolem">x</span> <span class="main">∈</span> <span class="free">J</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> insert <span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> my<span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="skolem">y</span> <span class="main">∈</span> <span class="free">J</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="main">(</span><span class="free">A</span><span class="main">`</span><span class="free">ℐ</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">A</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ordermap <span class="main">(</span><span class="free">A</span><span class="main">`</span><span class="free">ℐ</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">A</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> B_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ordermap <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">J</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">B</span> <span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ordermap <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">J</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">B</span> <span class="main">(</span>Max <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> mult_cancellation_lemma <span class="main">[</span><span class="operator">OF</span> §<span class="main">]</span> oB mx my x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> x y inv_into_IA<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="free">B</span> <span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span> <span class="main">(</span>Max <span class="skolem">y</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> B_eq mx my <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="var">?AB</span> <span class="main">=</span> elts <span class="main">(</span><span class="free">β</span> <span class="main">*</span> <span class="var">?α</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="var">?AB</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">β</span> <span class="main">*</span> <span class="var">?α</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def split_def USigma_iff IJ usplit_def<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_mem_iff_less_TC TC_small add_mult_less image_eqI oB ordermap_in_ordertype trans_llt wf_Ord_ordertype wf_llt<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="free">β</span> <span class="main">*</span> <span class="var">?α</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">f</span> <span class="main">`</span> <span class="var">?AB</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def split_def image_iff USigma_iff IJ usplit_def Bex_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> elts_multE <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">γ</span> <span class="skolem">δ</span>
          <span class="keyword3"><span class="command">assume</span></span> δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="var">?α</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> ordermap <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="free">ℐ</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">`</span> <span class="free">A</span> <span class="main">`</span> <span class="free">ℐ</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> γ ordermap_surj subset_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">ℐ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> ordermap <span class="main">(</span><span class="free">A</span><span class="main">`</span><span class="free">ℐ</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">A</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">∈</span> ordermap <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">J</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">`</span> <span class="free">J</span> <span class="skolem">i</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> β δ <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> in_mono ordermap_surj<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">=</span> ordermap <span class="main">(</span><span class="free">B</span><span class="main">`</span><span class="free">J</span> <span class="skolem">i</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">B</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mji<span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> IJ Max_insert2 <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> less_imp_le less_sets_def<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> IJ <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="skolem">i</span>›</span></span> less_setsD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword3"><span class="command">show</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">K</span><span class="main">.</span> <span class="bound">K</span> <span class="main">-</span> <span class="main">{</span>Max <span class="bound">K</span><span class="main">}</span> <span class="main">∈</span> <span class="free">ℐ</span> <span class="main">∧</span> Max <span class="bound">K</span> <span class="main">∈</span> <span class="free">J</span> <span class="main">(</span><span class="bound">K</span> <span class="main">-</span> <span class="main">{</span>Max <span class="bound">K</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span>
                          <span class="bound">K</span> <span class="main">=</span> insert <span class="main">(</span>Max <span class="bound">K</span><span class="main">)</span> <span class="bound">K</span> <span class="main">∧</span>
                          <span class="bound">l</span> <span class="main">=</span> <span class="free">A</span> <span class="main">(</span><span class="bound">K</span> <span class="main">-</span> <span class="main">{</span>Max <span class="bound">K</span><span class="main">}</span><span class="main">)</span> <span class="main">@</span> <span class="free">B</span> <span class="main">(</span>Max <span class="bound">K</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">β</span> <span class="main">*</span> <span class="skolem">γ</span> <span class="main">+</span> <span class="skolem">δ</span> <span class="main">=</span>
                    <span class="free">β</span> <span class="main">*</span>
                    ordermap <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="free">ℐ</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span>take <span class="main">(</span>length <span class="bound">l</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="bound">l</span><span class="main">)</span> <span class="main">+</span>
                    ordermap <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">J</span> <span class="main">(</span>inv_into <span class="free">ℐ</span> <span class="free">A</span> <span class="main">(</span>take <span class="main">(</span>length <span class="bound">l</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="var">?R</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="bound">l</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI exI<span class="main">)</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ji</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">j</span> <span class="skolem">i</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="skolem">i</span> <span class="main">@</span> <span class="free">B</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">(</span><span class="var">?ji</span> <span class="main">-</span> <span class="main">{</span>Max <span class="var">?ji</span><span class="main">}</span><span class="main">)</span> <span class="main">@</span> <span class="free">B</span> <span class="main">(</span>Max <span class="var">?ji</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mji<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="skolem">i</span>›</span></span> mji xu yv <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?AB</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="var">?AB</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> peq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="free">A</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">@</span> <span class="free">B</span> <span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> qeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">A</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span><span class="main">)</span> <span class="main">@</span> <span class="free">B</span> <span class="main">(</span>Max <span class="skolem">y</span><span class="main">)</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span> <span class="main">∈</span> <span class="free">ℐ</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span> <span class="main">∈</span> <span class="free">ℐ</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> mx<span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="skolem">x</span> <span class="main">∈</span> <span class="free">J</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> my<span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="skolem">y</span> <span class="main">∈</span> <span class="free">J</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> USigma_iff IJ usplit_def<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?my</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">f</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">f</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span>
        <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="main">(</span><span class="free">A</span><span class="main">`</span><span class="free">ℐ</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">A</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> ordermap <span class="main">(</span><span class="free">A</span><span class="main">`</span><span class="free">ℐ</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">A</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="main">|</span> <span class="quoted"><span class="quoted">"ordermap <span class="main">(</span><span class="free">A</span><span class="main">`</span><span class="free">ℐ</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">A</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ordermap <span class="main">(</span><span class="free">A</span><span class="main">`</span><span class="free">ℐ</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">A</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"ordermap <span class="main">(</span><span class="free">B</span><span class="main">`</span><span class="free">J</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">B</span> <span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> ordermap <span class="main">(</span><span class="free">B</span><span class="main">`</span><span class="free">J</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">B</span> <span class="main">(</span>Max <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> x y mx my
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> mult_cancellation_less <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def split_def peq qeq oB<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="var">?mx</span> <span class="main">@</span> <span class="free">B</span> <span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span> <span class="var">?my</span> <span class="main">@</span> <span class="free">B</span> <span class="main">(</span>Max <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">case</span></span> 1
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="var">?mx</span><span class="main">,</span> <span class="free">A</span> <span class="var">?my</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> x y
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ord_mem_iff_lt <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> converse_ordermap_mono<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> x y mx my lenB lenlex_append1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> 2
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="var">?mx</span> <span class="main">=</span> <span class="free">A</span> <span class="var">?my</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?my</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?mx</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mx</span> <span class="main">=</span> <span class="var">?my</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="var">?my</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?mx</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> inv_into_IA<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">B</span> <span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span><span class="main">,</span> <span class="free">B</span> <span class="main">(</span>Max <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> mx my  2
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ord_mem_iff_lt <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> converse_ordermap_mono<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq irrefl_less_than<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> peq qeq f_def split_def sorted_list_of_set_Un AB<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> pqR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="var">?mx</span> <span class="main">@</span> <span class="free">B</span> <span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span> <span class="var">?my</span> <span class="main">@</span> <span class="free">B</span> <span class="main">(</span>Max <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> peq qeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="var">?mx</span><span class="main">,</span> <span class="free">A</span> <span class="var">?my</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="var">?mx</span> <span class="main">=</span> <span class="free">A</span> <span class="var">?my</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span> <span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span><span class="main">,</span> <span class="free">B</span> <span class="main">(</span>Max <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="var">?mx</span><span class="main">,</span> <span class="free">A</span> <span class="var">?my</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="var">?my</span><span class="main">,</span> <span class="free">A</span> <span class="var">?mx</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="var">?my</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?mx</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="quoted">"§"</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Max <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">J</span> <span class="var">?my</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">J</span> <span class="var">?mx</span>›</span></span> lenB lenlex_append1 omega_sum_1_less order.asym that<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="var">?mx</span> <span class="main">=</span> <span class="free">A</span> <span class="var">?my</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> False UNIV_I total_llt total_on_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"§"</span> irrefl_less_than that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">*</span> ordermap <span class="main">(</span><span class="free">A</span><span class="main">`</span><span class="free">ℐ</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">A</span> <span class="var">?mx</span><span class="main">)</span> <span class="main">+</span> ordermap <span class="main">(</span><span class="free">B</span><span class="main">`</span><span class="free">J</span> <span class="var">?mx</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">B</span> <span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>
               <span class="main">&lt;</span> <span class="free">β</span> <span class="main">*</span> ordermap <span class="main">(</span><span class="free">A</span><span class="main">`</span><span class="free">ℐ</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">A</span> <span class="var">?my</span><span class="main">)</span> <span class="main">+</span> ordermap <span class="main">(</span><span class="free">B</span><span class="main">`</span><span class="free">J</span> <span class="var">?my</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">B</span> <span class="main">(</span>Max <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">case</span></span> 1
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> add_mult_less_add_mult<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="main">(</span><span class="free">A</span><span class="main">`</span><span class="free">ℐ</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="var">?mx</span><span class="main">)</span> <span class="main">&lt;</span> ordermap <span class="main">(</span><span class="free">A</span><span class="main">`</span><span class="free">ℐ</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="var">?my</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"1"</span> <span class="quoted"><span class="quoted">‹<span class="var">?my</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?mx</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> ordermap_mono_less<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ordertype <span class="main">(</span><span class="free">A</span><span class="main">`</span><span class="free">ℐ</span><span class="main">)</span> <span class="var">?R</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> wf_Ord_ordertype <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">J</span> <span class="var">?mx</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">B</span> <span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Ord_less_TC_mem <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?mx</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">J</span> <span class="var">?mx</span>›</span></span> oB <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">J</span> <span class="var">?my</span><span class="main">)</span> <span class="var">?R</span> <span class="main">(</span><span class="free">B</span> <span class="main">(</span>Max <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Ord_less_TC_mem <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?my</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Max <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">J</span> <span class="var">?my</span>›</span></span> oB <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="var">?my</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?mx</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> 2
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?mx</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Max <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">J</span> <span class="var">?my</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">J</span> <span class="var">?mx</span>›</span></span> ordermap_mono_less
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Kirby.add_less_cancel_left TC_small image_iff inv_into_IA trans_llt wf_llt y<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">f</span> <span class="skolem">q</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?my</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?mx</span> <span class="main">∈</span> <span class="free">ℐ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Max <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">J</span> <span class="var">?my</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Max <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">J</span> <span class="var">?mx</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> peq qeq f_def split_def AB<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹The final part of 3.8, where two sequences are merged›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">merge</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat list list<span class="main">,</span>nat list list<span class="main">,</span>nat list list<span class="main">,</span>nat list list<span class="main">]</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> NullNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">merge</span> <span class="main">[]</span> <span class="main">[]</span> <span class="main">[]</span> <span class="main">[]</span>"</span></span>
      <span class="main">|</span> Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">merge</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">[]</span> <span class="main">[</span>concat <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">]</span> <span class="main">[]</span>"</span></span>
      <span class="main">|</span> App<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">as1</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">bs1</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span>
               concat <span class="free"><span class="bound"><span class="entity">as1</span></span></span> <span class="main">&lt;</span> concat <span class="free"><span class="bound"><span class="entity">bs1</span></span></span><span class="main">;</span> concat <span class="free"><span class="bound"><span class="entity">bs1</span></span></span> <span class="main">&lt;</span> concat <span class="free"><span class="bound"><span class="entity">as2</span></span></span><span class="main">;</span> <span class="free">merge</span> <span class="free"><span class="bound"><span class="entity">as2</span></span></span> <span class="free"><span class="bound"><span class="entity">bs2</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">⟧</span>
              <span class="main">⟹</span> <span class="free">merge</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">as1</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">as2</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs1</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">bs2</span></span></span><span class="main">)</span> <span class="main">(</span>concat <span class="free"><span class="bound"><span class="entity">as1</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">(</span>concat <span class="free"><span class="bound"><span class="entity">bs1</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_simps</span></span> Null1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"merge <span class="main">[]</span> <span class="free">bs</span> <span class="free">us</span> <span class="free">vs</span>"</span></span>
<span class="keyword1"><span class="command">inductive_simps</span></span> Null2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"merge <span class="free">as</span> <span class="main">[]</span> <span class="free">us</span> <span class="free">vs</span>"</span></span>

<span class="keyword1" id="Omega_Omega-merge_single"><span class="command">lemma</span></span> merge_single<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>concat <span class="free">as</span> <span class="main">&lt;</span> concat <span class="free">bs</span><span class="main">;</span> concat <span class="free">as</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> concat <span class="free">bs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span> merge <span class="free">as</span> <span class="free">bs</span> <span class="main">[</span>concat <span class="free">as</span><span class="main">]</span> <span class="main">[</span>concat <span class="free">bs</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> merge.App <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-merge_length1_nonempty"><span class="command">lemma</span></span> merge_length1_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"merge <span class="free">as</span> <span class="free">bs</span> <span class="free">us</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">us</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mem_lists_non_Nil<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-merge_length2_nonempty"><span class="command">lemma</span></span> merge_length2_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"merge <span class="free">as</span> <span class="free">bs</span> <span class="free">us</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mem_lists_non_Nil<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-merge_length1_gt_0"><span class="command">lemma</span></span> merge_length1_gt_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"merge <span class="free">as</span> <span class="free">bs</span> <span class="free">us</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">us</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction</span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-merge_length_le"><span class="command">lemma</span></span> merge_length_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"merge <span class="free">as</span> <span class="free">bs</span> <span class="free">us</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">≤</span> length <span class="free">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction</span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-merge_length_le_Suc"><span class="command">lemma</span></span> merge_length_le_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"merge <span class="free">as</span> <span class="free">bs</span> <span class="free">us</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">us</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction</span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-merge_length_less2"><span class="command">lemma</span></span> merge_length_less2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"merge <span class="free">as</span> <span class="free">bs</span> <span class="free">us</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">≤</span> length <span class="free">as</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>App <span class="skolem">as1</span> <span class="skolem">bs1</span> <span class="skolem">as2</span> <span class="skolem">bs2</span> <span class="skolem">as</span> <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_eq_plus1 Suc_leI add.commute add_mono length_greater_0_conv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-merge_preserves"><span class="command">lemma</span></span> merge_preserves<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"merge <span class="free">as</span> <span class="free">bs</span> <span class="free">us</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"concat <span class="free">as</span> <span class="main">=</span> concat <span class="free">us</span> <span class="main">∧</span> concat <span class="free">bs</span> <span class="main">=</span> concat <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction</span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-merge_interact"><span class="command">lemma</span></span> merge_interact<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"merge <span class="free">as</span> <span class="free">bs</span> <span class="free">us</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="free">as</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="free">bs</span><span class="main">)</span>"</span></span>
           <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>interact <span class="free">us</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>App <span class="skolem">as1</span> <span class="skolem">bs1</span> <span class="skolem">as2</span> <span class="skolem">bs2</span> <span class="skolem">as</span> <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concat <span class="skolem">bs1</span> <span class="main">&lt;</span> concat <span class="skolem">bs</span>"</span></span> <span class="quoted"><span class="quoted">"concat <span class="skolem">bs1</span> <span class="main">&lt;</span> concat <span class="skolem">as</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"concat <span class="skolem">bs1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> merge_preserves strict_sorted_append_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concat <span class="skolem">bs1</span> <span class="main">&lt;</span> interact <span class="skolem">as</span> <span class="skolem">bs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> App
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> concat_eq_Nil_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Un_iff <span class="quoted"><span class="quoted">‹concat <span class="skolem">bs1</span> <span class="main">&lt;</span> concat <span class="skolem">as</span>›</span></span> <span class="quoted"><span class="quoted">‹concat <span class="skolem">bs1</span> <span class="main">&lt;</span> concat <span class="skolem">bs</span>›</span></span> last_in_set list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_interact sorted_wrt_append strict_sorted_append_iff strict_sorted_interact_imp_concat strict_sorted_sorted_wrt xx<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> App <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_sorted_append_iff <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> concat_eq_Nil_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hd_append2 less_list_def xx<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Omega_Omega-acc_lengths_merge1"><span class="command">lemma</span></span> acc_lengths_merge1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"merge <span class="free">as</span> <span class="free">bs</span> <span class="free">us</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>acc_lengths <span class="free">k</span> <span class="free">us</span><span class="main">)</span> <span class="main">⊆</span> list.set <span class="main">(</span>acc_lengths <span class="free">k</span> <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>App <span class="skolem">as1</span> <span class="skolem">bs1</span> <span class="skolem">as2</span> <span class="skolem">bs2</span> <span class="skolem">as</span> <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> acc_lengths_append acc_lengths.simps strict_sorted_append_iff length_concat_acc_lengths<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_supI2 length_concat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> acc_lengths.simps length_concat_acc_lengths<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-acc_lengths_merge2"><span class="command">lemma</span></span> acc_lengths_merge2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"merge <span class="free">as</span> <span class="free">bs</span> <span class="free">us</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>acc_lengths <span class="free">k</span> <span class="free">vs</span><span class="main">)</span> <span class="main">⊆</span> list.set <span class="main">(</span>acc_lengths <span class="free">k</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>App <span class="skolem">as1</span> <span class="skolem">bs1</span> <span class="skolem">as2</span> <span class="skolem">bs2</span> <span class="skolem">as</span> <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> acc_lengths_append acc_lengths.simps strict_sorted_append_iff length_concat_acc_lengths<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_supI2 length_concat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> acc_lengths.simps length_concat_acc_lengths<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-length_hd_le_concat"><span class="command">lemma</span></span> length_hd_le_concat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>hd <span class="free">as</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span>concat <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> add.commute assms concat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> le_add2 length_append list.exhaust_sel<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-length_hd_merge2"><span class="command">lemma</span></span> length_hd_merge2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"merge <span class="free">as</span> <span class="free">bs</span> <span class="free">us</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>hd <span class="free">bs</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span>hd <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> length_hd_le_concat<span class="main">)</span>

<span class="keyword1" id="Omega_Omega-merge_less_sets_hd"><span class="command">lemma</span></span> merge_less_sets_hd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"merge <span class="free">as</span> <span class="free">bs</span> <span class="free">us</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="free">as</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>hd <span class="free">us</span><span class="main">)</span> <span class="main">≪</span> list.set <span class="main">(</span>concat <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>App <span class="skolem">as1</span> <span class="skolem">bs1</span> <span class="skolem">as2</span> <span class="skolem">bs2</span> <span class="skolem">as</span> <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>concat <span class="skolem">bs1</span><span class="main">)</span> <span class="main">≪</span> list.set <span class="main">(</span>concat <span class="skolem">bs2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> strict_sorted_imp_less_sets<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>concat <span class="skolem">as1</span><span class="main">)</span> <span class="main">≪</span> list.set <span class="main">(</span>concat <span class="skolem">bs1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> App <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> concat_append strict_sorted_append_iff strict_sorted_imp_less_sets<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>concat <span class="skolem">as1</span><span class="main">)</span> <span class="main">≪</span> list.set <span class="main">(</span>concat <span class="skolem">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> App § less_sets_trans merge_preserves
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> List.set_empty append_in_lists_conv le_zero_eq length_concat_ge length_greater_0_conv list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> * App.hyps <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_sets_UN1 less_sets_UN2 less_sets_Un2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Omega_Omega-set_takeWhile"><span class="command">lemma</span></span> set_takeWhile<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="free">as</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">)</span> <span class="free">as</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> list.set <span class="free">as</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">as</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> concat <span class="skolem">as</span>"</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="skolem">as</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> list.set <span class="skolem">as</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">x</span> <span class="main">∈</span> list.set <span class="main">(</span>concat <span class="skolem">as</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> set_concat that<span class="main">(</span>5<span class="main">)</span> that<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">a</span> <span class="main">&lt;</span> hd <span class="main">(</span>concat <span class="skolem">as</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons.prems that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> hd <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that a
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹last <span class="skolem">x</span> <span class="main">∈</span> list.set <span class="main">(</span>concat <span class="skolem">as</span><span class="main">)</span>›</span></span> dual_order.strict_trans less_list_def not_le sorted_hd_le strict_sorted_imp_sorted<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_sorted_append_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">proposition</span></span> merge_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="free">as</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="free">bs</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"hd <span class="free">as</span> <span class="main">&lt;</span> hd <span class="free">bs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">a</span> <span class="main">∈</span> list.set <span class="free">as</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> list.set <span class="free">bs</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">a</span><span class="main">&lt;</span><span class="bound">b</span> <span class="main">∨</span> <span class="bound">b</span><span class="main">&lt;</span><span class="bound">a</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">us</span> <span class="bound">vs</span><span class="main">.</span> merge <span class="free">as</span> <span class="free">bs</span> <span class="bound">us</span> <span class="bound">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">as</span> <span class="main">+</span> length <span class="free">bs</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">as</span> <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as1</span></span> <span class="skolem"><span class="skolem">as2</span></span> <span class="skolem"><span class="skolem">bs1</span></span> <span class="skolem"><span class="skolem">bs2</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"concat <span class="skolem">as1</span> <span class="main">&lt;</span> concat <span class="skolem">bs1</span>"</span></span> <span class="quoted"><span class="quoted">"concat <span class="skolem">bs1</span> <span class="main">&lt;</span> concat <span class="skolem">as2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> <span class="skolem">as1</span><span class="main">@</span><span class="skolem">as2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">=</span> <span class="skolem">bs1</span><span class="main">@</span><span class="skolem">bs2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bs2</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">as2</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd <span class="skolem">as2</span> <span class="main">&lt;</span> hd <span class="skolem">bs2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">as1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as1</span> <span class="main">≡</span> takeWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="skolem">bs</span><span class="main">)</span> <span class="skolem">as</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">as2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as2</span> <span class="main">≡</span> dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="skolem">bs</span><span class="main">)</span> <span class="skolem">as</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs1</span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="skolem">as2</span><span class="main">=</span><span class="main">[]</span> <span class="keyword1">then</span> <span class="skolem">bs</span> <span class="keyword1">else</span> takeWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="skolem">as2</span><span class="main">)</span> <span class="skolem">bs</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs2</span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="skolem">as2</span><span class="main">=</span><span class="main">[]</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="skolem">as2</span><span class="main">)</span> <span class="skolem">bs</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> as1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as1</span> <span class="main">=</span> takeWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> last <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="main">(</span>hd <span class="skolem">bs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">as</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> less.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> as1_def less_list_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> takeWhile_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> as2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as2</span> <span class="main">=</span> dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> last <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="main">(</span>hd <span class="skolem">bs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">as</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> less.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> as2_def less_list_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> dropWhile_cong<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> hd_as2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as2</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="main">¬</span> hd <span class="skolem">as2</span> <span class="main">&lt;</span> hd <span class="skolem">bs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> as2_def hd_dropWhile <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> hd_bs2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bs2</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="main">¬</span> hd <span class="skolem">bs2</span> <span class="main">&lt;</span> hd <span class="skolem">as2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bs2_def hd_dropWhile <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> as1_def less.prems takeWhile_eq_Nil_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> as2 bs1_def hd_as2 hd_in_set less.prems<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> less.prems<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> set_dropWhileD takeWhile_eq_Nil_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs2</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">as2</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd <span class="skolem">as2</span> <span class="main">&lt;</span> hd <span class="skolem">bs2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> as2_def bs2_def hd_bs2 less.prems<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_dropWhileD<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">A</span> <span class="main">≪</span> list.set <span class="skolem">B</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> list.set <span class="skolem">as1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> list.set <span class="skolem">bs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> list.set <span class="skolem">as</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> as1 set_takeWhileD<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> concat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> concat_append less.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sorted_append split_list_last strict_sorted_imp_sorted<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>hd <span class="skolem">bs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> concat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl less.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less.prems<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> strict_sorted_append_iff strict_sorted_imp_sorted<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> that
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> as1_def less.prems set_takeWhile less_list_iff_less_sets less_sets_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> UN_I dual_order.strict_trans2 hd_concat less.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> less.prems<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mem_lists_non_Nil not_le set_concat sorted_hd_le strict_sorted_imp_sorted<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> <span class="skolem">as1</span><span class="main">@</span><span class="skolem">as2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> as1_def as2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">=</span> <span class="skolem">bs1</span><span class="main">@</span><span class="skolem">bs2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bs1_def bs2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>concat <span class="skolem">as1</span><span class="main">)</span> <span class="main">≪</span> list.set <span class="main">(</span>concat <span class="skolem">bs1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> AB set_takeWhileD <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> as1_def bs1_def less_sets_UN1 less_sets_UN2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"concat <span class="skolem">as1</span> <span class="main">&lt;</span> concat <span class="skolem">bs1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less_sets_imp_list_less<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>concat <span class="skolem">bs1</span><span class="main">)</span> <span class="main">≪</span> list.set <span class="main">(</span>concat <span class="skolem">as2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as2</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bs1_def less_sets_UN1 less_sets_UN2 set_takeWhile less.prems<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> list.set <span class="skolem">as2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> list.set <span class="skolem">bs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">&lt;</span> hd <span class="skolem">as2</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">B</span> <span class="main">≪</span> list.set <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hd_as2 less.prems<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_sets_def less_list_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> as2_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> as2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UN_I <span class="quoted"><span class="quoted">‹<span class="skolem">as</span> <span class="main">=</span> <span class="skolem">as1</span> <span class="main">@</span> <span class="skolem">as2</span>›</span></span> concat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> concat_append dual_order.strict_trans2 hd_concat in_set_conv_decomp_last not_le set_concat sorted_hd_le sorted_le_last sorted_sorted_wrt sorted_wrt_append strict_sorted_imp_sorted that<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"concat <span class="skolem">bs1</span> <span class="main">&lt;</span> concat <span class="skolem">as2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bs1_def less_sets_imp_list_less<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="skolem"><span class="skolem">ds</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"merge <span class="skolem">as2</span> <span class="skolem">bs2</span> <span class="skolem">cs</span> <span class="skolem">ds</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">as2</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">bs2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span>
      <span class="keyword1"><span class="command">using</span></span> that C NullNull Null <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">as2</span> <span class="main">+</span> length <span class="skolem">bs2</span> <span class="main">&lt;</span> length <span class="skolem">as</span> <span class="main">+</span> length <span class="skolem">bs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A B<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="skolem">as2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="skolem">bs2</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">as2</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs2</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">a</span> <span class="main">∈</span> list.set <span class="skolem">as2</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> list.set <span class="skolem">bs2</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">∨</span> <span class="bound">b</span> <span class="main">&lt;</span> <span class="bound">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> B less.prems strict_sorted_append_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> C less.hyps <span class="main">[</span><span class="operator">OF</span> †<span class="main">]</span> False that <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"merge <span class="main">(</span><span class="skolem">as1</span> <span class="main">@</span> <span class="skolem">as2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">bs1</span> <span class="main">@</span> <span class="skolem">bs2</span><span class="main">)</span> <span class="main">(</span>concat <span class="skolem">as1</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">(</span>concat <span class="skolem">bs1</span> <span class="main">#</span> <span class="skolem">ds</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A merge.App <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Actual proof of lemma 3.8›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 3.8 of Jean A. Larson, ibid.›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> lemma_3_8<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">X</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> WW"</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">X</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">=</span> ω<span class="main">↑</span>ω"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="free">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span>
                   <span class="main">∃</span><span class="bound">l</span><span class="main">.</span> Form <span class="bound">l</span> <span class="bound">u</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">l</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">[</span>enum <span class="free">N</span> <span class="bound">l</span><span class="main">]</span> <span class="main">&lt;</span> inter_scheme <span class="bound">l</span> <span class="bound">u</span> <span class="main">∧</span> List.set <span class="main">(</span>inter_scheme <span class="bound">l</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?LL</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lenlex less_than"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bf</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bf</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">M</span> <span class="bound">q</span><span class="main">.</span> wfrec pair_less <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span>
                                  <span class="keyword1">let</span> <span class="bound">R</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> prev <span class="bound">j</span> <span class="bound">i</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">M</span> <span class="main">|</span> Some <span class="bound">u</span> <span class="main">⇒</span> snd <span class="main">(</span><span class="bound">f</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span>
                                  <span class="keyword1">in</span> grab <span class="bound">R</span> <span class="main">(</span><span class="bound">q</span> <span class="bound">j</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> bf_rec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="keyword1">let</span> <span class="bound">R</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> prev <span class="skolem">j</span> <span class="skolem">i</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="skolem">M</span> <span class="main">|</span> Some <span class="bound">u</span> <span class="main">⇒</span> snd <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span>
                  <span class="keyword1">in</span>  grab <span class="bound">R</span> <span class="main">(</span><span class="skolem">q</span> <span class="skolem">j</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="skolem">j</span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bf_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def wfrec bf_def cut_apply prev_pair_less <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> conj_cong <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> infinite_bf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>snd <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> infinite <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="skolem">u</span>
    <span class="keyword1"><span class="command">using</span></span> wf_pair_less
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pair <span class="skolem">j</span> <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> less.IH prev_pair_less <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bf_rec <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> bf_less_sets<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="skolem">ij</span><span class="main">)</span> <span class="main">≪</span> snd <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="skolem">ij</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="skolem">ij</span>
    <span class="keyword1"><span class="command">using</span></span> wf_pair_less
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">ij</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pair <span class="skolem">j</span> <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> less_sets_grab <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bf_rec <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="main">]</span></span> less.IH prev_pair_less that <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> bf_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="main">∧</span> snd <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="skolem">u</span>
    <span class="keyword1"><span class="command">using</span></span> wf_pair_less
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pair <span class="skolem">j</span> <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bf_rec <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="main">]</span></span> that <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> fst_grab_subset less.IH prev_pair_less snd_grab_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> card_fst_bf<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>fst <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> card <span class="main">(</span>fst <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">q</span> <span class="skolem">j</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="skolem">j</span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that bf_rec <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> bf_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">q'</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">u</span> <span class="main">≤</span> fst <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span><span class="main">≤</span><span class="bound">y</span><span class="main">;</span> <span class="bound">y</span><span class="main">≤</span>fst <span class="skolem">u</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">q'</span> <span class="bound">y</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">q</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="skolem">q'</span> <span class="skolem">u</span>
    <span class="keyword1"><span class="command">using</span></span> wf_pair_less that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pair <span class="skolem">j</span> <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> less.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bf_rec <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="main">]</span></span>  <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j'</span> <span class="skolem">i'</span>
        <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"prev <span class="skolem">j</span> <span class="skolem">i</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">j'</span><span class="main">,</span> <span class="skolem">i'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> pair_less"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pair prev_pair_less<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="skolem">j'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Pair less.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prev_Some_less <span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">;</span> <span class="bound">y</span> <span class="main">≤</span> <span class="skolem">j'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">q'</span> <span class="bound">y</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">q</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ** less.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pair_less_def Pair<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"grab <span class="main">(</span>snd <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">q</span> <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q</span> <span class="skolem">j</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> grab <span class="main">(</span>snd <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">q'</span> <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q</span> <span class="skolem">j</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> less.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ediff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ediff</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">D</span><span class="main">::</span> nat <span class="main">⇒</span> nat set<span class="main">.</span> <span class="main">λ</span><span class="bound">j</span> <span class="bound">i</span><span class="main">.</span> enum <span class="main">(</span><span class="bound">D</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> enum <span class="main">(</span><span class="bound">D</span> <span class="bound">j</span><span class="main">)</span> <span class="bound">i</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">l</span> <span class="main">(</span><span class="bound">dl</span><span class="main">,</span><span class="bound">a0</span><span class="main">::</span>nat set<span class="main">,</span><span class="bound">b0</span><span class="main">::</span>nat <span class="main">×</span> nat <span class="main">⇒</span> nat set<span class="main">,</span><span class="bound">M</span><span class="main">)</span><span class="main">.</span>
          <span class="keyword1">let</span> <span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="bound">Md</span><span class="main">)</span> <span class="main">=</span> grab <span class="main">(</span>nxt <span class="bound">M</span> <span class="main">(</span>enum <span class="free">N</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Suc <span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">l</span><span class="main">)</span> <span class="keyword1">in</span>
          <span class="keyword1">let</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">Ma</span><span class="main">)</span> <span class="main">=</span> grab <span class="bound">Md</span> <span class="main">(</span>Min <span class="bound">d</span><span class="main">)</span> <span class="keyword1">in</span>
          <span class="keyword1">let</span> <span class="bound">Gb</span> <span class="main">=</span> <span class="skolem">bf</span> <span class="bound">Ma</span> <span class="main">(</span><span class="skolem">ediff</span> <span class="main">(</span><span class="bound">dl</span><span class="main">(</span><span class="bound">l</span> <span class="main">:=</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span>
          <span class="keyword1">let</span> <span class="bound">dl'</span> <span class="main">=</span> <span class="bound">dl</span><span class="main">(</span><span class="bound">l</span> <span class="main">:=</span> <span class="bound">d</span><span class="main">)</span> <span class="keyword1">in</span>
          <span class="main">(</span><span class="bound">dl'</span><span class="main">,</span> <span class="bound">a</span><span class="main">,</span> fst <span class="main">∘</span> <span class="bound">Gb</span><span class="main">,</span> snd <span class="main">(</span><span class="bound">Gb</span><span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">l</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">DF</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DF</span> <span class="main">≡</span> rec_nat <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="main">{}</span><span class="main">,</span> <span class="main">{}</span><span class="main">,</span> <span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">{}</span><span class="main">,</span> <span class="free">N</span><span class="main">)</span> <span class="skolem">F</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> DF_simps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DF</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="main">{}</span><span class="main">,</span> <span class="main">{}</span><span class="main">,</span> <span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">{}</span><span class="main">,</span> <span class="free">N</span><span class="main">)</span>"</span></span>
                 <span class="quoted"><span class="quoted">"<span class="skolem">DF</span> <span class="main">(</span>Suc <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">F</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">DF</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">l</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> cut_apply <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

  <span class="keyword1"><span class="command">have</span></span> inf <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">dl</span> <span class="bound">al</span> <span class="bound">bl</span> <span class="bound">L</span><span class="main">.</span> <span class="skolem">DF</span> <span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="bound">dl</span><span class="main">,</span><span class="bound">al</span><span class="main">,</span><span class="bound">bl</span><span class="main">,</span><span class="bound">L</span><span class="main">)</span> <span class="main">⟶</span> infinite <span class="bound">L</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">l</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DF_simps F_def Let_def grab_eqD infinite_nxtN assms <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Ψ</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">Ψ</span> <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">dl</span><span class="main">,</span> <span class="bound">a</span><span class="main">,</span> <span class="bound">b</span> <span class="main">::</span> nat <span class="main">×</span> nat <span class="main">⇒</span> nat set<span class="main">,</span> <span class="bound">M</span><span class="main">::</span>nat set<span class="main">)</span><span class="main">.</span> <span class="main">λ</span><span class="bound">l</span><span class="main">::</span>nat<span class="main">.</span>
           <span class="bound">dl</span> <span class="bound">l</span> <span class="main">≪</span> <span class="bound">a</span> <span class="main">∧</span> finite <span class="bound">a</span> <span class="main">∧</span> <span class="bound">dl</span> <span class="bound">l</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">l</span><span class="main">.</span> card <span class="main">(</span><span class="bound">dl</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> Suc <span class="bound">j</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≪</span> <span class="main">⋃</span><span class="main">(</span>range <span class="bound">b</span><span class="main">)</span> <span class="main">∧</span> range <span class="bound">b</span> <span class="main">⊆</span> Collect finite <span class="main">∧</span>
           <span class="bound">a</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∧</span> <span class="main">⋃</span><span class="main">(</span>range <span class="bound">b</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∧</span> infinite <span class="bound">M</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">l</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">≪</span> <span class="bound">M</span> <span class="main">∧</span>
           <span class="bound">M</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Ψ_DF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ψ</span> <span class="main">(</span><span class="skolem">DF</span> <span class="main">(</span>Suc <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">l</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bf_rec F_def DF_simps Ψ_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> grab_eqD<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> grab_eqD infinite_nxtN<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_UN2 less_sets_grab card_fst_bf <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> less_sets_weaken2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Min_in card_eq_0_iff greaterThan_iff le_inf_iff less_nat_zero_code n_not_Suc_n nxt_def subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> nxt_subset snd_grab_subset bf_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">unfolding</span></span> Let_def DF_simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">l</span>"</span></span><span class="main">]</span> F_def Ψ_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bf_rec DF_simps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> grab_eqD<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> grab_eqD infinite_nxtN<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_sets_UN2 less_sets_grab card_fst_bf<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> less_sets_weaken2<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> IntE Min_in card.empty greaterThan_iff leD not_less_eq_eq nxt_def subsetD zero_less_Suc<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> bf_subset less_sets_weaken2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> nxt_subset subset_eq<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> bf_subset nxt_subset subset_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> bf_rec infinite_bf <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
       <span class="keyword1"><span class="command">using</span></span> bf_less_sets bf_rec <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bf_rec bf_subset nxt_subset subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">dk</span><span class="main">,</span><span class="bound">ak</span><span class="main">,</span><span class="bound">bk</span><span class="main">,</span><span class="bound">M</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">DF</span><span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="keyword1">in</span> <span class="bound">dk</span> <span class="bound">k</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">dk</span><span class="main">,</span><span class="bound">ak</span><span class="main">,</span><span class="bound">bk</span><span class="main">,</span><span class="bound">M</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">DF</span><span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="keyword1">in</span> <span class="bound">ak</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">dk</span><span class="main">,</span><span class="bound">ak</span><span class="main">,</span><span class="bound">bk</span><span class="main">,</span><span class="bound">M</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">DF</span><span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="keyword1">in</span> <span class="bound">bk</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">dk</span><span class="main">,</span><span class="bound">ak</span><span class="main">,</span><span class="bound">bk</span><span class="main">,</span><span class="bound">M</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">DF</span> <span class="bound">k</span> <span class="keyword1">in</span> <span class="bound">M</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> infinite_M <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="skolem">M</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def inf <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> M_Suc_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def M_def F_def DF_simps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> grab_eqD<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> infinite_nxtN local.inf<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">using</span></span> bf_subset nxt_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> Inf_M_Suc_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span><span class="skolem">M</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> Inf <span class="main">(</span><span class="skolem">M</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_Suc_subset cInf_superset_mono infinite_imp_nonempty<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> Inf_M_telescoping<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>Inf <span class="main">(</span><span class="skolem">M</span> <span class="skolem">k</span><span class="main">)</span><span class="main">..}</span> <span class="main">⊆</span> <span class="main">{</span>Inf <span class="main">(</span><span class="skolem">M</span> <span class="skolem">k'</span><span class="main">)</span><span class="main">..}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">k'</span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">-</span><span class="skolem">k'</span>"</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Inf_M_Suc_ge M_Suc_subset cInf_superset_mono infinite_imp_nonempty lift_Suc_antimono_le<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> d_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">k</span> <span class="main">=</span> fst <span class="main">(</span>grab <span class="main">(</span>nxt <span class="main">(</span><span class="skolem">M</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>enum <span class="free">N</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def M_def Let_def DF_simps F_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> finite_d <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">d</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d_ne <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.empty card_grab d_eq infinite_M infinite_nxtN nat.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">M</span><span class="main">.</span> <span class="skolem">a</span> <span class="skolem">k</span> <span class="main">=</span> fst <span class="main">(</span>grab <span class="bound">M</span> <span class="main">(</span>Min <span class="main">(</span><span class="skolem">d</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> infinite <span class="bound">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def d_def M_def Let_def DF_simps F_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv grab_eqD infinite_nxtN local.inf<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> card_a<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">a</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> Inf <span class="main">(</span><span class="skolem">d</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cInf_eq_Min card_grab d_ne finite_d<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> d_eq_dl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">dl</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">dl</span><span class="main">,</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">DF</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">l</span> <span class="skolem">dl</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">P</span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">l</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">dl</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">P</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def DF_simps F_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> card_d <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">d</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_eq infinite_nxtN<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> d_ne <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_ne <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> finite_d <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> finite_a <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">a</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">using</span></span> Ψ_DF <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ψ_def a_def d_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> da<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">k</span> <span class="main">≪</span> <span class="skolem">a</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> Ψ_DF <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ψ_def a_def d_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> ab_same<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">k</span> <span class="main">≪</span> <span class="main">⋃</span><span class="main">(</span>range<span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> Ψ_DF <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ψ_def a_def b_def M_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> snd_bf_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">r</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> snd <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">r</span> <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> ji<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> pair_less"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span> <span class="main">∈</span> IJ <span class="skolem">k</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span> <span class="skolem">r</span> <span class="skolem">k</span> <span class="skolem">j</span> <span class="skolem">i</span> <span class="skolem">j'</span> <span class="skolem">i'</span>
    <span class="keyword1"><span class="command">using</span></span> wf_pair_less ji
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">j</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">i</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pair <span class="skolem">j</span> <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"prev <span class="skolem">j</span> <span class="skolem">i</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span> <span class="skolem">i'</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="skolem">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">j'</span><span class="main">,</span> <span class="skolem">i'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> pair_less"</span></span> <span class="quoted"><span class="quoted">"prev <span class="skolem">j</span> <span class="skolem">i</span> <span class="main">=</span> Some <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less.prems pair_less_prev <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pair bf_rec snd_grab_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">r</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊆</span> snd <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">r</span> <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span> <span class="skolem">i'</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pair less.IH prev_pair_less that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">r</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">⊆</span> snd <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">r</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 2 Pair bf_rec snd_grab_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> less_bf<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">r</span> <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span><span class="main">)</span> <span class="main">≪</span> fst <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">r</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> ji<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> pair_less"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span> <span class="main">∈</span> IJ <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span> <span class="skolem">r</span> <span class="skolem">k</span> <span class="skolem">j</span> <span class="skolem">i</span> <span class="skolem">j'</span> <span class="skolem">i'</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"prev <span class="skolem">j</span> <span class="skolem">i</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span> <span class="skolem">i'</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="skolem">j''</span> <span class="skolem">i''</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">j'</span><span class="main">,</span> <span class="skolem">i'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">j''</span><span class="main">,</span><span class="skolem">i''</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> pair_less"</span></span> <span class="quoted"><span class="quoted">"prev <span class="skolem">j</span> <span class="skolem">i</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">j''</span><span class="main">,</span><span class="skolem">i''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pair_less_prev ji prod.exhaust_sel<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> bf_less_sets bf_rec infinite_bf less_sets_fst_grab <span class="quoted"><span class="quoted">‹infinite <span class="skolem">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">r</span> <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span><span class="main">)</span> <span class="main">≪</span> snd <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M</span> <span class="skolem">r</span> <span class="main">(</span><span class="skolem">j''</span><span class="main">,</span><span class="skolem">i''</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bf_less_sets snd_bf_subset less_sets_weaken2 that<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> bf_rec infinite_bf less_sets_fst_grab <span class="quoted"><span class="quoted">‹infinite <span class="skolem">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> aM<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">k</span> <span class="main">≪</span> <span class="skolem">M</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def M_def DF_simps F_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bf_subset grab_eqD infinite_nxtN less_sets_weaken2 local.inf<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">k</span> <span class="main">≪</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntE card_d card.empty d_eq da fst_grab_subset less_sets_trans less_sets_weaken2 nat.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nxt_def subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">j</span> <span class="main">≪</span> <span class="skolem">a</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I a_ne less_sets_imp_strict_mono_sets strict_mono_sets_def that<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">k'</span> <span class="main">≪</span> <span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">k'</span> <span class="skolem">j</span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_ne ab_same le_less less_sets_UN2 less_sets_trans rangeI that<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> db<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">j</span> <span class="main">≪</span> <span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">j</span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a_ne ab da less_sets_trans that<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> bMkk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">M</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> Ψ_DF <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ψ_def b_def d_def M_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">P</span></span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="skolem">k</span><span class="main">.</span> infinite <span class="bound">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">≤</span><span class="bound">j</span> <span class="main">⟶</span> <span class="bound">j</span><span class="main">≤</span><span class="skolem">k</span> <span class="main">⟶</span> <span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span><span class="skolem">bf</span> <span class="bound">P</span> <span class="main">(</span><span class="skolem">ediff</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> b_def DF_simps F_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">a'</span> <span class="skolem">d'</span> <span class="skolem">dl</span> <span class="skolem">bb</span> <span class="skolem">P</span> <span class="skolem">M'</span> <span class="skolem">M''</span>
    <span class="keyword3"><span class="command">assume</span></span> gr<span class="main">:</span> <span class="quoted"><span class="quoted">"grab <span class="skolem">M''</span> <span class="main">(</span>Min <span class="skolem">d'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">,</span> <span class="skolem">M'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"grab <span class="main">(</span>nxt <span class="skolem">P</span> <span class="main">(</span>enum <span class="free">N</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">M''</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> DF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DF</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">dl</span><span class="main">,</span> <span class="skolem">a</span><span class="main">,</span> <span class="skolem">bb</span><span class="main">,</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> deq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">then</span> <span class="skolem">d'</span> <span class="keyword1">else</span> <span class="skolem">dl</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DF d_eq_dl less_not_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> that DF gr
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def DF_simps F_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">⊆</span> <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gr in_mono nxt_subset snd_conv snd_grab_subset subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> DF <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">M'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> DF <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> finite_grab_iff gr infinite_nxtN local.inf snd_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ediff</span> <span class="main">(</span><span class="skolem">dl</span><span class="main">(</span><span class="skolem">k</span> <span class="main">:=</span> <span class="skolem">d'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">j</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">ediff</span> <span class="skolem">d</span> <span class="skolem">j</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deq that ediff_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bf</span> <span class="skolem">M'</span> <span class="main">(</span><span class="skolem">ediff</span> <span class="main">(</span><span class="skolem">dl</span><span class="main">(</span><span class="skolem">k</span> <span class="main">:=</span> <span class="skolem">d'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>
             <span class="main">=</span> <span class="skolem">bf</span> <span class="skolem">M'</span> <span class="main">(</span><span class="skolem">ediff</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> bf_cong that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">P</span></span><span class="main">⊆</span><span class="skolem">M</span> <span class="skolem">k</span><span class="main">.</span> infinite <span class="bound">P</span> <span class="main">∧</span>
                           <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">k</span>
                                        <span class="main">⟶</span> fst <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M'</span> <span class="main">(</span><span class="skolem">ediff</span> <span class="main">(</span><span class="skolem">dl</span><span class="main">(</span><span class="skolem">k</span> <span class="main">:=</span> <span class="skolem">d'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">=</span> fst <span class="main">(</span><span class="skolem">bf</span> <span class="bound">P</span> <span class="main">(</span><span class="skolem">ediff</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> card_b<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">j</span> <span class="skolem">i</span>
    <span class="comment1">―‹there's a short proof of this from the previous result but it would need <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span><span class="quoted">"<span class="skolem">i</span><span class="main">≤</span><span class="skolem">j</span>"</span><span class="antiquote">}</span></span>›</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> b_def DF_simps F_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">dl</span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">a</span> <span class="skolem">a'</span> <span class="skolem">d'</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">bb</span> <span class="skolem">M</span> <span class="skolem">M'</span> <span class="skolem">M''</span>
    <span class="keyword3"><span class="command">assume</span></span> gr<span class="main">:</span> <span class="quoted"><span class="quoted">"grab <span class="skolem">M''</span> <span class="main">(</span>Min <span class="skolem">d'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">,</span> <span class="skolem">M'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"grab <span class="main">(</span>nxt <span class="skolem">M</span> <span class="main">(</span>enum <span class="free">N</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span><span class="skolem">M''</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> DF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DF</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">dl</span><span class="main">,</span> <span class="skolem">a</span><span class="main">,</span> <span class="skolem">bb</span><span class="main">,</span> <span class="skolem">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">then</span> <span class="skolem">d'</span> <span class="keyword1">else</span> <span class="skolem">dl</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DF d_eq_dl less_not_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> that DF gr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def DF_simps F_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>fst <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M'</span> <span class="main">(</span><span class="skolem">ediff</span> <span class="main">(</span><span class="skolem">dl</span><span class="main">(</span><span class="skolem">k</span> <span class="main">:=</span> <span class="skolem">d'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">=</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> DF gr card_fst_bf grab_eqD infinite_nxtN local.inf ediff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> card_b_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">j</span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_b that finite_enumerate_step<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> b_ne <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">j</span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> card_b_pos <span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> less_imp_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> card_b_finite <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">u</span>
    <span class="keyword1"><span class="command">using</span></span> Ψ_DF <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ψ_def b_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> bM<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">M</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">M'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">≤</span><span class="bound">j</span> <span class="main">⟹</span> <span class="bound">j</span><span class="main">≤</span><span class="skolem">k</span> <span class="main">⟹</span> <span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M'</span> <span class="main">(</span><span class="skolem">ediff</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">=</span><span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> less_sets_trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ bMkk<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹infinite <span class="skolem">M'</span>›</span></span> False
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bk pair_less_def IJ_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_bf<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> b_ne that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> bMkk <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> b_InfM<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">⨅</span><span class="main">(</span><span class="skolem">M</span> <span class="skolem">k</span><span class="main">)</span><span class="main">..}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ψ_def b_def M_def DF_simps F_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">dl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat set"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">d'</span> <span class="skolem">a'</span> <span class="skolem">M''</span> <span class="skolem">M'</span> <span class="skolem">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="skolem">j'</span> <span class="skolem">i'</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> gr<span class="main">:</span> <span class="quoted"><span class="quoted">"grab <span class="skolem">M''</span> <span class="main">(</span>Min <span class="skolem">d'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">,</span> <span class="skolem">M'</span><span class="main">)</span>"</span></span>
               <span class="quoted"><span class="quoted">"grab <span class="main">(</span>nxt <span class="skolem">P</span> <span class="main">(</span>enum <span class="free">N</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">M''</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> DF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DF</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">dl</span><span class="main">,</span> <span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">,</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fst <span class="main">(</span><span class="skolem">bf</span> <span class="skolem">M'</span> <span class="main">(</span><span class="skolem">ediff</span> <span class="main">(</span><span class="skolem">dl</span><span class="main">(</span><span class="skolem">k</span> <span class="main">:=</span> <span class="skolem">d'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span> <span class="skolem">i'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> DF local.inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">⊆</span> <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> gr grab_eqD infinite_nxtN nxt_subset order.trans<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> bf_subset <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="skolem">P</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">x</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Inf_nat_def x le_less_linear not_less_Least <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> b_Inf_M_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">≪</span> <span class="main">{</span>Inf<span class="main">(</span><span class="skolem">M</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">j</span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> bMkk <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_nat_def1 bM finite.emptyI infinite_M less_setsD less_sets_singleton2<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> bb_same<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> pair_less"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span> <span class="main">∈</span> IJ <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">j</span> <span class="skolem">i</span> <span class="skolem">j'</span> <span class="skolem">i'</span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">unfolding</span></span> b_def DF_simps F_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_bf grab_eqD infinite_nxtN local.inf <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k'</span> <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="skolem">j'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j'</span><span class="main">≤</span><span class="skolem">k'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span><span class="main">&lt;</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">i'</span> <span class="skolem">j</span> <span class="skolem">j'</span> <span class="skolem">k'</span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> atLeast_less_sets<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k'</span> <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span> <span class="skolem">i'</span><span class="main">)</span> <span class="main">≪</span> <span class="main">{</span>Inf<span class="main">(</span><span class="skolem">M</span> <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc_lessD b_Inf_M_Suc nat_less_le j <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">⨅</span><span class="main">(</span><span class="skolem">M</span> <span class="skolem">k</span><span class="main">)</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ b_InfM<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>  <span class="main">⊆</span> <span class="main">{</span>Inf<span class="main">(</span><span class="skolem">M</span> <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span><span class="main">)</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Inf_M_telescoping k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span>Inf<span class="main">(</span><span class="skolem">M</span> <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span><span class="main">)</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> M_subset_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="skolem">k</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Ψ_DF <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k'</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def Let_def Ψ_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def DF_simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a_subset_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">k</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> Ψ_DF <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def Ψ_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split prod.split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> d_subset_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">k</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> M_subset_N <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> d_eq fst_grab_subset nxt_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> b_subset_N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">j</span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> Ψ_DF <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> b_def Ψ_def<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">𝒦</span></span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat<span class="main">,</span>nat<span class="main">]</span> <span class="main">⇒</span> nat set set"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒦</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">j0</span> <span class="bound">j</span><span class="main">.</span> nsets <span class="main">{</span><span class="bound">j0</span><span class="main">&lt;..}</span> <span class="bound">j</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> 𝒦_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">∈</span> <span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="main">⟹</span> finite <span class="skolem">K</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">K</span> <span class="skolem">j0</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 𝒦_def nsets_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 𝒦_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">∈</span> <span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="main">⟹</span> card <span class="skolem">K</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">K</span> <span class="skolem">j0</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 𝒦_def nsets_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 𝒦_enum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">&lt;</span> enum <span class="skolem">K</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">∈</span> <span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> card <span class="skolem">K</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">K</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒦_def nsets_def finite_enumerate_in_set subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 𝒦_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒦</span> <span class="skolem">k</span> <span class="main">0</span> <span class="main">=</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒦_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> 𝒦_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> USigma <span class="main">(</span><span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">K</span><span class="main">.</span> <span class="main">{</span>Max <span class="main">(</span>insert <span class="skolem">j0</span> <span class="bound">K</span><span class="main">)</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">j0</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">⊆</span> USigma <span class="main">(</span><span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">K</span><span class="main">.</span> <span class="main">{</span>Max <span class="main">(</span>insert <span class="skolem">j0</span> <span class="bound">K</span><span class="main">)</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> 𝒦_def nsets_def USigma_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">K</span>
      <span class="keyword3"><span class="command">assume</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">j0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">K</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">K</span> <span class="main">=</span> Suc <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>insert <span class="skolem">j0</span> <span class="main">(</span><span class="skolem">K</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">K</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">=</span> insert <span class="skolem">i</span> <span class="main">(</span><span class="skolem">K</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">K</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff Max.coboundedI Max_in card_0_eq insert_Diff insert_iff le_neq_implies_less nat.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">L</span></span><span class="main">⊆</span><span class="main">{</span><span class="skolem">j0</span><span class="main">&lt;..}</span><span class="main">.</span> finite <span class="bound">L</span> <span class="main">∧</span> card <span class="bound">L</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span>Max <span class="main">(</span>insert <span class="skolem">j0</span> <span class="bound">L</span><span class="main">)</span><span class="main">&lt;..}</span><span class="main">.</span> <span class="skolem">K</span> <span class="main">=</span> insert <span class="bound">i</span> <span class="bound">L</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> K
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Max_in card_Diff_singleton_if card_gt_0_iff diff_Suc_1 finite_Diff greaterThan_iff insert_subset zero_less_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">⊆</span> <span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  𝒦_def nsets_def USigma_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">BB</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">BB</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">j0</span> <span class="bound">j</span> <span class="bound">K</span><span class="main">.</span> list_of <span class="main">(</span><span class="skolem">a</span> <span class="bound">j0</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">&lt;</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="bound">K</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="bound">j0</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">XX</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">XX</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">BB</span> <span class="bound">j</span> <span class="bound">j</span> <span class="main">`</span> <span class="skolem">𝒦</span> <span class="bound">j</span> <span class="bound">j</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> less_list_of<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">BB</span> <span class="skolem">j</span> <span class="skolem">i</span> <span class="skolem">K</span> <span class="main">&lt;</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">∈</span> <span class="skolem">𝒦</span> <span class="skolem">j</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="skolem">K</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">i</span> <span class="skolem">K</span> <span class="skolem">l</span>
    <span class="keyword1"><span class="command">unfolding</span></span> BB_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> less_sets_imp_sorted_list_of_set<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> card <span class="skolem">K</span> <span class="main">⟹</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">b</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span> card <span class="skolem">K</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 𝒦_card 𝒦_enum 𝒦_finite bb finite_enumerate_in_set nat_less_le less_le_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">i</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">b</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> 𝒦_def nsets_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_sets_Un1 less_sets_UN1 ab finite_enumerate_in_set subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> BB_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">BB</span> <span class="skolem">j0</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="skolem">K</span> <span class="main">=</span> usplit <span class="main">(</span><span class="main">λ</span><span class="bound">L</span> <span class="bound">k</span><span class="main">.</span> <span class="skolem">BB</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="bound">L</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="bound">k</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">K</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">∈</span> <span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span>
    <span class="comment1">―‹towards the ordertype proof›</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> Kj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">j0</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">K</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cardK<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">K</span> <span class="main">=</span> Suc <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒦_def nsets_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> KMK<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">K</span><span class="main">}</span> <span class="main">∈</span> <span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 𝒦_Suc USigma_iff 𝒦_finite less_sets_def usplit_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">&lt;</span> Max <span class="skolem">K</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Kj Max_in cardK card_gt_0_iff greaterThan_iff subsetD zero_less_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> MaxK<span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="skolem">K</span> <span class="main">=</span> enum <span class="skolem">K</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Max_eqI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"enum <span class="skolem">K</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">K</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cardK finite_enumerate_in_set<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> enum <span class="skolem">K</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="skolem">K</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">using</span></span> that K
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">K</span>›</span></span> cardK enum_obtain_index_finite finite_enumerate_mono leI less_Suc_eq less_asym<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ene<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span> <span class="main">⟹</span> enum <span class="main">(</span><span class="skolem">K</span> <span class="main">-</span> <span class="main">{</span>enum <span class="skolem">K</span> <span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> enum <span class="skolem">K</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> finite_enumerate_Diff_singleton <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">K</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cardK<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">BB</span> <span class="skolem">j0</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="skolem">K</span> <span class="main">=</span> list_of <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="skolem">j0</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">&lt;</span><span class="skolem">j</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BB_def lessThan_Suc Un_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> list_of <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="skolem">j0</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">j</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sorted_list_of_set_Un<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bb<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> j that <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">≤</span> enum <span class="skolem">K</span> <span class="skolem">i</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that K <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 𝒦_enum cardK less_SucI less_imp_le_nat<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"enum <span class="skolem">K</span> <span class="skolem">i</span> <span class="main">&lt;</span> enum <span class="skolem">K</span> <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cardK finite_enumerate_mono that<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">j0</span> <span class="main">≪</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> MaxK <span class="quoted"><span class="quoted">‹<span class="skolem">j0</span> <span class="main">&lt;</span> Max <span class="skolem">K</span>›</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">j0</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">&lt;</span><span class="skolem">j</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_sets_Un1 less_sets_UN1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_UnI<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">BB</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="main">(</span><span class="skolem">K</span> <span class="main">-</span> <span class="main">{</span>Max <span class="skolem">K</span><span class="main">}</span><span class="main">)</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>Max <span class="skolem">K</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BB_def MaxK ene<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> usplit <span class="main">(</span><span class="main">λ</span><span class="bound">L</span> <span class="bound">k</span><span class="main">.</span> <span class="skolem">BB</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="bound">L</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="bound">k</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">K</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usplit_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> enum_d_0<span class="main">:</span> <span class="quoted"><span class="quoted">"enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> Inf <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">using</span></span> enum_0_eq_Inf_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> Inf_b_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">(</span><span class="skolem">b</span> <span class="skolem">k'</span> <span class="main">(</span><span class="skolem">j'</span><span class="main">,</span><span class="skolem">i'</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">⨅</span><span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="skolem">j'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j'</span><span class="main">≤</span><span class="skolem">k'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span><span class="main">&lt;</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">i'</span> <span class="skolem">j</span> <span class="skolem">j'</span> <span class="skolem">k'</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> bb <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i'</span></span> <span class="quoted"><span class="skolem">j'</span></span> <span class="quoted"><span class="skolem">k'</span></span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> that b_ne <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i'</span></span> <span class="quoted"><span class="skolem">j'</span></span> <span class="quoted"><span class="skolem">k'</span></span><span class="main">]</span> b_ne <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_sets_def Inf_nat_def1<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> b_ge_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">k</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">,</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False Inf_b_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> False Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> b_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">k</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≥</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">j</span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> k
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&gt;</span> <span class="skolem">i</span>›</span></span> Suc True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Inf_b_less<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.IH True <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Suc <span class="main">(</span><span class="main">⨅</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_b_less <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">=</span> Suc <span class="skolem">k</span>›</span></span> b_ge_k diff_Suc_1 leD le_refl lessI zero_less_Suc<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> hd_b<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">j</span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hd_list_of cInf_eq_Min<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> b_disjoint_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">i'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">j0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">K</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">K</span> <span class="main">≥</span> <span class="skolem">j0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">i'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">i'</span> <span class="skolem">j</span> <span class="skolem">j0</span> <span class="skolem">K</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bb less_sets_imp_disjnt <span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> disjnt_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">≤</span> enum <span class="skolem">K</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> K finite_enumerate_in_set greaterThan_iff less_imp_le_nat less_le_trans subsetD<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"enum <span class="skolem">K</span> <span class="skolem">i</span> <span class="main">&lt;</span> enum <span class="skolem">K</span> <span class="skolem">i'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> K <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> b_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">i'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">j0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">K</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">K</span> <span class="main">≥</span> <span class="skolem">j0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">i'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">i'</span> <span class="skolem">j</span> <span class="skolem">j0</span> <span class="skolem">K</span>
    <span class="keyword1"><span class="command">using</span></span> that b_disjoint_less inf_commute neq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">have</span></span> otω<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="bound">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span>Max <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span><span class="main">&lt;..}</span><span class="main">)</span> <span class="var">?LL</span> <span class="main">=</span> ω"</span></span>
             <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">if</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">∈</span> <span class="skolem">𝒦</span> <span class="skolem">j</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">i</span> <span class="skolem">K</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> Sucj<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Max <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 𝒦_finite that<span class="main">(</span>1<span class="main">)</span> le_Suc_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?N</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>Inf<span class="main">(</span><span class="skolem">b</span> <span class="bound">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">|</span> <span class="bound">k</span><span class="main">.</span> Max <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> infN<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="var">?N</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_nat_iff_unbounded_le<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">m</span><span class="main">.</span> <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">b</span> <span class="bound">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> Max <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b_ge <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&gt;</span> <span class="skolem">i</span>›</span></span> Sucj
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> diff_Suc_1 le_SucI le_trans less_Suc_eq_le nat_le_linear zero_less_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">⟷</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">K</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒦_finite<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> ordertype <span class="var">?N</span> less_than"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ordertype_eqI strip<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k'</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k'</span>"</span></span>  <span class="quoted"><span class="quoted">"hd <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k'</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">k'</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_b_less <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> hd_b nat_less_le not_le that<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k'</span> <span class="bound">j'</span> <span class="bound">i'</span><span class="main">.</span> hd <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">b</span> <span class="bound">k'</span> <span class="main">(</span><span class="bound">j'</span><span class="main">,</span> <span class="bound">i'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i'</span> <span class="main">&lt;</span> <span class="bound">j'</span> <span class="main">∧</span> <span class="bound">j'</span> <span class="main">≤</span> <span class="bound">k'</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> hd_b less_imp_le_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k'</span><span class="main">.</span> hd <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">b</span> <span class="bound">k'</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="bound">k'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">K</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">k'</span><span class="main">)</span>"</span></span>
         <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">K</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">using</span></span> that K hd_b less_imp_le_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> hd <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="bound">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span>Max <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span><span class="main">&lt;..}</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">K</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">using</span></span> that K <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hd_b image_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw hd <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="bound">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span>Max <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span><span class="main">&lt;..}</span><span class="main">)</span> <span class="main">{</span><span class="main">⨅</span> <span class="main">(</span><span class="skolem">b</span> <span class="bound">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> Max <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">k</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def inj_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ms</span> <span class="skolem">ns</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="bound">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span>Max <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span><span class="main">&lt;..}</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="bound">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span>Max <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span><span class="main">&lt;..}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        ms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span> <span class="main">=</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span> <span class="main">=</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k'</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lt_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">K</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lt_k'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">K</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="skolem">k'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒦_finite<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> len_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns</span> <span class="main">=</span> length <span class="skolem">ms</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_b<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b_ne <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k'</span>›</span></span> ns <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">ms</span><span class="main">,</span> hd <span class="skolem">ns</span><span class="main">)</span> <span class="main">∈</span> less_than <span class="main">⟷</span> <span class="main">(</span><span class="skolem">ms</span><span class="main">,</span> <span class="skolem">ns</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?LL</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">ms</span><span class="main">,</span> hd <span class="skolem">ns</span><span class="main">)</span> <span class="main">∈</span> less_than"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ms</span><span class="main">,</span> <span class="skolem">ns</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?LL</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that nz
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lenlex_def 𝒦_finite card_b <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hd_lex<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ms</span><span class="main">,</span> <span class="skolem">ns</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?LL</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>list_of <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k'</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?LL</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> less_asym ms ns omega_sum_1_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">ms</span><span class="main">,</span> hd <span class="skolem">ns</span><span class="main">)</span> <span class="main">∈</span> less_than"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k'</span>›</span></span> Inf_b_less <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span> ms ns
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_lenlex_iff § len_eq b_ne card_b_finite diff_Suc_1 hd_Cons_tl hd_b length_Cons less_or_eq_imp_le less_than_iff linorder_neqE_nat sorted_list_of_set_eq_Nil_iff that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ω"</span></span>
      <span class="keyword1"><span class="command">using</span></span> infN ordertype_nat_ω <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> otωj<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">BB</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="main">`</span> <span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span><span class="main">)</span> <span class="var">?LL</span> <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">j0</span>
    <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> XX_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ih<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">BB</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="main">`</span> <span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span><span class="main">)</span> <span class="var">?LL</span> <span class="main">=</span> ω <span class="main">↑</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems Suc_leD<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> inj_BB<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="skolem">BB</span> <span class="skolem">j0</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="main">[</span><span class="main">{</span><span class="skolem">j0</span><span class="main">&lt;..}</span>]<span class="hidden">⇗</span><sup><span class="skolem">j</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def BB_def nsets_def subset_iff sorted_list_of_set_Un less_sets_UN2<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span>
      <span class="keyword3"><span class="command">assume</span></span> X <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">⟶</span> <span class="skolem">j0</span> <span class="main">&lt;</span> <span class="bound">t</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> Y <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="skolem">j0</span> <span class="main">&lt;</span> <span class="bound">t</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> jeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> card <span class="skolem">X</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">Y</span> <span class="main">=</span> card <span class="skolem">X</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"list_of <span class="main">(</span><span class="skolem">a</span> <span class="skolem">j0</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">&lt;</span>card <span class="skolem">X</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">=</span> list_of <span class="main">(</span><span class="skolem">a</span> <span class="skolem">j0</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">&lt;</span>card <span class="skolem">X</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> enumX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">n</span> <span class="main">&lt;</span> card <span class="skolem">X</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">j0</span> <span class="main">≤</span> enum <span class="skolem">X</span> <span class="bound">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> X <span class="quoted"><span class="quoted">‹finite <span class="skolem">X</span>›</span></span> finite_enumerate_in_set less_imp_le_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> enumY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">n</span> <span class="main">&lt;</span> card <span class="skolem">X</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">j0</span> <span class="main">≤</span> enum <span class="skolem">Y</span> <span class="bound">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y <span class="quoted"><span class="quoted">‹card <span class="skolem">Y</span> <span class="main">=</span> card <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y</span>›</span></span> finite_enumerate_in_set less_imp_le_nat<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> smX<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="main">{..&lt;</span>card <span class="skolem">X</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> smY<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_sets <span class="main">{..&lt;</span>card <span class="skolem">X</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="quoted"><span class="quoted">‹card <span class="skolem">Y</span> <span class="main">=</span> card <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y</span>›</span></span> bb enumX enumY jeq
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_mono_sets_def<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> len_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ms</span> <span class="main">=</span> length <span class="skolem">ns</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ms</span><span class="main">,</span> <span class="skolem">ns</span><span class="main">)</span> <span class="main">∈</span> list.set <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>list_of <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>
                                     <span class="main">(</span>map <span class="main">(</span>list_of <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> card <span class="skolem">X</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ms</span> <span class="skolem">ns</span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_b enumX enumY<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span>map <span class="main">(</span>list_of <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{..&lt;</span>card <span class="skolem">X</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>
          <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span>list_of <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{..&lt;</span>card <span class="skolem">X</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_list_of_set_Un less_sets_UN2 sorted_list_of_set_UN_lessThan ab enumX enumY smX smY<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> map_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>list_of <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{..&lt;</span>card <span class="skolem">X</span><span class="main">}</span><span class="main">)</span>
                       <span class="main">=</span> map <span class="main">(</span>list_of <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{..&lt;</span>card <span class="skolem">X</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> concat_injective<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> len_eq <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enum <span class="skolem">X</span> <span class="skolem">i</span> <span class="main">=</span> enum <span class="skolem">Y</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> card <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">X</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Inf <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> iffD1 <span class="main">[</span><span class="operator">OF</span> map_eq_conv<span class="main">,</span> <span class="operator">OF</span> map_eq<span class="main">]</span> Suc.prems that
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> card_b_finite comp_apply finite_lessThan lessThan_iff set_sorted_list_of_set<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">X</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">X</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"Inf <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Inf_nat_def1 Suc.prems b_ne enumX enumY jeq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_b_less enumX enumY leI nat_less_le that<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">Y</span> <span class="main">=</span> card <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y</span>›</span></span> finite_enum_ext<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> BB_Suc'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">BB</span> <span class="skolem">j0</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">=</span> usplit <span class="main">(</span><span class="main">λ</span><span class="bound">L</span> <span class="bound">k</span><span class="main">.</span> <span class="skolem">BB</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="bound">L</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="bound">k</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> USigma <span class="main">(</span><span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">K</span><span class="main">.</span> <span class="main">{</span>Max <span class="main">(</span>insert <span class="skolem">j0</span> <span class="bound">K</span><span class="main">)</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
      <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> USigma_iff 𝒦_finite less_sets_def usplit_def 𝒦_Suc BB_Suc <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">BB</span> <span class="skolem">j0</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="var">?LL</span>
        <span class="main">=</span> ordertype
           <span class="main">(</span>usplit <span class="main">(</span><span class="main">λ</span><span class="bound">L</span> <span class="bound">k</span><span class="main">.</span> <span class="skolem">BB</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="bound">L</span> <span class="main">@</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="bound">k</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> USigma <span class="main">(</span><span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">K</span><span class="main">.</span> <span class="main">{</span>Max <span class="main">(</span>insert <span class="skolem">j0</span> <span class="bound">K</span><span class="main">)</span><span class="main">&lt;..}</span><span class="main">)</span><span class="main">)</span> <span class="var">?LL</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BB_Suc' 𝒦_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ω <span class="main">*</span> ordertype <span class="main">(</span><span class="skolem">BB</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="main">`</span> <span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span><span class="main">)</span> <span class="var">?LL</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_append_image_IJ<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">L</span> <span class="skolem">k</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span>Max <span class="main">(</span>insert <span class="skolem">j0</span> <span class="skolem">L</span><span class="main">)</span><span class="main">&lt;..}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">L</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 𝒦_finite<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">BB</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">L</span> <span class="main">&lt;</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">∈</span> <span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>›</span></span> 𝒦_finite less_list_of<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="skolem">BB</span> <span class="skolem">j0</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 𝒦_def inj_BB<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">L</span>
      <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">≪</span> <span class="main">{</span>Max <span class="main">(</span>insert <span class="skolem">j0</span> <span class="skolem">L</span><span class="main">)</span><span class="main">&lt;..}</span> <span class="main">∧</span> finite <span class="skolem">L</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 𝒦_finite atLeast_Suc_greaterThan finite_insert less_sets_Suc_Max less_sets_weaken1 subset_insertI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="bound">i</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span>Max <span class="main">(</span>insert <span class="skolem">j0</span> <span class="skolem">L</span><span class="main">)</span><span class="main">&lt;..}</span><span class="main">)</span> <span class="var">?LL</span> <span class="main">=</span> ω"</span></span>
        <span class="keyword1"><span class="command">using</span></span> L Suc.prems Suc_le_lessD otω <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒦_finite card_b<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ω <span class="main">↑</span> ord_of_nat <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ih One_nat_def Ord_ω Ord_ord_of_nat oexp_1_right oexp_add one_V_def ord_of_nat.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ord_of_nat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ord_of_nat_add plus_1_eq_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">seqs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seqs</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">j0</span> <span class="bound">j</span> <span class="bound">K</span><span class="main">.</span> list_of <span class="main">(</span><span class="skolem">a</span> <span class="bound">j0</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>map <span class="main">(</span>list_of <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="bound">K</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="bound">j0</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{..&lt;</span><span class="bound">j</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> length_seqs <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqs_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> BB_eq_concat_seqs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">BB</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> seqs_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">seqs</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">∈</span> <span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">K</span> <span class="skolem">j</span> <span class="skolem">j0</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> j0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> card <span class="skolem">K</span> <span class="main">⟹</span> <span class="skolem">j0</span> <span class="main">≤</span> enum <span class="skolem">K</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> le_j0<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">K</span> <span class="main">≤</span> <span class="skolem">j0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_enumerate_in_set that <span class="keyword1"><span class="command">unfolding</span></span> 𝒦_def nsets_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">BB</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> BB_def 𝒦_def nsets_def seqs_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> j0 ab bb less_sets_UN2 sorted_list_of_set_Un
          strict_mono_sets_def sorted_list_of_set_UN_lessThan<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> card <span class="skolem">K</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> j0 le_j0 less_le_trans that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">K</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> K 𝒦_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seqs</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> seqs_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> card_b_finite sorted_list_of_set_eq_Nil_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> BB_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cs</span><span class="main">.</span> <span class="skolem">BB</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span> <span class="main">=</span> concat <span class="bound">cs</span> <span class="main">∧</span> <span class="bound">cs</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">∈</span> <span class="skolem">𝒦</span> <span class="skolem">j0</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">K</span> <span class="skolem">j</span> <span class="skolem">j0</span>
    <span class="keyword1"><span class="command">using</span></span> BB_eq_concat_seqs seqs_ne K that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> a_subset_M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">k</span> <span class="main">⊆</span> <span class="skolem">M</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a_def M_def DF_simps F_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> fst_conv fst_grab_subset nxt_subset snd_conv snd_grab_subset subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ba_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">a</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a_subset_M bM less_sets_weaken2 nat_less_le that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ba<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">a</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span> <span class="skolem">r</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_lessI a_ne aa ba_Suc less_sets_trans that<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> disjnt_ba<span class="main">:</span> <span class="quoted"><span class="quoted">"disjnt <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span> <span class="skolem">r</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ba less_sets_imp_disjnt that<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">r</span> <span class="main">≪</span> <span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False a_ne aa ab_same less_linear less_sets_UN2 less_sets_trans rangeI<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> disjnt_sym less_sets_imp_disjnt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> bb_disjnt<span class="main">:</span> <span class="quoted"><span class="quoted">"disjnt <span class="main">(</span><span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">q</span> <span class="skolem">r</span> <span class="skolem">k</span> <span class="skolem">l</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="skolem">l</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pair_less_def IJ_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> bb_same less_sets_imp_disjnt<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bb less_sets_imp_disjnt disjnt_sym nat_neq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> sum_card_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">j</span><span class="main">.</span> card <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j0</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">-</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j0</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">j0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">K</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">K</span> <span class="main">≥</span> <span class="skolem">j0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> dis<span class="main">:</span> <span class="quoted"><span class="quoted">"disjnt <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">j</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b_disjoint<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"disjnt <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Suc.prems <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> b_disjoint_less disjnt_def disjnt_sym less_Suc_eq that<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> j0_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">&lt;</span> enum <span class="skolem">K</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Suc.prems Suc_le_lessD finite_enumerate_in_set greaterThan_iff less_le_trans subsetD K<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>Suc <span class="skolem">j</span><span class="main">.</span> card <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">=</span> card <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">j</span><span class="main">.</span> card <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lessThan_Suc card_Un_disjnt <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ dis<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j0</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">-</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j0</span><span class="main">)</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.IH <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat_diff_split<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j0</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j0</span><span class="main">)</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> j0_less
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_b <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat_diff_split<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems card_d finite_d finite_enumerate_step le_imp_less_Suc less_asym<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> card_UN_b<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">j</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j0</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">-</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j0</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">j0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">K</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">K</span> <span class="main">≥</span> <span class="skolem">j0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_UN_disjoint sum_card_b b_disjoint<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> len_BB<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">BB</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span> <span class="main">=</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">∈</span> <span class="skolem">𝒦</span> <span class="skolem">j</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">K</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> dis_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">⟹</span> disjnt <span class="main">(</span><span class="skolem">a</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> K 𝒦_card 𝒦_enum ab less_sets_imp_disjnt nat_less_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">unfolding</span></span> BB_def 𝒦_def nsets_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_UN_b card_Un_disjnt dis_ab card_a cInf_le_finite finite_enumerate_in_set enum_0_eq_Inf_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">k</span> <span class="main">≪</span> <span class="skolem">d</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aM a_ne d_eq da less_sets_fst_grab less_sets_trans less_sets_weaken2 nxt_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> dd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">k'</span> <span class="main">≪</span> <span class="skolem">d</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k'</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I d_ne less_sets_imp_strict_mono_sets strict_mono_sets_def that<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">XX</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> WW"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> XX_def BB_def WW_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">XX</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?LL</span><span class="main">)</span> <span class="main">=</span> ω <span class="main">↑</span> ω"</span></span>
      <span class="keyword1"><span class="command">using</span></span> otωj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> XX_def ordertype_ωω<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span>
    <span class="keyword3"><span class="command">assume</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> <span class="main">[</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">XX</span><span class="main">)</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ueq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> len_xy<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">≤</span> length <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lenlex_nsets_2_eq lenlex_length<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> Form <span class="bound">l</span> <span class="skolem">U</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> <span class="bound">l</span> <span class="main">⟶</span> <span class="main">[</span>enum <span class="free">N</span> <span class="bound">l</span><span class="main">]</span> <span class="main">&lt;</span> inter_scheme <span class="bound">l</span> <span class="skolem">U</span> <span class="main">∧</span> list.set <span class="main">(</span>inter_scheme <span class="bound">l</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">=</span> length <span class="skolem">y</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Form.intros<span class="main">(</span>1<span class="main">)</span> U Ueq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">&lt;</span> length <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> len_xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">K</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">∈</span> <span class="skolem">𝒦</span> <span class="skolem">j</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">BB</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">BB</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span> <span class="main">≠</span> <span class="skolem">BB</span> <span class="skolem">r</span> <span class="skolem">r</span> <span class="skolem">L</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> <span class="skolem">𝒦</span> <span class="skolem">r</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">BB</span> <span class="skolem">r</span> <span class="skolem">r</span> <span class="skolem">L</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> U <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ueq XX_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">=</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">y</span> <span class="main">=</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> len_BB<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xy dd
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_d finite_enumerate_in_set finite_d lessI less_asym less_setsD linorder_neqE_nat<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> aj_ar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">j</span> <span class="main">≪</span> <span class="skolem">a</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> aa <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> Ksub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">j</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">K</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">K</span> <span class="main">≥</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒦_def nsets_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> Lsub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">r</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">L</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">L</span> <span class="main">≥</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒦_def nsets_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> enumK<span class="main">:</span> <span class="quoted"><span class="quoted">"enum <span class="skolem">K</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">using</span></span> K 𝒦_card 𝒦_enum that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> enumL<span class="main">:</span> <span class="quoted"><span class="quoted">"enum <span class="skolem">L</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">using</span></span> L 𝒦_card 𝒦_enum that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>acc_lengths <span class="skolem">w</span> <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(+)</span> <span class="skolem">w</span> <span class="main">`</span> <span class="skolem">d</span> <span class="skolem">j0</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">j0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">K</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">K</span> <span class="main">≥</span> <span class="skolem">j0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span> <span class="skolem">w</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqs_def acc_lengths.simps Inf_nat_def1 card_a<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?db</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j0</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">j</span><span class="main">.</span> card <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">&lt;</span> enum <span class="skolem">K</span> <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Suc.prems Suc_le_lessD finite_enumerate_in_set greaterThan_iff le_trans subsetD K<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?db</span> <span class="main">=</span> enum <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j0</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc.prems
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_card_b card_b that enum_d_0 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat_diff_split<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cInf_le_finite finite_enumerate_in_set leD<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?db</span> <span class="main">∈</span> <span class="skolem">d</span> <span class="skolem">j0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc.prems finite_enumerate_in_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_enumerate_in_set<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>acc_lengths <span class="skolem">w</span> <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(+)</span> <span class="skolem">w</span> <span class="main">`</span> <span class="skolem">d</span> <span class="skolem">j0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc Suc_leD<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>acc_lengths <span class="main">(</span><span class="skolem">w</span> <span class="main">+</span> <span class="main">⨅</span> <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j0</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">(</span>map <span class="main">(</span>list_of <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j0</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_of <span class="main">{..&lt;</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">⊆</span> <span class="main">(+)</span> <span class="skolem">w</span> <span class="main">`</span> <span class="skolem">d</span> <span class="skolem">j0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqs_def acc_lengths.simps card_a subset_insertI<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqs_def acc_lengths.simps acc_lengths_append image_iff Inf_nat_def1
                        sum_sorted_list_of_set_map card_a<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> acc_lengths_subset_d<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">d</span> <span class="skolem">j0</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">j0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">K</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">K</span> <span class="main">≥</span> <span class="skolem">j0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j0</span> <span class="skolem">j</span> <span class="skolem">K</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_add_0 that<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xeq yeq BB_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> disjnt_xy<span class="main">:</span> <span class="quoted"><span class="quoted">"disjnt <span class="main">(</span>list.set <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>list.set <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"disjnt <span class="main">(</span><span class="skolem">a</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> aa less_sets_imp_disjnt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"disjnt <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjnt_ba enumK less_imp_le_nat that<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"disjnt <span class="main">(</span><span class="skolem">a</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">L</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> disjnt_ba disjnt_sym enumL less_imp_le_nat that<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"disjnt <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">L</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">q</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> bb_disjnt enumK enumL less_imp_le that<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xeq yeq BB_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">us</span> <span class="bound">vs</span><span class="main">.</span> merge <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span> <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">r</span> <span class="skolem">r</span> <span class="skolem">L</span><span class="main">)</span> <span class="bound">us</span> <span class="bound">vs</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> merge_exists<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> BB_eq_concat_seqs K <span class="quoted"><span class="quoted">‹strict_sorted <span class="skolem">x</span>›</span></span> xeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">r</span> <span class="skolem">r</span> <span class="skolem">L</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> BB_eq_concat_seqs L <span class="quoted"><span class="quoted">‹strict_sorted <span class="skolem">y</span>›</span></span> yeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seqs</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seqs</span> <span class="skolem">r</span> <span class="skolem">r</span> <span class="skolem">L</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> K L seqs_ne<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">r</span> <span class="skolem">r</span> <span class="skolem">L</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aj_ar less_sets_imp_list_less seqs_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seqs</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seqs</span> <span class="skolem">r</span> <span class="skolem">r</span> <span class="skolem">L</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> seqs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">have</span></span> less_bb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">L</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">L</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span>
          <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">p</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"enum <span class="skolem">K</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"enum <span class="skolem">L</span> <span class="skolem">p</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> less
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bb enumK less_imp_le_nat <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> equal
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> enumK <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> IJ_iff pair_less_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> bb_same<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> greater
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> bb enumL less_imp_le_nat neg <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">&lt;</span> <span class="skolem">v</span> <span class="main">∨</span> <span class="skolem">v</span> <span class="main">&lt;</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> list.set <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> list.set <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">r</span> <span class="skolem">r</span> <span class="skolem">L</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
          <span class="keyword1"><span class="command">using</span></span> that enumK enumL
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> seqs_def aj_ar <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> less_bb less_sets_imp_list_less<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> ab ba less_imp_le_nat not_le<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uus</span></span> <span class="skolem"><span class="skolem">vvs</span></span> <span class="keyword2"><span class="keyword">where</span></span> merge<span class="main">:</span> <span class="quoted"><span class="quoted">"merge <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span> <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">r</span> <span class="skolem">r</span> <span class="skolem">L</span><span class="main">)</span> <span class="skolem">uus</span> <span class="skolem">vvs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">uus</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> merge_length1_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> seqs_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span><span class="main">#</span><span class="skolem">us</span> <span class="main">=</span> <span class="skolem">uus</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> neq_Nil_conv<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ku</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ku</span> <span class="main">≡</span> length <span class="main">(</span><span class="skolem">u1</span><span class="main">#</span><span class="skolem">us</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">≡</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">u1</span><span class="main">#</span><span class="skolem">us</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> us_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span><span class="main">#</span><span class="skolem">us</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> merge_length1_nonempty seqs_ne us merge us K <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> xu_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">u1</span><span class="main">#</span><span class="skolem">us</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> BB_eq_concat_seqs K merge merge_preserves us xeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="skolem">u1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹strict_sorted <span class="skolem">x</span>›</span></span> strict_sorted_append_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> u_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">ps</span> <span class="main">⊆</span> list.set <span class="main">(</span>acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> acc_lengths_merge1 merge ps_def us <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vvs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> merge BB_eq_concat_seqs L merge_preserves xy yeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">#</span><span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">vvs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> neq_Nil_conv<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">kv</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kv</span> <span class="main">≡</span> length <span class="main">(</span><span class="skolem">v1</span><span class="main">#</span><span class="skolem">vs</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">≡</span> acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">#</span><span class="skolem">vs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> vs_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">#</span><span class="skolem">vs</span> <span class="main">∈</span> lists <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> L merge merge_length2_nonempty seqs_ne vs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> yv_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">v1</span><span class="main">#</span><span class="skolem">vs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> BB_eq_concat_seqs L merge merge_preserves vs yeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="skolem">v1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹strict_sorted <span class="skolem">y</span>›</span></span> strict_sorted_append_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> v_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">qs</span> <span class="main">⊆</span> list.set <span class="main">(</span>acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">r</span> <span class="skolem">r</span> <span class="skolem">L</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> acc_lengths_merge2 merge qs_def vs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> ss_concat_jj<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>concat <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> BB_eq_concat_seqs K <span class="quoted"><span class="quoted">‹strict_sorted <span class="skolem">x</span>›</span></span> xeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">kv</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kv</span> <span class="main">≤</span> <span class="skolem">ku</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ku</span> <span class="main">≤</span> Suc <span class="skolem">kv</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kv</span> <span class="main">≤</span> Suc <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> us vs merge_length_le merge_length_le_Suc merge_length_less2 merge
        <span class="keyword1"><span class="command">unfolding</span></span> ku_def kv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">≡</span> concat <span class="main">[</span><span class="skolem">ps</span><span class="main">,</span><span class="skolem">u1</span><span class="main">,</span><span class="skolem">qs</span><span class="main">,</span><span class="skolem">v1</span><span class="main">]</span> <span class="main">@</span> interact <span class="skolem">us</span> <span class="skolem">vs</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="skolem">zs</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> ssp<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="skolem">ps</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> ps_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> strict_sorted_acc_lengths us_ne<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> ssq<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_sorted <span class="skolem">qs</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> qs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> strict_sorted_acc_lengths vs_ne<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">j</span> <span class="main">≪</span> list.set <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> da <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span> db <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span>  K 𝒦_card 𝒦_enum nat_less_le
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xeq BB_def less_sets_Un2 less_sets_UN2<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ac_x<span class="main">:</span> <span class="quoted"><span class="quoted">"acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ksub <span class="quoted"><span class="quoted">‹finite <span class="skolem">K</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> card <span class="skolem">K</span>›</span></span> acc_lengths_subset_d dual_order.refl less_sets_imp_list_less less_sets_weaken1<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">&lt;</span> <span class="skolem">u1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> K Ksub UnI1 𝒦_card <span class="quoted"><span class="quoted">‹finite <span class="skolem">K</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> card <span class="skolem">K</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="skolem">j</span> <span class="main">≪</span> list.set <span class="skolem">x</span>›</span></span> acc_lengths_subset_d concat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> empty_iff empty_set hd_append2 less_list_def less_sets_imp_list_less less_sets_weaken1 list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_append u_sub xu_eq<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">r</span> <span class="main">≪</span> list.set <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> da <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> db <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>  L 𝒦_card 𝒦_enum nat_less_le
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> yeq BB_def less_sets_Un2 less_sets_UN2<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">r</span> <span class="skolem">r</span> <span class="skolem">L</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Lsub <span class="quoted"><span class="quoted">‹finite <span class="skolem">L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">≤</span> card <span class="skolem">L</span>›</span></span> acc_lengths_subset_d dual_order.refl less_sets_imp_list_less less_sets_weaken1<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">&lt;</span> <span class="skolem">v1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L Lsub UnI1 𝒦_card <span class="quoted"><span class="quoted">‹finite <span class="skolem">L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">≤</span> card <span class="skolem">L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="skolem">r</span> <span class="main">≪</span> list.set <span class="skolem">y</span>›</span></span> acc_lengths_subset_d concat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> empty_iff empty_set hd_append2 less_list_def less_sets_imp_list_less less_sets_weaken1 list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_append v_sub yv_eq<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> carda_v1<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">a</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">≤</span> length <span class="skolem">v1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> length_hd_merge2 <span class="main">[</span><span class="operator">OF</span> merge<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> vs <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqs_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> ab_enumK<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">⟹</span> <span class="skolem">a</span> <span class="skolem">j</span> <span class="main">≪</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ab enumK le_trans less_imp_le_nat<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> ab_enumL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> <span class="skolem">r</span> <span class="main">⟹</span> <span class="skolem">a</span> <span class="skolem">j</span> <span class="main">≪</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">L</span> <span class="bound">q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> ab enumL le_trans less_imp_le_nat<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ay<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">j</span> <span class="main">≪</span> list.set <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> yeq BB_def less_sets_Un2 less_sets_UN2 aj_ar<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> disjnt_hd_last_K_y<span class="main">:</span> <span class="quoted"><span class="quoted">"disjnt <span class="main">{</span>hd <span class="skolem">l</span><span class="main">..</span>last <span class="skolem">l</span><span class="main">}</span> <span class="main">(</span>list.set <span class="skolem">y</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> list.set <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">l</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> yeq BB_def disjnt_iff Ball_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI strip<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
          <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≤</span> last <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> l <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≤</span> last <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">a</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">a</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">u</span>"</span></span>
            <span class="main">|</span> <span class="skolem">i</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≤</span> last <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">u</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> seqs_def<span class="main">)</span>
          <span class="keyword1"><span class="command">note</span></span> l_cases <span class="main">=</span> this
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> <span class="skolem">a</span> <span class="skolem">r</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
            <span class="keyword3"><span class="command">case</span></span> 1
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_ne aj_ar finite_a last_in_set leD less_setsD set_sorted_list_of_set sorted_list_of_set_eq_Nil_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 2
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> enumK ab ba Inf_nat_def1 b_ne card_b_finite hd_b last_in_set less_asym less_setsD not_le set_sorted_list_of_set sorted_list_of_set_eq_Nil_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> <span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">L</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_cases
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
            <span class="keyword3"><span class="command">case</span></span> 1
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> a_ne ab_enumL finite_a last_in_set leD less_setsD set_sorted_list_of_set sorted_list_of_set_eq_Nil_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 2
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"enum <span class="skolem">K</span> <span class="skolem">i</span> <span class="main">=</span> enum <span class="skolem">L</span> <span class="skolem">q</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> 2 bb_same <span class="main">[</span><span class="operator">of</span> <span class="quasi_keyword">concl</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"enum <span class="skolem">L</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IJ_def pair_less_def less_sets_def<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> enumK b_ne card_b_finite last_in_set leD less_imp_le_nat set_sorted_list_of_set sorted_list_of_set_eq_Nil_iff<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">with</span></span> 2 bb enumK enumL <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> less_sets_def
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> b_ne card_b_finite last_in_set leD less_imp_le_nat list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nat_neq_iff set_sorted_list_of_set sorted_list_of_set_eq_Nil_iff<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">have</span></span> u1_y<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">u1</span> <span class="main">≪</span> list.set <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vs yv_eq L <span class="quoted"><span class="quoted">‹strict_sorted <span class="skolem">y</span>›</span></span> merge merge_less_sets_hd merge_preserves seqs_ne ss_concat_jj us <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">have</span></span> u1_subset_seqs<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">u1</span> <span class="main">⊆</span> list.set <span class="main">(</span>concat <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> merge_preserves <span class="main">[</span><span class="operator">OF</span> merge<span class="main">]</span> us <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">d</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">j</span> <span class="skolem">i</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bM d_eq less_sets_fst_grab less_sets_weaken2 nxt_subset that<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">≪</span> <span class="skolem">d</span> <span class="skolem">k'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">k'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">k'</span> <span class="skolem">j</span> <span class="skolem">i</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_lessI d_ne dd less_sets_trans that<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">k</span> <span class="main">≪</span> <span class="skolem">d</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aM d_eq less_sets_fst_grab less_sets_weaken2 nxt_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ad<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">k</span> <span class="main">≪</span> <span class="skolem">d</span> <span class="skolem">k'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span><span class="skolem">k'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">k'</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_lessI d_ne dd less_sets_trans that<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u1_y less_sets_imp_list_less<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> Inf <span class="main">(</span><span class="skolem">d</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> list.set <span class="skolem">u1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> list.set <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> list.set <span class="skolem">l</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> n u1_subset_seqs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> list_of <span class="main">(</span><span class="skolem">a</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="skolem">i</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> list_of <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> seqs_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
            <span class="keyword3"><span class="command">case</span></span> 1
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_nat_def1 <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> ad d_ne finite_a less_setsD n set_sorted_list_of_set<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 2
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def disjnt_iff less_sets_def<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> hd <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> less_setsD that u1_y
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gr_implies_not0 list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> xy<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 2 disjnt_hd_last_K_y <span class="main">[</span><span class="operator">OF</span> l<span class="main">]</span> u1_y
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def disjnt_iff<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_b_finite hd_list_of leI less_imp_le_nat list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>enum <span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> hd <span class="main">(</span>list_of <span class="main">(</span><span class="skolem">a</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">y</span>›</span></span> L n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  2yeq BB_eq_concat_seqs seqs_def less_list_def<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enum <span class="skolem">K</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"2"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> a_ne ab card_b_finite empty_iff finite.emptyI finite_a last_in_set leI less_asym less_setsD list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n set_sorted_list_of_set<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> enum <span class="skolem">K</span> <span class="skolem">i</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"2"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> enumK less_imp_le_nat<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 2 n bd <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="quoted">"enum <span class="skolem">K</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> Inf_nat_def1 less_setsD <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">u1</span> <span class="main">&lt;</span> Inf <span class="main">(</span><span class="skolem">d</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">uus</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> us_ne <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> length <span class="skolem">v1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> card_a carda_v1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">u1</span> <span class="main">&lt;</span> length <span class="skolem">v1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">&lt;</span> <span class="skolem">qs</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs_def acc_lengths.simps less_list_def<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>interact <span class="main">(</span><span class="skolem">u1</span><span class="main">#</span><span class="skolem">us</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">#</span><span class="skolem">vs</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> L <span class="quoted"><span class="quoted">‹strict_sorted <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹strict_sorted <span class="skolem">y</span>›</span></span> merge merge_interact merge_preserves seqs_ne us vs xu_eq yv_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_sorted <span class="main">(</span>interact <span class="skolem">us</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">&lt;</span> interact <span class="skolem">us</span> <span class="skolem">vs</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_sorted_append_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">&lt;</span> <span class="skolem">u1</span> <span class="main">@</span> <span class="skolem">qs</span> <span class="main">@</span> <span class="skolem">v1</span> <span class="main">@</span> interact <span class="skolem">us</span> <span class="skolem">vs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ps</span> <span class="main">&lt;</span> <span class="skolem">u1</span>›</span></span> us_ne <span class="keyword1"><span class="command">unfolding</span></span> less_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">&lt;</span> <span class="skolem">qs</span> <span class="main">@</span> <span class="skolem">v1</span> <span class="main">@</span> interact <span class="skolem">us</span> <span class="skolem">vs</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u1</span> <span class="main">&lt;</span> <span class="skolem">qs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vvs</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> acc_lengths_eq_Nil_iff hd_append less_list_def qs_def vs<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">&lt;</span> <span class="skolem">v1</span> <span class="main">@</span> interact <span class="skolem">us</span> <span class="skolem">vs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qs</span> <span class="main">&lt;</span> <span class="skolem">v1</span>›</span></span> us_ne <span class="quoted"><span class="quoted">‹last <span class="skolem">u1</span> <span class="main">&lt;</span> length <span class="skolem">v1</span>›</span></span> vs_ne <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_list_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zs_def strict_sorted_append_iff ssp ssq <span class="quoted"><span class="quoted">‹strict_sorted <span class="skolem">u1</span>›</span></span> <span class="quoted"><span class="quoted">‹strict_sorted <span class="skolem">v1</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> ps_subset_d<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">ps</span> <span class="main">⊆</span> <span class="skolem">d</span> <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> K Ksub 𝒦_card <span class="quoted"><span class="quoted">‹finite <span class="skolem">K</span>›</span></span> acc_lengths_subset_d u_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> ps_less_u1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">&lt;</span> <span class="skolem">u1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">u1</span> <span class="main">=</span> hd <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> us_ne <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xu_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">u1</span> <span class="main">∈</span> <span class="skolem">a</span> <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xeq BB_eq_concat_seqs K seqs_def hd_append hd_list_of<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">ps</span> <span class="main">≪</span> <span class="main">{</span>hd <span class="skolem">u1</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> da ps_subset_d less_sets_def singletonD subset_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_hd_imp_less list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> empty_set less_sets_imp_list_less<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> qs_subset_d<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">qs</span> <span class="main">⊆</span> <span class="skolem">d</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> L Lsub 𝒦_card <span class="quoted"><span class="quoted">‹finite <span class="skolem">L</span>›</span></span> acc_lengths_subset_d v_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> qs_less_v1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">&lt;</span> <span class="skolem">v1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">v1</span> <span class="main">=</span> hd <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vs_ne <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> yv_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">v1</span> <span class="main">∈</span> <span class="skolem">a</span> <span class="skolem">r</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> yeq BB_eq_concat_seqs L seqs_def hd_append hd_list_of<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">qs</span> <span class="main">≪</span> <span class="main">{</span>hd <span class="skolem">v1</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> da qs_subset_d less_sets_def singletonD subset_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_hd_imp_less list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> empty_set less_sets_imp_list_less<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> FB<span class="main">:</span> <span class="quoted"><span class="quoted">"Form_Body <span class="skolem">ku</span> <span class="skolem">kv</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">zs</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Form_Body.simps
        <span class="keyword1"><span class="command">using</span></span> ku_def kv_def ps_def qs_def ss us_ne vs_ne xu_eq xy yv_eq zs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="main">(</span>inter_scheme <span class="main">(</span><span class="main">(</span><span class="skolem">ku</span><span class="main">+</span><span class="skolem">kv</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Form_Body_imp_inter_scheme k<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"Form <span class="skolem">l</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zs_eq_interact<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> inter_scheme <span class="skolem">l</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ku</span><span class="main">+</span><span class="skolem">kv</span><span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Form <span class="main">(</span><span class="skolem">ku</span><span class="main">+</span><span class="skolem">kv</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="skolem">U</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ku</span><span class="main">=</span><span class="skolem">kv</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> FB Form.simps Ueq <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">kv</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_2<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ku</span> <span class="main">=</span> Suc <span class="skolem">kv</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> FB Form.simps Ueq <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">kv</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> inter_scheme <span class="main">(</span><span class="skolem">ku</span> <span class="main">+</span> <span class="skolem">kv</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Form_Body_imp_inter_scheme <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FB k<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enum <span class="free">N</span> <span class="skolem">l</span> <span class="main">≤</span> enum <span class="free">N</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms less_imp_le_nat<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> Min <span class="main">(</span><span class="skolem">d</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Min_in card_0_eq card_d d_eq finite_d fst_grab_subset greaterThan_iff in_mono le_inf_iff nxt_def old.nat.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> ls<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>enum <span class="free">N</span> <span class="skolem">l</span><span class="main">}</span> <span class="main">≪</span> <span class="skolem">d</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> l False Form_0_cases_raw Set.doubleton_eq_iff Ueq gr0I<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Ueq
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI impI<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> zs_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">zs</span> <span class="main">⊆</span> list.set <span class="main">(</span>acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> list.set <span class="main">(</span>acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">r</span> <span class="skolem">r</span> <span class="skolem">L</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> list.set <span class="skolem">x</span> <span class="main">∪</span> list.set <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> u_sub v_sub <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zs_def xu_eq yv_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="skolem">K</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> d_subset_N Ksub <span class="quoted"><span class="quoted">‹finite <span class="skolem">K</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> card <span class="skolem">K</span>›</span></span> acc_lengths_subset_d <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>acc_lengths <span class="main">0</span> <span class="main">(</span><span class="skolem">seqs</span> <span class="skolem">r</span> <span class="skolem">r</span> <span class="skolem">L</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> d_subset_N Lsub <span class="quoted"><span class="quoted">‹finite <span class="skolem">L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">≤</span> card <span class="skolem">L</span>›</span></span> acc_lengths_subset_d <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">x</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">y</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xeq yeq BB_def a_subset_N UN_least b_subset_N<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span>inter_scheme <span class="skolem">l</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> zs_eq_interact <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>enum <span class="free">N</span> <span class="skolem">l</span><span class="main">]</span> <span class="main">&lt;</span> <span class="skolem">ps</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ps_subset_d ls
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_set less_sets_imp_list_less less_sets_weaken2 list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>enum <span class="free">N</span> <span class="skolem">l</span><span class="main">]</span> <span class="main">&lt;</span> inter_scheme <span class="skolem">l</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zs_def less_list_def ps_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> zs_eq_interact<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> Ueq l <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The main partition theorem for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ω<span class="main"><span class="main">↑</span></span>ω"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iso_ll</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iso_ll</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> iso <span class="main">(</span>lenlex less_than <span class="main">∩</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">×</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lenlex less_than <span class="main">∩</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">×</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">corollary</span></span> ordertype_eq_ordertype_iso_ll<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Field <span class="main">(</span>Restr <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"Field <span class="main">(</span>Restr <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ordertype <span class="free">A</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">=</span> ordertype <span class="free">B</span> <span class="main">(</span>lenlex less_than<span class="main">)</span><span class="main">)</span>
         <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> iso_ll <span class="free">A</span> <span class="free">B</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">∧</span> total_on <span class="free">B</span> <span class="main">(</span>lenlex less_than<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I total_lenlex total_on_def total_on_less_than<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms wf_lenlex lenlex_transI iso_ll_def ordertype_eq_ordertype_iso_Restr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> partition_ωω_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts ω"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partn_lst <span class="main">(</span>lenlex less_than<span class="main">)</span> WW <span class="main">[</span>ω<span class="main">↑</span>ω<span class="main">,</span><span class="free">α</span><span class="main">]</span> <span class="numeral">2</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"partn_lst <span class="var">?R</span> WW <span class="main">[</span>ω<span class="main">↑</span>ω<span class="main">,</span><span class="free">α</span><span class="main">]</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> strict_sorted_into_WW <span class="keyword1"><span class="command">unfolding</span></span> WW_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> partn_lst_triv1<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> i<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> ord_of_nat <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms elts_ω <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&gt;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> partn_lst_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">X</span></span> <span class="main">⊆</span> WW<span class="main">.</span> ordertype <span class="bound">X</span> <span class="var">?R</span> <span class="main">=</span> ω<span class="main">↑</span>ω <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">M</span></span> <span class="main">⊆</span> WW<span class="main">.</span> ordertype <span class="bound">M</span> <span class="var">?R</span> <span class="main">=</span> <span class="free">α</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P0</span> <span class="main">∨</span> <span class="var">?P1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjCI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> not1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W'</span><span class="main">.</span> ordertype <span class="bound">W'</span> <span class="var">?R</span> <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">W'</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">W'</span> <span class="main">⊆</span> WW_seg <span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> fnm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span>WW_seg <span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">m</span><span class="main">)</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f WW_seg_subset_WW <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">*</span><span class="skolem">m</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> in_mono nsets_Pi_contra<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"partn_lst <span class="var">?R</span> <span class="main">(</span>WW_seg <span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>ω<span class="main">↑</span><span class="skolem">n</span><span class="main">,</span> ord_of_nat <span class="skolem">m</span><span class="main">]</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ordertype_WW_seg <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">*</span><span class="skolem">m</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partn_lst_VWF_imp_partn_lst <span class="main"><span class="main">[</span></span><span class="operator">OF</span> Theorem_3_2<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> partn_lst_E <span class="main">[</span><span class="operator">OF</span> * fnm<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> One_nat_def Suc_1 WW_seg_subset_WW order.trans less_2_cases m not1 nth_Cons' nth_Cons_Suc<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W'</span></span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list set"</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> otW'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> ordertype <span class="main">(</span><span class="skolem">W'</span> <span class="bound">n</span><span class="main">)</span> <span class="var">?R</span> <span class="main">=</span> ω<span class="main">↑</span><span class="bound">n</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> f_W'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="skolem">W'</span> <span class="bound">n</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> seg_W'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">W'</span> <span class="bound">n</span> <span class="main">⊆</span> WW_seg <span class="main">(</span><span class="bound">n</span><span class="main">*</span><span class="skolem">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">WW'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">WW'</span> <span class="main">≡</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">W'</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">WW'</span> <span class="main">⊆</span> WW"</span></span>
        <span class="keyword1"><span class="command">using</span></span> seg_W' WW_seg_subset_WW <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WW'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> f <span class="keyword1"><span class="command">have</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">WW'</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{..&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nsets_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> ot'<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">WW'</span> <span class="var">?R</span> <span class="main">=</span> ω<span class="main">↑</span>ω"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">WW'</span> <span class="var">?R</span> <span class="main">≤</span> ordertype WW <span class="var">?R</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">WW'</span> <span class="main">⊆</span> WW›</span></span> lenlex_transI ordertype_mono wf_lenlex<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ordertype_WW
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">WW'</span> <span class="var">?R</span> <span class="main">≤</span> ω <span class="main">↑</span> ω"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">↑</span> <span class="skolem">n</span> <span class="main">≤</span> ordertype <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">W'</span><span class="main">)</span><span class="main">)</span> <span class="var">?R</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TC_small UNIV_I UN_I otW' lenlex_transI ordertype_mono subsetI trans_less_than wf_lenlex wf_less_than<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">↑</span> ω <span class="main">≤</span> ordertype <span class="skolem">WW'</span> <span class="var">?R</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> elts_ω oexp_Limit ZFC_in_HOL.SUP_le_iff WW'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> FR_WW<span class="main">:</span> <span class="quoted"><span class="quoted">"Field <span class="main">(</span>Restr <span class="main">(</span>lenlex less_than<span class="main">)</span> WW<span class="main">)</span> <span class="main">=</span> WW"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit_omega_oexp Limit_ordertype_imp_Field_Restr ordertype_WW<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> FR_WW'<span class="main">:</span> <span class="quoted"><span class="quoted">"Field <span class="main">(</span>Restr <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="skolem">WW'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">WW'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit_omega_oexp Limit_ordertype_imp_Field_Restr ot'<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> FR_W<span class="main">:</span> <span class="quoted"><span class="quoted">"Field <span class="main">(</span>Restr <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">(</span>WW_seg <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> WW_seg <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit_omega_oexp ordertype_WW_seg that Limit_ordertype_imp_Field_Restr<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> FR_W'<span class="main">:</span> <span class="quoted"><span class="quoted">"Field <span class="main">(</span>Restr <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">(</span><span class="skolem">W'</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">W'</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit_omega_oexp otW' that Limit_ordertype_imp_Field_Restr<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h</span><span class="main">.</span> iso_ll <span class="main">(</span>WW_seg <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">W'</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">h</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ordertype_eq_ordertype_iso_ll <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>WW_seg <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">=</span> ordertype <span class="main">(</span><span class="skolem">W'</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordertype_WW_seg otW'<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FR_W FR_W' that<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h_seg</span></span> <span class="keyword2"><span class="keyword">where</span></span> h_seg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> iso_ll <span class="main">(</span>WW_seg <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">W'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">h_seg</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">l</span><span class="main">=</span><span class="main">[]</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="skolem">h_seg</span> <span class="main">(</span>length <span class="bound">l</span><span class="main">)</span> <span class="bound">l</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> bij_h_seg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> bij_betw <span class="main">(</span><span class="skolem">h_seg</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>WW_seg <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">W'</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> h_seg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iso_ll_def iso_iff2 FR_W FR_W'<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> len_h_seg<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">h_seg</span> <span class="main">(</span>length <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">l</span> <span class="main">*</span> <span class="skolem">m</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> WW"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">l</span>
        <span class="keyword1"><span class="command">using</span></span> bij_betwE <span class="main">[</span><span class="operator">OF</span> bij_h_seg<span class="main">]</span> seg_W' that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WW_seg_def subset_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> hlen<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">h</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">h</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⟷</span> length <span class="skolem">x</span> <span class="main">=</span> length <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> WW"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> WW"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">m</span>›</span></span> h_def len_h_seg <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

      <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"iso_ll WW <span class="skolem">WW'</span> <span class="skolem">h</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> iso_ll_def iso_iff2 FR_WW FR_WW'
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI strip<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> W'_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W'</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
          <span class="keyword1"><span class="command">using</span></span> otW' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="skolem">WW'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> seg_W' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WW'_def WW_seg_def<span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">l</span><span class="main">=</span><span class="main">[]</span> <span class="keyword1">then</span> <span class="bound">l</span> <span class="keyword1">else</span> inv_into <span class="main">(</span>WW_seg <span class="main">(</span>length <span class="bound">l</span> <span class="keyword1">div</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">h_seg</span> <span class="main">(</span>length <span class="bound">l</span> <span class="keyword1">div</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="bound">l</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> h_seg_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">a</span> <span class="main">∈</span> WW_seg <span class="bound">n</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> WW_seg <span class="bound">n</span><span class="main">;</span> <span class="bound">n</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span>
                          <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than <span class="main">⟷</span>
                          <span class="main">(</span><span class="skolem">h_seg</span> <span class="bound">n</span> <span class="bound">a</span><span class="main">,</span> <span class="skolem">h_seg</span> <span class="bound">n</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than <span class="main">∧</span> <span class="skolem">h_seg</span> <span class="bound">n</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">W'</span> <span class="bound">n</span> <span class="main">∧</span> <span class="skolem">h_seg</span> <span class="bound">n</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">W'</span> <span class="bound">n</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> h_seg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iso_ll_def iso_iff2 FR_W FR_W'<span class="main">)</span>

        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">h</span> WW <span class="skolem">WW'</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_iff_bijections
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI ballI<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> WW"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> WW_seg <span class="main">(</span>length <span class="skolem">l</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WW_seg_def<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">l</span> <span class="main">∈</span> <span class="skolem">W'</span> <span class="main">(</span>length <span class="skolem">l</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">with</span></span> seg_W' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> W'_ne <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WW_seg_def h_def<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> bij_betwE bij_h_seg h_def l <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">l</span> <span class="main">∈</span> <span class="skolem">WW'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> WW'_def <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="skolem">l</span> <span class="main">∈</span> <span class="skolem">W'</span> <span class="main">(</span>length <span class="skolem">l</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">(</span><span class="skolem">h</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h_seg</span> <span class="main">(</span>length <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> WW›</span></span> len_h_seg <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">m</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def len_h_seg <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> WW›</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">l</span>›</span></span> bij_betw_inv_into_left bij_h_seg l<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="skolem">WW'</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="skolem">W'</span> <span class="main">(</span>length <span class="skolem">l</span> <span class="keyword1">div</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> WW_seg_def <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">m</span>›</span></span> seg_W' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WW'_def<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="skolem">l</span> <span class="main">∈</span> WW"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∉</span> <span class="skolem">W'</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> WW_seg_def seg_W' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">with</span></span> l <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="main">(</span>WW_seg <span class="main">(</span>length <span class="skolem">l</span> <span class="keyword1">div</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">h_seg</span> <span class="main">(</span>length <span class="skolem">l</span> <span class="keyword1">div</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">∈</span> WW_seg <span class="main">(</span>length <span class="skolem">l</span> <span class="keyword1">div</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.neq0_conv bij_betwE bij_betw_inv_into bij_h_seg<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> False WW_seg_subset_WW <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WW_def<span class="main">)</span>

          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="var">?g</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">l</span> <span class="keyword1">div</span> <span class="skolem">m</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> WW_seg_def l seg_W' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="main">(</span>WW_seg <span class="main">(</span>length <span class="skolem">l</span> <span class="keyword1">div</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">h_seg</span> <span class="main">(</span>length <span class="skolem">l</span> <span class="keyword1">div</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">∈</span> WW_seg <span class="main">(</span>length <span class="skolem">l</span> <span class="keyword1">div</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_imp_surj_on bij_h_seg inv_into_into l<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> bij_h_seg <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">l</span> <span class="keyword1">div</span> <span class="skolem">m</span>"</span></span><span class="main">]</span> WW_seg_def <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">l</span> <span class="keyword1">div</span> <span class="skolem">m</span>›</span></span> bij_betw_inv_into_right l
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> WW"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> WW"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> Restr <span class="main">(</span>lenlex less_than<span class="main">)</span> WW <span class="main">⟷</span> <span class="main">(</span><span class="skolem">h</span> <span class="skolem">a</span><span class="main">,</span> <span class="skolem">h</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> Restr <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="skolem">WW'</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">a</span> <span class="main">&lt;</span> length <span class="skolem">b</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"length <span class="skolem">a</span> <span class="main">=</span> length <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> lex less_than"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lenlex_conv<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
            <span class="keyword3"><span class="command">case</span></span> 1
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">h</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">h</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> WW›</span></span> h_def len_h_seg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span> <span class="skolem">a</span><span class="main">,</span> <span class="skolem">h</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lenlex_conv<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> WW›</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">h</span> WW <span class="skolem">WW'</span>›</span></span> bij_betwE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 2
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> WW_seg <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> WW_seg <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> WW›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WW_seg_def<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">h</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">h</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 2 <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> WW›</span></span> h_def len_h_seg <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than"</span></span>
              <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h_seg</span> <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span> <span class="skolem">a</span><span class="main">,</span> <span class="skolem">h_seg</span> <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 2 ab h_seg_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 2 <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> WW›</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">h</span> WW <span class="skolem">WW'</span>›</span></span> bij_betwE h_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> R<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> R'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span> <span class="skolem">a</span><span class="main">,</span> <span class="skolem">h</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">a</span> <span class="main">&lt;</span> length <span class="skolem">b</span>"</span></span>
            <span class="main">|</span> <span class="quoted"><span class="quoted">"length <span class="skolem">a</span> <span class="main">=</span> length <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span> <span class="skolem">a</span><span class="main">,</span> <span class="skolem">h</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> lex less_than"</span></span>
            <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lenlex_conv h_def len_h_seg <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
            <span class="keyword3"><span class="command">case</span></span> 1
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than"</span></span>
              <span class="keyword1"><span class="command">using</span></span> omega_sum_less_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> WW›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 2
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> WW_seg <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> WW_seg <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> WW›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WW_seg_def<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than"</span></span>
              <span class="keyword1"><span class="command">using</span></span> bij_betwE <span class="main">[</span><span class="operator">OF</span> bij_h_seg<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> WW›</span></span> R' 2
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def h_seg_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> WW›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fh</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∘</span> image <span class="skolem">h</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">h</span> WW <span class="skolem">WW'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">unfolding</span></span> iso_ll_def iso_iff2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FR_WW FR_WW'<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> fh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fh</span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">→</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Pi_iff <span class="keyword1"><span class="command">using</span></span> bij_betwE f' bij_betw_nsets <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PiE comp_apply<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">WW'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">WW'</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">=</span> length <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">W'</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">W'</span> <span class="skolem">q</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> WW'_def <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">WW'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">WW'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">W'</span> <span class="skolem">n</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> seg_W' <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">m</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x</span> <span class="main">=</span> length <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WW'_def WW_seg_def subset_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f_W' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fh_eq_0_eqlen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fh</span><span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> WW"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> WW"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">=</span> length <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
        <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">h</span> WW <span class="skolem">WW'</span>›</span></span>  that hlen
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_iff_bijections<span class="main">)</span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">have</span></span> m_f_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">[</span><span class="skolem">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">⊆</span> WW"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">M</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">M</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False m that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> not1 <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">]</span> f
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">m</span>›</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pi_iff image_subset_iff finite_ordertype_eq_card m<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_2_cases nsets_mono numeral_2_eq_2 subset_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> m_fh_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">[</span><span class="skolem">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">.</span> <span class="var">?fh</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">⊆</span> WW"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">M</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">`</span> <span class="skolem">M</span> <span class="main">⊆</span> WW"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">WW'</span> <span class="main">⊆</span> WW›</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">h</span> WW <span class="skolem">WW'</span>›</span></span> bij_betwE that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">h</span> <span class="main">`</span> <span class="skolem">M</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">h</span> WW <span class="skolem">WW'</span>›</span></span> bij_betw_def bij_betw_subset card_image that<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">h</span> <span class="main">`</span> <span class="skolem">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> m_f_0<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">`</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">Y</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">M</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nsets_def subset_image_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">⊆</span> WW›</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">h</span> WW <span class="skolem">WW'</span>›</span></span> bij_betw_def card_image card.infinite inj_on_subset zero_neq_numeral<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">N</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">u</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">k</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">;</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">;</span> Form <span class="bound">k</span> <span class="bound">u</span><span class="main">;</span> <span class="main">[</span>enum <span class="skolem">N</span> <span class="bound">k</span><span class="main">]</span> <span class="main">&lt;</span> inter_scheme <span class="bound">k</span> <span class="bound">u</span><span class="main">;</span> List.set <span class="main">(</span>inter_scheme <span class="bound">k</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">N</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?fh</span> <span class="bound">u</span> <span class="main">=</span> <span class="skolem">j</span> <span class="bound">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lemma_3_6 <span class="main">[</span><span class="operator">OF</span> fh<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> infN'<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>enum <span class="skolem">N</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">k</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span> enum_works finite_image_iff infinite_Ioi strict_mono_imp_inj_on<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> j_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="skolem">m</span></sup><span class="hidden">⇖</span>"</span></span>
                 <span class="keyword2"><span class="keyword">and</span></span> MF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> Form <span class="skolem">k</span> <span class="bound">u</span>"</span></span>
                 <span class="keyword2"><span class="keyword">and</span></span> Mi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span> List.set <span class="main">(</span>inter_scheme <span class="skolem">k</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⊆</span> enum <span class="skolem">N</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">k</span><span class="main">&lt;..}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> lemma_3_7 <span class="main">[</span><span class="operator">OF</span> infN' <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fh</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> m_fh_0 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">]</span> M <span class="main">[</span><span class="operator">unfolded</span> nsets_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"Form <span class="skolem">k</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"List.set <span class="main">(</span>inter_scheme <span class="skolem">k</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">⊆</span> enum <span class="skolem">N</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">k</span><span class="main">&lt;..}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MF Mi <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">M</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">[</span>WW]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> M u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enum <span class="skolem">N</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">k</span><span class="main">&lt;..}</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span> range_enum <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>enum <span class="skolem">N</span> <span class="skolem">k</span><span class="main">]</span> <span class="main">&lt;</span> inter_scheme <span class="skolem">k</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> inter_scheme <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span>  strict_mono_enum <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span><span class="main">]</span> §
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_list_def subset_image_iff subset_eq Bex_def image_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hd_in_set strict_mono_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> N that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> WW"</span></span> <span class="keyword2"><span class="keyword">and</span></span> otX<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">X</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">=</span> ω<span class="main">↑</span>ω"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⟹</span>
                   <span class="main">∃</span><span class="bound">l</span><span class="main">.</span> Form <span class="bound">l</span> <span class="bound">u</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">l</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">[</span>enum <span class="skolem">N</span> <span class="bound">l</span><span class="main">]</span> <span class="main">&lt;</span> inter_scheme <span class="bound">l</span> <span class="bound">u</span> <span class="main">∧</span> List.set <span class="main">(</span>inter_scheme <span class="bound">l</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">N</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lemma_3_8 <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">N</span>›</span></span><span class="main">]</span> ot' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fh</span> <span class="main">`</span> <span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
        <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">[</span><span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Form <span class="skolem">l</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">[</span>enum <span class="skolem">N</span> <span class="skolem">l</span><span class="main">]</span> <span class="main">&lt;</span> inter_scheme <span class="skolem">l</span> <span class="skolem">u</span> <span class="main">∧</span> List.set <span class="main">(</span>inter_scheme <span class="skolem">l</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> u X <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fh</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Form_0_cases_raw <span class="quoted"><span class="quoted">‹Form <span class="skolem">l</span> <span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> WW›</span></span> doubleton_in_nsets_2 fh_eq_0_eqlen subset_iff u<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>enum <span class="skolem">N</span> <span class="skolem">l</span><span class="main">]</span> <span class="main">&lt;</span> inter_scheme <span class="skolem">l</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"List.set <span class="main">(</span>inter_scheme <span class="skolem">l</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="skolem">l</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Nat.neq0_conv j_0 l <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> WW›</span></span> N inter_scheme <span class="quoted"><span class="quoted">‹Form <span class="skolem">l</span> <span class="skolem">u</span>›</span></span> doubleton_in_nsets_2 u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nsets_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">`</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?P0</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">`</span> <span class="skolem">X</span> <span class="main">⊆</span> WW"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">WW'</span> <span class="main">⊆</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> WW›</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">h</span> WW <span class="skolem">WW'</span>›</span></span> bij_betw_imp_surj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">h</span> <span class="main">`</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">(</span>lenlex less_than<span class="main">)</span> <span class="main">=</span> ω <span class="main">↑</span> ω"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ordertype_inc_eq<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span> <span class="skolem">x</span><span class="main">,</span> <span class="skolem">h</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than"</span></span>
            <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> lenlex less_than"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
            <span class="keyword1"><span class="command">using</span></span> that h <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> WW›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FR_WW FR_WW' iso_iff2 iso_ll_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> otX <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="skolem">h</span> <span class="main">`</span> <span class="skolem">X</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_subset_iff nsets_def<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">h</span> <span class="main">`</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">Y</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into WW <span class="skolem">h</span> <span class="main">`</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">h</span> <span class="main">`</span> <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">h</span> WW <span class="skolem">WW'</span>›</span></span> bij_betw_inv_into_LEFT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>inv_into WW <span class="skolem">h</span> <span class="main">`</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>inv_into WW <span class="skolem">h</span> <span class="main">`</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">h</span> <span class="main">`</span> <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">Y</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span> card_image inj_on_inv_into subset_image_iff subset_trans<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">`</span> inv_into WW <span class="skolem">h</span> <span class="main">`</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_subset_iff nsets_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> WW›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">h</span> <span class="main">`</span> <span class="skolem">X</span>›</span></span> image_inv_into_cancel image_mono order_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">H</span></span><span class="main">⊆</span>WW<span class="main">.</span> ordertype <span class="bound">H</span> <span class="var">?R</span> <span class="main">=</span> <span class="main">[</span>ω<span class="main">↑</span>ω<span class="main">,</span> <span class="free">α</span><span class="main">]</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">[</span><span class="bound">H</span>]<span class="hidden">⇗</span><sup><span class="numeral">2</span></sup><span class="hidden">⇖</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def lessI nth_Cons_0 nth_Cons_Suc zero_less_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 3.1 of Jean A. Larson, ibid.›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> partition_ωω<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts ω <span class="main">⟹</span> partn_lst_VWF <span class="main">(</span>ω<span class="main">↑</span>ω<span class="main">)</span> <span class="main">[</span>ω<span class="main">↑</span>ω<span class="main">,</span><span class="free">α</span><span class="main">]</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> partn_lst_imp_partn_lst_VWF_eq <span class="main">[</span><span class="operator">OF</span> partition_ωω_aux<span class="main">]</span> ordertype_WW <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>