<div id="CS_Tools">
<div class="head">
<h1>Theory CS_Tools</h1>
</div>
<pre class="source"><span class="comment1">(* Copyright 2021 (C) Mihails Milehins *)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Import›</span></span>
<span class="keyword1"><span class="command">theory</span></span> CS_Tools
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Standard library extension›</span></span>

<span class="keyword1"><span class="command">ML_file</span></span> <span class="quoted">"More_Tactical.ML"</span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Specialized functionality›</span></span>

<span class="keyword1"><span class="command">ML_file</span></span> <span class="quoted">"CS_Stats.ML"</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="files/More_Tactical.ML">
<div class="head">
<h1>File ‹More_Tactical.ML›</h1>
</div>
<pre class="source"><span class="comment1">(* Copyright 2021 (C) Mihails Milehins *)</span>

<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">TACTICAL</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>
  <span class="keyword1"><span class="keyword">include</span></span> TACTICAL
  <span class="keyword1"><span class="keyword">val</span></span> FIRST_APPEND' <span class="main">:</span> <span class="main">(</span>'a <span class="main">-&gt;</span> tactic<span class="main">)</span> list <span class="main">-&gt;</span> 'a <span class="main">-&gt;</span> tactic
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">Tactical</span><span class="main">:</span> <span class="entity">TACTICAL</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>

<span class="keyword3"><span class="keyword">open</span></span> Tactical<span class="main">;</span>

<span class="comment1">(* based on the tactical FIRST in the main distribution *)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">FIRST_APPEND'</span> <span class="entity">tacs</span> <span class="main">=</span> fold_rev <span class="main">(</span>curry <span class="keyword1"><span class="keyword">op</span></span> APPEND'<span class="main">)</span> <span class="entity">tacs</span> <span class="main">(</span>K no_tac<span class="main">)</span><span class="main">;</span>

<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword3"><span class="keyword">open</span></span> Tactical<span class="main">;</span></pre>
</div><div id="files/CS_Stats.ML">
<div class="head">
<h1>File ‹CS_Stats.ML›</h1>
</div>
<pre class="source"><span class="comment1">(* Copyright 2021 (C) Mihails Milehins *)</span>

<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">CS_STATS</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>
<span class="keyword1"><span class="keyword">val</span></span> basic_stats <span class="main">:</span> real list <span class="main">-&gt;</span> real list
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">CS_Stats</span><span class="main">:</span> <span class="entity">CS_STATS</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>

<span class="comment1">(*based on https://en.wikipedia.org/wiki/Variance*)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">basic_stats</span> <span class="entity">xs</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">sqr</span> <span class="entity">x</span> <span class="main">=</span> <span class="entity">x</span>*<span class="entity">x</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">n</span> <span class="main">=</span> Real.fromInt <span class="main">(</span>length <span class="entity">xs</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">mean</span> <span class="main">=</span> fold <span class="main">(</span>curry <span class="keyword1"><span class="keyword">op</span></span>+<span class="main">)</span> <span class="entity">xs</span> <span class="inner_numeral">0.0</span> / <span class="entity">n</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">variance</span> <span class="main">=</span> fold <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">y</span> <span class="main">=&gt;</span> <span class="entity">y</span> + <span class="entity">sqr</span> <span class="main">(</span><span class="entity">x</span> - <span class="entity">mean</span><span class="main">)</span><span class="main">)</span> <span class="entity">xs</span> <span class="inner_numeral">0.0</span> / <span class="entity">n</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">max</span> <span class="main">=</span> fold <span class="main">(</span>curry Real.max<span class="main">)</span> <span class="entity">xs</span> <span class="inner_numeral">0.0</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">min</span> <span class="main">=</span> fold <span class="main">(</span>curry Real.min<span class="main">)</span> <span class="entity">xs</span> <span class="entity">max</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="main">[</span><span class="entity">mean</span><span class="main">,</span> <span class="entity">variance</span><span class="main">,</span> <span class="entity">min</span><span class="main">,</span> <span class="entity">max</span><span class="main">]</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span></pre>
</div><div id="IHOL_CS">
<div class="head">
<h1>Theory IHOL_CS</h1>
</div>
<pre class="source"><span class="comment1">(* Copyright 2021 (C) Mihails Milehins *)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>IHOL_CS›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">theory</span></span> IHOL_CS
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="#CS_Tools">CS_Tools/CS_Tools</a>"</span>
  <span class="keyword2"><span class="keyword">keywords</span></span> <span class="quoted">"cs_full"</span> <span class="quoted">"cs_ist_simple"</span> <span class="quoted">"cs_simp"</span> <span class="quoted">"cs_intro"</span>  
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">ML_file</span></span> <span class="quoted">"CS_TimeIt.ML"</span>
<span class="keyword1"><span class="command">ML_file</span></span> <span class="quoted">"CS_UM.ML"</span>
<span class="keyword1"><span class="command">ML_file</span></span> <span class="quoted">"CS_Cond_Simp.ML"</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="files/CS_TimeIt.ML">
<div class="head">
<h1>File ‹CS_TimeIt.ML›</h1>
</div>
<pre class="source"><span class="comment1">(* Copyright 2021 (C) Mihails Milehins *)</span>

<span class="comment1">(*
The infrastructure of CS_TimeIt builds upon and extends the functionality of
the method timeit of Eisbach. It provides only a very thin layer of additional 
or alternative functionality.
*)</span>
<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">CS_TIMEIT</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>
<span class="keyword1"><span class="keyword">val</span></span> timing_stats <span class="main">:</span> Timing.timing list <span class="main">-&gt;</span> Timing.timing list
<span class="keyword1"><span class="keyword">val</span></span> timing_report <span class="main">:</span> Timing.timing list <span class="main">-&gt;</span> unit
<span class="keyword1"><span class="keyword">val</span></span> TIMEIT <span class="main">:</span> int <span class="main">-&gt;</span> <span class="main">(</span>thm <span class="main">-&gt;</span> thm Seq.seq<span class="main">)</span> <span class="main">-&gt;</span> tactic
<span class="keyword1"><span class="keyword">val</span></span> mtimeit <span class="main">:</span> int <span class="main">-&gt;</span> <span class="entity">Method.text</span> <span class="main">-&gt;</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> <span class="entity">Method.method</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">CS_TimeIt</span><span class="main">:</span> <span class="entity">CS_TIMEIT</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">timing_stats</span> <span class="main">(</span><span class="entity">ts</span> <span class="main">:</span> Timing.timing list<span class="main">)</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">mean_time</span> <span class="main">=</span>
      map <span class="main">(</span>Time.toReal<span class="main">)</span> #&gt; <span class="entity">CS_Stats.basic_stats</span> #&gt; map Time.fromReal
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">es</span> <span class="main">=</span> map <span class="main">#</span>elapsed <span class="entity">ts</span> |&gt; <span class="entity">mean_time</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">cpus</span> <span class="main">=</span> map <span class="main">#</span>cpu <span class="entity">ts</span> |&gt; <span class="entity">mean_time</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">gcs</span> <span class="main">=</span> map <span class="main">#</span>gc <span class="entity">ts</span> |&gt; <span class="entity">mean_time</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">timing_mean</span> <span class="main">=</span> <span class="main">{</span>elapsed <span class="main">=</span> nth <span class="entity">es</span> <span class="inner_numeral">0</span><span class="main">,</span> cpu <span class="main">=</span> nth <span class="entity">cpus</span> <span class="inner_numeral">0</span><span class="main">,</span> gc <span class="main">=</span> nth <span class="entity">gcs</span> <span class="inner_numeral">0</span><span class="main">}</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">timing_variance</span> <span class="main">=</span> <span class="main">{</span>elapsed <span class="main">=</span> nth <span class="entity">es</span> <span class="inner_numeral">1</span><span class="main">,</span> cpu <span class="main">=</span> nth <span class="entity">cpus</span> <span class="inner_numeral">1</span><span class="main">,</span> gc <span class="main">=</span> nth <span class="entity">gcs</span> <span class="inner_numeral">1</span><span class="main">}</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">timing_min</span> <span class="main">=</span> <span class="main">{</span>elapsed <span class="main">=</span> nth <span class="entity">es</span> <span class="inner_numeral">2</span><span class="main">,</span> cpu <span class="main">=</span> nth <span class="entity">cpus</span> <span class="inner_numeral">2</span><span class="main">,</span> gc <span class="main">=</span> nth <span class="entity">gcs</span> <span class="inner_numeral">2</span><span class="main">}</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">timing_max</span> <span class="main">=</span> <span class="main">{</span>elapsed <span class="main">=</span> nth <span class="entity">es</span> <span class="inner_numeral">3</span><span class="main">,</span> cpu <span class="main">=</span> nth <span class="entity">cpus</span> <span class="inner_numeral">3</span><span class="main">,</span> gc <span class="main">=</span> nth <span class="entity">gcs</span> <span class="inner_numeral">3</span><span class="main">}</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="main">[</span><span class="entity">timing_mean</span><span class="main">,</span> <span class="entity">timing_variance</span><span class="main">,</span> <span class="entity">timing_min</span><span class="main">,</span> <span class="entity">timing_max</span><span class="main">]</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">timing_report</span> <span class="entity">ts</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">is_trivial</span> <span class="entity">ts</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">is_trivial_impl</span> <span class="main">=</span> 
          map <span class="main">(</span>Timing.is_relevant_time #&gt; not<span class="main">)</span> #&gt; List.all I
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">is_trivial_es</span> <span class="main">=</span> <span class="entity">ts</span> |&gt; map <span class="main">#</span>elapsed |&gt; <span class="entity">is_trivial_impl</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">is_trivial_cpu</span> <span class="main">=</span> <span class="entity">ts</span> |&gt; map <span class="main">#</span>cpu |&gt; <span class="entity">is_trivial_impl</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">is_trivial_gc</span> <span class="main">=</span> <span class="entity">ts</span> |&gt; map <span class="main">#</span>gc |&gt; <span class="entity">is_trivial_impl</span>
      <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">is_trivial_es</span> <span class="keyword1"><span class="keyword">andalso</span></span> <span class="entity">is_trivial_cpu</span> <span class="keyword1"><span class="keyword">andalso</span></span> <span class="entity">is_trivial_gc</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_report_string</span> <span class="entity">timings</span> <span class="entity">ts</span> <span class="main">=</span> 
      <span class="inner_quoted">"\nNumber of runs : "</span> ^ Int.toString <span class="main">(</span>length <span class="entity">ts</span><span class="main">)</span> ^ <span class="inner_quoted">"\n"</span> ^
      <span class="inner_quoted">"Mean timing : "</span> ^ <span class="main">(</span>nth <span class="entity">timings</span> <span class="inner_numeral">0</span> |&gt; Timing.message<span class="main">)</span> ^ <span class="inner_quoted">"\n"</span> ^
      <span class="inner_quoted">"Timing variance : "</span> ^ <span class="main">(</span>nth <span class="entity">timings</span> <span class="inner_numeral">1</span> |&gt; Timing.message<span class="main">)</span> ^ <span class="inner_quoted">"\n"</span> ^
      <span class="inner_quoted">"Minimum time : "</span> ^ <span class="main">(</span>nth <span class="entity">timings</span> <span class="inner_numeral">2</span> |&gt; Timing.message<span class="main">)</span> ^ <span class="inner_quoted">"\n"</span> ^
      <span class="inner_quoted">"Maximum time : "</span> ^ <span class="main">(</span>nth <span class="entity">timings</span> <span class="inner_numeral">3</span> |&gt; Timing.message<span class="main">)</span> ^ <span class="inner_quoted">"\n"</span> ^
      <span class="inner_quoted">"Individual timings : \n"</span> ^
      String.concatWith <span class="inner_quoted">"\n"</span> <span class="main">(</span>map Timing.message <span class="entity">ts</span><span class="main">)</span> ^ <span class="inner_quoted">"\n"</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">is_trivial</span> <span class="entity">ts</span> 
      <span class="keyword2"><span class="keyword">then</span></span> writeln <span class="inner_quoted">"Trivial timing data: nothing to report"</span>
      <span class="keyword2"><span class="keyword">else</span></span> 
        <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">timings</span> <span class="main">=</span> <span class="entity">timing_stats</span> <span class="entity">ts</span>
        <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">mk_report_string</span> <span class="entity">timings</span> <span class="entity">ts</span> |&gt; writeln <span class="keyword2"><span class="keyword">end</span></span>

  <span class="keyword2"><span class="keyword">in</span></span> <span class="main">(</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">TIMEIT</span> <span class="entity">n</span> <span class="entity">tac</span> <span class="entity">st</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">n</span> &lt;= <span class="inner_numeral">0</span>
  <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">tac</span> <span class="entity">st</span>
  <span class="keyword2"><span class="keyword">else</span></span>
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">eval</span> <span class="entity">tac</span> <span class="entity">st</span> <span class="main">=</span>
        <span class="keyword2"><span class="keyword">let</span></span>
          <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ts</span> <span class="main">=</span> Timing.start <span class="main">(</span><span class="main">)</span>
          <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result</span> <span class="main">=</span> SINGLE <span class="entity">tac</span> <span class="entity">st</span>
          <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">te</span> <span class="main">=</span> Timing.result <span class="entity">ts</span>
        <span class="keyword2"><span class="keyword">in</span></span> <span class="main">(</span><span class="entity">result</span><span class="main">,</span> <span class="entity">te</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span> 
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">results</span> <span class="main">=</span> map <span class="main">(</span><span class="entity">eval</span> <span class="entity">tac</span><span class="main">)</span> <span class="main">(</span>replicate <span class="entity">n</span> <span class="entity">st</span><span class="main">)</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> <span class="entity">timing_report</span> <span class="main">(</span>map <span class="main">#</span><span class="inner_numeral">2</span> <span class="entity">results</span><span class="main">)</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result</span> <span class="main">=</span> <span class="entity">results</span> |&gt; hd |&gt; <span class="main">#</span><span class="inner_numeral">1</span>
    <span class="keyword2"><span class="keyword">in</span></span>
      <span class="main">(</span>
        <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">result</span> <span class="keyword2"><span class="keyword">of</span></span>
          NONE <span class="main">=&gt;</span> Seq.empty
        <span class="main">|</span> SOME <span class="entity">st'</span> <span class="main">=&gt;</span> Seq.single <span class="entity">st'</span>
      <span class="main">)</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mtimeit</span> <span class="entity">n</span> <span class="entity">m</span> <span class="entity">ctxt</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">tac</span> <span class="main">=</span> <span class="main">(</span><span class="entity">Method.evaluate</span> <span class="entity">m</span> <span class="entity">ctxt</span><span class="main">)</span> <span class="main">[</span><span class="main">]</span>
      |&gt; <span class="entity">Context_Tactic.NO_CONTEXT_TACTIC</span> <span class="entity">ctxt</span>
      |&gt; <span class="entity">TIMEIT</span> <span class="entity">n</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">SIMPLE_METHOD</span> <span class="entity">tac</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">timeit_parser</span> <span class="main">=</span> 
  <span class="entity">Method.text_closure</span> -- Scan.option <span class="main">(</span>Scan.lift <span class="main">(</span>Parse.int<span class="main">)</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">process_timeit</span> <span class="entity">args</span> <span class="entity">ctxt</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">n</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> snd <span class="entity">args</span> <span class="keyword2"><span class="keyword">of</span></span> SOME <span class="entity">n</span> <span class="main">=&gt;</span> <span class="entity">n</span> <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="inner_numeral">1</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">mtimeit</span> <span class="entity">n</span> <span class="main">(</span>fst <span class="entity">args</span><span class="main">)</span> <span class="entity">ctxt</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> Theory.setup
  <span class="main">(</span>
    <span class="entity">Method.setup</span>
      <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹timeit'›</span></span>
      <span class="main">(</span><span class="entity">timeit_parser</span> &gt;&gt; <span class="entity">process_timeit</span><span class="main">)</span>
      <span class="inner_quoted">"higher order timing method"</span>
  <span class="main">)</span><span class="main">;</span>

<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span></pre>
</div><div id="files/CS_UM.ML">
<div class="head">
<h1>File ‹CS_UM.ML›</h1>
</div>
<pre class="source"><span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">CS_UM</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>

<span class="keyword1"><span class="keyword">val</span></span> match_inst_rec <span class="main">:</span>
  <span class="main">(</span>thm <span class="main">-&gt;</span> term<span class="main">)</span> <span class="main">-&gt;</span>
  <span class="main">(</span>thm <span class="main">-&gt;</span> bool<span class="main">)</span> <span class="main">-&gt;</span>
  <span class="entity">Proof.context</span> <span class="main">-&gt;</span>
  thm <span class="main">-&gt;</span>
  term <span class="main">-&gt;</span>
  Envir.env list <span class="main">-&gt;</span>
  thm list

<span class="keyword1"><span class="keyword">val</span></span> match_inst_list <span class="main">:</span>
  <span class="main">(</span>thm <span class="main">-&gt;</span> term<span class="main">)</span> <span class="main">-&gt;</span>
  <span class="main">(</span>thm <span class="main">-&gt;</span> bool<span class="main">)</span> <span class="main">-&gt;</span>
  <span class="entity">Proof.context</span> <span class="main">-&gt;</span>
  thm <span class="main">-&gt;</span>
  term <span class="main">-&gt;</span>
  Envir.env list <span class="main">-&gt;</span>
  thm list

<span class="keyword1"><span class="keyword">val</span></span> match_inst <span class="main">:</span>
  <span class="main">(</span>
    <span class="main">(</span>thm <span class="main">-&gt;</span> term<span class="main">)</span> <span class="main">-&gt;</span>
    <span class="main">(</span>thm <span class="main">-&gt;</span> bool<span class="main">)</span> <span class="main">-&gt;</span>
    <span class="entity">Proof.context</span> <span class="main">-&gt;</span>
    thm <span class="main">-&gt;</span>
    term <span class="main">-&gt;</span>
    Envir.env list <span class="main">-&gt;</span>
    thm list
  <span class="main">)</span> <span class="main">-&gt;</span>
  <span class="main">(</span>thm <span class="main">-&gt;</span> term<span class="main">)</span> <span class="main">-&gt;</span>
  <span class="main">(</span>thm <span class="main">-&gt;</span> bool<span class="main">)</span> <span class="main">-&gt;</span>
  <span class="entity">Proof.context</span> <span class="main">-&gt;</span>
  thm <span class="main">-&gt;</span>
  term <span class="main">-&gt;</span>
  thm list

<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">CS_UM</span><span class="main">:</span> <span class="entity">CS_UM</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>

<span class="keyword2"><span class="keyword">local</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">prep_trm</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="main">(</span><span class="entity">T</span><span class="main">,</span> <span class="entity">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span><span class="main">,</span> Thm.cterm_of <span class="entity">ctxt</span> <span class="entity">t</span><span class="main">)</span><span class="main">;</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">prep_ty</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="main">(</span><span class="entity">S</span><span class="main">,</span> <span class="entity">ty</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">S</span><span class="main">)</span><span class="main">,</span> Thm.ctyp_of <span class="entity">ctxt</span> <span class="entity">ty</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">um_inst</span> <span class="entity">ctxt</span> <span class="entity">thm</span> <span class="entity">env</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">tenv</span> <span class="main">=</span> Vartab.dest <span class="main">(</span>Envir.term_env <span class="entity">env</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">tyenv</span> <span class="main">=</span> Vartab.dest <span class="main">(</span>Envir.type_env <span class="entity">env</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">inst</span> <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="entity">prep_ty</span> <span class="entity">ctxt</span><span class="main">)</span> <span class="entity">tyenv</span><span class="main">,</span> map <span class="main">(</span><span class="entity">prep_trm</span> <span class="entity">ctxt</span><span class="main">)</span> <span class="entity">tenv</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">in</span></span> 
    <span class="entity">thm</span>
    |&gt; Drule.instantiate_normalize <span class="entity">inst</span>
    |&gt; Drule.eta_contraction_rule
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">um_inst_rec</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">[</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">]</span>
  <span class="main">|</span> <span class="entity">um_inst_rec</span> <span class="entity">cond</span> <span class="entity">pat_fun</span> <span class="entity">is_trivial</span> <span class="entity">ctxt</span> <span class="entity">thm</span> <span class="entity">trm</span> <span class="main">(</span><span class="entity">env</span>::<span class="entity">envs</span><span class="main">)</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thm'</span> <span class="main">=</span> <span class="entity">um_inst</span> <span class="entity">ctxt</span> <span class="entity">thm</span> <span class="entity">env</span>
      <span class="keyword2"><span class="keyword">in</span></span> 
        <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">cond</span> <span class="entity">pat_fun</span> <span class="entity">is_trivial</span> <span class="entity">thm'</span> <span class="entity">trm</span>
        <span class="keyword2"><span class="keyword">then</span></span> single <span class="entity">thm'</span>
        <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">um_inst_rec</span> <span class="entity">cond</span> <span class="entity">pat_fun</span> <span class="entity">is_trivial</span> <span class="entity">ctxt</span> <span class="entity">thm</span> <span class="entity">trm</span> <span class="entity">envs</span>
      <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">um_inst_list</span> <span class="entity">cond</span> <span class="entity">pat_fun</span> <span class="entity">is_trivial</span> <span class="entity">ctxt</span> <span class="entity">thm</span> <span class="entity">trm</span> <span class="entity">envs</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">um_inst_rec_single</span> <span class="entity">env</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thm'</span> <span class="main">=</span> <span class="entity">um_inst</span> <span class="entity">ctxt</span> <span class="entity">thm</span> <span class="entity">env</span>
      <span class="keyword2"><span class="keyword">in</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">cond</span> <span class="entity">pat_fun</span> <span class="entity">is_trivial</span> <span class="entity">thm'</span> <span class="entity">trm</span>
        <span class="keyword2"><span class="keyword">then</span></span> single <span class="entity">thm'</span>
        <span class="keyword2"><span class="keyword">else</span></span> <span class="main">[</span><span class="main">]</span>
      <span class="keyword2"><span class="keyword">end</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thms</span> <span class="main">=</span> <span class="entity">envs</span> |&gt; map <span class="entity">um_inst_rec_single</span> |&gt; flat
  <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">thms</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">match_cond</span> <span class="entity">pat_fun</span> <span class="entity">is_trivial</span> <span class="entity">thm'</span> <span class="entity">trm</span> <span class="main">=</span>
  <span class="main">(</span><span class="entity">pat_fun</span> <span class="entity">thm'</span><span class="main">)</span> aconv <span class="entity">trm</span> <span class="keyword1"><span class="keyword">andalso</span></span> not <span class="main">(</span><span class="entity">is_trivial</span> <span class="entity">thm'</span><span class="main">)</span><span class="main">;</span>

<span class="keyword2"><span class="keyword">in</span></span>

<span class="comment1">(*
The implementation of the following functions incorporates elements of the code 
from the textbook 
"The Isabelle Cookbook: A Gentle Tutorial for Programming Isabelle/ML".
*)</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">match_inst_rec</span> <span class="main">=</span> <span class="entity">um_inst_rec</span> <span class="entity">match_cond</span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">match_inst_list</span> <span class="main">=</span> <span class="entity">um_inst_list</span> <span class="entity">match_cond</span><span class="main">;</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">match_inst</span> <span class="entity">match_inst_impl</span> <span class="entity">pat_fun</span> <span class="entity">is_trivial</span> <span class="entity">ctxt</span> <span class="entity">thm</span> <span class="entity">trm</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">univ</span> <span class="main">=</span> Unify.matchers <span class="main">(</span>Context.Proof <span class="entity">ctxt</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span><span class="entity">pat_fun</span> <span class="entity">thm</span><span class="main">,</span> <span class="entity">trm</span><span class="main">)</span><span class="main">]</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">envs</span> <span class="main">=</span> Seq.list_of <span class="entity">univ</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">match_inst_impl</span> <span class="entity">pat_fun</span> <span class="entity">is_trivial</span> <span class="entity">ctxt</span> <span class="entity">thm</span> <span class="entity">trm</span> <span class="entity">envs</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span></pre>
</div><div id="files/CS_Cond_Simp.ML">
<div class="head">
<h1>File ‹CS_Cond_Simp.ML›</h1>
</div>
<pre class="source"><span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">CS_COND_SIMP</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>
<span class="keyword1"><span class="keyword">datatype</span></span> <span class="entity">match</span> <span class="main">=</span> <span class="entity">mdefault</span> <span class="main">|</span> <span class="entity">mfull</span><span class="main">;</span>
<span class="keyword1"><span class="keyword">datatype</span></span> <span class="entity">ist</span> <span class="main">=</span> <span class="entity">ist_simple</span> <span class="main">|</span> <span class="entity">ist_compound</span><span class="main">;</span>
<span class="keyword1"><span class="keyword">datatype</span></span> <span class="entity">is_thm</span> <span class="main">=</span> <span class="entity">cs_simp</span> <span class="keyword2"><span class="keyword">of</span></span> thm list <span class="main">|</span> <span class="entity">cs_intro</span> <span class="keyword2"><span class="keyword">of</span></span> thm list<span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> concl_simp_of_simp <span class="main">:</span> thm <span class="main">-&gt;</span> thm
<span class="keyword1"><span class="keyword">val</span></span> prems_simp_of_simp <span class="main">:</span> thm <span class="main">-&gt;</span> thm
<span class="keyword1"><span class="keyword">val</span></span> remdups_tac <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic
<span class="keyword1"><span class="keyword">val</span></span> cs_concl_step_tac <span class="main">:</span>
  <span class="entity">Proof.context</span> <span class="main">-&gt;</span> bool <span class="main">-&gt;</span> <span class="entity">match</span> <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic
<span class="keyword1"><span class="keyword">val</span></span> cs_concl_step <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> bool <span class="main">-&gt;</span> <span class="entity">match</span> <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> <span class="entity">Method.method</span>
<span class="keyword1"><span class="keyword">val</span></span> cs_intro_step_tac <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> bool <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic
<span class="keyword1"><span class="keyword">val</span></span> cs_intro_search_tac <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> bool <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic
<span class="keyword1"><span class="keyword">val</span></span> cs_concl_tac <span class="main">:</span>
  <span class="entity">Proof.context</span> <span class="main">-&gt;</span> bool <span class="main">-&gt;</span> <span class="entity">match</span> <span class="main">-&gt;</span> <span class="entity">ist</span> <span class="main">-&gt;</span> <span class="entity">is_thm</span> list <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic
<span class="keyword1"><span class="keyword">val</span></span> cs_concl <span class="main">:</span>
  <span class="entity">Proof.context</span> <span class="main">-&gt;</span> int <span class="main">-&gt;</span> bool <span class="main">-&gt;</span> <span class="entity">match</span> <span class="main">-&gt;</span> <span class="entity">ist</span> <span class="main">-&gt;</span> <span class="entity">is_thm</span> list <span class="main">-&gt;</span> <span class="entity">Method.method</span>
<span class="keyword1"><span class="keyword">val</span></span> cs_prems_atom_step_tac <span class="main">:</span> 
  <span class="entity">Proof.context</span> <span class="main">-&gt;</span> <span class="entity">match</span> <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic
<span class="keyword1"><span class="keyword">val</span></span> cs_prems_atom_step <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> <span class="entity">match</span> <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> <span class="entity">Method.method</span>
<span class="keyword1"><span class="keyword">val</span></span> cs_prems_step_tac <span class="main">:</span>
  <span class="entity">Proof.context</span> <span class="main">-&gt;</span>
  bool <span class="main">-&gt;</span>
  <span class="entity">match</span> <span class="main">-&gt;</span>
  <span class="entity">ist</span> <span class="main">-&gt;</span>
  thm list <span class="main">-&gt;</span>
  <span class="entity">is_thm</span> list <span class="main">-&gt;</span>
  int <span class="main">-&gt;</span>
  thm <span class="main">-&gt;</span>
  thm Seq.seq
<span class="keyword1"><span class="keyword">val</span></span> cs_prems_step<span class="main">:</span> 
  <span class="entity">Proof.context</span> <span class="main">-&gt;</span> bool <span class="main">-&gt;</span> <span class="entity">match</span> <span class="main">-&gt;</span> <span class="entity">ist</span> <span class="main">-&gt;</span> <span class="entity">is_thm</span> list <span class="main">-&gt;</span> <span class="entity">Method.method</span>
<span class="keyword1"><span class="keyword">val</span></span> cs_prems_tac <span class="main">:</span>
  <span class="entity">Proof.context</span> <span class="main">-&gt;</span> bool <span class="main">-&gt;</span> <span class="entity">match</span> <span class="main">-&gt;</span> <span class="entity">ist</span> <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> <span class="entity">is_thm</span> list <span class="main">-&gt;</span> tactic
<span class="keyword1"><span class="keyword">val</span></span> cs_prems<span class="main">:</span> 
  <span class="entity">Proof.context</span> <span class="main">-&gt;</span> int <span class="main">-&gt;</span> bool <span class="main">-&gt;</span> <span class="entity">match</span> <span class="main">-&gt;</span> <span class="entity">ist</span> <span class="main">-&gt;</span> <span class="entity">is_thm</span> list <span class="main">-&gt;</span> <span class="entity">Method.method</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>


<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">CS_Cond_Simp</span><span class="main">:</span> <span class="entity">CS_COND_SIMP</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>



<span class="comment1">(*** General purpose utilities ***)</span>


<span class="comment1">(** General purpose messages **)</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">msg_simp_rules</span> <span class="main">=</span> <span class="inner_quoted">"cs: invalid simplification rules"</span>


<span class="comment1">(** Synthesis of introduction rules from conditional rewrite rules **)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">concl_simp_of_simp</span> <span class="entity">thm</span> <span class="main">=</span> <span class="entity">thm</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> forw_subst<span class="antiquote">}</span></span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">map_concl_simp_of_simp</span> <span class="entity">thms</span> <span class="main">=</span> map <span class="entity">concl_simp_of_simp</span> <span class="entity">thms</span>
  <span class="keyword3"><span class="keyword">handle</span></span> THM <span class="main">(</span><span class="inner_quoted">"RSN: no unifiers"</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span>warning <span class="entity">msg_simp_rules</span><span class="main">;</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">prems_simp_of_simp</span> <span class="entity">thm</span> <span class="main">=</span> <span class="main">(</span><span class="entity">thm</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> subst<span class="antiquote">}</span></span></span><span class="main">)</span>
  |&gt; rotate_prems <span class="inner_numeral">~1</span>
  |&gt; Tactic.make_elim<span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">map_prems_simp_of_simp</span> <span class="entity">thms</span> <span class="main">=</span> map <span class="entity">prems_simp_of_simp</span> <span class="entity">thms</span>
  <span class="keyword3"><span class="keyword">handle</span></span> THM <span class="main">(</span><span class="inner_quoted">"RSN: no unifiers"</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span>warning <span class="entity">msg_simp_rules</span><span class="main">;</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>


<span class="comment1">(** Removal of duplicate premises **)</span>

<span class="comment1">(*Copied (with amendments) from the file ~/Tools/intuitionistic.ML in the 
main distribution of Isabelle2020.*)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">remdups_tac</span> <span class="entity">ctxt</span> <span class="main">=</span> SUBGOAL 
  <span class="main">(</span>
    <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">g</span><span class="main">,</span> <span class="entity">i</span><span class="main">)</span> <span class="main">=&gt;</span>
    <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prems</span> <span class="main">=</span> Logic.strip_assums_hyp <span class="entity">g</span> 
    <span class="keyword2"><span class="keyword">in</span></span>
      REPEAT_DETERM_N <span class="main">(</span>length <span class="entity">prems</span> - length <span class="main">(</span>distinct <span class="keyword1"><span class="keyword">op</span></span> aconv <span class="entity">prems</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>ematch_tac <span class="entity">ctxt</span> <span class="main">[</span>Drule.remdups_rl<span class="main">]</span> <span class="entity">i</span> THEN Tactic.eq_assume_tac <span class="entity">i</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">end</span></span>
  <span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> Theory.setup
  <span class="main">(</span>
    <span class="entity">Method.setup</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹remdups›</span></span> 
      <span class="main">(</span>Scan.succeed <span class="main">(</span><span class="entity">SIMPLE_METHOD'</span> o <span class="entity">remdups_tac</span><span class="main">)</span><span class="main">)</span>
      <span class="inner_quoted">"removal of duplicate premises"</span>
  <span class="main">)</span><span class="main">;</span>



<span class="comment1">(*** Flags ***)</span>


<span class="comment1">(** Match function selector **)</span>

<span class="keyword1"><span class="keyword">datatype</span></span> <span class="entity">match</span> <span class="main">=</span> <span class="entity">mdefault</span> <span class="main">|</span> <span class="entity">mfull</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">fun_of_match</span> <span class="entity">mdefault</span> <span class="main">=</span> <span class="entity">CS_UM.match_inst_rec</span>
  <span class="main">|</span> <span class="entity">fun_of_match</span> <span class="entity">mfull</span> <span class="main">=</span> <span class="entity">CS_UM.match_inst_list</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">match_of_cs_match</span> <span class="inner_quoted">"cs_default"</span> <span class="main">=</span> <span class="entity">mdefault</span>
  <span class="main">|</span> <span class="entity">match_of_cs_match</span> <span class="inner_quoted">"cs_full"</span> <span class="main">=</span> <span class="entity">mfull</span>
  <span class="main">|</span> <span class="entity">match_of_cs_match</span> <span class="main">_</span> <span class="main">=</span> error <span class="inner_quoted">"match_of_cs_match: invalid keyword"</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">cs_match_parser</span> <span class="main">=</span> Scan.lift <span class="main">(</span>Scan.optional <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span>‹<span class="keyword2">cs_full</span>›</span></span><span class="main">)</span> <span class="inner_quoted">"cs_default"</span><span class="main">)</span><span class="main">;</span>


<span class="comment1">(** Introduction step selector **)</span>

<span class="keyword1"><span class="keyword">datatype</span></span> <span class="entity">ist</span> <span class="main">=</span> <span class="entity">ist_simple</span> <span class="main">|</span> <span class="entity">ist_compound</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">ist_of_cs_ist</span> <span class="inner_quoted">"cs_ist_simple"</span> <span class="main">=</span> <span class="entity">ist_simple</span>
  <span class="main">|</span> <span class="entity">ist_of_cs_ist</span> <span class="inner_quoted">"cs_ist_compound"</span> <span class="main">=</span> <span class="entity">ist_compound</span>
  <span class="main">|</span> <span class="entity">ist_of_cs_ist</span> <span class="main">_</span> <span class="main">=</span> error <span class="inner_quoted">"ist_of_cs_ist: invalid keyword"</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">cs_ist_parser</span> <span class="main">=</span>
  Scan.lift <span class="main">(</span>Scan.optional <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span>‹<span class="keyword2">cs_ist_simple</span>›</span></span><span class="main">)</span> <span class="inner_quoted">"cs_ist_compound"</span><span class="main">)</span><span class="main">;</span>


<span class="comment1">(** Printed output **)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">print_state</span> <span class="entity">ctxt</span> <span class="entity">c</span> <span class="entity">st</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">c_st</span> <span class="main">=</span> <span class="entity">st</span>
      |&gt; Thm.prems_of
      |&gt; hd
      |&gt; Logic.strip_imp_concl
      |&gt; Syntax.string_of_term <span class="entity">ctxt</span>
  <span class="keyword2"><span class="keyword">in</span></span> writeln <span class="main">(</span><span class="entity">c</span> ^ <span class="entity">c_st</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>



<span class="comment1">(*** Auxiliary tactics and tacticals ***)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">ONLY_IF_NULL</span> <span class="entity">p</span> <span class="entity">f</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> null <span class="entity">p</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">f</span> <span class="keyword2"><span class="keyword">else</span></span> no_tac<span class="main">;</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">only_if_not_null</span> <span class="entity">x</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> null <span class="entity">x</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="keyword3"><span class="keyword">raise</span></span> Empty <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">x</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">trivial_solved_tac</span> <span class="entity">ctxt</span> <span class="entity">i</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">assm_tac</span> <span class="main">=</span> <span class="entity">Method.assm_tac</span> <span class="entity">ctxt</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">assm_tac</span> <span class="entity">i</span>
    APPEND SOLVED' <span class="main">(</span>resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> HOL.sym<span class="antiquote">}</span></span></span> THEN' <span class="entity">assm_tac</span><span class="main">)</span> <span class="entity">i</span>
    APPEND SOLVED' <span class="main">(</span>resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> HOL.not_sym<span class="antiquote">}</span></span></span> THEN' <span class="entity">assm_tac</span><span class="main">)</span> <span class="entity">i</span>
    APPEND SOLVED' <span class="main">(</span>resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> HOL.refl<span class="antiquote">}</span></span></span><span class="main">)</span> <span class="entity">i</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>



<span class="comment1">(*** Conditional simplification of a conclusion ***)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">is_trivial_intro</span> <span class="entity">thm</span> <span class="main">=</span> <span class="entity">thm</span>
  |&gt; Thm.prems_of
  |&gt; find_index <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">t</span> <span class="main">=&gt;</span> <span class="entity">t</span> aconv <span class="main">(</span>Thm.concl_of <span class="entity">thm</span><span class="main">)</span><span class="main">)</span>
  |&gt; <span class="main">(</span>curry <span class="keyword1"><span class="keyword">op</span></span>&lt;= <span class="inner_numeral">0</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">concl_match_inst</span> <span class="entity">m</span> <span class="main">=</span>
  <span class="entity">CS_UM.match_inst</span> <span class="main">(</span><span class="entity">fun_of_match</span> <span class="entity">m</span><span class="main">)</span> Thm.concl_of <span class="entity">is_trivial_intro</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">match_concl_tac</span> <span class="entity">ctxt</span> <span class="entity">m</span> <span class="entity">rwr</span> <span class="main">=</span>
  <span class="entity">Subgoal.FOCUS</span>
    <span class="main">(</span>
      <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt'</span><span class="main">,</span> concl <span class="main">=</span> <span class="entity">concl_ct</span><span class="main">,</span> params <span class="main">=</span> <span class="entity">params</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=&gt;</span>
        <span class="entity">ONLY_IF_NULL</span> <span class="entity">params</span>
          <span class="main">(</span>
            HEADGOAL
              <span class="main">(</span>
                <span class="entity">Classical.rule_tac</span>
                  <span class="entity">ctxt'</span>
                  <span class="main">(</span>
                    <span class="entity">concl_ct</span>
                    |&gt; Thm.term_of
                    |&gt; Logic.strip_imp_concl
                    |&gt; <span class="entity">concl_match_inst</span> <span class="entity">m</span> <span class="entity">ctxt'</span> <span class="entity">rwr</span>
                    |&gt; <span class="entity">only_if_not_null</span>
                  <span class="main">)</span>
                  <span class="main">[</span><span class="main">]</span>
              <span class="main">)</span>
              <span class="keyword3"><span class="keyword">handle</span></span>
                  Empty <span class="main">=&gt;</span> no_tac
                <span class="main">|</span> Pattern.MATCH <span class="main">=&gt;</span> no_tac
          <span class="main">)</span>
    <span class="main">)</span>
    <span class="entity">ctxt</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_concl_step_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="entity">rwr_thms</span> <span class="entity">i</span> <span class="entity">st</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">verbose</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">print_state</span> <span class="entity">ctxt</span> <span class="inner_quoted">"simp: "</span> <span class="entity">st</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">tacs</span> <span class="main">=</span> map <span class="main">(</span><span class="entity">match_concl_tac</span> <span class="entity">ctxt</span> <span class="entity">m</span><span class="main">)</span> <span class="entity">rwr_thms</span>
  <span class="keyword2"><span class="keyword">in</span></span> 
    <span class="entity">Subgoal.FOCUS_PARAMS</span>
      <span class="main">(</span>
        <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt'</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=&gt;</span>
          <span class="main">(</span>
            <span class="entity">trivial_solved_tac</span> <span class="entity">ctxt'</span> <span class="inner_numeral">1</span>
            APPEND
              <span class="main">(</span>
                CONVERSION Thm.eta_conversion <span class="inner_numeral">1</span>
                THEN <span class="entity">FIRST_APPEND'</span> <span class="entity">tacs</span> <span class="inner_numeral">1</span>
                THEN TRY <span class="main">(</span><span class="entity">remdups_tac</span> <span class="entity">ctxt'</span> <span class="inner_numeral">1</span><span class="main">)</span>
              <span class="main">)</span>
          <span class="main">)</span>
      <span class="main">)</span>
      <span class="entity">ctxt</span>
      <span class="entity">i</span>
      <span class="entity">st</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_concl_step</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="entity">rwr_thms</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">rwr_thms'</span> <span class="main">=</span> <span class="entity">map_concl_simp_of_simp</span> <span class="entity">rwr_thms</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">SIMPLE_METHOD'</span> <span class="main">(</span><span class="entity">cs_concl_step_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="entity">rwr_thms'</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> Theory.setup
  <span class="main">(</span>
    <span class="entity">Method.setup</span>
      <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹cs_concl_step›</span></span>
      <span class="main">(</span>
        <span class="entity">cs_match_parser</span> -- <span class="entity">Attrib.thms</span> &gt;&gt;
          <span class="main">(</span>
            <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">csm</span><span class="main">,</span> <span class="entity">thms</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span>
              <span class="entity">cs_concl_step</span> <span class="entity">ctxt</span> false <span class="main">(</span><span class="entity">match_of_cs_match</span> <span class="entity">csm</span><span class="main">)</span> <span class="main">(</span>rev <span class="entity">thms</span><span class="main">)</span>
          <span class="main">)</span>
      <span class="main">)</span>
      <span class="inner_quoted">"conditional simplification of a conclusion"</span>
  <span class="main">)</span><span class="main">;</span>



<span class="comment1">(*** Introduction for conditional simplification ***)</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">default_intro_thms</span> <span class="main">=</span> <span class="main">[</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> TrueI<span class="antiquote">}</span></span></span><span class="main">]</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">is_sc_match</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">sc_rule</span><span class="main">,</span> <span class="entity">t</span><span class="main">)</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> 
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">seq_null</span> <span class="entity">seq</span> <span class="main">=</span> is_none <span class="main">(</span>Seq.pull <span class="entity">seq</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">sc_match</span> <span class="main">=</span> Thm.concl_of <span class="entity">sc_rule</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="main">(</span><span class="entity">sc_match</span><span class="main">,</span> <span class="entity">t</span><span class="main">)</span>
    |&gt; single
    |&gt; Unify.matchers <span class="main">(</span>Context.Proof <span class="entity">ctxt</span><span class="main">)</span> 
    |&gt; <span class="entity">seq_null</span>
    |&gt; not
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_intro_step_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">all_rwrs</span> <span class="entity">i</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">all_rwrs'</span> <span class="main">=</span> <span class="entity">all_rwrs</span> @ <span class="entity">default_intro_thms</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_hd_goal_concl_t</span> <span class="entity">st</span> <span class="main">=</span> <span class="entity">st</span>
      |&gt; Thm.prems_of
      |&gt; hd
      |&gt; Logic.strip_imp_concl
      <span class="keyword3"><span class="keyword">handle</span></span>
          Empty <span class="main">=&gt;</span> Thm.full_prop_of <span class="entity">st</span>
        <span class="main">|</span> Pattern.MATCH <span class="main">=&gt;</span> Thm.full_prop_of <span class="entity">st</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">side_cond_impl_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">all_rwrs</span> <span class="entity">i</span> <span class="entity">st</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">verbose</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">print_state</span> <span class="entity">ctxt</span> <span class="inner_quoted">"intro: "</span> <span class="entity">st</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span><span class="main">)</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">sts</span> <span class="main">=</span> <span class="entity">Method.assm_tac</span> <span class="entity">ctxt</span> <span class="entity">i</span> <span class="entity">st</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">sts</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> Seq.pull <span class="entity">sts</span> <span class="keyword2"><span class="keyword">of</span></span>
            SOME <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">sts</span>
          <span class="main">|</span> NONE <span class="main">=&gt;</span>
              <span class="keyword2"><span class="keyword">let</span></span>
                <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">rwrs</span> <span class="main">=</span> filter
                  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">rwr</span> <span class="main">=&gt;</span> <span class="entity">is_sc_match</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">rwr</span><span class="main">,</span> <span class="entity">get_hd_goal_concl_t</span> <span class="entity">st</span><span class="main">)</span><span class="main">)</span> 
                  <span class="entity">all_rwrs</span>
                <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">scrs</span> <span class="main">=</span> <span class="entity">rwrs</span>
                  |&gt; map
                    <span class="main">(</span>
                      <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">rwr</span> <span class="main">=&gt;</span> 
                        <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">thm</span> <span class="main">=&gt;</span> <span class="entity">thm</span> |&gt; single |&gt; match_tac <span class="entity">ctxt</span><span class="main">)</span> <span class="entity">rwr</span> <span class="entity">i</span> <span class="entity">st</span>
                    <span class="main">)</span>
              <span class="keyword2"><span class="keyword">in</span></span> fold Seq.append <span class="entity">scrs</span> Seq.empty <span class="keyword2"><span class="keyword">end</span></span>
      <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">sts</span> <span class="keyword2"><span class="keyword">end</span></span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">Subgoal.FOCUS_PARAMS</span>
      <span class="main">(</span>
        <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt'</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=&gt;</span>
          CONVERSION Thm.eta_conversion <span class="inner_numeral">1</span>
          THEN <span class="entity">side_cond_impl_tac</span> <span class="entity">ctxt'</span> <span class="entity">verbose</span> <span class="entity">all_rwrs'</span> <span class="inner_numeral">1</span> 
          THEN TRY <span class="main">(</span><span class="entity">remdups_tac</span> <span class="entity">ctxt'</span> <span class="inner_numeral">1</span><span class="main">)</span>
      <span class="main">)</span>
      <span class="entity">ctxt</span>
      <span class="entity">i</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_intro_step</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">thms</span> <span class="main">=</span> 
  <span class="entity">SIMPLE_METHOD'</span> <span class="main">(</span><span class="entity">cs_intro_step_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">thms</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> Theory.setup
  <span class="main">(</span>
    <span class="entity">Method.setup</span>
      <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹cs_intro_step›</span></span>
      <span class="main">(</span><span class="entity">Attrib.thms</span> &gt;&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">thms</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="entity">cs_intro_step</span> <span class="entity">ctxt</span> false <span class="entity">thms</span><span class="main">)</span><span class="main">)</span>
      <span class="inner_quoted">"apply side condition introduction rules once"</span>
  <span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_intro_search_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">all_rwrs</span> <span class="entity">i</span> <span class="main">=</span>
  DEPTH_SOLVE_1 <span class="main">(</span><span class="entity">cs_intro_step_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">all_rwrs</span> <span class="entity">i</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_intro_search</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">thms</span> <span class="main">=</span> 
  <span class="entity">SIMPLE_METHOD'</span> <span class="main">(</span><span class="entity">cs_intro_search_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">thms</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> Theory.setup
  <span class="main">(</span>
    <span class="entity">Method.setup</span>
      <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹cs_intro_search›</span></span>
      <span class="main">(</span><span class="entity">Attrib.thms</span> &gt;&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">thms</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="entity">cs_intro_search</span> <span class="entity">ctxt</span> false <span class="entity">thms</span><span class="main">)</span><span class="main">)</span>
      <span class="inner_quoted">"repeated application of the side condition introduction rules"</span>
  <span class="main">)</span><span class="main">;</span>



<span class="comment1">(*** is_thm : disjoint set of rewrite rules and introduction rules ***)</span>

<span class="keyword1"><span class="keyword">datatype</span></span> <span class="entity">is_thm</span> <span class="main">=</span> <span class="entity">cs_simp</span> <span class="keyword2"><span class="keyword">of</span></span> thm list <span class="main">|</span> <span class="entity">cs_intro</span> <span class="keyword2"><span class="keyword">of</span></span> thm list<span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">is_simp_thms</span> <span class="main">(</span><span class="entity">cs_simp</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span> true
  <span class="main">|</span> <span class="entity">is_simp_thms</span> <span class="main">(</span><span class="entity">cs_intro</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span> false<span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">apply_is_thm</span> <span class="entity">f</span> <span class="main">(</span><span class="entity">cs_simp</span> <span class="entity">thms</span><span class="main">)</span> <span class="main">=</span> <span class="entity">cs_simp</span> <span class="main">(</span><span class="entity">f</span> <span class="entity">thms</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">apply_is_thm</span> <span class="entity">f</span> <span class="main">(</span><span class="entity">cs_intro</span> <span class="entity">thms</span><span class="main">)</span> <span class="main">=</span> <span class="entity">cs_intro</span> <span class="main">(</span><span class="entity">f</span> <span class="entity">thms</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_thms_of_is_thms</span> <span class="main">(</span><span class="entity">cs_simp</span> <span class="entity">thms</span><span class="main">)</span> <span class="main">=</span> <span class="entity">thms</span>
  <span class="main">|</span> <span class="entity">get_thms_of_is_thms</span> <span class="main">(</span><span class="entity">cs_intro</span> <span class="entity">thms</span><span class="main">)</span> <span class="main">=</span> <span class="entity">thms</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">process_cs_simps</span> <span class="main">_</span> <span class="main">[</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">]</span>
  <span class="main">|</span> <span class="entity">process_cs_simps</span> <span class="entity">f</span> <span class="main">(</span><span class="entity">cs_simp</span> <span class="entity">thms</span>::<span class="entity">is_thms</span><span class="main">)</span> <span class="main">=</span>
      <span class="entity">cs_simp</span> <span class="main">(</span><span class="entity">f</span> <span class="entity">thms</span><span class="main">)</span> :: <span class="entity">process_cs_simps</span> <span class="entity">f</span> <span class="entity">is_thms</span>
  <span class="main">|</span> <span class="entity">process_cs_simps</span> <span class="entity">f</span> <span class="main">(</span><span class="entity">cs_intro</span> <span class="entity">thms</span>::<span class="entity">is_thms</span><span class="main">)</span> <span class="main">=</span>
      <span class="entity">cs_intro</span> <span class="entity">thms</span> :: <span class="entity">process_cs_simps</span> <span class="entity">f</span> <span class="entity">is_thms</span><span class="main">;</span>



<span class="comment1">(*** Combined simplification and introduction solver ***)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_concl_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="entity">ist</span> <span class="entity">is_thms</span> <span class="entity">i</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">concl_step_impl_compound_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="main">(</span><span class="entity">cs_simp</span> <span class="entity">thms</span><span class="main">)</span> <span class="main">=</span>
        <span class="entity">cs_concl_step_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="main">(</span>rev <span class="entity">thms</span><span class="main">)</span>
      <span class="main">|</span> <span class="entity">concl_step_impl_compound_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="main">_</span> <span class="main">(</span><span class="entity">cs_intro</span> <span class="entity">thms</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span>
          <span class="entity">cs_intro_search_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">thms</span> 
          APPEND' <span class="entity">cs_intro_step_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">thms</span>
        <span class="main">)</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">concl_step_impl_simple_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="main">(</span><span class="entity">cs_simp</span> <span class="entity">thms</span><span class="main">)</span> <span class="main">=</span>
        <span class="entity">cs_concl_step_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="main">(</span>rev <span class="entity">thms</span><span class="main">)</span>
      <span class="main">|</span> <span class="entity">concl_step_impl_simple_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="main">_</span> <span class="main">(</span><span class="entity">cs_intro</span> <span class="entity">thms</span><span class="main">)</span> <span class="main">=</span>
        <span class="entity">cs_intro_step_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">thms</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">conc_step_impl_tac</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">ist</span> <span class="keyword2"><span class="keyword">of</span></span>
        <span class="entity">ist_simple</span> <span class="main">=&gt;</span> <span class="entity">concl_step_impl_simple_tac</span>
      <span class="main">|</span> <span class="entity">ist_compound</span> <span class="main">=&gt;</span> <span class="entity">concl_step_impl_compound_tac</span>
  <span class="keyword2"><span class="keyword">in</span></span> 
    <span class="main">(</span><span class="entity">FIRST_APPEND'</span> <span class="main">(</span>map <span class="main">(</span><span class="entity">conc_step_impl_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span><span class="main">)</span> <span class="entity">is_thms</span><span class="main">)</span> <span class="entity">i</span><span class="main">)</span>
    |&gt; DEPTH_SOLVE_1
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_concl</span> <span class="entity">ctxt</span> <span class="entity">timing</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="entity">ist</span> <span class="entity">is_thms</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> 
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">is_thms'</span> <span class="main">=</span> 
      <span class="entity">process_cs_simps</span> <span class="entity">map_concl_simp_of_simp</span> <span class="entity">is_thms</span> @ <span class="main">[</span><span class="entity">cs_simp</span> <span class="main">[</span><span class="main">]</span><span class="main">]</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">tac</span> <span class="entity">i</span> <span class="entity">st</span> <span class="main">=</span> 
      <span class="entity">CS_TimeIt.TIMEIT</span> <span class="entity">timing</span> <span class="main">(</span><span class="entity">cs_concl_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="entity">ist</span> <span class="entity">is_thms'</span> <span class="entity">i</span><span class="main">)</span> <span class="entity">st</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">SIMPLE_METHOD'</span> <span class="entity">tac</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_simp_intro_thms_parser</span> <span class="entity">kw</span> <span class="main">=</span>
  Scan.lift <span class="main">(</span><span class="entity">kw</span> -- Args.colon<span class="main">)</span> |-- <span class="entity">Attrib.thms</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">cs_simp_intro_parser</span> <span class="main">=</span>
  <span class="entity">cs_simp_intro_thms_parser</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span>‹<span class="keyword2">cs_simp</span>›</span></span> &gt;&gt; <span class="entity">cs_simp</span> ||
  <span class="entity">cs_simp_intro_thms_parser</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span>‹<span class="keyword2">cs_intro</span>›</span></span> &gt;&gt; <span class="entity">cs_intro</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> Theory.setup
  <span class="main">(</span>
    <span class="entity">Method.setup</span>
      <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹cs_concl›</span></span>
      <span class="main">(</span>
        Scan.option <span class="main">(</span>Scan.lift <span class="main">(</span>Parse.int<span class="main">)</span><span class="main">)</span> --
        Scan.option <span class="main">(</span>Scan.lift Args.bang<span class="main">)</span> --
        <span class="entity">cs_match_parser</span> --
        <span class="entity">cs_ist_parser</span> --
        Scan.repeat <span class="entity">cs_simp_intro_parser</span> &gt;&gt;
        <span class="main">(</span>
          <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="entity">timing</span><span class="main">,</span> <span class="entity">verbose</span><span class="main">)</span><span class="main">,</span> <span class="entity">csm</span><span class="main">)</span><span class="main">,</span> <span class="entity">ist</span><span class="main">)</span><span class="main">,</span> <span class="entity">is_thms</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span>
            <span class="entity">cs_concl</span>
              <span class="entity">ctxt</span>
              <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">timing</span> <span class="keyword2"><span class="keyword">of</span></span> SOME <span class="entity">n</span> <span class="main">=&gt;</span> <span class="entity">n</span> <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="inner_numeral">0</span><span class="main">)</span>
              <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">verbose</span> <span class="keyword2"><span class="keyword">of</span></span> SOME <span class="main">_</span> <span class="main">=&gt;</span> true <span class="main">|</span> NONE <span class="main">=&gt;</span> false<span class="main">)</span>
              <span class="main">(</span><span class="entity">match_of_cs_match</span> <span class="entity">csm</span><span class="main">)</span>
              <span class="main">(</span><span class="entity">ist_of_cs_ist</span> <span class="entity">ist</span><span class="main">)</span>
              <span class="entity">is_thms</span>
        <span class="main">)</span>
      <span class="main">)</span>
      <span class="inner_quoted">"combined simplification and introduction solver"</span>
  <span class="main">)</span><span class="main">;</span>



<span class="comment1">(*** Conditional simplification of premises ***)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">is_trivial_elim</span> <span class="entity">thm</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prems</span> <span class="main">=</span> Thm.prems_of <span class="entity">thm</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">lhs_t</span> <span class="main">=</span> hd <span class="entity">prems</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">rhs_t</span> <span class="main">=</span> <span class="entity">prems</span> |&gt; tl |&gt; rev |&gt; hd |&gt; Logic.dest_implies |&gt; <span class="main">#</span><span class="inner_numeral">1</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">lhs_t</span> aconv <span class="entity">rhs_t</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">elim_pat_fun</span> <span class="main">=</span> Thm.prems_of #&gt; hd<span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">elim_matcher_inst</span> <span class="entity">m</span> <span class="main">=</span>
  <span class="entity">CS_UM.match_inst</span> <span class="main">(</span><span class="entity">fun_of_match</span> <span class="entity">m</span><span class="main">)</span> <span class="entity">elim_pat_fun</span> <span class="entity">is_trivial_elim</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">match_prems_tac</span> <span class="entity">ctxt</span> <span class="entity">m</span> <span class="entity">rwr</span> <span class="main">=</span>
  <span class="entity">Subgoal.FOCUS_PARAMS_FIXED</span>
    <span class="main">(</span>
      <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt'</span><span class="main">,</span> concl <span class="main">=</span> <span class="entity">concl</span><span class="main">,</span> params <span class="main">=</span> <span class="entity">params</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=&gt;</span>
        <span class="entity">ONLY_IF_NULL</span> <span class="entity">params</span>
          <span class="main">(</span>
            <span class="keyword2"><span class="keyword">let</span></span>
              <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">initialize</span> <span class="entity">ctxt'</span> <span class="entity">concl</span> <span class="main">=</span>
                <span class="keyword2"><span class="keyword">let</span></span>
                  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prems</span> <span class="main">=</span> <span class="entity">concl</span> |&gt; Thm.term_of |&gt; Logic.strip_imp_prems
                  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thms</span> <span class="main">=</span> <span class="entity">prems</span> 
                    |&gt; hd 
                    |&gt; <span class="entity">elim_matcher_inst</span> <span class="entity">m</span> <span class="entity">ctxt'</span> <span class="entity">rwr</span> 
                    |&gt; <span class="entity">only_if_not_null</span>
                  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">insts</span> <span class="main">=</span> Thm.match 
                    <span class="main">(</span>
                      <span class="main">(</span><span class="main">(</span><span class="inner_quoted">"V"</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">)</span><span class="main">,</span> <span class="antiquoted"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span><span class="quoted">‹prop›</span></span><span class="main">)</span> |&gt; Var |&gt; Thm.cterm_of <span class="entity">ctxt'</span><span class="main">,</span>
                      Thm.cterm_of <span class="entity">ctxt'</span> <span class="main">(</span>nth <span class="entity">prems</span> <span class="inner_numeral">0</span><span class="main">)</span>
                    <span class="main">)</span>
                  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">remdups</span> <span class="main">=</span> Drule.instantiate_normalize <span class="entity">insts</span> thin_rl
                <span class="keyword2"><span class="keyword">in</span></span> <span class="main">(</span><span class="entity">remdups</span><span class="main">,</span> <span class="entity">thms</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span>
              <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">params</span> <span class="main">=</span> SOME <span class="main">(</span><span class="entity">initialize</span> <span class="entity">ctxt'</span> <span class="entity">concl</span><span class="main">)</span>
                <span class="keyword3"><span class="keyword">handle</span></span> 
                    Empty <span class="main">=&gt;</span> NONE
                  <span class="main">|</span> Pattern.MATCH <span class="main">=&gt;</span> NONE
            <span class="keyword2"><span class="keyword">in</span></span>
              <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">params</span> <span class="keyword2"><span class="keyword">of</span></span>
                  NONE <span class="main">=&gt;</span> no_tac
                <span class="main">|</span> SOME <span class="main">(</span><span class="entity">remdups</span><span class="main">,</span> <span class="entity">thms</span><span class="main">)</span> <span class="main">=&gt;</span>
                    HEADGOAL
                      <span class="main">(</span>
                        <span class="entity">Subgoal.FOCUS</span>
                          <span class="main">(</span>
                            <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt''</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=&gt;</span>
                              HEADGOAL <span class="main">(</span><span class="entity">Classical.rule_tac</span> <span class="entity">ctxt''</span> <span class="entity">thms</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span>
                              <span class="keyword3"><span class="keyword">handle</span></span> Empty <span class="main">=&gt;</span> no_tac
                          <span class="main">)</span>
                        <span class="entity">ctxt'</span>
                      <span class="main">)</span>
                THEN <span class="main">(</span>PRIMITIVE <span class="main">(</span>Thm.permute_prems <span class="inner_numeral">0</span> <span class="inner_numeral">~1</span><span class="main">)</span><span class="main">)</span>
                THEN HEADGOAL <span class="main">(</span>eresolve_tac <span class="entity">ctxt'</span> <span class="main">(</span>single <span class="entity">remdups</span><span class="main">)</span><span class="main">)</span>
                THEN HEADGOAL <span class="main">(</span>rotate_tac <span class="inner_numeral">~1</span><span class="main">)</span>
                THEN HEADGOAL defer_tac
            <span class="keyword2"><span class="keyword">end</span></span>
          <span class="main">)</span>
    <span class="main">)</span>
    <span class="entity">ctxt</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_prems_atom_step_tac</span> <span class="entity">ctxt</span> <span class="entity">m</span> <span class="entity">rwr_thms</span> <span class="entity">i</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">tacs</span> <span class="main">=</span> map <span class="main">(</span><span class="entity">match_prems_tac</span> <span class="entity">ctxt</span> <span class="entity">m</span><span class="main">)</span> <span class="entity">rwr_thms</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">Subgoal.FOCUS_PARAMS</span>
      <span class="main">(</span>
        <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt'</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=&gt;</span>
          <span class="entity">trivial_solved_tac</span> <span class="entity">ctxt'</span> <span class="inner_numeral">1</span>
          APPEND
            <span class="main">(</span>
              CONVERSION Thm.eta_conversion <span class="inner_numeral">1</span>
              THEN <span class="entity">FIRST_APPEND'</span> <span class="entity">tacs</span> <span class="inner_numeral">1</span>
              THEN TRY <span class="main">(</span><span class="entity">remdups_tac</span> <span class="entity">ctxt'</span> <span class="inner_numeral">1</span><span class="main">)</span>
            <span class="main">)</span>
      <span class="main">)</span>
      <span class="entity">ctxt</span>
      <span class="entity">i</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_prems_atom_step</span> <span class="entity">ctxt</span> <span class="entity">m</span> <span class="entity">rwr_thms</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">rwr_thms'</span> <span class="main">=</span> <span class="entity">map_prems_simp_of_simp</span> <span class="entity">rwr_thms</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">SIMPLE_METHOD'</span> <span class="main">(</span><span class="entity">cs_prems_atom_step_tac</span> <span class="entity">ctxt</span> <span class="entity">m</span> <span class="entity">rwr_thms'</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> Theory.setup
  <span class="main">(</span>
    <span class="entity">Method.setup</span>
      <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹cs_prems_atom_step›</span></span>
      <span class="main">(</span>
        <span class="entity">cs_match_parser</span> -- <span class="entity">Attrib.thms</span> &gt;&gt;
          <span class="main">(</span>
            <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">csm</span><span class="main">,</span> <span class="entity">thms</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span>
              <span class="entity">cs_prems_atom_step</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">match_of_cs_match</span> <span class="entity">csm</span><span class="main">)</span> <span class="main">(</span>rev <span class="entity">thms</span><span class="main">)</span>
          <span class="main">)</span>
      <span class="main">)</span>
      <span class="inner_quoted">"conditional simplification of premises: single atomic step"</span>
  <span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_prems_step_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="entity">ist</span> <span class="entity">prem_rwr_thms</span> <span class="entity">concl_is_thms</span> <span class="entity">i</span> <span class="entity">st</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_prems_intro_step</span> <span class="entity">i</span> <span class="entity">st</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">sgn</span> <span class="main">=</span> Thm.nprems_of <span class="entity">st</span>
      <span class="keyword2"><span class="keyword">in</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">i</span> <span class="main">=</span> <span class="entity">sgn</span>
        <span class="keyword2"><span class="keyword">then</span></span> all_tac <span class="entity">st</span>
        <span class="keyword2"><span class="keyword">else</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">i</span> &gt; <span class="entity">sgn</span>
          <span class="keyword2"><span class="keyword">then</span></span> no_tac <span class="entity">st</span>
          <span class="keyword2"><span class="keyword">else</span></span>
            <span class="entity">st</span>
            |&gt; <span class="entity">cs_concl_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="entity">ist</span> <span class="entity">concl_is_thms</span> <span class="entity">i</span>
            |&gt; Seq.map <span class="main">(</span><span class="entity">cs_prems_intro_step</span> <span class="entity">i</span><span class="main">)</span>
            |&gt; Seq.flat
      <span class="keyword2"><span class="keyword">end</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">sts</span> <span class="main">=</span> <span class="entity">st</span>
      |&gt; <span class="entity">cs_prems_atom_step_tac</span> <span class="entity">ctxt</span> <span class="entity">m</span> <span class="entity">prem_rwr_thms</span> <span class="entity">i</span>
      |&gt; Seq.map <span class="main">(</span><span class="entity">cs_prems_intro_step</span> <span class="entity">i</span><span class="main">)</span>
      |&gt; Seq.flat
  <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">sts</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_prem_thms</span> <span class="entity">is_thms</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prem_rwr_thms</span> <span class="main">=</span> <span class="entity">is_thms</span>
      |&gt; filter <span class="entity">is_simp_thms</span>
      |&gt; map <span class="main">(</span><span class="entity">apply_is_thm</span> <span class="main">(</span><span class="entity">map_prems_simp_of_simp</span><span class="main">)</span><span class="main">)</span>
      |&gt; map <span class="entity">get_thms_of_is_thms</span>
      |&gt; flat
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">concl_is_thms</span> <span class="main">=</span> <span class="entity">process_cs_simps</span> <span class="main">(</span><span class="entity">map_concl_simp_of_simp</span><span class="main">)</span> <span class="entity">is_thms</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="main">(</span><span class="entity">prem_rwr_thms</span><span class="main">,</span> <span class="entity">concl_is_thms</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_prems_step</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="entity">ist</span> <span class="entity">is_thms</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">prem_rwr_thms</span><span class="main">,</span> <span class="entity">concl_is_thms</span><span class="main">)</span> <span class="main">=</span> <span class="entity">mk_prem_thms</span> <span class="entity">is_thms</span>
  <span class="keyword2"><span class="keyword">in</span></span> 
    <span class="entity">SIMPLE_METHOD'</span> <span class="main">(</span>
      <span class="entity">cs_prems_step_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="entity">ist</span> <span class="entity">prem_rwr_thms</span> <span class="entity">concl_is_thms</span>
      <span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> Theory.setup
  <span class="main">(</span>
    <span class="entity">Method.setup</span>
      <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹cs_prems_step›</span></span>
      <span class="main">(</span>
        Scan.option <span class="main">(</span>Scan.lift Args.bang<span class="main">)</span> --
        <span class="entity">cs_match_parser</span> --
        <span class="entity">cs_ist_parser</span> --
        Scan.repeat <span class="entity">cs_simp_intro_parser</span> &gt;&gt;
        <span class="main">(</span>
          <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="entity">verbose</span><span class="main">,</span> <span class="entity">csm</span><span class="main">)</span><span class="main">,</span> <span class="entity">ist</span><span class="main">)</span><span class="main">,</span> <span class="entity">is_thms</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span>
            <span class="entity">cs_prems_step</span> 
              <span class="entity">ctxt</span> 
              <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">verbose</span> <span class="keyword2"><span class="keyword">of</span></span> SOME <span class="main">_</span> <span class="main">=&gt;</span> true <span class="main">|</span> NONE <span class="main">=&gt;</span> false<span class="main">)</span>
              <span class="main">(</span><span class="entity">match_of_cs_match</span> <span class="entity">csm</span><span class="main">)</span>
              <span class="main">(</span><span class="entity">ist_of_cs_ist</span> <span class="entity">ist</span><span class="main">)</span> 
              <span class="entity">is_thms</span>
        <span class="main">)</span>
      <span class="main">)</span>
      <span class="inner_quoted">"conditional simplification of premises: single step"</span>
  <span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_prems_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="entity">ist</span> <span class="entity">prem_rwr_thms</span> <span class="entity">concl_is_thms</span> <span class="main">=</span>
  REPEAT_SOME <span class="main">(</span><span class="entity">cs_prems_step_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="entity">ist</span> <span class="entity">prem_rwr_thms</span> <span class="entity">concl_is_thms</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cs_prems</span> <span class="entity">ctxt</span> <span class="entity">timing</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="entity">ist</span> <span class="entity">is_thms</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> 
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">prem_rwr_thms</span><span class="main">,</span> <span class="entity">concl_is_thms</span><span class="main">)</span> <span class="main">=</span> <span class="entity">mk_prem_thms</span> <span class="entity">is_thms</span> |&gt;&gt; rev
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">tac</span> <span class="main">=</span> <span class="entity">cs_prems_tac</span> <span class="entity">ctxt</span> <span class="entity">verbose</span> <span class="entity">m</span> <span class="entity">ist</span> <span class="entity">prem_rwr_thms</span> <span class="entity">concl_is_thms</span>
      |&gt; <span class="entity">CS_TimeIt.TIMEIT</span> <span class="entity">timing</span> 
  <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">SIMPLE_METHOD</span> <span class="entity">tac</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> Theory.setup
  <span class="main">(</span>
    <span class="entity">Method.setup</span>
      <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹cs_prems›</span></span>
      <span class="main">(</span>
        Scan.option <span class="main">(</span>Scan.lift <span class="main">(</span>Parse.int<span class="main">)</span><span class="main">)</span> --
        Scan.option <span class="main">(</span>Scan.lift Args.bang<span class="main">)</span> --
        <span class="entity">cs_match_parser</span> --
        <span class="entity">cs_ist_parser</span> --
        Scan.repeat <span class="entity">cs_simp_intro_parser</span> &gt;&gt;
        <span class="main">(</span>
          <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="entity">timing</span><span class="main">,</span> <span class="entity">verbose</span><span class="main">)</span><span class="main">,</span> <span class="entity">csm</span><span class="main">)</span><span class="main">,</span> <span class="entity">ist</span><span class="main">)</span><span class="main">,</span> <span class="entity">is_thms</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> 
            <span class="entity">cs_prems</span> 
              <span class="entity">ctxt</span>
              <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">timing</span> <span class="keyword2"><span class="keyword">of</span></span> SOME <span class="entity">n</span> <span class="main">=&gt;</span> <span class="entity">n</span> <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="inner_numeral">0</span><span class="main">)</span>
              <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">verbose</span> <span class="keyword2"><span class="keyword">of</span></span> SOME <span class="main">_</span> <span class="main">=&gt;</span> true <span class="main">|</span> NONE <span class="main">=&gt;</span> false<span class="main">)</span>
              <span class="main">(</span><span class="entity">match_of_cs_match</span> <span class="entity">csm</span><span class="main">)</span> 
              <span class="main">(</span><span class="entity">ist_of_cs_ist</span> <span class="entity">ist</span><span class="main">)</span> 
              <span class="entity">is_thms</span>
        <span class="main">)</span>
      <span class="main">)</span>
      <span class="inner_quoted">"conditional simplification of premises"</span>
  <span class="main">)</span><span class="main">;</span>

<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span></pre>
</div><div id="Reference_Prerequisites">
<div class="head">
<h1>Theory Reference_Prerequisites</h1>
</div>
<pre class="source"><span class="comment1">(* Copyright 2021 (C) Mihails Milehins *)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Reference prerequisites›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Reference_Prerequisites
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/LaTeXsugar.html">HOL-Library.LaTeXsugar</a>"</span> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">ML_file</span></span> <span class="quoted">‹~~/src/Doc/antiquote_setup.ML›</span>


<span class="comment1">(* Copied from Transfer.thy in the main library. *)</span>
<span class="keyword1"><span class="command">notation</span></span> rel_fun <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">===&gt;</span>"</span> 55<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> map_fun <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">---&gt;</span>"</span> 55<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="files/ISABELLE_HOME/src/Doc/antiquote_setup.ML">
<div class="head">
<h1>File ‹~~/src/Doc/antiquote_setup.ML›</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Doc/antiquote_setup.ML
    Author:     Makarius

Auxiliary antiquotations for the Isabelle manuals.
*)</span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">Antiquote_Setup</span><span class="main">:</span> <span class="keyword2"><span class="keyword">sig</span></span> <span class="keyword2"><span class="keyword">end</span></span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>

<span class="comment1">(* misc utils *)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">translate</span> <span class="entity">f</span> <span class="main">=</span> Symbol.explode #&gt; map <span class="entity">f</span> #&gt; implode<span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">clean_string</span> <span class="main">=</span> <span class="entity">translate</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="inner_quoted">"_"</span> <span class="main">=&gt;</span> <span class="inner_quoted">"\\_"</span>
    <span class="main">|</span> <span class="inner_quoted">"#"</span> <span class="main">=&gt;</span> <span class="inner_quoted">"\\#"</span>
    <span class="main">|</span> <span class="inner_quoted">"$"</span> <span class="main">=&gt;</span> <span class="inner_quoted">"\\$"</span>
    <span class="main">|</span> <span class="inner_quoted">"%"</span> <span class="main">=&gt;</span> <span class="inner_quoted">"\\%"</span>
    <span class="main">|</span> <span class="inner_quoted">"&lt;"</span> <span class="main">=&gt;</span> <span class="inner_quoted">"$&lt;$"</span>
    <span class="main">|</span> <span class="inner_quoted">"&gt;"</span> <span class="main">=&gt;</span> <span class="inner_quoted">"$&gt;$"</span>
    <span class="main">|</span> <span class="inner_quoted">"{"</span> <span class="main">=&gt;</span> <span class="inner_quoted">"\\{"</span>
    <span class="main">|</span> <span class="inner_quoted">"|"</span> <span class="main">=&gt;</span> <span class="inner_quoted">"$\\mid$"</span>
    <span class="main">|</span> <span class="inner_quoted">"}"</span> <span class="main">=&gt;</span> <span class="inner_quoted">"\\}"</span>
    <span class="main">|</span> <span class="inner_quoted">"‐"</span> <span class="main">=&gt;</span> <span class="inner_quoted">"-"</span>
    <span class="main">|</span> <span class="entity">c</span> <span class="main">=&gt;</span> <span class="entity">c</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">clean_name</span> <span class="inner_quoted">"…"</span> <span class="main">=</span> <span class="inner_quoted">"dots"</span>
  <span class="main">|</span> <span class="entity">clean_name</span> <span class="inner_quoted">".."</span> <span class="main">=</span> <span class="inner_quoted">"ddot"</span>
  <span class="main">|</span> <span class="entity">clean_name</span> <span class="inner_quoted">"."</span> <span class="main">=</span> <span class="inner_quoted">"dot"</span>
  <span class="main">|</span> <span class="entity">clean_name</span> <span class="inner_quoted">"_"</span> <span class="main">=</span> <span class="inner_quoted">"underscore"</span>
  <span class="main">|</span> <span class="entity">clean_name</span> <span class="inner_quoted">"{"</span> <span class="main">=</span> <span class="inner_quoted">"braceleft"</span>
  <span class="main">|</span> <span class="entity">clean_name</span> <span class="inner_quoted">"}"</span> <span class="main">=</span> <span class="inner_quoted">"braceright"</span>
  <span class="main">|</span> <span class="entity">clean_name</span> <span class="entity">s</span> <span class="main">=</span> <span class="entity">s</span> |&gt; <span class="entity">translate</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="inner_quoted">"_"</span> <span class="main">=&gt;</span> <span class="inner_quoted">"-"</span> <span class="main">|</span> <span class="inner_quoted">"‐"</span> <span class="main">=&gt;</span> <span class="inner_quoted">"-"</span> <span class="main">|</span> <span class="entity">c</span> <span class="main">=&gt;</span> <span class="entity">c</span><span class="main">)</span><span class="main">;</span>


<span class="comment1">(* ML text *)</span>

<span class="keyword2"><span class="keyword">local</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">ml_val</span> <span class="main">(</span><span class="entity">toks1</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> ML_Lex.read <span class="inner_quoted">"fn _ =&gt; ("</span> @ <span class="entity">toks1</span> @ ML_Lex.read <span class="inner_quoted">");"</span>
  <span class="main">|</span> <span class="entity">ml_val</span> <span class="main">(</span><span class="entity">toks1</span><span class="main">,</span> <span class="entity">toks2</span><span class="main">)</span> <span class="main">=</span>
      ML_Lex.read <span class="inner_quoted">"fn _ =&gt; ("</span> @ <span class="entity">toks1</span> @ ML_Lex.read <span class="inner_quoted">" : "</span> @ <span class="entity">toks2</span> @ ML_Lex.read <span class="inner_quoted">");"</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">ml_op</span> <span class="main">(</span><span class="entity">toks1</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> ML_Lex.read <span class="inner_quoted">"fn _ =&gt; (op "</span> @ <span class="entity">toks1</span> @ ML_Lex.read <span class="inner_quoted">");"</span>
  <span class="main">|</span> <span class="entity">ml_op</span> <span class="main">(</span><span class="entity">toks1</span><span class="main">,</span> <span class="entity">toks2</span><span class="main">)</span> <span class="main">=</span>
      ML_Lex.read <span class="inner_quoted">"fn _ =&gt; (op "</span> @ <span class="entity">toks1</span> @ ML_Lex.read <span class="inner_quoted">" : "</span> @ <span class="entity">toks2</span> @ ML_Lex.read <span class="inner_quoted">");"</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">ml_type</span> <span class="main">(</span><span class="entity">toks1</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> ML_Lex.read <span class="inner_quoted">"val _ = NONE : ("</span> @ <span class="entity">toks1</span> @ ML_Lex.read <span class="inner_quoted">") option;"</span>
  <span class="main">|</span> <span class="entity">ml_type</span> <span class="main">(</span><span class="entity">toks1</span><span class="main">,</span> <span class="entity">toks2</span><span class="main">)</span> <span class="main">=</span>
      ML_Lex.read <span class="inner_quoted">"val _ = [NONE : ("</span> @ <span class="entity">toks1</span> @ ML_Lex.read <span class="inner_quoted">") option, NONE : ("</span> @
        <span class="entity">toks2</span> @ ML_Lex.read <span class="inner_quoted">") option];"</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">ml_exception</span> <span class="main">(</span><span class="entity">toks1</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> ML_Lex.read <span class="inner_quoted">"fn _ =&gt; ("</span> @ <span class="entity">toks1</span> @ ML_Lex.read <span class="inner_quoted">" : exn);"</span>
  <span class="main">|</span> <span class="entity">ml_exception</span> <span class="main">(</span><span class="entity">toks1</span><span class="main">,</span> <span class="entity">toks2</span><span class="main">)</span> <span class="main">=</span>
      ML_Lex.read <span class="inner_quoted">"fn _ =&gt; ("</span> @ <span class="entity">toks1</span> @ ML_Lex.read <span class="inner_quoted">" : "</span> @ <span class="entity">toks2</span> @ ML_Lex.read <span class="inner_quoted">" -&gt; exn);"</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">ml_structure</span> <span class="main">(</span><span class="entity">toks</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span>
  ML_Lex.read <span class="inner_quoted">"functor XXX() = struct structure XX = "</span> @ <span class="entity">toks</span> @ ML_Lex.read <span class="inner_quoted">" end;"</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">ml_functor</span> <span class="main">(</span>Antiquote.Text <span class="entity">tok</span> :: <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span>
      ML_Lex.read <span class="inner_quoted">"ML_Env.check_functor "</span> @
      ML_Lex.read <span class="main">(</span>ML_Syntax.print_string <span class="main">(</span>ML_Lex.content_of <span class="entity">tok</span><span class="main">)</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">ml_functor</span> <span class="main">_</span> <span class="main">=</span> <span class="keyword3"><span class="keyword">raise</span></span> Fail <span class="inner_quoted">"Bad ML functor specification"</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">is_name</span> <span class="main">=</span>
  ML_Lex.kind_of #&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">kind</span> <span class="main">=&gt;</span> <span class="entity">kind</span> <span class="main">=</span> ML_Lex.Ident <span class="keyword1"><span class="keyword">orelse</span></span> <span class="entity">kind</span> <span class="main">=</span> ML_Lex.Long_Ident<span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">ml_name</span> <span class="entity">txt</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> filter <span class="entity">is_name</span> <span class="main">(</span>ML_Lex.tokenize <span class="entity">txt</span><span class="main">)</span> <span class="keyword2"><span class="keyword">of</span></span>
    <span class="entity">toks</span> <span class="keyword1"><span class="keyword">as</span></span> <span class="main">[</span><span class="main">_</span><span class="main">]</span> <span class="main">=&gt;</span> ML_Lex.flatten <span class="entity">toks</span>
  <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> error <span class="main">(</span><span class="inner_quoted">"Single ML name expected in input: "</span> ^ quote <span class="entity">txt</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">prep_ml</span> <span class="entity">source</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">#</span><span class="inner_numeral">1</span> <span class="main">(</span>Input.source_content <span class="entity">source</span><span class="main">)</span><span class="main">,</span> ML_Lex.read_source <span class="entity">source</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">index_ml</span> <span class="entity">name</span> <span class="entity">kind</span> <span class="entity">ml</span> <span class="main">=</span> <span class="entity">Thy_Output.antiquotation_raw</span> <span class="entity">name</span>
  <span class="main">(</span>Scan.lift <span class="main">(</span>Args.text_input -- Scan.option <span class="main">(</span>Args.colon |-- Args.text_input<span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">source1</span><span class="main">,</span> <span class="entity">opt_source2</span><span class="main">)</span> <span class="main">=&gt;</span>
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">txt1</span><span class="main">,</span> <span class="entity">toks1</span><span class="main">)</span> <span class="main">=</span> <span class="entity">prep_ml</span> <span class="entity">source1</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">txt2</span><span class="main">,</span> <span class="entity">toks2</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">opt_source2</span> <span class="keyword2"><span class="keyword">of</span></span>
          SOME <span class="entity">source</span> <span class="main">=&gt;</span> <span class="entity">prep_ml</span> <span class="entity">source</span>
        <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="main">(</span><span class="inner_quoted">""</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>

      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">txt</span> <span class="main">=</span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">txt2</span> <span class="main">=</span> <span class="inner_quoted">""</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">txt1</span>
        <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">kind</span> <span class="main">=</span> <span class="inner_quoted">"type"</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">txt1</span> ^ <span class="inner_quoted">" = "</span> ^ <span class="entity">txt2</span>
        <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">kind</span> <span class="main">=</span> <span class="inner_quoted">"exception"</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">txt1</span> ^ <span class="inner_quoted">" of "</span> ^ <span class="entity">txt2</span>
        <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword2"><span class="keyword">if</span></span> Symbol_Pos.is_identifier <span class="main">(</span>Long_Name.base_name <span class="main">(</span><span class="entity">ml_name</span> <span class="entity">txt1</span><span class="main">)</span><span class="main">)</span>
        <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">txt1</span> ^ <span class="inner_quoted">": "</span> ^ <span class="entity">txt2</span>
        <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">txt1</span> ^ <span class="inner_quoted">" : "</span> ^ <span class="entity">txt2</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">txt'</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">kind</span> <span class="main">=</span> <span class="inner_quoted">""</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">txt</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">kind</span> ^ <span class="inner_quoted">" "</span> ^ <span class="entity">txt</span><span class="main">;</span>

      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">pos</span> <span class="main">=</span> Input.pos_of <span class="entity">source1</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span>
        ML_Context.eval_in <span class="main">(</span>SOME <span class="entity">ctxt</span><span class="main">)</span> ML_Compiler.flags <span class="entity">pos</span> <span class="main">(</span><span class="entity">ml</span> <span class="main">(</span><span class="entity">toks1</span><span class="main">,</span> <span class="entity">toks2</span><span class="main">)</span><span class="main">)</span>
          <span class="keyword3"><span class="keyword">handle</span></span> ERROR <span class="entity">msg</span> <span class="main">=&gt;</span> error <span class="main">(</span><span class="entity">msg</span> ^ Position.here <span class="entity">pos</span><span class="main">)</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">kind'</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">kind</span> <span class="main">=</span> <span class="inner_quoted">""</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="inner_quoted">"ML"</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="inner_quoted">"ML "</span> ^ <span class="entity">kind</span><span class="main">;</span>
    <span class="keyword2"><span class="keyword">in</span></span>
      Latex.block
       <span class="main">[</span>Latex.string <span class="main">(</span><span class="inner_quoted">"\\indexdef{}{"</span> ^ <span class="entity">kind'</span> ^ <span class="inner_quoted">"}{"</span> ^ <span class="entity">clean_string</span> <span class="main">(</span><span class="entity">ml_name</span> <span class="entity">txt1</span><span class="main">)</span> ^ <span class="inner_quoted">"}"</span><span class="main">)</span><span class="main">,</span>
        <span class="entity">Thy_Output.verbatim</span> <span class="entity">ctxt</span> <span class="entity">txt'</span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span><span class="main">;</span>

<span class="keyword2"><span class="keyword">in</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span>
  Theory.setup
   <span class="main">(</span><span class="entity">index_ml</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹index_ML›</span></span> <span class="inner_quoted">""</span> <span class="entity">ml_val</span> #&gt;
    <span class="entity">index_ml</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹index_ML_op›</span></span> <span class="inner_quoted">"infix"</span> <span class="entity">ml_op</span> #&gt;
    <span class="entity">index_ml</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹index_ML_type›</span></span> <span class="inner_quoted">"type"</span> <span class="entity">ml_type</span> #&gt;
    <span class="entity">index_ml</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹index_ML_exception›</span></span> <span class="inner_quoted">"exception"</span> <span class="entity">ml_exception</span> #&gt;
    <span class="entity">index_ml</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹index_ML_structure›</span></span> <span class="inner_quoted">"structure"</span> <span class="entity">ml_structure</span> #&gt;
    <span class="entity">index_ml</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹index_ML_functor›</span></span> <span class="inner_quoted">"functor"</span> <span class="entity">ml_functor</span><span class="main">)</span><span class="main">;</span>

<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>


<span class="comment1">(* named theorems *)</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span>
  Theory.setup <span class="main">(</span><span class="entity">Thy_Output.antiquotation_raw</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹named_thms›</span></span>
    <span class="main">(</span>Scan.repeat <span class="main">(</span><span class="entity">Attrib.thm</span> -- Scan.lift <span class="main">(</span>Args.parens Args.name<span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span>
      map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">thm</span><span class="main">,</span> <span class="entity">name</span><span class="main">)</span> <span class="main">=&gt;</span>
        Output.output
          <span class="main">(</span><span class="entity">Document_Antiquotation.format</span> <span class="entity">ctxt</span>
            <span class="main">(</span><span class="entity">Document_Antiquotation.delimit</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">Thy_Output.pretty_thm</span> <span class="entity">ctxt</span> <span class="entity">thm</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> ^
        enclose <span class="inner_quoted">"\\rulename{"</span> <span class="inner_quoted">"}"</span> <span class="main">(</span>Output.output <span class="entity">name</span><span class="main">)</span><span class="main">)</span>
      #&gt; space_implode <span class="inner_quoted">"\\par\\smallskip%\n"</span>
      #&gt; Latex.string #&gt; single
      #&gt; <span class="entity">Thy_Output.isabelle</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>


<span class="comment1">(* Isabelle/Isar entities (with index) *)</span>

<span class="keyword2"><span class="keyword">local</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">no_check</span> <span class="main">(</span><span class="main">_</span><span class="main">:</span> <span class="entity">Proof.context</span><span class="main">)</span> <span class="main">(</span><span class="entity">name</span><span class="main">,</span> <span class="main">_</span><span class="main">:</span> Position.T<span class="main">)</span> <span class="main">=</span> <span class="entity">name</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">check_keyword</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">name</span><span class="main">,</span> <span class="entity">pos</span><span class="main">)</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">if</span></span> Keyword.is_keyword <span class="main">(</span>Thy_Header.get_keywords' <span class="entity">ctxt</span><span class="main">)</span> <span class="entity">name</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">name</span>
  <span class="keyword2"><span class="keyword">else</span></span> error <span class="main">(</span><span class="inner_quoted">"Bad outer syntax keyword "</span> ^ quote <span class="entity">name</span> ^ Position.here <span class="entity">pos</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">check_system_option</span> <span class="entity">ctxt</span> <span class="entity">arg</span> <span class="main">=</span>
  <span class="main">(</span>Completion.check_option <span class="main">(</span>Options.default <span class="main">(</span><span class="main">)</span><span class="main">)</span> <span class="entity">ctxt</span> <span class="entity">arg</span><span class="main">;</span> true<span class="main">)</span>
    <span class="keyword3"><span class="keyword">handle</span></span> ERROR <span class="main">_</span> <span class="main">=&gt;</span> false<span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">arg</span> <span class="main">=</span> enclose <span class="inner_quoted">"{"</span> <span class="inner_quoted">"}"</span> o <span class="entity">clean_string</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">entity</span> <span class="entity">check</span> <span class="entity">markup</span> <span class="entity">binding</span> <span class="entity">index</span> <span class="main">=</span>
  <span class="entity">Thy_Output.antiquotation_raw</span>
    <span class="main">(</span><span class="entity">binding</span> |&gt; Binding.map_name <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">name</span> <span class="main">=&gt;</span> <span class="entity">name</span> ^
      <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">index</span> <span class="keyword2"><span class="keyword">of</span></span> NONE <span class="main">=&gt;</span> <span class="inner_quoted">""</span> <span class="main">|</span> SOME true <span class="main">=&gt;</span> <span class="inner_quoted">"_def"</span> <span class="main">|</span> SOME false <span class="main">=&gt;</span> <span class="inner_quoted">"_ref"</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>Scan.lift <span class="main">(</span>Scan.optional <span class="main">(</span>Args.parens Args.name<span class="main">)</span> <span class="inner_quoted">""</span> -- Args.name_position<span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">logic</span><span class="main">,</span> <span class="main">(</span><span class="entity">name</span><span class="main">,</span> <span class="entity">pos</span><span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">kind</span> <span class="main">=</span> <span class="entity">translate</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="inner_quoted">"_"</span> <span class="main">=&gt;</span> <span class="inner_quoted">" "</span> <span class="main">|</span> <span class="entity">c</span> <span class="main">=&gt;</span> <span class="entity">c</span><span class="main">)</span> <span class="main">(</span>Binding.name_of <span class="entity">binding</span><span class="main">)</span><span class="main">;</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">hyper_name</span> <span class="main">=</span>
          <span class="inner_quoted">"{"</span> ^ Long_Name.append <span class="entity">kind</span> <span class="main">(</span>Long_Name.append <span class="entity">logic</span> <span class="main">(</span><span class="entity">clean_name</span> <span class="entity">name</span><span class="main">)</span><span class="main">)</span> ^ <span class="inner_quoted">"}"</span><span class="main">;</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">hyper</span> <span class="main">=</span>
          enclose <span class="main">(</span><span class="inner_quoted">"\\hyperlink"</span> ^ <span class="entity">hyper_name</span> ^ <span class="inner_quoted">"{"</span><span class="main">)</span> <span class="inner_quoted">"}"</span> #&gt;
          <span class="entity">index</span> <span class="main">=</span> SOME true ? enclose <span class="main">(</span><span class="inner_quoted">"\\hypertarget"</span> ^ <span class="entity">hyper_name</span> ^ <span class="inner_quoted">"{"</span><span class="main">)</span> <span class="inner_quoted">"}"</span><span class="main">;</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">idx</span> <span class="main">=</span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">index</span> <span class="keyword2"><span class="keyword">of</span></span>
            NONE <span class="main">=&gt;</span> <span class="inner_quoted">""</span>
          <span class="main">|</span> SOME <span class="entity">is_def</span> <span class="main">=&gt;</span>
              <span class="inner_quoted">"\\index"</span> ^ <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="entity">is_def</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="inner_quoted">"def"</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="inner_quoted">"ref"</span><span class="main">)</span> ^ <span class="entity">arg</span> <span class="entity">logic</span> ^ <span class="entity">arg</span> <span class="entity">kind</span> ^ <span class="entity">arg</span> <span class="entity">name</span><span class="main">)</span><span class="main">;</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">if</span></span> Context_Position.is_reported <span class="entity">ctxt</span> <span class="entity">pos</span> <span class="keyword2"><span class="keyword">then</span></span> ignore <span class="main">(</span><span class="entity">check</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">name</span><span class="main">,</span> <span class="entity">pos</span><span class="main">)</span><span class="main">)</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span><span class="main">)</span><span class="main">;</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">latex</span> <span class="main">=</span>
          <span class="entity">idx</span> ^
          <span class="main">(</span>Output.output <span class="entity">name</span>
            |&gt; <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="entity">markup</span> <span class="main">=</span> <span class="inner_quoted">""</span> <span class="keyword2"><span class="keyword">then</span></span> I <span class="keyword2"><span class="keyword">else</span></span> enclose <span class="main">(</span><span class="inner_quoted">"\\"</span> ^ <span class="entity">markup</span> ^ <span class="inner_quoted">"{"</span><span class="main">)</span> <span class="inner_quoted">"}"</span><span class="main">)</span>
            |&gt; <span class="entity">hyper</span> o enclose <span class="inner_quoted">"\\mbox{\\isa{"</span> <span class="inner_quoted">"}}"</span><span class="main">)</span><span class="main">;</span>
      <span class="keyword2"><span class="keyword">in</span></span> Latex.string <span class="entity">latex</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">entity_antiqs</span> <span class="entity">check</span> <span class="entity">markup</span> <span class="entity">kind</span> <span class="main">=</span>
  <span class="entity">entity</span> <span class="entity">check</span> <span class="entity">markup</span> <span class="entity">kind</span> NONE #&gt;
  <span class="entity">entity</span> <span class="entity">check</span> <span class="entity">markup</span> <span class="entity">kind</span> <span class="main">(</span>SOME true<span class="main">)</span> #&gt;
  <span class="entity">entity</span> <span class="entity">check</span> <span class="entity">markup</span> <span class="entity">kind</span> <span class="main">(</span>SOME false<span class="main">)</span><span class="main">;</span>

<span class="keyword2"><span class="keyword">in</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span>
  Theory.setup
   <span class="main">(</span><span class="entity">entity_antiqs</span> <span class="entity">no_check</span> <span class="inner_quoted">""</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹syntax›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="entity">Outer_Syntax.check_command</span> <span class="inner_quoted">"isacommand"</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹command›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="entity">check_keyword</span> <span class="inner_quoted">"isakeyword"</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹keyword›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="entity">check_keyword</span> <span class="inner_quoted">"isakeyword"</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹element›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="entity">Method.check_name</span> <span class="inner_quoted">""</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹method›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="entity">Attrib.check_name</span> <span class="inner_quoted">""</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹attribute›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="entity">no_check</span> <span class="inner_quoted">""</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹fact›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="entity">no_check</span> <span class="inner_quoted">""</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹variable›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="entity">no_check</span> <span class="inner_quoted">""</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹case›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="entity">Document_Antiquotation.check</span> <span class="inner_quoted">""</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹antiquotation›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="entity">Document_Antiquotation.check_option</span> <span class="inner_quoted">""</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹antiquotation_option›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> Document_Marker.check <span class="inner_quoted">""</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹document_marker›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="entity">no_check</span> <span class="inner_quoted">"isasystem"</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹setting›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="entity">check_system_option</span> <span class="inner_quoted">"isasystem"</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹system_option›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="entity">no_check</span> <span class="inner_quoted">""</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹inference›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="entity">no_check</span> <span class="inner_quoted">"isasystem"</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹executable›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="entity">Isabelle_Tool.check</span> <span class="inner_quoted">"isatool"</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹tool›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> ML_Context.check_antiquotation <span class="inner_quoted">""</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹ML_antiquotation›</span></span> #&gt;
    <span class="entity">entity_antiqs</span> <span class="main">(</span>K <span class="entity">JEdit.check_action</span><span class="main">)</span> <span class="inner_quoted">"isasystem"</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹action›</span></span><span class="main">)</span><span class="main">;</span>

<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
</pre>
</div><div id="CS_Reference">
<div class="head">
<h1>Theory CS_Reference</h1>
</div>
<pre class="source"><span class="comment1">(* Copyright 2021 (C) Mihails Milehins *)</span>

<span class="keyword1"><span class="command">theory</span></span> CS_Reference
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="#IHOL_CS">IHOL_CS</a>
    <a href="#Reference_Prerequisites">Reference_Prerequisites</a>
<span class="keyword2"><span class="keyword">begin</span></span>




<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Introduction›</span></span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Background›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
This section presents a reference manual for the framework CS. The framework CS
is a collection of experimental tactics and associated proof methods 
aimed at the automation of conditional simplification  
in the object logic Isabelle/HOL (e.g., see \cite{yang_comprehending_2017})
of the formal proof assistant Isabelle \cite{paulson_natural_1986}. The methods
that are provided in the collection offer the functionality that is similar to
certain aspects of the functionality provided by the standard proof 
methods of Isabelle that combine classical reasoning and simplification 
(e.g., the method <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> auto<span class="antiquote"><span class="antiquote">}</span></span></span></span> 
\cite{nipkow_isabellehol_2002, wenzel_isabelle/isar_2019-1}), 
but there are notable differences. More specifically, the methods provided in 
the collection allow for the side conditions of
the rewrite rules to be solved via intro-resolution.
›</span></span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Purpose and scope›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The primary functionality of the framework is available via 
the proof methods <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_concl_step<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_prems_atom_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> and
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_intro_step<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
The methods <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_concl_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_prems_atom_step<span class="antiquote"><span class="antiquote">}</span></span></span></span>
accept a collection of (conditional) rewrite rules and execute
one rewrite step on the conclusion or a premise of some goal, 
respectively. The application of the rewrite step produces new goals that
are associated with the premises of the rewrite rules. These 
goals are meant to be discharged via a recursive application 
of either <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_intro_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> or <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_concl_step<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
The procedure outlined above was automated and made available as part
of the proof methods <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_concl<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_prems<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Related and previous work›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
No claim with regard to the originality of the algorithms used in the methods
implemented as part of the CS is made and, due to the experimental
and evolving nature of this work, a comprehensive literature review
is considered to be outside its scope. Therefore, the only contributions
claimed by the author are the implementation of the algorithms associated 
with the methods provided as part of the CS in Isabelle/ML and their integration
with the Isabelle/Isar infrastructure.

The implementation of the methods associated with the framework builds 
upon the existing infrastructure of Isabelle and provides only a very 
thin layer of additional or alternative functionality. As such, it may be 
possible to achieve integration of the functionality offered by the CS with the 
standard infrastructure for classical reasoning and simplification 
in Isabelle.

It should also be mentioned that the Isabelle/ML code from the 
main distribution of Isabelle2020 and from
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>The Isabelle/ML Cookbook›</span></span></span></span> \cite{urban_isabelle_2019} was frequently reused
(with amendments) during the development of the library. Some particular
examples of such reuse include 
\begin{itemize}
\item The adoption of the code for the tactic <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>remdups_tac›</span></span></span></span> from the file
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>~/Tools/Intuitionistic.ML›</span></span></span></span>.
\item The adoption of the code presented in subsection 3.3 of 
\cite{urban_isabelle_2019} for higher-order matching and unification.
\end{itemize}
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\newpage›</span></span>



<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Syntax›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
This section presents the syntactic categories that are associated with the 
methods <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_concl_step<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_intro_step<span class="antiquote"><span class="antiquote">}</span></span></span></span>, 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_intro_search<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_concl<span class="antiquote"><span class="antiquote">}</span></span></span></span>,  
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_prems_atom_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_prems<span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
It is important to note that the presentation is only approximate.
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹

\begin{matharray}{rcl}
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method_def</span></span> cs_concl_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> &amp; : &amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>method›</span></span></span></span>\\
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method_def</span></span> cs_intro_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> &amp; : &amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>method›</span></span></span></span>\\
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method_def</span></span> cs_intro_search<span class="antiquote"><span class="antiquote">}</span></span></span></span> &amp; : &amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>method›</span></span></span></span>\\
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method_def</span></span> cs_concl<span class="antiquote"><span class="antiquote">}</span></span></span></span> &amp; : &amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>method›</span></span></span></span>\\
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method_def</span></span> cs_prems_atom_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> &amp; : &amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>method›</span></span></span></span>\\
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method_def</span></span> cs_prems<span class="antiquote"><span class="antiquote">}</span></span></span></span> &amp; : &amp; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>method›</span></span></span></span>
\end{matharray}

  <span class="antiquoted"><span class="operator"><span class="antiquoted"><span class="operator">┉</span></span></span></span>

  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">rail</span><span class="hidden">&gt;</span></span></span>‹
    <span class="keyword1"><span class="keyword1">@</span></span><span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_concl_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> thms
    <span class="keyword2"><span class="keyword2">;</span></span>
    <span class="keyword1"><span class="keyword1">@</span></span><span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_intro_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> thms
    <span class="keyword2"><span class="keyword2">;</span></span>
    <span class="keyword1"><span class="keyword1">@</span></span><span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_intro_search<span class="antiquote"><span class="antiquote">}</span></span></span></span> thms
    <span class="keyword2"><span class="keyword2">;</span></span>
    <span class="keyword1"><span class="keyword1">@</span></span><span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_concl<span class="antiquote"><span class="antiquote">}</span></span></span></span>
      ((<span class="keyword1"><span class="keyword1">@</span></span><span class="inner_quoted"><span class="inner_quoted">'cs_full'</span></span>)<span class="keyword3"><span class="keyword3">?</span></span>) ((<span class="keyword1"><span class="keyword1">@</span></span><span class="inner_quoted"><span class="inner_quoted">'cs_ist_simple'</span></span>)<span class="keyword3"><span class="keyword3">?</span></span>) ((cs_simp cs_intro)<span class="keyword3"><span class="keyword3">*</span></span>)
    <span class="keyword2"><span class="keyword2">;</span></span>
    <span class="keyword1"><span class="keyword1">@</span></span><span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_prems_atom_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> thms
    <span class="keyword2"><span class="keyword2">;</span></span>
    <span class="keyword1"><span class="keyword1">@</span></span><span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_prems<span class="antiquote"><span class="antiquote">}</span></span></span></span> 
      ((<span class="keyword1"><span class="keyword1">@</span></span><span class="inner_quoted"><span class="inner_quoted">'cs_full'</span></span>)<span class="keyword3"><span class="keyword3">?</span></span>) ((<span class="keyword1"><span class="keyword1">@</span></span><span class="inner_quoted"><span class="inner_quoted">'cs_ist_simple'</span></span>)<span class="keyword3"><span class="keyword3">?</span></span>) ((cs_simp cs_intro)<span class="keyword3"><span class="keyword3">*</span></span>)
    <span class="keyword2"><span class="keyword2">;</span></span>
    cs_simp<span class="keyword2"><span class="keyword2">:</span></span> (<span class="keyword1"><span class="keyword1">@</span></span><span class="inner_quoted"><span class="inner_quoted">'cs_simp'</span></span> <span class="keyword1"><span class="keyword1">@</span></span><span class="inner_quoted"><span class="inner_quoted">':'</span></span> thms)<span class="keyword3"><span class="keyword3">?</span></span> 
    <span class="keyword2"><span class="keyword2">;</span></span>
    cs_intro<span class="keyword2"><span class="keyword2">:</span></span> (<span class="keyword1"><span class="keyword1">@</span></span><span class="inner_quoted"><span class="inner_quoted">'cs_intro'</span></span> <span class="keyword1"><span class="keyword1">@</span></span><span class="inner_quoted"><span class="inner_quoted">':'</span></span> thms)<span class="keyword3"><span class="keyword3">?</span></span>
  ›</span></span>

  <span class="antiquoted"><span class="antiquoted">➧</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_concl_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>thms›</span></span></span></span> performs a single rewrite step of 
the conclusion of some goal using the collection of the rewrite rules <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>thms›</span></span></span></span>.
The rewriting is performed via the intro-resolution with the 
rewrite rule stated in an altered form: the application of 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_concl_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> may produce new subgoals that are associated with 
the premises of the applied rewrite rule.
  <span class="antiquoted"><span class="antiquoted">➧</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_intro_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>thms›</span></span></span></span> performs a single refinement step 
via intro-resolution. 
  <span class="antiquoted"><span class="antiquoted">➧</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_intro_search<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>thms›</span></span></span></span> attempts to solve a single goal 
using a search procedure based on the algorithm outlined
in the description of the method <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_intro_step<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  <span class="antiquoted"><span class="antiquoted">➧</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_concl<span class="antiquote"><span class="antiquote">}</span></span></span></span> 
(<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">element</span></span> "cs_full"<span class="antiquote"><span class="antiquote">}</span></span></span></span>) (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">element</span></span> "cs_ist_simple"<span class="antiquote"><span class="antiquote">}</span></span></span></span>) 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">element</span></span> "cs_simp"<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>:›</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>simp_thms›</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">element</span></span> "cs_intro"<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>:›</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>intro_thms›</span></span></span></span> 
attempts to solve a single goal using a search procedure that employs 
the method applications <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_concl_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>simp_thms›</span></span></span></span> 
and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_intro_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>intro_thms›</span></span></span></span> as individual steps.
If the optional argument <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">element</span></span> "cs_full"<span class="antiquote"><span class="antiquote">}</span></span></span></span> is provided during the
invocation of the proof method, all possible rule-term
matches are considered. Otherwise, only a single sensible default match
is used for every applicable rule-term pair. If the optional
argument <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">element</span></span> "cs_ist_simple"<span class="antiquote"><span class="antiquote">}</span></span></span></span> is provided, then the search space
of the method is expanded by allowing backtracking after every atomic
step (the default behaviour uses a tailor-made empirically established
routine that can be inferred from the implementation of the method).
  <span class="antiquoted"><span class="antiquoted">➧</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_prems_atom_step<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>thms›</span></span></span></span> performs a single rewrite step of 
the first premise of some goal using the collection of the rewrite rules <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>thms›</span></span></span></span>.
  <span class="antiquoted"><span class="antiquoted">➧</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_prems<span class="antiquote"><span class="antiquote">}</span></span></span></span> 
(<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">element</span></span> "cs_full"<span class="antiquote"><span class="antiquote">}</span></span></span></span>) (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">element</span></span> "cs_ist_simple"<span class="antiquote"><span class="antiquote">}</span></span></span></span>) 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">element</span></span> "cs_simp"<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>:›</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>simp_thms›</span></span></span></span>
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">element</span></span> "cs_intro"<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>:›</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>intro_thms›</span></span></span></span> 
repeatedly performs a single rewrite step of 
the first premise of some goal using the collection of the rewrite rules 
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>simp_thms›</span></span></span></span>, followed by an attempt to solve all but the final subgoal using
the method application 
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(›</span></span></span></span><span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_concl<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">element</span></span> "cs_simp"<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>:›</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>simp_thms›</span></span></span></span> 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">element</span></span> "cs_intro"<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>:›</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>intro_thms›</span></span></span></span><span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>)›</span></span></span></span>.
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">element</span></span> "cs_full"<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">element</span></span> "cs_ist_simple"<span class="antiquote"><span class="antiquote">}</span></span></span></span> serve a purpose that 
is similar to their purpose in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> cs_concl<span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\newpage›</span></span>



<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Known issues and limitations›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The collection of the proof methods that are associated with the framework CS  
is a result of experimentation during practical formalization 
work. The collection of methods should be viewed as an idea or
a proposal for further development, rather than a finished product. 
The limitations and the performance of these methods have not been 
investigated and there is little guarantee that they will be suitable 
for any specific target application.

The methods have only been tested extensively on the subgoals that do
not contain any explicit occurrences of the Isabelle/Pure universal 
quantifier. Therefore, users should not assume that the methods
associated with the CS provide any degree of support for dealing with 
the subgoals that contain explicit occurrences of the Isabelle/Pure 
quantifiers, although a limited and highly experimental capacity for 
the first-order reasoning is provided.
›</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>