<div id="Iterings">
<div class="head">
<h1>Theory Iterings</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Iterings
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Iterings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory introduces algebraic structures with an operation that describes iteration in various relational computation models.
An iteration describes the repeated sequential execution of a computation.
This is typically modelled by fixpoints, but different computation models use different fixpoints in the refinement order.
We therefore look at equational and simulation axioms rather than induction axioms.
Our development is based on \cite{Guttmann2012c} and the proposed algebras generalise Kleene algebras.

We first consider a variant of Conway semirings \cite{BloomEsik1993a} based on idempotent left semirings.
Conway semirings expand semirings by an iteration operation satisfying Conway's sumstar and productstar axioms \cite{Conway1971}.
Many properties of iteration follow already from these equational axioms.

Next we introduce iterings, which use generalised versions of simulation axioms in addition to sumstar and productstar.
Unlike the induction axioms of the Kleene star, which hold only in partial-correctness models, the simulation axioms are also valid in total and general correctness models.
They are still powerful enough to prove the correctness of complex results such as separation theorems of \cite{Cohen2000} and Back's atomicity refinement theorem \cite{BackWright1999,Wright2004}.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Iterings

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../stone_relation_algebras/theories/#Semirings">Stone_Relation_Algebras.Semirings</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Conway Semirings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this section, we consider equational axioms for iteration.
The algebraic structures are based on idempotent left semirings, which are expanded by a unary iteration operation.
We start with an unfold property, one inequality of the sliding rule and distributivity over joins, which is similar to Conway's sumstar.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> circ <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">circ</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">⇧</span><sup>∘</sup></span></span></span>"</span> <span class="main">[</span>100<span class="main">]</span> 100<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> left_conway_semiring <span class="main">=</span> idempotent_left_semiring <span class="main">+</span> circ <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> circ_left_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> circ_left_slide<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> circ_sup_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We obtain one inequality of Conway's productstar, as well as of the other unfold rule.
›</span></span>

<span class="keyword1" id="Iterings-circ_mult_sub"><span class="command">lemma</span></span> circ_mult_sub<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_right_isotone circ_left_slide circ_left_unfold mult_assoc mult_right_isotone<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_right_unfold_sub"><span class="command">lemma</span></span> circ_right_unfold_sub<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_mult_sub mult_1_left mult_1_right<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_zero"><span class="command">lemma</span></span> circ_zero<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bot<span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_monoid.add_0_right circ_left_unfold mult_left_zero<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_increasing"><span class="command">lemma</span></span> circ_increasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_supI2 circ_left_unfold circ_right_unfold_sub mult_1_left mult_right_sub_dist_sup_left order_trans<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_reflexive"><span class="command">lemma</span></span> circ_reflexive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_left_divisibility circ_left_unfold<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_mult_increasing"><span class="command">lemma</span></span> circ_mult_increasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_reflexive mult_right_isotone mult_1_right<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_mult_increasing_2"><span class="command">lemma</span></span> circ_mult_increasing_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_reflexive mult_left_isotone mult_1_left<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_transitive_equal"><span class="command">lemma</span></span> circ_transitive_equal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_idem circ_sup_1 circ_left_unfold mult_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
While iteration is not idempotent, a fixpoint is reached after applying this operation twice.
Iteration is idempotent for the unit.
›</span></span>

<span class="keyword1" id="Iterings-circ_circ_circ"><span class="command">lemma</span></span> circ_circ_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_idem circ_sup_1 circ_increasing circ_transitive_equal le_iff_sup<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_one"><span class="command">lemma</span></span> circ_one<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_circ_circ circ_zero<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_sup_sub"><span class="command">lemma</span></span> circ_sup_sub<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup_1 circ_left_slide<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_plus_one"><span class="command">lemma</span></span> circ_plus_one<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_iff_sup circ_reflexive<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Iteration satisfies a characteristic property of reflexive transitive closures.
›</span></span>

<span class="keyword1" id="Iterings-circ_rtc_2"><span class="command">lemma</span></span> circ_rtc_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_assoc circ_increasing circ_plus_one circ_transitive_equal le_iff_sup<span class="main">)</span>

<span class="keyword1" id="Iterings-mult_zero_circ"><span class="command">lemma</span></span> mult_zero_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> bot<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_left_unfold mult_assoc mult_left_zero<span class="main">)</span>

<span class="keyword1" id="Iterings-mult_zero_sup_circ"><span class="command">lemma</span></span> mult_zero_sup_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> bot<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> bot<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup_1 mult_assoc mult_left_zero<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_plus_sub"><span class="command">lemma</span></span> circ_plus_sub<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_left_slide mult_1_left mult_1_right<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_loop_fixpoint"><span class="command">lemma</span></span> circ_loop_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute circ_left_unfold mult_assoc mult_1_left mult_right_dist_sup<span class="main">)</span>

<span class="keyword1" id="Iterings-left_plus_below_circ"><span class="command">lemma</span></span> left_plus_below_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.cobounded2 circ_left_unfold<span class="main">)</span>

<span class="keyword1" id="Iterings-right_plus_below_circ"><span class="command">lemma</span></span> right_plus_below_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> circ_right_unfold_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Iterings-circ_sup_upper_bound"><span class="command">lemma</span></span> circ_sup_upper_bound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Iterings-circ_mult_upper_bound"><span class="command">lemma</span></span> circ_mult_upper_bound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isotone circ_transitive_equal<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_sub_dist"><span class="command">lemma</span></span> circ_sub_dist<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup_sub circ_plus_one mult_1_left mult_right_sub_dist_sup_left order_trans<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_sub_dist_1"><span class="command">lemma</span></span> circ_sub_dist_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> circ_increasing le_supE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Iterings-circ_sub_dist_2"><span class="command">lemma</span></span> circ_sub_dist_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute circ_mult_upper_bound circ_sub_dist_1<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_sub_dist_3"><span class="command">lemma</span></span> circ_sub_dist_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute circ_mult_upper_bound circ_sub_dist<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_isotone"><span class="command">lemma</span></span> circ_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sub_dist le_iff_sup<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_sup_2"><span class="command">lemma</span></span> circ_sup_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.bounded_iff circ_increasing circ_isotone circ_reflexive mult_isotone mult_1_left mult_1_right<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_sup_one_left_unfold"><span class="command">lemma</span></span> circ_sup_one_left_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym le_iff_sup mult_1_left mult_right_sub_dist_sup_left left_plus_below_circ<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_sup_one_right_unfold"><span class="command">lemma</span></span> circ_sup_one_right_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym le_iff_sup mult_left_sub_dist_sup_left mult_1_right right_plus_below_circ<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_decompose_4"><span class="command">lemma</span></span> circ_decompose_4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_assoc sup_commute circ_sup_1 circ_loop_fixpoint circ_plus_one circ_rtc_2 circ_transitive_equal mult_assoc<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_decompose_5"><span class="command">lemma</span></span> circ_decompose_5<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_decompose_4 circ_loop_fixpoint order.antisym mult_right_sub_dist_sup_right mult_assoc<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_decompose_6"><span class="command">lemma</span></span> circ_decompose_6<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute circ_sup_1<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_decompose_7"><span class="command">lemma</span></span> circ_decompose_7<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup_1 circ_decompose_6 circ_transitive_equal mult_assoc<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_decompose_8"><span class="command">lemma</span></span> circ_decompose_8<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym eq_refl mult_assoc mult_isotone mult_1_right circ_mult_upper_bound circ_reflexive circ_sub_dist_3<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_decompose_9"><span class="command">lemma</span></span> circ_decompose_9<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_decompose_4 mult_assoc<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_decompose_10"><span class="command">lemma</span></span> circ_decompose_10<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_ge2 circ_loop_fixpoint circ_reflexive circ_sup_one_right_unfold mult_assoc order_trans<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_back_loop_prefixpoint"><span class="command">lemma</span></span> circ_back_loop_prefixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.bounded_iff circ_left_unfold mult_assoc mult_left_sub_dist_sup_left mult_right_isotone mult_1_right right_plus_below_circ<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We obtain the fixpoint and prefixpoint properties of iteration, but not least or greatest fixpoint properties.
›</span></span>

<span class="keyword1" id="Iterings-circ_loop_is_fixpoint"><span class="command">lemma</span></span> circ_loop_is_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_fixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="free">y</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_loop_fixpoint is_fixpoint_def<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_back_loop_is_prefixpoint"><span class="command">lemma</span></span> circ_back_loop_is_prefixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_prefixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_back_loop_prefixpoint is_prefixpoint_def<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_circ_sup"><span class="command">lemma</span></span> circ_circ_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute circ_sup_1 circ_decompose_4 circ_zero mult_1_right<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_circ_mult_sub"><span class="command">lemma</span></span> circ_circ_mult_sub<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_increasing circ_isotone circ_mult_upper_bound circ_reflexive<span class="main">)</span>

<span class="keyword1" id="Iterings-left_plus_circ"><span class="command">lemma</span></span> left_plus_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_left_unfold circ_sup_1 mult_1_right mult_sub_right_one sup.absorb1 mult_assoc<span class="main">)</span>

<span class="keyword1" id="Iterings-right_plus_circ"><span class="command">lemma</span></span> right_plus_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute circ_isotone circ_loop_fixpoint circ_plus_sub circ_sub_dist order.eq_iff left_plus_circ<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_square"><span class="command">lemma</span></span> circ_square<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_increasing circ_isotone left_plus_circ mult_right_isotone<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_mult_sub_sup"><span class="command">lemma</span></span> circ_mult_sub_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_ge1 sup_ge2 circ_isotone circ_square mult_isotone order_trans<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_sup_mult_zero"><span class="command">lemma</span></span> circ_sup_mult_zero<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> bot<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> bot<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> bot<span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_zero_sup_circ mult_zero_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_1_left mult_left_zero mult_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute le_iff_sup zero_right_mult_decreasing<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Iterings-troeger_1"><span class="command">lemma</span></span> troeger_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup_1 circ_left_unfold mult_assoc<span class="main">)</span>

<span class="keyword1" id="Iterings-troeger_2"><span class="command">lemma</span></span> troeger_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup_1 circ_loop_fixpoint mult_assoc<span class="main">)</span>

<span class="keyword1" id="Iterings-troeger_3"><span class="command">lemma</span></span> troeger_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> bot<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> bot<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_zero_sup_circ mult_zero_circ<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_sup_sub_sup_one_1"><span class="command">lemma</span></span> circ_sup_sub_sup_one_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_increasing circ_left_unfold mult_1_left mult_1_right mult_left_sub_dist_sup mult_right_sub_dist_sup_left order_trans sup_mono<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_sup_sub_sup_one_2"><span class="command">lemma</span></span> circ_sup_sub_sup_one_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup_sub_sup_one_1 circ_transitive_equal mult_assoc mult_right_isotone<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_sup_sub_sup_one"><span class="command">lemma</span></span> circ_sup_sub_sup_one<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup_sub_sup_one_2 mult_assoc mult_right_isotone<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_square_2"><span class="command">lemma</span></span> circ_square_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.bounded_iff circ_increasing circ_mult_upper_bound circ_reflexive circ_square<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_extra_circ"><span class="command">lemma</span></span> circ_extra_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_decompose_6 circ_transitive_equal left_plus_circ mult_assoc<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_circ_sub_mult"><span class="command">lemma</span></span> circ_circ_sub_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_increasing circ_isotone circ_mult_upper_bound circ_reflexive<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_decompose_11"><span class="command">lemma</span></span> circ_decompose_11<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_decompose_10 circ_decompose_4 circ_decompose_5 circ_decompose_9 left_plus_circ<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_mult_below_circ_circ"><span class="command">lemma</span></span> circ_mult_below_circ_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_increasing circ_isotone circ_reflexive dual_order.trans mult_left_isotone mult_right_isotone mult_1_right<span class="main">)</span>

<span class="comment1">(*
lemma circ_right_unfold: "1 ⊔ x<span class="hidden">⇧</span><sup>∘</sup> * x = x<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma circ_mult: "1 ⊔ x * (y * x)<span class="hidden">⇧</span><sup>∘</sup> * y = (x * y)<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma circ_slide: "(x * y)<span class="hidden">⇧</span><sup>∘</sup> * x = x * (y * x)<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma circ_plus_same: "x<span class="hidden">⇧</span><sup>∘</sup> * x = x * x<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma "1<span class="hidden">⇧</span><sup>∘</sup> * x<span class="hidden">⇧</span><sup>∘</sup> ≤ x<span class="hidden">⇧</span><sup>∘</sup> * 1<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine,card=7] oops
lemma circ_circ_mult_1: "x<span class="hidden">⇧</span><sup>∘</sup> * 1<span class="hidden">⇧</span><sup>∘</sup> = x<span class="hidden">⇧</span><sup>∘</sup><span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine,card=7] oops
lemma "x<span class="hidden">⇧</span><sup>∘</sup> * 1<span class="hidden">⇧</span><sup>∘</sup> ≤ 1<span class="hidden">⇧</span><sup>∘</sup> * x<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine,card=7] oops
lemma circ_circ_mult: "1<span class="hidden">⇧</span><sup>∘</sup> * x<span class="hidden">⇧</span><sup>∘</sup> = x<span class="hidden">⇧</span><sup>∘</sup><span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine,card=7] oops
lemma circ_sup: "(x<span class="hidden">⇧</span><sup>∘</sup> * y)<span class="hidden">⇧</span><sup>∘</sup> * x<span class="hidden">⇧</span><sup>∘</sup> = (x ⊔ y)<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine,card=8] oops
lemma circ_unfold_sum: "(x ⊔ y)<span class="hidden">⇧</span><sup>∘</sup> = x<span class="hidden">⇧</span><sup>∘</sup> ⊔ x<span class="hidden">⇧</span><sup>∘</sup> * y * (x ⊔ y)<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine,card=7] oops

lemma mult_zero_sup_circ_2: "(x ⊔ y * bot)<span class="hidden">⇧</span><sup>∘</sup> = x<span class="hidden">⇧</span><sup>∘</sup> ⊔ x<span class="hidden">⇧</span><sup>∘</sup> * y * bot" nitpick [expect=genuine,card=7] oops
lemma sub_mult_one_circ: "x * 1<span class="hidden">⇧</span><sup>∘</sup> ≤ 1<span class="hidden">⇧</span><sup>∘</sup> * x" nitpick [expect=genuine] oops
lemma circ_back_loop_fixpoint: "(z * y<span class="hidden">⇧</span><sup>∘</sup>) * y ⊔ z = z * y<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma circ_back_loop_is_fixpoint: "is_fixpoint (λx . x * y ⊔ z) (z * y<span class="hidden">⇧</span><sup>∘</sup>)" nitpick [expect=genuine] oops
lemma "x<span class="hidden">⇧</span><sup>∘</sup> * y<span class="hidden">⇧</span><sup>∘</sup> ≤ (x<span class="hidden">⇧</span><sup>∘</sup> * y)<span class="hidden">⇧</span><sup>∘</sup> * x<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine,card=7] oops
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The next class considers the interaction of iteration with a greatest element.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_left_conway_semiring <span class="main">=</span> bounded_idempotent_left_semiring <span class="main">+</span> left_conway_semiring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Iterings-circ_top"><span class="command">lemma</span></span> circ_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"top<span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.antisym circ_increasing<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_right_top"><span class="command">lemma</span></span> circ_right_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> top <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_right_top circ_loop_fixpoint<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_left_top"><span class="command">lemma</span></span> circ_left_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_right_top circ_top circ_decompose_11<span class="main">)</span>

<span class="keyword1" id="Iterings-mult_top_circ"><span class="command">lemma</span></span> mult_top_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_left_top circ_left_unfold mult_assoc<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> left_zero_conway_semiring <span class="main">=</span> idempotent_left_zero_semiring <span class="main">+</span> left_conway_semiring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Iterings-mult_zero_sup_circ_2"><span class="command">lemma</span></span> mult_zero_sup_circ_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> bot<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_left_dist_sup mult_1_right troeger_3<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_unfold_sum"><span class="command">lemma</span></span> circ_unfold_sum<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_left_dist_sup mult_1_right troeger_1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The next class assumes the full sliding equation.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> left_conway_semiring_1 <span class="main">=</span> left_conway_semiring <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> circ_right_slide<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Iterings-circ_slide_1"><span class="command">lemma</span></span> circ_slide_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym circ_left_slide circ_right_slide<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This implies the full unfold rules and Conway's productstar.
›</span></span>

<span class="keyword1" id="Iterings-circ_right_unfold_1"><span class="command">lemma</span></span> circ_right_unfold_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_left_unfold circ_slide_1 mult_1_left mult_1_right<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_mult_1"><span class="command">lemma</span></span> circ_mult_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_left_unfold circ_slide_1 mult_assoc<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_sup_9"><span class="command">lemma</span></span> circ_sup_9<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup_1 circ_slide_1<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_plus_same"><span class="command">lemma</span></span> circ_plus_same<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_slide_1 mult_1_left mult_1_right<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_decompose_12"><span class="command">lemma</span></span> circ_decompose_12<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup_9 circ_sub_dist_3<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> left_zero_conway_semiring_1 <span class="main">=</span> left_zero_conway_semiring <span class="main">+</span> left_conway_semiring_1
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Iterings-circ_back_loop_fixpoint"><span class="command">lemma</span></span> circ_back_loop_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">=</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute circ_left_unfold circ_plus_same mult_assoc mult_left_dist_sup mult_1_right<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_back_loop_is_fixpoint"><span class="command">lemma</span></span> circ_back_loop_is_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_fixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_back_loop_fixpoint is_fixpoint_def<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_elimination"><span class="command">lemma</span></span> circ_elimination<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> bot <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_monoid.add_0_left circ_back_loop_fixpoint circ_plus_same mult_assoc mult_left_zero order_refl<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Iterings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This section adds simulation axioms to Conway semirings.
We consider several classes with increasingly general simulation axioms.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> itering_1 <span class="main">=</span> left_conway_semiring_1 <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> circ_simulate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span> <span class="main">⟶</span> <span class="free">z</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">z</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Iterings-circ_circ_mult"><span class="command">lemma</span></span> circ_circ_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym circ_circ_sup circ_reflexive circ_simulate circ_sub_dist_3 circ_sup_one_left_unfold circ_transitive_equal mult_1_left order_refl<span class="main">)</span>

<span class="keyword1" id="Iterings-sub_mult_one_circ"><span class="command">lemma</span></span> sub_mult_one_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_simulate mult_1_left mult_1_right order_refl<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The left simulation axioms is enough to prove a basic import property of tests.
›</span></span>

<span class="keyword1" id="Iterings-circ_import"><span class="command">lemma</span></span> circ_import<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms coreflexive_transitive order.eq_iff test_preserves_equation mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms circ_simulate circ_slide_1 test_preserves_equation<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> circ_isotone mult_left_isotone mult_1_left mult_right_isotone order.antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Including generalisations of both simulation axioms allows us to prove separation rules.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> itering_2 <span class="main">=</span> left_conway_semiring_1 <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> circ_simulate_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">⟶</span> <span class="free">z</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> circ_simulate_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">⟶</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> itering_1
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_monoid.add_0_right circ_simulate_right mult_left_zero<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_simulate_left_1"><span class="command">lemma</span></span> circ_simulate_left_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_monoid.add_0_right circ_simulate_left mult_assoc mult_left_zero mult_right_dist_sup<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_separate_1"><span class="command">lemma</span></span> circ_separate_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms circ_simulate_left_1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> bot <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_left_isotone mult_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_transitive_equal mult_assoc mult_left_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> circ_simulate_right mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_absorb1 zero_right_mult_decreasing<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circ_decompose_6 circ_sup_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.antisym circ_sub_dist_3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Iterings-circ_circ_mult_1"><span class="command">lemma</span></span> circ_circ_mult_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute circ_circ_sup circ_separate_1 mult_1_left mult_1_right order_refl<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
With distributivity, we also get Back's atomicity refinement theorem.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> itering_3 <span class="main">=</span> itering_2 <span class="main">+</span> left_zero_conway_semiring_1
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Iterings-circ_simulate_1"><span class="command">lemma</span></span> circ_simulate_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms circ_simulate<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_simulate_left_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_assoc sup_monoid.add_0_right circ_loop_fixpoint mult_assoc mult_left_zero mult_zero_sup_circ_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Iterings-atomicity_refinement"><span class="command">lemma</span></span> atomicity_refinement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">s</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">l</span> <span class="main">*</span> <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">l</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">l</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">l</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">q</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">*</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">b</span> <span class="main">⊔</span> <span class="free">r</span> <span class="main">⊔</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">q</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">q</span> <span class="main">⊔</span> <span class="free">r</span> <span class="main">⊔</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">b</span> <span class="main">⊔</span> <span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">l</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">b</span> <span class="main">⊔</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5-7<span class="main">)</span> mult_left_dist_sup mult_right_dist_sup semiring.add_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">b</span> <span class="main">⊔</span> <span class="free">r</span> <span class="main">⊔</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">q</span> <span class="main">=</span> <span class="free">s</span> <span class="main">*</span> <span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">b</span> <span class="main">⊔</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute circ_separate_1 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">s</span> <span class="main">*</span> <span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">⊔</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> circ_separate_1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">b</span> <span class="main">⊔</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> circ_sup_1 sup_assoc sup_commute mult_assoc<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_slide_1 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">*</span> <span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> circ_isotone mult_assoc mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>10<span class="main"><span class="main">)</span></span> mult_left_isotone mult_right_isotone mult_1_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">*</span> <span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>8<span class="main"><span class="main">)</span></span> circ_simulate mult_assoc mult_left_isotone mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">*</span> <span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>10<span class="main"><span class="main">)</span></span> sup_monoid.add_0_left circ_back_loop_fixpoint circ_plus_same mult_assoc mult_left_zero mult_left_isotone mult_right_isotone mult_1_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">q</span> <span class="main">⊔</span> <span class="free">r</span> <span class="main">⊔</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute circ_sup_1 circ_sub_dist_3 mult_assoc mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following class contains the most general simulation axioms we consider.
They allow us to prove further separation properties.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> itering <span class="main">=</span> idempotent_left_zero_semiring <span class="main">+</span> circ <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> circ_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> circ_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> circ_simulate_right_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">⟶</span> <span class="free">z</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> circ_simulate_left_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">⟶</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Iterings-circ_right_unfold"><span class="command">lemma</span></span> circ_right_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_mult mult_1_left mult_1_right<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_slide"><span class="command">lemma</span></span> circ_slide<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> Rf <span class="free">x</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> circ_mult mult_1_left mult_1_right mult_left_dist_sup mult_right_dist_sup mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> circ_mult mult_1_right mult_left_dist_sup mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subclass</span></span> itering_3
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> circ_mult mult_1_left mult_1_right<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> circ_slide order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup circ_slide<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> circ_slide order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> sup_left_isotone circ_right_unfold mult_left_isotone mult_left_sub_dist_sup_left mult_1_right order_trans circ_simulate_right_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute sup_ge1 sup_right_isotone circ_mult mult_right_isotone mult_1_right order_trans circ_simulate_left_plus<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_simulate_right_plus_1"><span class="command">lemma</span></span> circ_simulate_right_plus_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_monoid.add_0_right circ_simulate_right_plus mult_left_zero<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_simulate_left_plus_1"><span class="command">lemma</span></span> circ_simulate_left_plus_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_monoid.add_0_right circ_simulate_left_plus mult_assoc mult_left_zero mult_right_dist_sup<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_simulate_2"><span class="command">lemma</span></span> circ_simulate_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⟷</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> sup_assoc sup_monoid.add_0_right circ_loop_fixpoint circ_simulate_left_plus_1 mult_assoc mult_left_zero mult_zero_sup_circ_2<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_increasing mult_left_isotone order_trans<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_simulate_absorb"><span class="command">lemma</span></span> circ_simulate_absorb<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_simulate_left_plus_1 circ_zero mult_1_right<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_simulate_3"><span class="command">lemma</span></span> circ_simulate_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⟹</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.bounded_iff circ_reflexive circ_simulate_2 le_iff_sup mult_right_isotone mult_1_right<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_separate_mult_1"><span class="command">lemma</span></span> circ_separate_mult_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_mult_sub_sup circ_separate_1<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_separate_unfold"><span class="command">lemma</span></span> circ_separate_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_back_loop_fixpoint circ_plus_same circ_unfold_sum sup_commute mult_assoc<span class="main">)</span>

<span class="keyword1" id="Iterings-separation"><span class="command">lemma</span></span> separation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms circ_simulate_left_plus_1 circ_transitive_equal mult_assoc mult_left_isotone<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute circ_sup_1 circ_simulate_right circ_sub_dist_3 le_iff_sup mult_assoc mult_left_zero zero_right_mult_decreasing<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Iterings-simulation"><span class="command">lemma</span></span> simulation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⟹</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_ge2 circ_isotone circ_mult_upper_bound circ_sub_dist separation<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_simulate_4"><span class="command">lemma</span></span> circ_simulate_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> circ_back_loop_fixpoint mult_right_dist_sup sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_1_right sup_assoc sup_ge1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms mult_left_dist_sup mult_right_dist_sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup_upper_bound circ_increasing circ_reflexive circ_simulate_right_plus_1 mult_right_isotone mult_right_sub_dist_sup_right order_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_simulate_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Iterings-circ_simulate_5"><span class="command">lemma</span></span> circ_simulate_5<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup_sub_sup_one circ_simulate_4 order_trans<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_simulate_6"><span class="command">lemma</span></span> circ_simulate_6<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute circ_back_loop_fixpoint circ_simulate_5 mult_right_sub_dist_sup_left order_trans<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_separate_4"><span class="command">lemma</span></span> circ_separate_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circ_transitive_equal mult_left_dist_sup mult_right_dist_sup mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms sup_right_isotone circ_simulate_2 circ_simulate_4 mult_assoc mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_reflexive circ_transitive_equal le_iff_sup mult_assoc mult_right_isotone mult_1_right<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup_1 left_plus_circ mult_assoc separation<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Iterings-circ_separate_5"><span class="command">lemma</span></span> circ_separate_5<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup_sub_sup_one circ_separate_4 order_trans<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_separate_6"><span class="command">lemma</span></span> circ_separate_6<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute circ_back_loop_fixpoint circ_separate_5 mult_right_sub_dist_sup_left order_trans<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_itering <span class="main">=</span> bounded_idempotent_left_zero_semiring <span class="main">+</span> itering
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> bounded_left_conway_semiring <span class="keyword1"><span class="command">..</span></span>

<span class="comment1">(*
lemma "1 = x<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma "x = x<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma "x = x * x<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma "x * x<span class="hidden">⇧</span><sup>∘</sup> = x<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma "x<span class="hidden">⇧</span><sup>∘</sup> = x<span class="hidden">⇧</span><sup>∘</sup><span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma "(x * y)<span class="hidden">⇧</span><sup>∘</sup> = (x ⊔ y)<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma "x<span class="hidden">⇧</span><sup>∘</sup> * y<span class="hidden">⇧</span><sup>∘</sup> = (x ⊔ y)<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine,card=6] oops
lemma "(x ⊔ y)<span class="hidden">⇧</span><sup>∘</sup> = (x<span class="hidden">⇧</span><sup>∘</sup> * y<span class="hidden">⇧</span><sup>∘</sup>)<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma "1 = 1<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops

lemma "1 = (x * bot)<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma "1 ⊔ x * bot = x<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma "x<span class="hidden">⇧</span><sup>∘</sup> = x<span class="hidden">⇧</span><sup>∘</sup> * 1<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma "z ⊔ y * x = x ⟶ y<span class="hidden">⇧</span><sup>∘</sup> * z ≤ x" nitpick [expect=genuine] oops
lemma "y * x = x ⟶ y<span class="hidden">⇧</span><sup>∘</sup> * x ≤ x" nitpick [expect=genuine] oops
lemma "z ⊔ x * y = x ⟶ z * y<span class="hidden">⇧</span><sup>∘</sup> ≤ x" nitpick [expect=genuine] oops
lemma "x * y = x ⟶ x * y<span class="hidden">⇧</span><sup>∘</sup> ≤ x" nitpick [expect=genuine] oops
lemma "x = z ⊔ y * x ⟶ x ≤ y<span class="hidden">⇧</span><sup>∘</sup> * z" nitpick [expect=genuine] oops
lemma "x = y * x ⟶ x ≤ y<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
lemma "x * z = z * y ⟶ x<span class="hidden">⇧</span><sup>∘</sup> * z ≤ z * y<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops

lemma "x<span class="hidden">⇧</span><sup>∘</sup> = (x * x)<span class="hidden">⇧</span><sup>∘</sup> * (x ⊔ 1)" oops
lemma "y<span class="hidden">⇧</span><sup>∘</sup> * x<span class="hidden">⇧</span><sup>∘</sup> ≤ x<span class="hidden">⇧</span><sup>∘</sup> * y<span class="hidden">⇧</span><sup>∘</sup> ⟶ (x ⊔ y)<span class="hidden">⇧</span><sup>∘</sup> = x<span class="hidden">⇧</span><sup>∘</sup> * y<span class="hidden">⇧</span><sup>∘</sup>" oops
lemma "y * x ≤ (1 ⊔ x) * y<span class="hidden">⇧</span><sup>∘</sup> ⟶ (x ⊔ y)<span class="hidden">⇧</span><sup>∘</sup> = x<span class="hidden">⇧</span><sup>∘</sup> * y<span class="hidden">⇧</span><sup>∘</sup>" oops
lemma "y * x ≤ x ⟶ y<span class="hidden">⇧</span><sup>∘</sup> * x ≤ 1<span class="hidden">⇧</span><sup>∘</sup> * x" oops
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We finally expand Conway semirings and iterings by an element that corresponds to the endless loop.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> L <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">L</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> left_conway_semiring_L <span class="main">=</span> left_conway_semiring <span class="main">+</span> L <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> one_circ_mult_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> L <span class="main">⊔</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> L_split_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> L<span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> L"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Iterings-L_def"><span class="command">lemma</span></span> L_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"L <span class="main">=</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_monoid.add_0_right one_circ_mult_split<span class="main">)</span>

<span class="keyword1" id="Iterings-one_circ_split"><span class="command">lemma</span></span> one_circ_split<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> L <span class="main">⊔</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_1_right one_circ_mult_split<span class="main">)</span>

<span class="keyword1" id="Iterings-one_circ_circ_split"><span class="command">lemma</span></span> one_circ_circ_split<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> L <span class="main">⊔</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_one one_circ_split<span class="main">)</span>

<span class="keyword1" id="Iterings-sub_mult_one_circ"><span class="command">lemma</span></span> sub_mult_one_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L_split_sup sup_commute mult_1_right one_circ_mult_split<span class="main">)</span>

<span class="keyword1" id="Iterings-one_circ_mult_split_2"><span class="command">lemma</span></span> one_circ_mult_split_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> L"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> L <span class="main">⊔</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_circ_mult_split sub_mult_one_circ <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> circ_back_loop_prefixpoint le_iff_sup sup.boundedE<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup one_circ_mult_split sup_assoc sup_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Iterings-sub_mult_one_circ_split"><span class="command">lemma</span></span> sub_mult_one_circ_split<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> L"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute one_circ_mult_split sub_mult_one_circ<span class="main">)</span>

<span class="keyword1" id="Iterings-sub_mult_one_circ_split_2"><span class="command">lemma</span></span> sub_mult_one_circ_split_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L_def sup_right_isotone order_trans sub_mult_one_circ_split zero_right_mult_decreasing<span class="main">)</span>

<span class="keyword1" id="Iterings-L_split"><span class="command">lemma</span></span> L_split<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> L <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> bot <span class="main">⊔</span> L"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L_split_sup sup_monoid.add_0_left<span class="main">)</span>

<span class="keyword1" id="Iterings-L_left_zero"><span class="command">lemma</span></span> L_left_zero<span class="main">:</span>
  <span class="quoted"><span class="quoted">"L <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> L"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L_def mult_assoc mult_left_zero<span class="main">)</span>

<span class="keyword1" id="Iterings-one_circ_L"><span class="command">lemma</span></span> one_circ_L<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> L <span class="main">=</span> L"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L_def circ_transitive_equal mult_assoc<span class="main">)</span>

<span class="keyword1" id="Iterings-mult_L_circ"><span class="command">lemma</span></span> mult_L_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> L<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> L"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L_left_zero circ_left_unfold mult_assoc<span class="main">)</span>

<span class="keyword1" id="Iterings-mult_L_circ_mult"><span class="command">lemma</span></span> mult_L_circ_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> L<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> L"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L_left_zero mult_L_circ mult_assoc mult_1_left mult_right_dist_sup<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_L"><span class="command">lemma</span></span> circ_L<span class="main">:</span>
  <span class="quoted"><span class="quoted">"L<span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> L <span class="main">⊔</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L_left_zero sup_commute circ_left_unfold<span class="main">)</span>

<span class="keyword1" id="Iterings-L_below_one_circ"><span class="command">lemma</span></span> L_below_one_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"L <span class="main">≤</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L_def zero_right_mult_decreasing<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_circ_mult_1"><span class="command">lemma</span></span> circ_circ_mult_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L_left_zero sup_commute circ_sup_1 circ_circ_sup mult_zero_circ one_circ_split<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_circ_mult"><span class="command">lemma</span></span> circ_circ_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym circ_circ_mult_1 circ_circ_sub_mult sub_mult_one_circ<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_circ_split"><span class="command">lemma</span></span> circ_circ_split<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> L <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_circ_mult one_circ_mult_split<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_sup_6"><span class="command">lemma</span></span> circ_sup_6<span class="main">:</span>
  <span class="quoted"><span class="quoted">"L <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_assoc sup_commute circ_sup_1 circ_circ_sup circ_circ_split circ_decompose_4<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> itering_L <span class="main">=</span> itering <span class="main">+</span> L <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> L_def<span class="main">:</span> <span class="quoted"><span class="quoted">"L <span class="main">=</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> bot"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Iterings-one_circ_split"><span class="command">lemma</span></span> one_circ_split<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> L <span class="main">⊔</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L_def sup_commute order.antisym circ_sup_upper_bound circ_reflexive circ_simulate_absorb mult_1_right order_refl zero_right_mult_decreasing<span class="main">)</span>

<span class="keyword1" id="Iterings-one_circ_mult_split"><span class="command">lemma</span></span> one_circ_mult_split<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> L <span class="main">⊔</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L_def sup_commute circ_loop_fixpoint mult_assoc mult_left_zero mult_zero_circ one_circ_split<span class="main">)</span>

<span class="keyword1" id="Iterings-sub_mult_one_circ_split"><span class="command">lemma</span></span> sub_mult_one_circ_split<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> L"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute one_circ_mult_split sub_mult_one_circ<span class="main">)</span>

<span class="keyword1" id="Iterings-sub_mult_one_circ_split_2"><span class="command">lemma</span></span> sub_mult_one_circ_split_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L_def sup_right_isotone order_trans sub_mult_one_circ_split zero_right_mult_decreasing<span class="main">)</span>

<span class="keyword1" id="Iterings-L_split"><span class="command">lemma</span></span> L_split<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> L <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> bot <span class="main">⊔</span> L"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L_def mult_assoc mult_left_isotone mult_right_dist_sup sub_mult_one_circ_split_2<span class="main">)</span>

<span class="keyword1"><span class="command">subclass</span></span> left_conway_semiring_L
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> L_def sup_commute circ_loop_fixpoint mult_assoc mult_left_zero mult_zero_circ one_circ_split<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute mult_assoc mult_left_isotone one_circ_mult_split sub_mult_one_circ<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_left_induct_mult_L"><span class="command">lemma</span></span> circ_left_induct_mult_L<span class="main">:</span>
  <span class="quoted"><span class="quoted">"L <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_one circ_simulate le_iff_sup one_circ_mult_split<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_left_induct_mult_iff_L"><span class="command">lemma</span></span> circ_left_induct_mult_iff_L<span class="main">:</span>
  <span class="quoted"><span class="quoted">"L <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.bounded_iff circ_back_loop_fixpoint circ_left_induct_mult_L le_iff_sup<span class="main">)</span>

<span class="keyword1" id="Iterings-circ_left_induct_L"><span class="command">lemma</span></span> circ_left_induct_L<span class="main">:</span>
  <span class="quoted"><span class="quoted">"L <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.bounded_iff circ_left_induct_mult_L le_iff_sup mult_right_dist_sup<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Kleene_Algebras">
<div class="head">
<h1>Theory Kleene_Algebras</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Kleene Algebras
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Kleene Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Kleene algebras have been axiomatised by Kozen to describe the equational theory of regular languages \cite{Kozen1994}.
Binary relations are another important model.
This theory implements variants of Kleene algebras based on idempotent left semirings \cite{Moeller2007}.
The weakening of some semiring axioms allows the treatment of further computation models.
The presented algebras are special cases of iterings, so many results can be inherited.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Kleene_Algebras

<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Iterings">Iterings</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We start with left Kleene algebras, which use the left unfold and left induction axioms of Kleene algebras.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> star <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">star</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup></span></span></span>"</span> <span class="main">[</span>100<span class="main">]</span> 100<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> left_kleene_algebra <span class="main">=</span> idempotent_left_semiring <span class="main">+</span> star <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_left_unfold <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_left_induct <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  trancl <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>+</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">tc</span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>+</sup></span>"</span> <span class="main">[</span>100<span class="main">]</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tc</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1" id="Kleene_Algebras-star_left_unfold_equal"><span class="command">lemma</span></span> star_left_unfold_equal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_right_isotone order.antisym mult_right_isotone mult_1_right star_left_induct star_left_unfold<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This means that for some properties of Kleene algebras, only one inequality can be derived, as exemplified by the following sliding rule.
›</span></span>

<span class="keyword1" id="Kleene_Algebras-star_left_slide"><span class="command">lemma</span></span> star_left_slide<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_left_sub_dist_sup mult_1_right star_left_induct star_left_unfold_equal<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_isotone"><span class="command">lemma</span></span> star_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_right_isotone mult_left_isotone order_trans star_left_unfold mult_1_right star_left_induct<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_sup_1"><span class="command">lemma</span></span> star_sup_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_right_divisibility star_left_unfold_equal <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_left_isotone sup_left_divisibility star_left_unfold_equal <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_supI mult_right_dist_sup mult_right_sub_dist_sup_right mult_assoc star_left_unfold_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reflexive_mult_closed star_left_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star_left_induct <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone mult_right_sub_dist_sup_right star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_right_isotone star_left_unfold star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.bounded_iff mult_1_right star_left_induct star_left_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We now show that left Kleene algebras form iterings.
A sublocale is used instead of a subclass, because iterings use a different iteration operation.
›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> left_kleene_algebra <span class="main">&lt;</span> star<span class="main">:</span> left_conway_semiring <span class="keyword2"><span class="keyword">where</span></span> circ <span class="main">=</span> <span class="quoted">star</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> star_left_unfold_equal<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> star_left_slide<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> star_sup_1<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> left_kleene_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A number of lemmas in this class are taken from Georg Struth's Kleene algebra theory \cite{ArmstrongGomesStruthWeber2016}.
›</span></span>

<span class="keyword1" id="Kleene_Algebras-star_sub_one"><span class="command">lemma</span></span> star_sub_one<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_right_isotone order.eq_iff le_iff_sup mult_1_right star.circ_plus_one star_left_induct<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_one"><span class="command">lemma</span></span> star_one<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_sub_one<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_left_induct_mult"><span class="command">lemma</span></span> star_left_induct_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_left_induct<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_left_induct_mult_iff"><span class="command">lemma</span></span> star_left_induct_mult_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_left_isotone order_trans star.circ_increasing star_left_induct_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Kleene_Algebras-star_involutive"><span class="command">lemma</span></span> star_involutive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> star.circ_circ_sup star_sup_1 star_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Kleene_Algebras-star_sup_one"><span class="command">lemma</span></span> star_sup_one<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> star.circ_circ_sup star_involutive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Kleene_Algebras-star_plus_loops"><span class="command">lemma</span></span> star_plus_loops<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">1</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> star.circ_plus_one star_left_unfold_equal sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Kleene_Algebras-star_left_induct_equal"><span class="command">lemma</span></span> star_left_induct_equal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_left_induct<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_left_induct_mult_equal"><span class="command">lemma</span></span> star_left_induct_mult_equal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_left_induct_mult<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_star_upper_bound"><span class="command">lemma</span></span> star_star_upper_bound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> star_involutive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Kleene_Algebras-star_simulation_left"><span class="command">lemma</span></span> star_simulation_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone star.left_plus_below_circ mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star.circ_back_loop_prefixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_left_induct mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Algebras-quasicomm_1"><span class="command">lemma</span></span> quasicomm_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟷</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isotone order_refl order_trans star.circ_increasing star_involutive star_simulation_left<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_rtc_3"><span class="command">lemma</span></span> star_rtc_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.bounded_iff le_iff_sup mult_left_sub_dist_sup_left mult_1_right star_left_induct_mult_iff star.circ_sub_dist<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_decompose_1"><span class="command">lemma</span></span> star_decompose_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_sup_2<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> star.circ_sub_dist_3 star_isotone star_involutive <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Kleene_Algebras-star_sum"><span class="command">lemma</span></span> star_sum<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> star_decompose_1 star_involutive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Kleene_Algebras-star_decompose_3"><span class="command">lemma</span></span> star_decompose_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> star_sup_1 star_decompose_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In contrast to iterings, we now obtain that the iteration operation results in least fixpoints.
›</span></span>

<span class="keyword1" id="Kleene_Algebras-star_loop_least_fixpoint"><span class="command">lemma</span></span> star_loop_least_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute star_left_induct_equal<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_loop_is_least_fixpoint"><span class="command">lemma</span></span> star_loop_is_least_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_least_fixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="free">y</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_least_fixpoint_def star.circ_loop_fixpoint star_loop_least_fixpoint<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_loop_mu"><span class="command">lemma</span></span> star_loop_mu<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="free">y</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> least_fixpoint_same star_loop_is_least_fixpoint<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-affine_has_least_fixpoint"><span class="command">lemma</span></span> affine_has_least_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="free">y</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> has_least_fixpoint_def star_loop_is_least_fixpoint<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_outer_increasing"><span class="command">lemma</span></span> star_outer_increasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_back_loop_prefixpoint star.circ_loop_fixpoint sup.boundedE<span class="main">)</span>

<span class="comment1">(*
lemma circ_sup: "(x<span class="hidden">⇧</span><sup>⋆</sup> * y)<span class="hidden">⇧</span><sup>⋆</sup> * x<span class="hidden">⇧</span><sup>⋆</sup> = (x ⊔ y)<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine,card=7] oops
lemma circ_mult: "1 ⊔ x * (y * x)<span class="hidden">⇧</span><sup>⋆</sup> * y = (x * y)<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine] oops
lemma circ_plus_same: "x<span class="hidden">⇧</span><sup>⋆</sup> * x = x * x<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine] oops
lemma circ_unfold_sum: "(x ⊔ y)<span class="hidden">⇧</span><sup>⋆</sup> = x<span class="hidden">⇧</span><sup>⋆</sup> ⊔ x<span class="hidden">⇧</span><sup>⋆</sup> * y * (x ⊔ y)<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine,card=7] oops
lemma mult_zero_sup_circ_2: "(x ⊔ y * bot)<span class="hidden">⇧</span><sup>⋆</sup> = x<span class="hidden">⇧</span><sup>⋆</sup> ⊔ x<span class="hidden">⇧</span><sup>⋆</sup> * y * bot" nitpick [expect=genuine,card=7] oops
lemma circ_simulate_left: "x * z ≤ z * y ⊔ w ⟶ x<span class="hidden">⇧</span><sup>⋆</sup> * z ≤ (z ⊔ x<span class="hidden">⇧</span><sup>⋆</sup> * w) * y<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine] oops
lemma circ_simulate_1: "y * x ≤ x * y ⟶ y<span class="hidden">⇧</span><sup>⋆</sup> * x<span class="hidden">⇧</span><sup>⋆</sup> ≤ x<span class="hidden">⇧</span><sup>⋆</sup> * y<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine,card=7] oops
lemma circ_separate_1: "y * x ≤ x * y ⟶ (x ⊔ y)<span class="hidden">⇧</span><sup>⋆</sup> = x<span class="hidden">⇧</span><sup>⋆</sup> * y<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine,card=7] oops
lemma atomicity_refinement: "s = s * q ∧ x = q * x ∧ q * b = bot ∧ r * b ≤ b * r ∧ r * l ≤ l * r ∧ x * l ≤ l * x ∧ b * l ≤ l * b ∧ q * l ≤ l * q ∧ r<span class="hidden">⇧</span><sup>⋆</sup> * q ≤ q * r<span class="hidden">⇧</span><sup>⋆</sup> ∧ q ≤ 1 ⟶ s * (x ⊔ b ⊔ r ⊔ l)<span class="hidden">⇧</span><sup>⋆</sup> * q ≤ s * (x * b<span class="hidden">⇧</span><sup>⋆</sup> * q ⊔ r ⊔ l)<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine] oops
lemma circ_simulate_left_plus: "x * z ≤ z * y<span class="hidden">⇧</span><sup>⋆</sup> ⊔ w ⟶ x<span class="hidden">⇧</span><sup>⋆</sup> * z ≤ (z ⊔ x<span class="hidden">⇧</span><sup>⋆</sup> * w) * y<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine] oops
lemma circ_separate_unfold: "(y * x<span class="hidden">⇧</span><sup>⋆</sup>)<span class="hidden">⇧</span><sup>⋆</sup> = y<span class="hidden">⇧</span><sup>⋆</sup> ⊔ y<span class="hidden">⇧</span><sup>⋆</sup> * y * x * x<span class="hidden">⇧</span><sup>⋆</sup> * (y * x<span class="hidden">⇧</span><sup>⋆</sup>)<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine] oops
lemma separation: "y * x ≤ x * y<span class="hidden">⇧</span><sup>⋆</sup> ⟶ (x ⊔ y)<span class="hidden">⇧</span><sup>⋆</sup> = x<span class="hidden">⇧</span><sup>⋆</sup> * y<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine,card=7] oops
lemma circ_simulate_4: "y * x ≤ x * x<span class="hidden">⇧</span><sup>⋆</sup> * (1 ⊔ y) ⟶ y<span class="hidden">⇧</span><sup>⋆</sup> * x<span class="hidden">⇧</span><sup>⋆</sup> ≤ x<span class="hidden">⇧</span><sup>⋆</sup> * y<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine,card=7] oops
lemma circ_simulate_5: "y * x ≤ x * x<span class="hidden">⇧</span><sup>⋆</sup> * (x ⊔ y) ⟶ y<span class="hidden">⇧</span><sup>⋆</sup> * x<span class="hidden">⇧</span><sup>⋆</sup> ≤ x<span class="hidden">⇧</span><sup>⋆</sup> * y<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine,card=7] oops
lemma circ_simulate_6: "y * x ≤ x * (x ⊔ y) ⟶ y<span class="hidden">⇧</span><sup>⋆</sup> * x<span class="hidden">⇧</span><sup>⋆</sup> ≤ x<span class="hidden">⇧</span><sup>⋆</sup> * y<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine,card=7] oops
lemma circ_separate_4: "y * x ≤ x * x<span class="hidden">⇧</span><sup>⋆</sup> * (1 ⊔ y) ⟶ (x ⊔ y)<span class="hidden">⇧</span><sup>⋆</sup> = x<span class="hidden">⇧</span><sup>⋆</sup> * y<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine,card=7] oops
lemma circ_separate_5: "y * x ≤ x * x<span class="hidden">⇧</span><sup>⋆</sup> * (x ⊔ y) ⟶ (x ⊔ y)<span class="hidden">⇧</span><sup>⋆</sup> = x<span class="hidden">⇧</span><sup>⋆</sup> * y<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine,card=7] oops
lemma circ_separate_6: "y * x ≤ x * (x ⊔ y) ⟶ (x ⊔ y)<span class="hidden">⇧</span><sup>⋆</sup> = x<span class="hidden">⇧</span><sup>⋆</sup> * y<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine,card=7] oops
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We next add the right induction rule, which allows us to strengthen many inequalities of left Kleene algebras to equalities.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> strong_left_kleene_algebra <span class="main">=</span> left_kleene_algebra <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_right_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Kleene_Algebras-star_plus"><span class="command">lemma</span></span> star_plus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_plus_sub<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone star.right_plus_below_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_mult_increasing_2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star_right_induct <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Algebras-star_slide"><span class="command">lemma</span></span> star_slide<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> star_left_slide<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> sup.commute eq_refl star.circ_loop_fixpoint mult.assoc star_plus<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc star_right_induct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Algebras-star_simulation_right"><span class="command">lemma</span></span> star_simulation_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms dual_order.trans mult_isotone mult_left_sub_dist_sup_right star.circ_loop_fixpoint star.circ_transitive_equal sup.cobounded1 mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_supI star.circ_loop_fixpoint star_right_induct sup.cobounded2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Again we inherit results from the itering hierarchy.
›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> strong_left_kleene_algebra <span class="main">&lt;</span> star<span class="main">:</span> itering_1 <span class="keyword2"><span class="keyword">where</span></span> circ <span class="main">=</span> <span class="quoted">star</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_slide<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_simulation_right<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> strong_left_kleene_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Kleene_Algebras-star_right_induct_mult"><span class="command">lemma</span></span> star_right_induct_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_right_induct<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_right_induct_mult_iff"><span class="command">lemma</span></span> star_right_induct_mult_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_right_isotone order_trans star.circ_increasing star_right_induct_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Kleene_Algebras-star_simulation_right_equal"><span class="command">lemma</span></span> star_simulation_right_equal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.eq_iff star_simulation_left star_simulation_right<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_simulation_star"><span class="command">lemma</span></span> star_simulation_star<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_simulation_left star_simulation_right<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_right_induct_equal"><span class="command">lemma</span></span> star_right_induct_equal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_right_induct<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_right_induct_mult_equal"><span class="command">lemma</span></span> star_right_induct_mult_equal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_right_induct_mult<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_back_loop_least_fixpoint"><span class="command">lemma</span></span> star_back_loop_least_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute star_right_induct_equal<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_back_loop_is_least_fixpoint"><span class="command">lemma</span></span> star_back_loop_is_least_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_least_fixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_least_fixpoint_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_supI1 mult_left_isotone star.circ_back_loop_prefixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_right_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">=</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order.antisym star.circ_back_loop_prefixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_back_loop_least_fixpoint<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Algebras-star_back_loop_mu"><span class="command">lemma</span></span> star_back_loop_mu<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> least_fixpoint_same star_back_loop_is_least_fixpoint<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_square"><span class="command">lemma</span></span> star_square<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"isotone <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_left_isotone isotone_def mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∘</span> <span class="var">?f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_assoc sup_commute mult_assoc mult_right_dist_sup o_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mu_square mult_left_one star_back_loop_mu has_least_fixpoint_def star_back_loop_is_least_fixpoint<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Algebras-star_square_2"><span class="command">lemma</span></span> star_square_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_right_dist_sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> order.antisym mult_left_sub_dist_sup star.circ_square_2 star_slide sup_commute star_square<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Algebras-star_circ_simulate_right_plus"><span class="command">lemma</span></span> star_circ_simulate_right_plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_right_dist_sup star.circ_back_loop_prefixpoint sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_supI1 star.circ_back_loop_prefixpoint sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.bounded_iff mult_isotone mult_left_isotone mult_left_one mult_left_sub_dist_sup_left star.circ_reflexive star.left_plus_below_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_right_isotone star.circ_transitive_equal<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.bounded_iff star_right_induct mult_left_sub_dist_sup_left star.circ_loop_fixpoint<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Algebras-transitive_star"><span class="command">lemma</span></span> transitive_star<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym star.circ_mult_increasing_2 star.circ_plus_same star_left_induct_mult star_left_unfold_equal<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_sup_2"><span class="command">lemma</span></span> star_sup_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_decompose_6 star_sup_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> dual_order.antisym star.circ_back_loop_prefixpoint star_right_induct_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sup_commute transitive_star<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*
lemma star_circ_simulate_left_plus: "x * z ≤ z * y<span class="hidden">⇧</span><sup>⋆</sup> ⊔ w ⟶ x<span class="hidden">⇧</span><sup>⋆</sup> * z ≤ (z ⊔ x<span class="hidden">⇧</span><sup>⋆</sup> * w) * y<span class="hidden">⇧</span><sup>⋆</sup>" nitpick [expect=genuine,card=7] oops
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following class contains a generalisation of Kleene algebras, which lacks the right zero axiom.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> left_zero_kleene_algebra <span class="main">=</span> idempotent_left_zero_semiring <span class="main">+</span> strong_left_kleene_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Kleene_Algebras-star_star_absorb"><span class="command">lemma</span></span> star_star_absorb<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_transitive_equal star_slide mult_assoc<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_circ_simulate_left_plus"><span class="command">lemma</span></span> star_circ_simulate_left_plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> mult_right_sub_dist_sup_left star.circ_loop_fixpoint mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_left_dist_sup mult_right_dist_sup sup_right_isotone mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms mult_isotone semiring.add_right_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_dist_sup star.circ_transitive_equal mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_assoc sup_ge2 le_iff_sup star.circ_loop_fixpoint<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.bounded_iff mult_left_sub_dist_sup_left mult_1_right star.circ_right_unfold_1 star_left_induct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Algebras-star_one_sup_below"><span class="command">lemma</span></span> star_one_sup_below<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_ge2 order_trans star.circ_increasing star.circ_mult_upper_bound star.circ_sub_dist <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_sup_upper_bound star.circ_sub_dist<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_right_isotone mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following theorem is similar to the puzzle where persons insert themselves always in the middle between two groups of people in a line.
Here, however, items in the middle annihilate each other, leaving just one group of items behind.
›</span></span>

<span class="keyword1" id="Kleene_Algebras-cancel_separate"><span class="command">lemma</span></span> cancel_separate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_left_dist_sup mult_1_right star_left_unfold_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms dual_order.trans order.refl star.circ_mult_upper_bound star.circ_reflexive sup_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star.circ_increasing sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.bounded_iff sup_ge1 order_trans star.left_plus_below_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 sup.bounded_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_left_induct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Algebras-star_separate"><span class="command">lemma</span></span> star_separate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> transitive_star<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_decompose_6 star_sup_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_left_unfold_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms mult_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We can now inherit from the strongest variant of iterings.
›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> left_zero_kleene_algebra <span class="main">&lt;</span> star<span class="main">:</span> itering <span class="keyword2"><span class="keyword">where</span></span> circ <span class="main">=</span> <span class="quoted">star</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_sup_9<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_mult_1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_circ_simulate_right_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_circ_simulate_left_plus<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> left_zero_kleene_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Kleene_Algebras-star_absorb"><span class="command">lemma</span></span> star_absorb<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> bot <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.bounded_iff antisym_conv star.circ_back_loop_prefixpoint star.circ_elimination<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_separate_2"><span class="command">lemma</span></span> star_separate_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mult_assoc mult_1_left mult_left_zero star.circ_zero star_simulation_right_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone star.left_plus_below_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_left_isotone star.left_plus_below_circ star.right_plus_circ star_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_left_sub_dist_sup_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_right_divisibility star.circ_back_loop_fixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_1_right semiring.distrib_left star.circ_plus_same mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring.distrib_right mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_left_dist_sup mult_right_dist_sup sup_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult_left_dist_sup mult_left_zero sup_commute sup_monoid.add_0_left mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_outer_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_right_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_ge1 mult_right_isotone mult_1_right star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms star_absorb<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_supE mult_right_sub_dist_sup_left star.circ_loop_fixpoint<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_left_isotone star.circ_transitive_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_left_induct sup.bounded_iff mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Algebras-cancel_separate_eq"><span class="command">lemma</span></span> cancel_separate_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym cancel_separate star.circ_plus_one star.circ_sup_sub_sup_one_1 star_involutive<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-cancel_separate_1"><span class="command">lemma</span></span> cancel_separate_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_right_dist_sup star.circ_back_loop_fixpoint<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms semiring.add_right_mono mult_right_isotone mult_1_right mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> semiring.add_left_mono star.right_plus_below_circ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_back_loop_fixpoint sup.left_idem sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_left_dist_sup order_lesseq_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_back_loop_fixpoint sup.left_idem<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_decompose_7 star_right_induct_mult sup_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> order.antisym star.circ_sub_dist_3 sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Algebras-plus_sup"><span class="command">lemma</span></span> plus_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> semiring.distrib_left star.circ_sup_9 star_plus mult_assoc<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-plus_half_bot"><span class="command">lemma</span></span> plus_half_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> bot <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_absorb star_slide mult_assoc<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-cancel_separate_1_sup"><span class="command">lemma</span></span> cancel_separate_1_sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms cancel_separate_1 cancel_separate_eq sup_commute<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>star_separate_3›</span></span></span></span> was contributed by Nicolas Robinson-O'Brien.›</span></span>

<span class="keyword1" id="Kleene_Algebras-star_separate_3"><span class="command">lemma</span></span> star_separate_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mult_left_isotone mult_right_isotone star_right_induct_mult mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym semiring.add_left_mono star.circ_sup_2 star.circ_sup_sub star.circ_unfold_sum star_decompose_3 star_slide mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_isotone star.circ_increasing star.circ_sub_dist star.circ_sup_9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A Kleene algebra is obtained by requiring an idempotent semiring.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> kleene_algebra <span class="main">=</span> left_zero_kleene_algebra <span class="main">+</span> idempotent_semiring

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following classes are variants of Kleene algebras expanded by an additional iteration operation.
This is useful to study the Kleene star in computation models that do not use least fixpoints in the refinement order as the semantics of recursion.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> left_kleene_conway_semiring <span class="main">=</span> left_kleene_algebra <span class="main">+</span> left_conway_semiring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Kleene_Algebras-star_below_circ"><span class="command">lemma</span></span> star_below_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_left_unfold mult_1_right order_refl star_left_induct<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_zero_below_circ_mult"><span class="command">lemma</span></span> star_zero_below_circ_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> bot <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isotone star_below_circ<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_mult_circ"><span class="command">lemma</span></span> star_mult_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_right_divisibility order.antisym circ_left_unfold star_left_induct_mult star.circ_loop_fixpoint<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-circ_mult_star"><span class="command">lemma</span></span> circ_mult_star<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_assoc sup.bounded_iff circ_left_unfold circ_rtc_2 order.eq_iff left_plus_circ star.circ_sup_sub star.circ_back_loop_prefixpoint star.circ_increasing star_below_circ star_mult_circ star_sup_one<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-circ_star"><span class="command">lemma</span></span> circ_star<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym circ_reflexive circ_transitive_equal star.circ_increasing star.circ_sup_one_right_unfold star_left_induct_mult_equal<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-star_circ"><span class="command">lemma</span></span> star_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym circ_circ_sup circ_sub_dist le_iff_sup star.circ_rtc_2 star_below_circ<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-circ_sup_3"><span class="command">lemma</span></span> circ_sup_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> circ_star circ_sub_dist_3 star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> left_zero_kleene_conway_semiring <span class="main">=</span> left_zero_kleene_algebra <span class="main">+</span> itering
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> left_kleene_conway_semiring <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Kleene_Algebras-circ_isolate"><span class="command">lemma</span></span> circ_isolate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> bot <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute order.antisym circ_sup_upper_bound circ_mult_star circ_simulate_absorb star.left_plus_below_circ star_below_circ zero_right_mult_decreasing<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-circ_isolate_mult"><span class="command">lemma</span></span> circ_isolate_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> bot <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_isolate mult_assoc mult_left_zero mult_right_dist_sup<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-circ_isolate_mult_sub"><span class="command">lemma</span></span> circ_isolate_mult_sub<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_left_isotone circ_isolate_mult zero_right_mult_decreasing<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-circ_sub_decompose"><span class="command">lemma</span></span> circ_sub_decompose<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> bot <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.commute circ_isolate_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_star circ_sup_9 circ_sup_mult_zero star_decompose_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_star le_iff_sup star.circ_decompose_7 star.circ_unfold_sum<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Algebras-circ_sup_4"><span class="command">lemma</span></span> circ_sup_4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup circ_sub_decompose circ_transitive_equal mult_assoc mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_sup circ_isotone mult_left_isotone star_below_circ<span class="main">)</span>

<span class="keyword1" id="Kleene_Algebras-circ_sup_5"><span class="command">lemma</span></span> circ_sup_5<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> circ_sup_4 circ_sup_9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Kleene_Algebras-plus_circ"><span class="command">lemma</span></span> plus_circ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∘</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_idem circ_sup_4 circ_decompose_7 circ_star star.circ_decompose_5 star.right_plus_circ<span class="main">)</span>

<span class="comment1">(*
lemma "(x<span class="hidden">⇧</span><sup>⋆</sup> * y * x<span class="hidden">⇧</span><sup>⋆</sup>)<span class="hidden">⇧</span><sup>∘</sup> = (x<span class="hidden">⇧</span><sup>⋆</sup> * y)<span class="hidden">⇧</span><sup>∘</sup>" nitpick [expect=genuine] oops
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following classes add a greatest element.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_left_kleene_algebra <span class="main">=</span> bounded_idempotent_left_semiring <span class="main">+</span> left_kleene_algebra

<span class="keyword1"><span class="command">sublocale</span></span> bounded_left_kleene_algebra <span class="main">&lt;</span> star<span class="main">:</span> bounded_left_conway_semiring <span class="keyword2"><span class="keyword">where</span></span> circ <span class="main">=</span> <span class="quoted">star</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_left_zero_kleene_algebra <span class="main">=</span> bounded_idempotent_left_semiring <span class="main">+</span> left_zero_kleene_algebra

<span class="keyword1"><span class="command">sublocale</span></span> bounded_left_zero_kleene_algebra <span class="main">&lt;</span> star<span class="main">:</span> bounded_itering <span class="keyword2"><span class="keyword">where</span></span> circ <span class="main">=</span> <span class="quoted">star</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_kleene_algebra <span class="main">=</span> bounded_idempotent_semiring <span class="main">+</span> kleene_algebra

<span class="keyword1"><span class="command">sublocale</span></span> bounded_kleene_algebra <span class="main">&lt;</span> star<span class="main">:</span> bounded_itering <span class="keyword2"><span class="keyword">where</span></span> circ <span class="main">=</span> <span class="quoted">star</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We conclude with an alternative axiomatisation of Kleene algebras.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> kleene_algebra_var <span class="main">=</span> idempotent_semiring <span class="main">+</span> star <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_left_unfold_var <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_left_induct_var <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_right_induct_var <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> kleene_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> star_left_unfold_var<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> sup.bounded_iff mult_right_isotone order_trans star_left_induct_var<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> sup.bounded_iff mult_left_isotone order_trans star_right_induct_var<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Kleene_Relation_Algebras">
<div class="head">
<h1>Theory Kleene_Relation_Algebras</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Kleene Relation Algebras
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Kleene Relation Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory combines Kleene algebras with Stone relation algebras.
Relation algebras with transitive closure have been studied by \cite{Ng1984}.
The weakening to Stone relation algebras allows us to talk about reachability in weighted graphs, for example.

Many results in this theory are used in the correctness proof of Prim's minimum spanning tree algorithm.
In particular, they are concerned with the exchange property, preservation of parts of the invariant and with establishing parts of the postcondition.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Kleene_Relation_Algebras

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../stone_relation_algebras/theories/#Relation_Algebras">Stone_Relation_Algebras.Relation_Algebras</a> <a href="#Kleene_Algebras">Kleene_Algebras</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We first note that bounded distributive lattices can be expanded to Kleene algebras by reusing some of the operations.
›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> bounded_distrib_lattice <span class="main">&lt;</span> comp_inf<span class="main">:</span> bounded_kleene_algebra <span class="keyword2"><span class="keyword">where</span></span> star <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> top"</span></span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted">top</span> <span class="keyword2"><span class="keyword">and</span></span> times <span class="main">=</span> <span class="quoted">inf</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_infI2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We add the Kleene star operation to each of bounded distributive allegories, pseudocomplemented distributive allegories and Stone relation algebras.
We start with single-object bounded distributive allegories.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_distrib_kleene_allegory <span class="main">=</span> bounded_distrib_allegory <span class="main">+</span> kleene_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> bounded_kleene_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-conv_star_conv"><span class="command">lemma</span></span> conv_star_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.right_plus_below_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_dist_comp conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflexive_conv_closed star.circ_reflexive<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> star_left_induct <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
It follows that star and converse commute.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-conv_star_commute"><span class="command">lemma</span></span> conv_star_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_star_conv conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_star_conv conv_involutive<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-conv_plus_commute"><span class="command">lemma</span></span> conv_plus_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp conv_star_commute star_plus<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>reflexive_inf_star›</span></span></span></span> was contributed by Nicolas Robinson-O'Brien.›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-reflexive_inf_star"><span class="command">lemma</span></span> reflexive_inf_star<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reflexive <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms star_left_unfold_equal sup.absorb2 sup_inf_distrib1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following results are variants of a separation lemma of Kleene algebras.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-cancel_separate_2"><span class="command">lemma</span></span> cancel_separate_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms comp_isotone order.trans inf.cobounded2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> cancel_separate_1 sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-cancel_separate_3"><span class="command">lemma</span></span> cancel_separate_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms comp_isotone order.trans inf.cobounded2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cancel_separate_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-cancel_separate_4"><span class="command">lemma</span></span> cancel_separate_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> inf.orderE inf_sup_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cancel_separate_2 sup_commute mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cancel_separate_3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-cancel_separate_5"><span class="command">lemma</span></span> cancel_separate_5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dedekind_2 inf_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_inf inf.coboundedI2 mult_left_isotone mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mult_1_left mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-cancel_separate_6"><span class="command">lemma</span></span> cancel_separate_6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⊓</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">v</span> <span class="main">⊓</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_inf.mult_right_isotone mult_left_isotone star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">⊓</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.coboundedI2 star.circ_increasing star.circ_mult_upper_bound star_right_induct_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">v</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> cancel_separate_4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_sup_distrib1 star.circ_back_loop_fixpoint<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> cancel_separate_5 semiring.add_right_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1 mult_left_dist_sup sup_monoid.add_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf.semiring.distrib_left star.circ_back_loop_fixpoint sup_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> cancel_separate_5 sup_left_isotone sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_inf.mult_right_isotone star_isotone sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We show several results about the interaction of vectors and the Kleene star.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-vector_star_1"><span class="command">lemma</span></span> vector_star_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_slide<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms vector_conv_covector <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-vector_star_2"><span class="command">lemma</span></span> vector_star_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> bot<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_absorb vector_star_1<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-vector_vector_star"><span class="command">lemma</span></span> vector_vector_star<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">v</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> transitive_star vv_transitive<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-equivalence_star_closed"><span class="command">lemma</span></span> equivalence_star_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equivalence <span class="free">x</span> <span class="main">⟹</span> equivalence <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_star_commute star.circ_reflexive star.circ_transitive_equal<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-equivalence_plus_closed"><span class="command">lemma</span></span> equivalence_plus_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equivalence <span class="free">x</span> <span class="main">⟹</span> equivalence <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_star_commute star.circ_reflexive star.circ_sup_one_left_unfold star.circ_transitive_equal<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following equivalence relation characterises the component trees of a forest.
This is a special case of undirected reachability in a directed graph.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">forest_components</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-forest_components_equivalence"><span class="command">lemma</span></span> forest_components_equivalence<span class="main">:</span>
  <span class="quoted"><span class="quoted">"injective <span class="free">x</span> <span class="main">⟹</span> equivalence <span class="main">(</span>forest_components <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflexive_mult_closed star.circ_reflexive<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> cancel_separate_1 order.eq_iff star.circ_transitive_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp conv_star_commute<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-forest_components_increasing"><span class="command">lemma</span></span> forest_components_increasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> forest_components <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.trans mult_left_isotone mult_left_one star.circ_increasing star.circ_reflexive<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-forest_components_isotone"><span class="command">lemma</span></span> forest_components_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> forest_components <span class="free">x</span> <span class="main">≤</span> forest_components <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone conv_isotone star_isotone<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-forest_components_idempotent"><span class="command">lemma</span></span> forest_components_idempotent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"injective <span class="free">x</span> <span class="main">⟹</span> forest_components <span class="main">(</span>forest_components <span class="free">x</span><span class="main">)</span> <span class="main">=</span> forest_components <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> forest_components_equivalence cancel_separate_1 star.circ_transitive_equal star_involutive<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-forest_components_star"><span class="command">lemma</span></span> forest_components_star<span class="main">:</span>
  <span class="quoted"><span class="quoted">"injective <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span>forest_components <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> forest_components <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> forest_components_equivalence forest_components_idempotent star.circ_transitive_equal <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemma shows that the nodes reachable in the graph can be reached by only using edges between reachable nodes.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-reachable_restrict"><span class="command">lemma</span></span> reachable_restrict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_right_isotone mult_1_right star.circ_reflexive <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"covector <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms covector_mult_closed vector_conv_covector <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">g</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone mult_right_isotone star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_right_isotone star.left_plus_below_circ star_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">g</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">g</span> <span class="main">⊓</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊓</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms covector_comp_inf covector_mult_closed vector_conv_covector <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊓</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.absorb2 inf_commute mult_right_isotone star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊓</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf_vector_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_commute inf_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> covector_conv_vector inf_top.right_neutral vector_inf_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_right_isotone star.left_plus_below_circ star_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 star_right_induct <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.eq_iff mult_right_isotone star_isotone<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_acyclic_inv_1"><span class="command">lemma</span></span> kruskal_acyclic_inv_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">f</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> forest_components <span class="free">f</span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"forest_components <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="var">?q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="var">?q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> comp_associative conv_dist_inf covector_conv_vector inf_vector_comp vector_top_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?F</span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_inf.mult_right_isotone mult_left_isotone star.circ_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="var">?F</span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp conv_star_commute mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="var">?F</span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp conv_star_commute conv_top inf.sup_left_isotone star.circ_right_top star_outer_increasing mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?F</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="var">?F</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> forest_components_equivalence equivalence_comp_dist_inf mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="var">?F</span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_inf_vector_1 conv_dist_comp inf_vector_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="var">?F</span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_forest_components_inf_1"><span class="command">lemma</span></span> kruskal_forest_components_inf_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≤</span> forest_components <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> forest_components <span class="main">(</span>forest_components <span class="free">g</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">≤</span> forest_components <span class="main">(</span>forest_components <span class="free">g</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"forest_components <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"forest_components <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> <span class="var">?w</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊔</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf.absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="var">?w</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1 semiring.distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="var">?w</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> inf.sup_left_isotone mult_left_isotone sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="var">?w</span> <span class="main">⊔</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> inf.sup_left_isotone mult_left_isotone sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="var">?w</span> <span class="main">⊔</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp conv_dist_inf conv_star_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="var">?w</span> <span class="main">⊔</span> <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_loop_fixpoint sup_ge1 sup_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?w</span> <span class="main">⊔</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative mult_left_dist_sup star.circ_loop_fixpoint sup_commute sup_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?w</span> <span class="main">⊔</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star.left_plus_below_circ sup_left_isotone sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?w</span> <span class="main">⊔</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_loop_fixpoint sup.right_idem<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?w</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_associative conv_dist_inf mult_isotone sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> coreflexive_comp_top_inf inf.cobounded2 sup.orderE<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_forest_components_inf"><span class="command">lemma</span></span> kruskal_forest_components_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"forest_components <span class="free">f</span> <span class="main">≤</span> forest_components <span class="main">(</span>forest_components <span class="free">f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"forest_components <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"forest_components <span class="main">(</span><span class="var">?f</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflexive_mult_closed star.circ_reflexive<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> <span class="var">?w</span> <span class="main">≤</span> <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms forest_components_increasing kruskal_forest_components_inf_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 star_left_induct <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?w</span> <span class="main">≤</span> <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> kruskal_forest_components_inf_1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_dist_sup conv_involutive conv_isotone sup_commute<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_supI2 star.circ_back_loop_fixpoint star.circ_increasing<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">≤</span> <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 star_left_induct <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We next add the Kleene star to single-object pseudocomplemented distributive allegories.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> pd_kleene_allegory <span class="main">=</span> pd_allegory <span class="main">+</span> bounded_distrib_kleene_allegory
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following definitions and results concern acyclic graphs and forests.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">acyclic</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">acyclic</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">forest</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">forest</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> injective <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> acyclic <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-forest_bot"><span class="command">lemma</span></span> forest_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"forest bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Kleene_Relation_Algebras-acyclic_down_closed"><span class="command">lemma</span></span> acyclic_down_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> acyclic <span class="free">y</span> <span class="main">⟹</span> acyclic <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> comp_isotone star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Kleene_Relation_Algebras-forest_down_closed"><span class="command">lemma</span></span> forest_down_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> forest <span class="free">y</span> <span class="main">⟹</span> forest <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_isotone mult_isotone star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Kleene_Relation_Algebras-acyclic_star_below_complement"><span class="command">lemma</span></span> acyclic_star_below_complement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclic <span class="free">w</span> <span class="main">⟷</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_star_commute schroeder_4_p<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-acyclic_star_below_complement_1"><span class="command">lemma</span></span> acyclic_star_below_complement_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclic <span class="free">w</span> <span class="main">⟷</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pseudo_complement schroeder_5_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Kleene_Relation_Algebras-acyclic_star_inf_conv"><span class="command">lemma</span></span> acyclic_star_inf_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_star_commute dedekind_2 star.circ_transitive_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_star_commute p_antitone_iff pseudo_complement schroeder_4_p semiring.mult_not_zero star.circ_circ_mult star_involutive star_one<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.eq_iff le_bot mult_left_zero star.circ_plus_one star.circ_zero star_left_unfold_equal sup_inf_distrib1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.antisym star.circ_reflexive<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-acyclic_asymmetric"><span class="command">lemma</span></span> acyclic_asymmetric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclic <span class="free">w</span> <span class="main">⟹</span> asymmetric <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dual_order.trans pseudo_complement schroeder_5_p star.circ_increasing<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-forest_separate"><span class="command">lemma</span></span> forest_separate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms schroeder_5_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pseudo_complement<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star.circ_right_unfold_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms injective_comp_right_dist_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> conv_star_commute conv_dist_comp conv_dist_inf conv_involutive coreflexive_symmetric<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms cancel_separate inf.sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following definition captures the components of undirected weighted graphs.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">components</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-components_equivalence"><span class="command">lemma</span></span> components_equivalence<span class="main">:</span>
  <span class="quoted"><span class="quoted">"symmetric <span class="free">x</span> <span class="main">⟹</span> equivalence <span class="main">(</span>components <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_star_commute conv_complement star.circ_reflexive star.circ_transitive_equal<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-components_increasing"><span class="command">lemma</span></span> components_increasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> components <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order_trans pp_increasing star.circ_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Kleene_Relation_Algebras-components_isotone"><span class="command">lemma</span></span> components_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> components <span class="free">x</span> <span class="main">≤</span> components <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_isotone star_isotone<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-cut_reachable"><span class="command">lemma</span></span> cut_reachable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span> <span class="main">≤</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_left_isotone mult_right_isotone top_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_involutive<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> conv_isotone inf.sup_left_isotone mult_left_isotone mult_right_isotone star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_involutive dedekind_1 inf_top.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_right_isotone star.left_plus_below_circ star_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemma shows that the predecessors of visited nodes in the minimum spanning tree extending the current tree have all been visited.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-predecessors_reachable"><span class="command">lemma</span></span> predecessors_reachable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">r</span> <span class="main">≤</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> mult_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_associative conv_dist_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> conv_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp conv_star_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="free">w</span> <span class="main">*</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone acyclic_star_below_complement<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span> <span class="main">*</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_injective_below_complement<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">r</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> conv_dist_comp conv_involutive conv_star_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">⊔</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> calculation star.circ_loop_fixpoint<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">⊔</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> comp_isotone conv_isotone semiring.add_right_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_left_dist_sup mult_assoc mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_left_induct_mult_iff star_sub_one<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Prim's Algorithm›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following results are used for proving the correctness of Prim's minimum spanning tree algorithm.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Preservation of Invariant›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We first treat the preservation of the invariant.
The following lemma shows that the while-loop preserves that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>v›</span></span></span></span> represents the nodes of the constructed tree.
The remaining lemmas in this section show that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t›</span></span></span></span> is a spanning tree.
The exchange property is treated in the following two sections.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-reachable_inv"><span class="command">lemma</span></span> reachable_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">t</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> mult_right_isotone star.circ_sub_dist<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> top <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf_absorb2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_left_isotone mult_right_isotone top_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_inf_vector inf.sup_monoid.add_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> vector_conv_covector <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative mult_right_isotone star.right_plus_below_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup.bounded_iff star.circ_back_loop_prefixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> conv_isotone sup_ge1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span> <span class="main">⊔</span> top <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_isotone semiring.add_left_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span> <span class="main">⊔</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">t</span> <span class="main">⊔</span> top <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_sup mult_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span> <span class="main">⊔</span> top <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> comp_associative<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> top <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> star.circ_back_loop_fixpoint sup_ge1 sup_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> top <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_right_induct_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The next result is used to show that the while-loop preserves acyclicity of the constructed tree.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-acyclic_inv"><span class="command">lemma</span></span> acyclic_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="free">t</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> comp_associative mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_left_isotone mult_right_isotone top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_increasing schroeder_3_p<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-4<span class="main">)</span> et<span class="main">(</span>1<span class="main">)</span> star_absorb <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">e</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_loop_fixpoint star_square_2 sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> ee comp_left_zero bot_least sup_absorb1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_increasing schroeder_3_p<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star_sup_1 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_absorb assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> ee<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sup.absorb1 sup.orderI sup_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemma shows that the extended tree is in the component reachable from the root.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-mst_subgraph_inv_2"><span class="command">lemma</span></span> mst_subgraph_inv_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"regular <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"regular <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">*</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="var">?G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> inf_pp_commute mult_right_isotone star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_inf.mult_right_isotone comp_isotone conv_isotone inf.commute mult_right_isotone pp_isotone star_isotone sup.cobounded1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="var">?c</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">≤</span> <span class="var">?c</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_isotone conv_involutive<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="var">?c</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 order_trans mult_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> inf.bounded_iff inf.sup_left_divisibility mult_right_isotone top.extremum<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_left_mult_increasing inf.boundedI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf_covector inf.absorb2 mult_assoc top.extremum<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> sup_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2 mult_assoc mult_left_dist_sup conv_dist_comp conv_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> comp_left_increasing_sup inf.sup_left_isotone pp_dist_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">e</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ex231c<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> mult_left_isotone conv_isotone conv_dist_comp mult_assoc mult_isotone conv_involutive conv_complement inf.boundedE<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_left_isotone mult_right_isotone top.extremum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative mult_right_isotone star.circ_mult_upper_bound star.circ_sub_dist_1 star_isotone sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_right_isotone star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?c</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-span_inv"><span class="command">lemma</span></span> span_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> ve_dist <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="var">?d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp conv_dist_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="var">?d</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> conv_involutive<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_dist_comp conv_star_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> mult_left_isotone star_right_induct_mult_iff star_sub_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_left_isotone star.circ_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> mult_right_isotone star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_transitive_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative mult_right_isotone star.circ_plus_same star.left_plus_below_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_isotone eq_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="bound">x</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative mult_left_dist_sup mult_right_dist_sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> mult_assoc mult_right_dist_sup mult_right_zero sup_bot_right vTeT<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> comp_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vTeT assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_bot<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> star.circ_isotone vector_vector_star inf_le1 comp_associative comp_right_isotone comp_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_bot<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> star.circ_isotone vector_vector_star inf_le1 comp_associative comp_right_isotone comp_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_bot<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 8 9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5 6 sup.mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> comp_associative comp_right_zero ev comp_left_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_bot<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> comp_associative comp_right_zero ev comp_left_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_bot<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> arc_injective comp_associative comp_left_isotone comp_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_transitive_equal comp_associative<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> arc_injective comp_associative comp_left_isotone comp_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 11 12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 13 14 sup_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_right_isotone star.circ_reflexive <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring.distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring.distrib_left semiring.distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 10 15 le_supI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 16 sup_least <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_right_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_one_sup_below<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Exchange gives Spanning Trees›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following abbreviations are used in the spanning tree application using Prim's algorithm to construct the new tree for the exchange property.
It is obtained by replacing an edge with one that has minimal weight and reversing the path connecting these edges.
Here, w represents a weighted graph, v represents a set of nodes and e represents an edge.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">prim_E</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">prim_E</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">*</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">prim_P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">prim_P</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">⊓</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">*</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">prim_EP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">prim_EP</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">⊓</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">prim_W</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">prim_W</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The lemmas in this section are used to show that the relation after exchange represents a spanning tree.
The results in the next section are used to show that it is a minimum spanning tree.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-exchange_injective_3"><span class="command">lemma</span></span> exchange_injective_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms schroeder_4_p vTeT<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_right_divisibility star.circ_back_loop_fixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.assoc inf_import_p le_infI2 p_antitone p_antitone_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p_top schroeder_4_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-exchange_injective_6"><span class="command">lemma</span></span> exchange_injective_6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> p_antitone p_antitone_iff point_injective<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_involutive p_top triple_schroeder_p<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_inf.mult_left_isotone conv_dist_inf mult_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_dist_comp conv_dist_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_star_commute inf_vector_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dedekind mult_assoc conv_involutive inf_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> mult_left_isotone mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_bot semiring.mult_not_zero mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The graph after exchanging is injective.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-exchange_injective"><span class="command">lemma</span></span> exchange_injective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"injective <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone conv_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_complement conv_dist_comp conv_dist_inf<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf_vector conv_dist_comp conv_involutive inf_top_left mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_inf.mult_right_isotone mult_left_isotone mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> comp_inf_covector vector_conv_compl<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_isotone inf.coboundedI1 star.circ_plus_same star.left_plus_below_circ<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.assoc inf_import_p le_infI2 p_antitone p_antitone_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p_top schroeder_4_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> exchange_injective_3 bot_least<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 conv_dist_comp coreflexive_symmetric <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_inf mult_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> conv_star_commute conv_dist_comp conv_involutive conv_top mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_isotone comp_right_isotone mult_assoc assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> point_injective<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_isotone inf.left_commute inf.sup_monoid.add_commute mult_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> forest_separate<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms exchange_injective_6 bot_least <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp conv_involutive coreflexive_symmetric<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 6 conv_dist_comp coreflexive_symmetric <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> arc_injective<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>  <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_left_dist_sup comp_right_dist_sup conv_dist_sup sup.assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 3 4 5 6 7 8 9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-pv"><span class="command">lemma</span></span> pv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> conv_isotone inf_le1 inf_le2 mult_left_isotone order_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement conv_dist_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms covector_vector_comp mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-vector_pred_inv"><span class="command">lemma</span></span> vector_pred_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">e</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
   <span class="keyword1"><span class="command">using</span></span> assms exchange_injective_3 exchange_injective_6 comp_left_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> pv ev sup_bot_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">⊔</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring.distrib_left mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The graph after exchanging is acyclic.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-exchange_acyclic"><span class="command">lemma</span></span> exchange_acyclic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> conv_order dual_order.trans inf.cobounded1 inf.cobounded2 mult_left_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement conv_dist_comp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_associative mult_right_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> covector_vector_comp mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> ee <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">≤</span> top <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_inf.mult_semi_associative mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_inf_covector mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_left_isotone top.extremum inf_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> vector_conv_compl<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.assoc inf_import_p le_infI2 p_antitone p_antitone_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p_top schroeder_4_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> bot_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star_absorb <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_plus mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_loop_fixpoint mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> dual_order.trans mult_right_isotone top_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> comp_associative<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone star_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone star.left_plus_below_circ<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative star_left_induct<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_right_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> pv<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> bot_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">e</span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_right_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult_left_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> covector_vector_comp mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> bot_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> conv_complement order_lesseq_imp pp_increasing schroeder_6_p<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone star_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 12 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone comp_associative<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> 14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_complement conv_dist_comp conv_involutive conv_order inf_le1 inf_le2 order_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult_left_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc star.circ_back_loop_fixpoint star_plus sup_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc star_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 14 mult_assoc mult_right_isotone sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> top_greatest mult_right_isotone mult_left_isotone mult_assoc sup_right_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 13 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_right_induct_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc star.circ_transitive_equal<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone star_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone star.left_plus_below_circ<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone star_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> 17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_commute_below_diversity<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone conv_dist_inf inf.left_commute inf.sup_monoid.add_commute star_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp conv_star_commute star_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> conv_complement conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup mult_right_dist_sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc star.circ_transitive_equal<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> star_left_unfold_equal <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup sup.left_commute sup_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_dist_sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> star.circ_mult_increasing <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 17 18 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 19<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup mult_right_dist_sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc star.circ_transitive_equal<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_right_sub_dist_sup_right semiring.add_right_mono star.circ_back_loop_fixpoint<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_right_isotone star.left_plus_below_circ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_increasing schroeder_3_p<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 15 16 19 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone star_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mult_left_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 22<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 11 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_left_isotone star.left_plus_below_circ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 22 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_left_induct_mult mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_increasing schroeder_3_p<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 23<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_left_dist_sup mult_assoc star.circ_loop_fixpoint sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 24<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="free">e</span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_left_dist_sup mult_assoc star.circ_loop_fixpoint sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 25<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 21 23 24 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_sup_1 sup.left_commute sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 star_separate <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 mult_left_dist_sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 9 10 star_separate_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring.distrib_left semiring.distrib_right mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_left_dist_sup comp_associative<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 20 25 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemma shows that an edge across the cut between visited nodes and unvisited nodes does not leave the component of visited nodes.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-mst_subgraph_inv"><span class="command">lemma</span></span> mst_subgraph_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dedekind_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_right_isotone inf_commute le_infI2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> conv_involutive<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> comp_inf.mult_left_isotone comp_isotone star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_right_isotone inf_commute mult_assoc mult_right_isotone star.left_plus_below_circ star_plus <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> comp_inf.mult_left_isotone conv_dist_comp conv_isotone mult_left_isotone star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemmas show that the tree after exchanging contains the currently constructed and tree and its extension by the chosen edge.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-mst_extends_old_tree"><span class="command">lemma</span></span> mst_extends_old_tree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">⊓</span> prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.coboundedI2 inf.sup_monoid.add_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf.coboundedI1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> covector_vector_comp eq_refl schroeder_2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_bot pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> le_supI1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-mst_extends_new_tree"><span class="command">lemma</span></span> mst_extends_new_tree<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⟹</span> vector <span class="free">v</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">≤</span> prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mst_extends_old_tree <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemmas <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>forests_bot_1›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>forests_bot_2›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>forests_bot_3›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>fc_comp_eq_fc›</span></span></span></span> were contributed by Nicolas Robinson-O'Brien.›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-forests_bot_1"><span class="command">lemma</span></span> forests_bot_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equivalence <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_inf inf.boundedE inf.cobounded2 inf.orderE mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone pseudo_complement<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_isotone conv_dist_inf equivalence_comp_right_complement inf.boundedI inf.cobounded1 inf.cobounded2 le_bot<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-forests_bot_2"><span class="command">lemma</span></span> forests_bot_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equivalence <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms forests_bot_1 conv_dist_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_associative comp_inf.semiring.mult_not_zero conv_complement conv_dist_comp conv_dist_inf conv_involutive dedekind_1 inf.cobounded2 inf.sup_monoid.add_commute le_bot mult_right_zero p_antitone_iff pseudo_complement semiring.mult_not_zero symmetric_top_closed top.extremum<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-forests_bot_3"><span class="command">lemma</span></span> forests_bot_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equivalence <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms forests_bot_1 conv_dist_inf conv_complement <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> conv_dist_comp conv_involutive conv_order coreflexive_bot_closed coreflexive_symmetric<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_inf.semiring.mult_not_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> semiring.mult_not_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 dedekind_2 inf_commute schroeder_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_complement conv_dist_inf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We finally add the Kleene star to Stone relation algebras.
Kleene star and the relational operations are reasonably independent.
The only additional axiom we need in the generalisation to Stone-Kleene relation algebras is that star distributes over double complement.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> stone_kleene_relation_algebra <span class="main">=</span> stone_relation_algebra <span class="main">+</span> pd_kleene_allegory <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pp_dist_star<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-reachable_without_loops"><span class="command">lemma</span></span> reachable_without_loops<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> maddux_3_11_pp mult_right_dist_sup regular_one_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.cobounded2 le_supI mult_left_isotone star.circ_circ_mult star.left_plus_below_circ star_involutive star_one<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.cobounded2 maddux_3_11_pp regular_one_closed star.circ_circ_mult star.circ_sup_2 star_involutive star_sub_one<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_isotone<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-plus_reachable_without_loops"><span class="command">lemma</span></span> plus_reachable_without_loops<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative maddux_3_11_pp regular_one_closed star.circ_back_loop_fixpoint star.circ_loop_fixpoint sup_assoc reachable_without_loops<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-star_plus_without_loops"><span class="command">lemma</span></span> star_plus_without_loops<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> maddux_3_13 star_left_unfold_equal<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-regular_closed_star"><span class="command">lemma</span></span> regular_closed_star<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="free">x</span> <span class="main">⟹</span> regular <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_dist_star<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-components_idempotent"><span class="command">lemma</span></span> components_idempotent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"components <span class="main">(</span>components <span class="free">x</span><span class="main">)</span> <span class="main">=</span> components <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pp_dist_star star_involutive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Kleene_Relation_Algebras-fc_comp_eq_fc"><span class="command">lemma</span></span> fc_comp_eq_fc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span>forest_components <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>forest_components <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_complement p_comp_pp p_pp_comp pp_dist_star<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemma shows that the nodes reachable in the tree after exchange contain the nodes reachable in the tree before exchange.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-mst_reachable_inv"><span class="command">lemma</span></span> mst_reachable_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"regular <span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup.bounded_iff star.circ_back_loop_prefixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> covector_comp_inf vector_conv_compl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone mult_assoc star.circ_plus_same star.left_plus_below_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shunting_var_p<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> conv_dist_comp conv_order mult_assoc order.trans pp_comp_semi_commute pp_isotone sup.coboundedI1 sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_right_divisibility star.circ_back_loop_fixpoint le_supI1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_right_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_right_divisibility star.circ_back_loop_fixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_isotone mult_right_isotone conv_isotone inf_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp conv_star_commute mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_isotone inf_commute mult_right_isotone star_isotone le_infI2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> conv_isotone mult_left_isotone mult_right_isotone mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc star_slide<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span>top <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_order mult_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> conv_complement vector_conv_compl<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"covector <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> covector_mult_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf_vector_1 inf.idem<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 8 mult_right_isotone inf.sup_right_isotone inf_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_assoc inf_commute <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> conv_complement vector_complement_closed vector_covector <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_isotone star.circ_plus_same star.left_plus_below_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute shunting_var_p<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 9 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_right_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement conv_dist_comp conv_dist_inf conv_star_commute mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> top <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inf.absorb2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_right_isotone inf_commute mult_right_isotone top_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>top <span class="main">⊓</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> covector_inf_comp_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> comp_associative<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span> mst_extends_old_tree star_isotone mult_left_isotone mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 10 mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_inf_covector inf.idem inf.sup_right_divisibility<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 11 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> vector_conv_covector <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans mult_right_isotone star_isotone sup_ge1 sup_ge2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_right_isotone star.circ_transitive_equal star.left_plus_below_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊔</span> prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊔</span> prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf_top_right stone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_inf_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_right_isotone sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_assoc mult_right_isotone star.circ_plus_same star.left_plus_below_circ sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 12 sup.absorb1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_right_induct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Some of the following lemmas already hold in pseudocomplemented distributive Kleene allegories.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Exchange gives Minimum Spanning Trees›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The lemmas in this section are used to show that the after exchange we obtain a minimum spanning tree.
The following lemmas show various interactions between the three constituents of the tree after exchange.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-epm_1"><span class="command">lemma</span></span> epm_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">v</span> <span class="main">⟹</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">⊔</span> prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">=</span> prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute inf_sup_distrib1 mult_assoc mult_right_dist_sup regular_closed_p regular_complement_top vector_conv_compl<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-epm_2"><span class="command">lemma</span></span> epm_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"regular <span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">⊔</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">⊔</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> epm_1 sup_assoc sup_commute assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">⊔</span> prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf_top.right_neutral regular_complement_top sup_inf_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_inf_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-epm_4"><span class="command">lemma</span></span> epm_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> star_left_induct_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_star_commute conv_dist_comp conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⊓</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> inf.sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calculation conv_dist_comp conv_involutive coreflexive_symmetric <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> conv_complement conv_dist_comp conv_involutive conv_order mult_assoc mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym comp_associative comp_isotone dense_top_closed mult_left_isotone transitive_top_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-epm_5"><span class="command">lemma</span></span> epm_5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> epm_3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span> epm_4<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> comp_associative covector_vector_comp inf.sup_monoid.add_commute schroeder_2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_sup_distrib1 mult_assoc star.circ_back_loop_fixpoint star_plus sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf.mult_semi_associative inf.sup_monoid.add_commute semiring.add_right_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_right_isotone inf.sup_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.assoc le_infI2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 assms<span class="main">(</span>4<span class="main">)</span> inf.sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_mono mult_right_isotone top_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> inf_compl_bot vector_complement_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_inf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-epm_6"><span class="command">lemma</span></span> epm_6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">=</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> mult_isotone order_lesseq_imp pp_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span> epm_4<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> epm_3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_infI2 star.circ_back_loop_fixpoint sup.commute sup_ge1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> comp_associative covector_vector_comp inf.sup_monoid.add_commute schroeder_2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_sup_distrib1 mult_assoc star.circ_back_loop_fixpoint star_plus sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf.mult_semi_associative inf.sup_monoid.add_commute semiring.add_right_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_right_isotone inf.sup_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.assoc le_infI2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"5"</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-epm_7"><span class="command">lemma</span></span> epm_7<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⟹</span> injective <span class="free">w</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⟹</span> vector <span class="free">v</span> <span class="main">⟹</span> prim_W <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_bot epm_2 epm_5 epm_6<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-epm_8"><span class="command">lemma</span></span> epm_8<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> conv_isotone inf_le1 inf_mono order_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms acyclic_asymmetric inf.commute le_bot<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-epm_9"><span class="command">lemma</span></span> epm_9<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms complement_conv_sub vector_conv_covector ev p_antitone_iff p_bot<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute inf_sup_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_inf.mult_left_isotone inf.cobounded2 semiring.add_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.sup_relative_same_increasing inf_commute inf_sup_distrib1 maddux_3_13 regular_closed_p<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.sup_relative_same_increasing inf_bot_right inf_commute inf_p mult_left_isotone star_outer_increasing top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_inf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-epm_10"><span class="command">lemma</span></span> epm_10<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement conv_dist_comp conv_dist_inf inf.absorb_iff1 inf.left_commute inf_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> inf_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">v</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_mono mult_right_isotone top_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> inf_compl_bot vector_complement_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_inf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-epm_11"><span class="command">lemma</span></span> epm_11<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_isotone inf.sup_left_isotone inf.sup_right_isotone order.refl top_greatest vector_conv_compl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_le2 order_trans p_antitone pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-epm_12"><span class="command">lemma</span></span> epm_12<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> prim_EP <span class="free">w</span> <span class="free">v</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_isotone inf.sup_left_isotone inf.sup_right_isotone order.refl top_greatest vector_conv_compl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_le2 order_trans p_antitone pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-epm_13"><span class="command">lemma</span></span> epm_13<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">⊓</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prim_P <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">⊓</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans inf.cobounded1 inf.sup_mono inf_le2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_mono mult_right_isotone top_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms inf_compl_bot vector_complement_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_inf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemmas show that the relation characterising the edge across the cut is an arc.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-arc_edge_1"><span class="command">lemma</span></span> arc_edge_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> top <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_right_isotone inf_commute mult_right_isotone top_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> covector_inf_comp_3 inf_top.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> mult_left_isotone mult_right_isotone star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_right_isotone star.right_plus_below_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mult_left_isotone mult_right_isotone mult_1_right star.circ_reflexive<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-arc_edge_2"><span class="command">lemma</span></span> arc_edge_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-5<span class="main">)</span> arc_edge_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_left_dist_sup star.circ_loop_fixpoint sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> conv_dist_comp conv_isotone sup_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc star_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> mult_right_isotone mult_1_right sup_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_back_loop_fixpoint sup_absorb2 sup_ge2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 star_right_induct <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-arc_edge_3"><span class="command">lemma</span></span> arc_edge_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">=</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> top <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_inf_covector inf.assoc inf_top.left_neutral vector_conv_compl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> inf.assoc inf.commute vector_conv_compl vector_complement_closed <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> shunting_1_pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_star_commute comp_associative conv_dist_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-7<span class="main">)</span> arc_edge_2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_star_commute conv_dist_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp conv_dist_inf conv_star_commute mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> conv_complement covector_inf_comp_3 inf_top.right_neutral vector_complement_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> vector_complement_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p_antitone_iff schroeder_3_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_vector_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.commute shunting_p<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc p_antitone p_antitone_iff schroeder_3_p star.circ_loop_fixpoint sup_commute sup_right_divisibility<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star_left_induct_mult_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring.distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute shunting_p<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb1 p_antitone_iff p_comp_pp vector_export_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc star.circ_loop_fixpoint sup.bounded_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> comp_isotone conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement conv_dist_comp mult_assoc mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> vector_complement_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 shunting_1_pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order.antisym bot_least top_right_mult_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-arc_edge_4"><span class="command">lemma</span></span> arc_edge_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">*</span> top <span class="main">=</span> top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maddux_3_11_pp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> covector_comp_inf covector_complement_closed vector_conv_covector <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_back_loop_fixpoint sup.cobounded2 sup_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_supI1 mult_assoc mult_right_isotone star.circ_plus_same star.left_plus_below_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.orderE mult_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_increasing sup.coboundedI2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_right_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute shunting_var_p<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1-5<span class="main"><span class="main">)</span></span> arc_edge_1 inf.orderE<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> inf.sup_left_isotone mult_assoc mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_left_isotone mult_left_isotone top_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> vector_conv_compl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>top <span class="main">⊓</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> covector_inf_comp_3 inf_assoc inf_left_commute vector_complement_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> vector_complement_closed conv_complement inf_assoc vector_covector<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp conv_involutive conv_top mult_assoc top_mult_top<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"top <span class="main">≤</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> shunt_bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_inf_vector_1 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_star_commute top_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-arc_edge_5"><span class="command">lemma</span></span> arc_edge_5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> point_injective<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute le_infI2 mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> vector_complement_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> p_antitone p_antitone_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dedekind_2 inf.commute inf_top.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_isotone le_infI1 mult_left_isotone mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mult_left_isotone mult_left_one<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_inf_covector star_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 3 star_left_induct sup.bounded_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> shunting_1_pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_complement conv_dist_comp conv_dist_inf conv_top conv_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_isotone mult_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_star_commute conv_dist_comp conv_involutive conv_top mult_assoc top_mult_top<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_1_right mult_right_isotone mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> cancel_separate order.eq_iff star.circ_sup_sub_sup_one_1 star.circ_plus_one star_involutive<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_plus_one star_left_unfold_equal sup.assoc sup.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_infI1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> vector_conv_compl<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_complement conv_involutive conv_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.absorb_iff2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊓</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_inf.mult_right_dist_sup sup_assoc sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_le1 sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 8 inf.sup_right_isotone mult_right_isotone sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 9 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.sup_right_isotone mult_left_isotone sup.commute sup_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> top <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> vector_export_comp inf_top_right inf_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> vector_complement_closed vector_conv_compl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_star_commute conv_dist_comp inf.commute inf_assoc star.circ_plus_same<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-arc_edge_6"><span class="command">lemma</span></span> arc_edge_6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_isotone conv_order inf.coboundedI1 mult_one_associative <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms arc_edge_5<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_involutive regular_closed_bot regular_dense_top triple_schroeder_p<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_left_dist_sup mult_right_dist_sup regular_complement_top regular_one_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-arc_edge"><span class="command">lemma</span></span> arc_edge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"arc <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>6-8<span class="main">)</span> arc_edge_6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"injective <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp conv_top mult_assoc top_mult_top<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"surjective <span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-5<span class="main">,</span>8<span class="main">)</span> arc_edge_4 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>6-8<span class="main">)</span> arc_edge_5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"injective <span class="main">(</span><span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp conv_involutive conv_top mult_assoc top_mult_top<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span> <span class="main">*</span> top <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-5<span class="main">,</span>8<span class="main">)</span> arc_edge_4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"surjective <span class="main">(</span><span class="main">(</span>prim_E <span class="free">w</span> <span class="free">v</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc conv_dist_comp conv_top<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Invariant implies Postcondition›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The lemmas in this section are used to show that the invariant implies the postcondition at the end of the algorithm.
The following lemma shows that the nodes reachable in the graph are the same as those reachable in the constructed tree.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-span_post"><span class="command">lemma</span></span> span_post<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> mult_right_isotone mult_1_right star.circ_reflexive <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_complement mult_left_dist_sup regular_complement_top<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?vv</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?vv</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">g</span> <span class="main">=</span> <span class="var">?vv</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?vv</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?vv</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_right_isotone star.circ_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> vector_star_1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?vv</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?vv</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?vv</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?vv</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> covector_inf_comp_3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?vv</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="var">?vv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?vv</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_right_isotone star.left_plus_below_circ star_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?vv</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">g</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?vv</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star.circ_back_loop_prefixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?vv</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star_right_induct <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">g</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?vv</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.antisym mult_right_isotone star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span> order.antisym mult_right_isotone star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemma shows that the minimum spanning tree extending a tree is the same as the tree at the end of the algorithm.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-mst_post"><span class="command">lemma</span></span> mst_post<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> covector_mult_closed vector_conv_covector <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_right_isotone top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> conv_order mult_right_isotone mult_1_right star.circ_reflexive<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">r</span> <span class="main">=</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">r</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> conv_dist_comp conv_involutive conv_star_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">⊔</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">r</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_assoc star.circ_loop_fixpoint sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shunting<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">r</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⊓</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_order inf.sup_right_isotone mult_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊓</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp conv_involutive conv_top mult_assoc top_mult_top<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">t</span> <span class="main">⊓</span> <span class="free">t</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_involutive dedekind_1 inf.commute mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">r</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> mult_right_isotone order_trans star.circ_increasing star.left_plus_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_star_commute mult_assoc mult_1_left triple_schroeder_p<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">r</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> injective_comp_right_dist_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 6 p_antitone pseudo_complement_pp semiring.mult_not_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">r</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">r</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="free">r</span> <span class="main">≤</span> <span class="main">-</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> dual_order.trans pp_increasing schroeder_4_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="free">r</span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">-</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_associative<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="free">r</span> <span class="main">≤</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc schroeder_6_p<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">*</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone mult_right_isotone star.circ_mult_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> comp_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">*</span> <span class="free">r</span> <span class="main">≤</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">r</span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">-</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc schroeder_6_p<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">r</span> <span class="main">≤</span> <span class="main">-</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_associative<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">r</span> <span class="main">≤</span> <span class="main">-</span><span class="free">r</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="free">r</span> <span class="main">⊓</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_infI2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="free">r</span> <span class="main">⊓</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="free">r</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> comp_inf.mult_right_isotone conv_isotone mult_left_isotone star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="free">r</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">r</span> <span class="main">⊔</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_assoc star.circ_loop_fixpoint sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.commute maddux_3_13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">r</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="main">-</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complement_conv_sub conv_dist_comp conv_involutive conv_bot inf.assoc inf.orderE regular_closed_bot regular_dense_top top_left_mult_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">⊓</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="main">-</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> inf_absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> top <span class="main">*</span> <span class="main">-</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_inf.mult_left_isotone comp_inf.mult_right_isotone mult_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="main">(</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 assms<span class="main">(</span>1<span class="main">)</span> covector_inf_closed inf_assoc vector_conv_compl vector_conv_covector <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_inf_vector conv_complement conv_dist_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">r</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_top dedekind_eq inf_commute inf_top_left mult_1_left mult_1_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> comp_isotone conv_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> mult_left_isotone mult_1_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> order.antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Kruskal's Algorithm›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following results are used for proving the correctness of Kruskal's minimum spanning tree algorithm.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Preservation of Invariant›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We first treat the preservation of the invariant.
The following lemmas show conditions necessary for preserving that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span> is a forest.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_injective_inv_2"><span class="command">lemma</span></span> kruskal_injective_inv_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≤</span> <span class="main">-</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> acyclic_star_below_complement p_antitone_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">f</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone top_left_mult_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_mapping_complement conv_dist_comp conv_involutive conv_top<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> schroeder_4_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_injective_inv_3"><span class="command">lemma</span></span> kruskal_injective_inv_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">f</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp conv_involutive conv_star_commute conv_top vector_top_closed mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> arc_expanded mult_left_isotone mult_right_isotone mult_1_left mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">f</span> <span class="main">≤</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> forest_separate <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_acyclic_inv"><span class="command">lemma</span></span> kruskal_acyclic_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="free">f</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"covector <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_inf.semiring.mult_zero_right comp_inf_vector_1 conv_bot covector_bot_closed inf.sup_monoid.add_assoc p_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_right_zero star_absorb star_simulation_right_equal <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_sup_9<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone mult_right_isotone star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative conv_bot conv_dist_comp conv_involutive conv_star_commute star_absorb<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone mult_right_isotone star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> le_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative star_absorb<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> star.circ_transitive_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_one conv_involutive conv_one conv_star_commute triple_schroeder_p<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> forest_bot mult_left_zero mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_commute_below_diversity <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> acyclic_star_below_complement schroeder_5_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_left_unfold_equal sup_monoid.add_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_associative mult_left_dist_sup mult_right_dist_sup sup_assoc sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_back_loop_fixpoint star_plus sup_monoid.add_commute mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_left_isotone mult_right_isotone star_isotone sup_left_isotone conv_isotone order_trans inf_le1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_left_isotone mult_right_isotone star_isotone sup_left_isotone sup_right_isotone conv_isotone order_trans inf_le1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_loop_fixpoint sup_monoid.add_assoc mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_left_isotone mult_right_isotone star_isotone sup_left_isotone sup_right_isotone order_trans inf_le1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 7 8 9 assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_exchange_acyclic_inv_1"><span class="command">lemma</span></span> kruskal_exchange_acyclic_inv_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="free">f</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"covector <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> kruskal_acyclic_inv<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e<span class="main"><span class="main">=</span></span><span class="quoted">bot</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_exchange_acyclic_inv_2"><span class="command">lemma</span></span> kruskal_exchange_acyclic_inv_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bijective <span class="main">(</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bijective <span class="main">(</span><span class="free">e</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">⊔</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> comp_associative comp_inf.star.circ_decompose_9 comp_inf.star_star_absorb comp_isotone conv_dist_comp conv_involutive conv_order conv_star_commute conv_top inf.cobounded1 vector_top_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> top <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> bijective_reverse comp_associative conv_star_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> kruskal_exchange_acyclic_inv_3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult_left_isotone mult_1_left mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_least comp_associative mult_right_dist_sup star.circ_back_loop_fixpoint star.circ_plus_same sup_least<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative star_left_induct sup_least<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span> conv_bot conv_dist_comp conv_involutive conv_top order.trans inf.absorb2 inf.cobounded2 inf_commute le_bot p_antitone_iff p_top schroeder_4_p top_left_mult_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> comp_associative inf.cobounded2 le_bot p_antitone_iff schroeder_3_p semiring.mult_zero_left<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="main">(</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> schroeder_3_p mult_assoc 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative star_left_induct sup_least<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> <span class="free">w</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_left_unfold_equal mult_right_dist_sup mult_left_dist_sup mult_1_right mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">*</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_isotone mult_left_isotone mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult_1_left mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone p_antitone_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="main">(</span><span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_associative schroeder_3_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative star_left_induct sup_least<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_right_mult_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="main">(</span><span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_complement_sub_leq conv_dist_comp conv_involutive conv_star_commute le_bot mult_right_sub_dist_sup_right p_bot regular_closed_bot star.circ_back_loop_fixpoint<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_least comp_associative comp_commute_below_diversity ex231d order_lesseq_imp semiring.mult_zero_left star.circ_left_top<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_commute_below_diversity star.circ_transitive_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊓</span> <span class="var">?w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊓</span> <span class="var">?w</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_sup_1 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊓</span> <span class="var">?w</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_mult_1 star_absorb sup_monoid.add_commute mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊓</span> <span class="main">(</span><span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative mult_left_dist_sup mult_right_dist_sup sup_assoc sup_commute sup_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊓</span> <span class="main">(</span><span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊓</span> <span class="main">(</span><span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> comp_associative star.circ_loop_fixpoint sup_assoc sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⊓</span> <span class="main">(</span><span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_inf.mult_right_isotone comp_isotone semiring.add_right_mono star_isotone sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊓</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊓</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf_commute pseudo_complement sup_bot_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 8 p_antitone_iff pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> le_bot p_antitone_iff pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Exchange gives Spanning Trees›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The lemmas in this section are used to show that the relation after exchange represents a spanning tree.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-inf_star_import"><span class="command">lemma</span></span> inf_star_import<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"reflexive <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> pp_dist_star shunting_var_p star.circ_loop_fixpoint sup.cobounded2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">-</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dedekind_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> comp_inf.mult_right_isotone conv_isotone mult_left_isotone mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">*</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_associative comp_inf.mult_right_isotone mult_left_isotone mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">-</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">-</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">-</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">-</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf.semiring.distrib_left star_left_unfold_equal sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inf.coboundedI2 reflexive_mult_closed star.circ_reflexive<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">-</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> pp_dist_star shunting_var_p<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_supE le_supI mult_left_dist_sup star.circ_loop_fixpoint sup.cobounded1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_left_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> shunting_var_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> order.trans inf.sup_right_isotone pp_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_exchange_forest_components_inv"><span class="command">lemma</span></span> kruskal_exchange_forest_components_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"injective <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"forest_components <span class="free">w</span> <span class="main">≤</span> forest_components <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">⊔</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"forest_components <span class="var">?w</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span> kruskal_exchange_acyclic_inv_3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span> conv_bot conv_dist_comp conv_involutive conv_top order.trans inf.absorb2 inf.cobounded2 inf_commute le_bot p_antitone_iff p_top schroeder_4_p top_left_mult_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> conv_bot conv_dist_comp conv_involutive conv_star_commute star.circ_top star_absorb<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> comp_associative inf.cobounded2 le_bot p_antitone_iff schroeder_3_p semiring.mult_zero_left<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_star_commute p_antitone_iff schroeder_3_p mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> <span class="var">?v</span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊔</span> <span class="var">?v</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative mult_left_dist_sup star.circ_loop_fixpoint sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> mult_assoc mult_1_left mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p_antitone p_antitone_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_associative schroeder_3_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"injective <span class="var">?v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> conv_dist_sup mult_left_dist_sup mult_right_dist_sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">*</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> <span class="var">?v</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊔</span> <span class="var">?v</span> <span class="main">*</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative mult_left_dist_sup star.circ_loop_fixpoint sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊔</span> <span class="var">?v</span> <span class="main">*</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_left_isotone sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊔</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_1_left mult_left_isotone sup_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">*</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> top <span class="main">≤</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> star_left_induct sup_least comp_associative mult_right_sub_dist_sup_right sup.orderE vector_top_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative star_left_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_antitone star.circ_left_top star_outer_increasing mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> comp_associative comp_inf.star.circ_sup_2 comp_isotone conv_dist_comp conv_involutive conv_order conv_star_commute conv_top vector_top_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="var">?v</span> <span class="main">⊔</span> <span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_inf.semiring.distrib_left maddux_3_11_pp mult_left_isotone star_isotone sup.cobounded2 sup_commute sup_inf_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_sup_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top <span class="main">⊔</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> semiring.distrib_right star.circ_unfold_sum star_decompose_1 star_decompose_3 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top <span class="main">⊔</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_isotone le_supI mult_left_dist_sup mult_right_dist_sup mult_right_isotone star.circ_decompose_5 star_decompose_3 sup.cobounded1 sup_commute top.extremum<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top <span class="main">⊔</span> <span class="main">(</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_inf_distrib2 sup_monoid.add_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute pseudo_complement sup_monoid.add_0_right<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative conv_dist_comp conv_involutive conv_isotone conv_star_commute conv_top order.trans top_right_mult_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">≤</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> forest_components_increasing le_supE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 7 assms<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top_right vector_inf_comp vector_top_closed mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> comp_associative conv_dist_comp conv_top<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> forest_components_equivalence cancel_separate_1 conv_dist_comp conv_order mult_left_isotone star_involutive star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="var">?f</span> <span class="main">*</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> forest_components_equivalence forest_components_increasing conv_isotone le_supE mult_left_isotone mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?f</span> <span class="main">*</span> <span class="var">?f</span> <span class="main">*</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_isotone conv_dist_sup star.circ_loop_fixpoint star_isotone sup.cobounded1 sup.cobounded2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> forest_components_equivalence preorder_idempotent<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> shunting_var_p sup.orderE<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> forest_components_idempotent forest_components_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_spanning_inv"><span class="command">lemma</span></span> kruskal_spanning_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"injective <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">h</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> forest_components <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"components <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">h</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> forest_components <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"forest_components <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?FF</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"forest_components <span class="var">?f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"equivalence <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> forest_components_equivalence <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order.trans forest_components_increasing mult_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> forest_components_increasing mult_left_isotone conv_isotone preorder_idempotent<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_dist_sup conv_involutive sup_assoc sup_left_commute mult_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?f</span> <span class="main">*</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_supI1 mult_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 mult_right_dist_sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> maddux_3_11_pp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star_left_induct_mult_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> conv_isotone order.trans mult_left_isotone sup.cobounded1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?f</span> <span class="main">*</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone sup.left_commute sup_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 6 mult_right_dist_sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> conv_dist_sup maddux_3_11_pp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5 star_left_induct mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_dist_sup mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone conv_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?FF</span> <span class="main">*</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> forest_components_increasing mult_left_isotone conv_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 preorder_idempotent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="var">?FF</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 7 8 mult_right_dist_sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"components <span class="main">(</span><span class="main">-</span><span class="var">?h</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="free">h</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> comp_inf.mult_left_sub_dist_sup_left conv_complement p_dist_inf pp_dist_inf regular_closed_p star_isotone sup_inf_distrib2 sup_monoid.add_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="free">h</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star.circ_increasing star_isotone sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> sup_left_isotone star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?FF</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 9 star_left_induct <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_exchange_spanning_inv_1"><span class="command">lemma</span></span> kruskal_exchange_spanning_inv_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"injective <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"regular <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"components <span class="free">g</span> <span class="main">≤</span> forest_components <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"components <span class="free">g</span> <span class="main">≤</span> forest_components <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="var">?p</span> <span class="main">≤</span> forest_components <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> forest_components_increasing inf_import_p le_supE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="var">?p</span> <span class="main">≤</span> <span class="var">?w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> forest_components <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_isotone forest_components_equivalence forest_components_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="main">(</span><span class="var">?p</span> <span class="main">⊔</span> <span class="main">-</span><span class="var">?p</span><span class="main">)</span> <span class="main">≤</span> forest_components <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 inf_sup_distrib1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> forest_components <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf_top_right stone<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> forest_components <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> star_isotone forest_components_star <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> forest_components <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> conv_isotone conv_star_commute forest_components_equivalence <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"components <span class="free">g</span> <span class="main">≤</span> forest_components <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> forest_components <span class="var">?w</span> <span class="main">*</span> forest_components <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 3 mult_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> forest_components <span class="var">?w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> forest_components_equivalence preorder_idempotent <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_exchange_spanning_inv_2"><span class="command">lemma</span></span> kruskal_exchange_spanning_inv_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⊔</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> forest_components <span class="free">f</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> comp_isotone order.trans inf.cobounded1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> forest_components <span class="free">f</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊔</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊔</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊔</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_transitive_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 cancel_separate_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_assoc mult_left_isotone mult_right_isotone star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_left_isotone conv_isotone star_isotone comp_inf.mult_right_isotone inf.cobounded2 inf.left_commute inf.sup_monoid.add_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_complement conv_dist_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_spanning_inv_1"><span class="command">lemma</span></span> kruskal_spanning_inv_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"components <span class="main">(</span><span class="main">-</span><span class="free">h</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"equivalence <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"components <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">h</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">*</span> <span class="free">F</span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> mult_left_isotone order_lesseq_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">F</span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> conv_isotone mult_left_isotone preorder_idempotent<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 mult_right_dist_sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"components <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">h</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="free">h</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_inf.mult_left_sub_dist_sup_left conv_complement p_dist_inf pp_dist_inf regular_closed_p star_isotone sup_inf_distrib2 sup_monoid.add_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="free">h</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_left_isotone star.circ_increasing star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> sup_left_isotone star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 assms<span class="main">(</span>4<span class="main">)</span> star_left_induct <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_reroot_edge"><span class="command">lemma</span></span> kruskal_reroot_edge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"injective <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="var">?q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="var">?q</span><span class="main">)</span> <span class="main">⊔</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="var">?q</span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">-</span><span class="var">?q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_inf_vector_1 conv_complement covector_complement_closed vector_top_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp conv_star_commute mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_inf.semiring.mult_not_zero inf.sup_relative_same_increasing inf_p mult_right_zero star.circ_loop_fixpoint sup_commute sup_left_divisibility<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="var">?q</span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp conv_star_commute mult_assoc conv_dist_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_vector_comp vector_export_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> injective_comp_right_dist_inf mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> acyclic_star_below_complement_1 semiring.mult_not_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 mult_right_dist_sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_top star_absorb<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Exchange gives Minimum Spanning Trees›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The lemmas in this section are used to show that the after exchange we obtain a minimum spanning tree.
The following lemmas show that the relation characterising the edge across the cut is an arc.
›</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_edge_arc"><span class="command">lemma</span></span> kruskal_edge_arc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equivalence <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≤</span> forest_components <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"arc <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> arc_expanded<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?FF</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?GG</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"forest_components <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> forest_components <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> inf.coboundedI1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inf_star_import<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_reflexive<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> conv_complement<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_inf.mult_left_isotone mult_right_isotone star_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> acyclic_star_inf_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative mult_left_dist_sup star.circ_loop_fixpoint sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> arc_univalent mult_assoc mult_1_right mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_isotone mult_left_isotone mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> coreflexive_comp_top_inf inf.sup_right_divisibility <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_inf star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> order.antisym mult_1_left mult_left_isotone star.circ_plus_same star.circ_reflexive star.left_plus_below_circ star_left_induct_mult_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> forest_components <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> forest_components <span class="free">w</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone conv_dist_inf star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> comp_associative conv_bot conv_dist_comp conv_involutive conv_star_commute star_absorb<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> arc_univalent mult_assoc mult_1_right mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_associative ex231c mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative inf.absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> arc_univalent mult_assoc mult_1_right mult_right_isotone mult_left_isotone inf.sup_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_dist_comp conv_dist_inf conv_involutive inf.absorb_iff1 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_involutive dedekind_1 inf_top_left mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_inf.star.circ_decompose_9 comp_inf.star_star_absorb conv_dist_comp conv_involutive conv_top covector_inf_comp_3 vector_top_closed mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> arc_top_edge<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 star_right_induct_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> arc_injective conv_involutive mult_1_left mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_export_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_associative inf.sup_right_isotone mult_left_isotone star.circ_transitive_equal star_left_unfold_equal sup.absorb_iff2 sup_monoid.add_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> shunt_mapping conv_dist_comp conv_involutive conv_top<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> point_injective<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_antitone p_antitone_iff p_bot regular_closed_bot schroeder_3_p schroeder_4_p mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="var">?GG</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="var">?GG</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_inf.mult_left_isotone mult_isotone mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> arc_top_edge comp_inf.star.circ_decompose_9 comp_inf_covector inf.sup_right_isotone inf_le2 mult_left_isotone mult_right_isotone vector_top_closed mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_export_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> covector_comp_inf covector_comp_inf_1 covector_mult_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 7 mult_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_complement conv_dist_comp conv_top equivalence_comp_left_complement mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="var">?GG</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative covector_bot_closed le_bot vector_bot_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="var">?GG</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> comp_associative conv_bot conv_complement conv_dist_comp conv_dist_inf conv_star_commute star.circ_plus_same <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_inf inf_commute inf_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> covector_comp_inf vector_conv_covector vector_mult_closed vector_top_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_export_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?F</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_dist_comp inf_assoc inf_commute mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?F</span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_inf_covector inf_top.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?FF</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> arc_top_edge comp_associative <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?FF</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>top <span class="main">*</span> <span class="main">(</span><span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">(</span><span class="var">?E</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_inf inf_assoc inf_commute inf_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?FF</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?G</span> <span class="main">*</span> <span class="main">(</span><span class="var">?E</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> covector_comp_inf_1 covector_top_closed covector_mult_closed inf_top_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?FF</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?G</span> <span class="main">⊓</span> <span class="var">?E</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> covector_comp_inf_1 covector_top_closed mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?FF</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?G</span> <span class="main">⊓</span> <span class="var">?E</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> covector_comp_inf_1 covector_mult_closed inf.sup_monoid.add_assoc vector_top_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="var">?E</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?G</span> <span class="main">⊓</span> <span class="var">?E</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> covector_comp_inf_1 covector_mult_closed inf.sup_monoid.add_assoc vector_top_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="var">?E</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="main">(</span><span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute inf_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="var">?E</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_complement conv_dist_comp mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="var">?E</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_inf_covector inf_top.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="var">?E</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?GG</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> arc_top_edge comp_associative<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?GG</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_dist_comp conv_star_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?GG</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_inf_covector inf_top.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="var">?GG</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mult_assoc mult_1_right mult_left_isotone mult_right_isotone inf.sup_left_isotone inf.sup_right_isotone arc_expanded<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="var">?GG</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> cancel_separate_eq star_left_unfold_equal sup_monoid.add_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="var">?GG</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star.circ_plus_one star_left_unfold_equal sup_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="var">?GG</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊓</span> <span class="var">?GG</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="var">?FF</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="var">?GG</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1 inf_sup_distrib2 semiring.distrib_left semiring.distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊓</span> <span class="var">?GG</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 9 10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.cobounded1 mult_1_right mult_left_isotone mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="var">?G</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> top_greatest inf.sup_left_isotone inf.sup_right_isotone mult_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="var">?G</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_associative inf.sup_right_isotone mult_right_isotone top.extremum <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="var">?F</span><span class="main">)</span> <span class="main">⊓</span> <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> inf_assoc inf_commute inf_left_commute univalent_comp_left_dist_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span><span class="main">)</span> <span class="main">⊓</span> <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.sup_monoid.add_commute inf.sup_right_isotone mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">⊓</span> <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_inf_covector mult_left_isotone top.extremum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> conv_dist_comp conv_involutive conv_top inf_p mult_right_zero univalent_comp_left_dist_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> comp_associative conv_bot conv_complement conv_dist_comp conv_dist_inf conv_star_commute star.circ_plus_same <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_inf inf_commute inf_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?F</span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> covector_inf_comp_3 vector_mult_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> covector_comp_inf covector_inf_comp_3 vector_conv_covector vector_mult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span><span class="main">)</span> <span class="main">⊓</span> <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_inf_covector<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_inf_covector<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">(</span><span class="var">?E</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_inf inf.left_commute inf.sup_monoid.add_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">(</span><span class="var">?E</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> comp_associative conv_dist_comp conv_top vector_export_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?E</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> comp_associative inf_assoc conv_dist_comp conv_top vector_export_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?E</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="main">(</span><span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_assoc inf.left_commute inf.sup_monoid.add_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="main">(</span><span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_dist_comp conv_star_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="main">(</span><span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_inf_covector inf_top.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">(</span><span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mult_assoc mult_1_right mult_left_isotone mult_right_isotone inf.sup_left_isotone arc_expanded<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">(</span><span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_complement conv_dist_comp mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?G</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_inf_covector inf_top.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> <span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> arc_top_edge mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_dist_comp mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?F</span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_inf_covector inf_top.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> arc_top_edge mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> cancel_separate_eq star_left_unfold_equal sup_monoid.add_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star.circ_plus_one star_left_unfold_equal sup_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 11 12 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.coboundedI1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">*</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> comp_inf.comp_isotone equivalence_comp_right_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> bot_unique pp_isotone pseudo_complement_pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span> <span class="main">≤</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_1_left mult_right_dist_sup sup.absorb_iff2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_refl le_supE star.circ_back_loop_fixpoint<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span> <span class="main">≤</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="main">*</span> <span class="free">F</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> comp_inf.star_slide dedekind_2 inf_left_commute inf_top_right mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative conv_dist_comp mult_left_isotone preorder_idempotent<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order.trans p_shunting_swap pp_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> comp_mapping_complement conv_dist_comp conv_involutive conv_top<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> forest_components <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> mult_left_isotone mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone mult_right_isotone star_isotone mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative mult_right_isotone star.circ_plus_same star.left_plus_below_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative inf.sup_monoid.add_assoc mult_left_dist_sup star.circ_loop_fixpoint sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc top_greatest mult_right_isotone sup_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.cobounded1 mult_left_isotone sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_monoid.add_assoc inf.sup_right_isotone mult_left_isotone sup_commute sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_dist_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> mult_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">≤</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">F</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">≤</span> <span class="free">F</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> preorder_idempotent<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_refl le_supE star.circ_back_loop_fixpoint<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">F</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">≤</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">F</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">≤</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 15 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring.distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">≤</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> maddux_3_11_pp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> comp_associative mult_left_isotone star.circ_transitive_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">≤</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 14 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc star_left_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="var">?G</span> <span class="main">≤</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> covector_comp_inf covector_mult_closed star.circ_plus_same<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>8<span class="main">)</span> le_bot triple_schroeder_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> shunt_mapping conv_dist_comp conv_involutive conv_top<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 17 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> arc_top_arc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> p_antitone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> shunting_var_p star_left_unfold_equal sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 18 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">F</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 16 order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">F</span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_inf_covector<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">F</span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> arc_top_arc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">F</span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp conv_top vector_top_closed mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">(</span><span class="free">F</span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> shunt_bijective mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">(</span><span class="free">F</span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"top <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> shunt_mapping conv_dist_comp conv_involutive conv_top mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_inf_vector_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf_vector_1 inf_top.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?F</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_dist_comp mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?F</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?E</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="var">?G</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_dist_comp conv_star_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> <span class="var">?E</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_inf_vector_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="var">?G</span> <span class="main">⊓</span> <span class="var">?E</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_inf_vector_1 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="var">?E</span> <span class="main">⊓</span> <span class="var">?F</span> <span class="main">⊓</span> <span class="var">?G</span><span class="main">)</span> <span class="main">*</span> top <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute inf_left_commute top_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_edge_arc_1"><span class="command">lemma</span></span> kruskal_edge_arc_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≤</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"components <span class="free">g</span> <span class="main">≤</span> forest_components <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> schroeder_3_p vector_bot_closed mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">h</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> conv_complement conv_isotone top_right_mult_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> inf.sup_right_isotone pp_isotone conv_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> components <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_right_isotone star.circ_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> forest_components <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> comp_inf.mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_assoc vector_export_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_sup_distrib1 semiring.distrib_right star_left_unfold_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le2 mult_1_left mult_left_isotone sup_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_associative comp_inf.mult_right_isotone sup_right_isotone mult_right_isotone top.extremum vector_export_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 inf.sup_monoid.add_commute inf_vector_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_edge_between_components_1"><span class="command">lemma</span></span> kruskal_edge_between_components_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equivalence <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mapping <span class="main">(</span>top <span class="main">*</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">⊓</span> <span class="free">F</span> <span class="main">≤</span> <span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf_le1 inf_le2 le_infI order_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">F</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc vector_restrict_comp_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">*</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_associative conv_dist_comp conv_star_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> preorder_idempotent mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">⊓</span> <span class="free">F</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="main">-</span><span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_infI1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span>top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> conv_dist_comp total_conv_surjective comp_mapping_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_p le_bot p_antitone_iff pseudo_complement<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kleene_Relation_Algebras-kruskal_edge_between_components_2"><span class="command">lemma</span></span> kruskal_edge_between_components_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"forest_components <span class="free">f</span> <span class="main">≤</span> <span class="main">-</span><span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">f</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⊔</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⊔</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"forest_components <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> conv_complement conv_order <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="main">≤</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp conv_star_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"equivalence <span class="var">?F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> forest_components_equivalence <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⊔</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="var">?F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_inf forest_components_increasing inf.absorb_iff2 sup.boundedI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="free">d</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⊔</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">d</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inf_sup_distrib2 le_inf_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Related Structures›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Stone algebras can be expanded to Stone-Kleene relation algebras by reusing some operations.
›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> stone_algebra <span class="main">&lt;</span> comp_inf<span class="main">:</span> stone_kleene_relation_algebra <span class="keyword2"><span class="keyword">where</span></span> star <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> top"</span></span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted">top</span> <span class="keyword2"><span class="keyword">and</span></span> times <span class="main">=</span> <span class="quoted">inf</span> <span class="keyword2"><span class="keyword">and</span></span> conv <span class="main">=</span> <span class="quoted">id</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Every bounded linear order can be expanded to a Stone algebra, which can be expanded to a Stone relation algebra, which can be expanded to a Stone-Kleene relation algebra.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> linorder_stone_kleene_relation_algebra_expansion <span class="main">=</span> linorder_stone_relation_algebra_expansion <span class="main">+</span> star <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> top"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> kleene_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min.coboundedI1 min.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min.coboundedI1<span class="main">)</span>

<span class="keyword1"><span class="command">subclass</span></span> stone_kleene_relation_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A Kleene relation algebra is based on a relation algebra.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> kleene_relation_algebra <span class="main">=</span> relation_algebra <span class="main">+</span> stone_kleene_relation_algebra

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Kleene_Relation_Subalgebras">
<div class="head">
<h1>Theory Kleene_Relation_Subalgebras</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Subalgebras of Kleene Relation Algebras
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Subalgebras of Kleene Relation Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this theory we show that the regular elements of a Stone-Kleene relation algebra form a Kleene relation subalgebra.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Kleene_Relation_Subalgebras

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../stone_relation_algebras/theories/#Relation_Subalgebras">Stone_Relation_Algebras.Relation_Subalgebras</a> <a href="#Kleene_Relation_Algebras">Kleene_Relation_Algebras</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> regular <span class="main">::</span> <span class="main">(</span><span class="quoted">stone_kleene_relation_algebra</span><span class="main">)</span> <span class="quoted">kleene_relation_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">star_regular</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regular <span class="main">⇒</span> <span class="tfree">'a</span> regular"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">star</span>
  <span class="keyword1"><span class="command">using</span></span> regular_closed_p regular_closed_star <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> star_regular.rep_eq less_eq_regular.rep_eq left_kleene_algebra_class.star_left_unfold one_regular.rep_eq simp_regular sup_regular.rep_eq times_regular.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> less_eq_regular.rep_eq left_kleene_algebra_class.star_left_induct simp_regular star_regular.rep_eq sup_regular.rep_eq times_regular.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> less_eq_regular.rep_eq strong_left_kleene_algebra_class.star_right_induct simp_regular star_regular.rep_eq sup_regular.rep_eq times_regular.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Matrix_Kleene_Algebras">
<div class="head">
<h1>Theory Matrix_Kleene_Algebras</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Matrix Kleene Algebras
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Matrix Kleene Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory gives a matrix model of Stone-Kleene relation algebras.
The main result is that matrices over Kleene algebras form Kleene algebras.
The automata-based construction is due to Conway \cite{Conway1971}.
An implementation of the construction in Isabelle/HOL that extends \cite{ArmstrongGomesStruthWeber2016} was given in \cite{Asplund2014} without a correctness proof.

For specifying the size of matrices, Isabelle/HOL's type system requires the use of types, not sets.
This creates two issues when trying to implement Conway's recursive construction directly.
First, the matrix size changes for recursive calls, which requires dependent types.
Second, some submatrices used in the construction are not square, which requires typed Kleene algebras \cite{Kozen1998}, that is, categories of Kleene algebras.

Because these instruments are not available in Isabelle/HOL, we use square matrices with a constant size given by the argument of the Kleene star operation.
Smaller, possibly rectangular submatrices are identified by two lists of indices: one for the rows to include and one for the columns to include.
Lists are used to make recursive calls deterministic; otherwise sets would be sufficient.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Matrix_Kleene_Algebras

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../stone_relation_algebras/theories/#Matrix_Relation_Algebras">Stone_Relation_Algebras.Matrix_Relation_Algebras</a> <a href="#Kleene_Relation_Algebras">Kleene_Relation_Algebras</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Matrix Restrictions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this section we develop a calculus of matrix restrictions.
The restriction of a matrix to specific row and column indices is implemented by the following function, which keeps the size of the matrix and sets all unused entries to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">restrict_matrix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>bot<span class="main">)</span> square <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⟨</span>_<span class="keyword1">⟩</span> _"</span> <span class="main">[</span>90<span class="main">,</span>41<span class="main">,</span>90<span class="main">]</span> 91<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">restrict_matrix</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">.</span> <span class="keyword1">if</span> List.member <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="bound">i</span> <span class="main">∧</span> List.member <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following function captures Conway's automata-based construction of the Kleene star of a matrix.
An index <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>k›</span></span></span></span> is chosen and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s›</span></span></span></span> contains all other indices.
The matrix is split into four submatrices <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>b›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>d›</span></span></span></span> including/not including row/column <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>k›</span></span></span></span>.
Four matrices are computed containing the entries given by Conway's construction.
These four matrices are added to obtain the result.
All matrices involved in the function have the same size, but matrix restriction is used to set irrelevant entries to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">star_matrix'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>star<span class="main">,</span>times<span class="main">,</span>bounded_semilattice_sup_bot<span class="main">}</span><span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">star_matrix'</span> Nil <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="keyword1">mbot</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">star_matrix'</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">let</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">]</span> <span class="keyword1">in</span>
  <span class="keyword1">let</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">r</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">⟩</span><span class="bound">r</span> <span class="keyword1">in</span>
  <span class="keyword1">let</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">r</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">⟩</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">in</span>
  <span class="keyword1">let</span> <span class="bound">c</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">⟩</span><span class="bound">r</span> <span class="keyword1">in</span>
  <span class="keyword1">let</span> <span class="bound">d</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">⟩</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">in</span>
  <span class="keyword1">let</span> <span class="bound">as</span> <span class="main">=</span> <span class="bound">r</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="bound">a</span><span class="main">⟩</span><span class="bound">r</span> <span class="keyword1">in</span>
  <span class="keyword1">let</span> <span class="bound">ds</span> <span class="main">=</span> <span class="free">star_matrix'</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">d</span> <span class="keyword1">in</span>
  <span class="keyword1">let</span> <span class="bound">e</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">⊕</span> <span class="bound">b</span> <span class="main">⊙</span> <span class="bound">ds</span> <span class="main">⊙</span> <span class="bound">c</span> <span class="keyword1">in</span>
  <span class="keyword1">let</span> <span class="bound">es</span> <span class="main">=</span> <span class="bound">r</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="bound">e</span><span class="main">⟩</span><span class="bound">r</span> <span class="keyword1">in</span>
  <span class="keyword1">let</span> <span class="bound">f</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">⊕</span> <span class="bound">c</span> <span class="main">⊙</span> <span class="bound">as</span> <span class="main">⊙</span> <span class="bound">b</span> <span class="keyword1">in</span>
  <span class="keyword1">let</span> <span class="bound">fs</span> <span class="main">=</span> <span class="free">star_matrix'</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">f</span> <span class="keyword1">in</span>
  <span class="bound">es</span> <span class="main">⊕</span> <span class="bound">as</span> <span class="main">⊙</span> <span class="bound">b</span> <span class="main">⊙</span> <span class="bound">fs</span> <span class="main">⊕</span> <span class="bound">ds</span> <span class="main">⊙</span> <span class="bound">c</span> <span class="main">⊙</span> <span class="bound">es</span> <span class="main">⊕</span> <span class="bound">fs</span>
<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The Kleene star of the whole matrix is obtained by taking as indices all elements of the underlying type <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'a›</span></span></span></span>.
This is conveniently supplied by the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>enum›</span></span></span></span> class.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">star_matrix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>star<span class="main">,</span>times<span class="main">,</span>bounded_semilattice_sup_bot<span class="main">}</span><span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>⊙</sup></span>"</span> <span class="main">[</span>100<span class="main">]</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">star_matrix</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> star_matrix' <span class="main">(</span>enum_class.enum<span class="main">::</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemmas deconstruct matrices with non-empty restrictions.
›</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_empty_left"><span class="command">lemma</span></span> restrict_empty_left<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">=</span> <span class="keyword1">mbot</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> restrict_matrix_def List.member_def bot_matrix_def<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_empty_right"><span class="command">lemma</span></span> restrict_empty_right<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[]</span> <span class="main">=</span> <span class="keyword1">mbot</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> restrict_matrix_def List.member_def bot_matrix_def<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_nonempty_left"><span class="command">lemma</span></span> restrict_nonempty_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>bounded_semilattice_sup_bot<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> restrict_matrix_def List.member_def sup_matrix_def<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_nonempty_right"><span class="command">lemma</span></span> restrict_nonempty_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>bounded_semilattice_sup_bot<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> restrict_matrix_def List.member_def sup_matrix_def<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_nonempty"><span class="command">lemma</span></span> restrict_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>bounded_semilattice_sup_bot<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> restrict_matrix_def List.member_def sup_matrix_def<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following predicate captures that two index sets are disjoint.
This has consequences for composition and the unit matrix.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">disjoint</span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span> <span class="main">≡</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main">.</span> List.member <span class="free"><span class="bound"><span class="entity">ks</span></span></span> <span class="bound">x</span> <span class="main">∧</span> List.member <span class="free"><span class="bound"><span class="entity">ls</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-times_disjoint"><span class="command">lemma</span></span> times_disjoint<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>idempotent_semiring<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"disjoint <span class="free">ls</span> <span class="free">ms</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ns</span> <span class="main">=</span> <span class="keyword1">mbot</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ns</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ns</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ms</span> <span class="bound">k</span> <span class="main">∧</span> List.member <span class="free">ns</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> List.member <span class="free">ms</span> <span class="bound">k</span> <span class="main">∧</span> List.member <span class="free">ns</span> <span class="skolem">j</span> <span class="keyword1">then</span> bot <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sup_monoid.sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="main">(</span><span class="bound"><span class="bound">k</span></span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_monoid.sum.neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_iff le_funI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">mbot</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ns</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mbot</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-one_disjoint"><span class="command">lemma</span></span> one_disjoint<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"disjoint <span class="free">ks</span> <span class="free">ls</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="keyword1">mone</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>idempotent_semiring<span class="main">)</span> square<span class="main">)</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">=</span> <span class="keyword1">mbot</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?o</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mone</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="free">ls</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> bot <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_matrix_def one_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">mbot</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="free">ls</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mbot</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following predicate captures that an index set is a subset of another index set.
This has consequences for repeated restrictions.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_sublist</span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> List.member <span class="free"><span class="bound"><span class="entity">ks</span></span></span> <span class="bound">x</span> <span class="main">⟶</span> List.member <span class="free"><span class="bound"><span class="entity">ls</span></span></span> <span class="bound">x</span>"</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_sublist"><span class="command">lemma</span></span> restrict_sublist<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sublist <span class="free">ls</span> <span class="free">ks</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sublist <span class="free">ms</span> <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ls</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ns</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">=</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ls</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ns</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ls</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"List.member <span class="free">ls</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ms</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms restrict_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> restrict_matrix_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_superlist"><span class="command">lemma</span></span> restrict_superlist<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sublist <span class="free">ls</span> <span class="free">ks</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sublist <span class="free">ms</span> <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ks</span><span class="main">⟨</span><span class="free">ls</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ns</span> <span class="main">=</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">ls</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ns</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ls</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"List.member <span class="free">ls</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ms</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms restrict_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> restrict_matrix_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemmas give the sizes of the results of some matrix operations.
›</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_sup"><span class="command">lemma</span></span> restrict_sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>bounded_semilattice_sup_bot<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ks</span><span class="main">⟨</span><span class="free">f</span> <span class="main">⊕</span> <span class="free">g</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ls</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> restrict_matrix_def sup_matrix_def<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_times"><span class="command">lemma</span></span> restrict_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>idempotent_semiring<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ms</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def restrict_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ms</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ls</span> <span class="bound">k</span> <span class="main">∧</span> List.member <span class="free">ms</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ms</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> List.member <span class="free">ls</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sup_monoid.sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ms</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ls</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ls</span> <span class="bound">k</span> <span class="main">∧</span> List.member <span class="free">ms</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sup_monoid.sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_star"><span class="command">lemma</span></span> restrict_star<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>kleene_algebra<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">⟨</span>star_matrix' <span class="free">t</span> <span class="free">g</span><span class="main">⟩</span><span class="free">t</span> <span class="main">=</span> star_matrix' <span class="free">t</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_empty_left<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">k</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">#</span><span class="skolem">s</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> <span class="skolem">s</span><span class="main">⟨</span>star_matrix' <span class="skolem">s</span> <span class="bound">g</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">=</span> star_matrix' <span class="skolem">s</span> <span class="bound">g</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> <span class="var">?t</span><span class="main">⟨</span>star_matrix' <span class="skolem">s</span> <span class="bound">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">=</span> star_matrix' <span class="skolem">s</span> <span class="bound">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> restrict_superlist<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span>star_matrix' <span class="var">?t</span> <span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">=</span> star_matrix' <span class="var">?t</span> <span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">k</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="var">?a</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ds</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"star_matrix' <span class="skolem">s</span> <span class="var">?d</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?es</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="var">?e</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"star_matrix' <span class="skolem">s</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="var">?as</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">=</span> <span class="var">?as</span> <span class="main">∧</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?b</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">=</span> <span class="var">?b</span> <span class="main">∧</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?c</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">=</span> <span class="var">?c</span> <span class="main">∧</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?es</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">=</span> <span class="var">?es</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_superlist member_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="var">?ds</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">=</span> <span class="var">?ds</span> <span class="main">∧</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?fs</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">=</span> <span class="var">?fs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="var">?t</span><span class="main">⟨</span><span class="var">?as</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?b</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?fs</span><span class="main">⟩</span><span class="var">?t</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">=</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?as</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?b</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?fs</span><span class="main">⟩</span><span class="var">?t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> restrict_times<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="var">?t</span><span class="main">⟨</span><span class="var">?ds</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?c</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?es</span><span class="main">⟩</span><span class="var">?t</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">=</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?ds</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?c</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?es</span><span class="main">⟩</span><span class="var">?t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> restrict_times<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span>star_matrix' <span class="var">?t</span> <span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">=</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?es</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?fs</span><span class="main">⟩</span><span class="var">?t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_matrix'.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?es</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊕</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊕</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊕</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?fs</span><span class="main">⟩</span><span class="var">?t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?fs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 3 4 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> star_matrix' <span class="var">?t</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_matrix'.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_one"><span class="command">lemma</span></span> restrict_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> List.member <span class="free">ks</span> <span class="free">k</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="main">(</span><span class="keyword1">mone</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>idempotent_semiring<span class="main">)</span> square<span class="main">)</span><span class="main">⟩</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="keyword1">mone</span><span class="main">⟩</span><span class="main">[</span><span class="free">k</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="keyword1">mone</span><span class="main">⟩</span><span class="free">ks</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> restrict_nonempty<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms member_rec one_disjoint<span class="main">)</span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_one_left_unit"><span class="command">lemma</span></span> restrict_one_left_unit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="keyword1">mone</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>idempotent_semiring<span class="main">)</span> square<span class="main">)</span><span class="main">⟩</span><span class="free">ks</span> <span class="main">⊙</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?o</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mone</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>idempotent_semiring<span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="free">ks</span> <span class="main">⊙</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="free">ks</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ks</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="var">?o</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="bound">k</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ks</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="bound">k</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> one_matrix_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="bound">k</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sup_monoid.sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sup_monoid.sum.cong<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="free">ks</span> <span class="main">⊙</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemmas consider restrictions to singleton index sets.
›</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_singleton"><span class="command">lemma</span></span> restrict_singleton<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_matrix_def List.member_def<span class="main">)</span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_singleton_list"><span class="command">lemma</span></span> restrict_singleton_list<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_matrix_def List.member_def<span class="main">)</span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_list_singleton"><span class="command">lemma</span></span> restrict_list_singleton<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_matrix_def List.member_def<span class="main">)</span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_singleton_product"><span class="command">lemma</span></span> restrict_singleton_product<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>kleene_algebra<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="free">m</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">h</span></span> <span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">h</span></span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">h</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_singleton<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">h</span></span> <span class="keyword1">if</span> <span class="bound">h</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">h</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sup_monoid.sum.cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">l</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="free">m</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The Kleene star unfold law holds for matrices with a single entry on the diagonal.
›</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_star_unfold"><span class="command">lemma</span></span> restrict_star_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="main">(</span><span class="keyword1">mone</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>kleene_algebra<span class="main">)</span> square<span class="main">)</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?o</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mone</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>kleene_algebra<span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">l</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">l</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="keyword1">else</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_singleton o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">sup</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sup_monoid.sum.cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">l</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free">f</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_singleton one_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">l</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_left_unfold_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_singleton o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_all"><span class="command">lemma</span></span> restrict_all<span class="main">:</span>
  <span class="quoted"><span class="quoted">"enum_class.enum<span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span>enum_class.enum <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_matrix_def List.member_def enum_UNIV<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following shows the various components of a matrix product.
It is essentially a recursive implementation of the product.
›</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_nonempty_product"><span class="command">lemma</span></span> restrict_nonempty_product<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>idempotent_semiring<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> List.member <span class="free">ls</span> <span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_nonempty<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> List.member_def times_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_bounded_semilattice_sup_bot.sup_monoid.add_assoc matrix_semilattice_sup.sup_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Equality of matrices is componentwise.
›</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_nonempty_eq"><span class="command">lemma</span></span> restrict_nonempty_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ls</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sublist <span class="main">[</span><span class="free">k</span><span class="main">]</span> <span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span> <span class="main">∧</span> is_sublist <span class="free">ks</span> <span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span> <span class="main">∧</span> is_sublist <span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">∧</span> is_sublist <span class="free">ls</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> member_rec<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟩</span><span class="free">ls</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_sublist<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ls</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_sublist<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ls</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_singleton<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"List.member <span class="free">ls</span> <span class="skolem">j</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_singleton_list<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="free">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_list_singleton<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ls</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">⟹</span> List.member <span class="free">ls</span> <span class="skolem">j</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∨</span> List.member <span class="free">ks</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="main">∨</span> List.member <span class="free">ls</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_matrix_def List.member_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 4 5 6 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∨</span> List.member <span class="free">ks</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="main">∨</span> List.member <span class="free">ls</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_matrix_def List.member_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Inequality of matrices is componentwise.
›</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_nonempty_less_eq"><span class="command">lemma</span></span> restrict_nonempty_less_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>idempotent_semiring<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">≼</span> <span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">≼</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">≼</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">≼</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">≼</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ls</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_semilattice_sup.sup.order_iff<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> restrict_nonempty_eq restrict_sup<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemmas treat repeated restrictions to disjoint index sets.
›</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_disjoint_left"><span class="command">lemma</span></span> restrict_disjoint_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"disjoint <span class="free">ks</span> <span class="free">ms</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ms</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">⟩</span><span class="free">ns</span> <span class="main">=</span> <span class="keyword1">mbot</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ms</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">⟩</span><span class="free">ns</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ms</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ns</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_matrix_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ms</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">⟩</span><span class="free">ns</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mbot</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_matrix_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_disjoint_right"><span class="command">lemma</span></span> restrict_disjoint_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"disjoint <span class="free">ls</span> <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ms</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">⟩</span><span class="free">ns</span> <span class="main">=</span> <span class="keyword1">mbot</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ms</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">⟩</span><span class="free">ns</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free">ms</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ns</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="keyword1">if</span> List.member <span class="free">ks</span> <span class="skolem">i</span> <span class="main">∧</span> List.member <span class="free">ls</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_matrix_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ms</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">⟩</span><span class="free">ns</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mbot</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_matrix_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemma expresses the equality of a matrix and a product of two matrices componentwise.
›</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_nonempty_product_eq"><span class="command">lemma</span></span> restrict_nonempty_product_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>idempotent_semiring<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> List.member <span class="free">ks</span> <span class="free">k</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> List.member <span class="free">ls</span> <span class="free">l</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> List.member <span class="free">ms</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"disjoint <span class="main">[</span><span class="free">k</span><span class="main">]</span> <span class="free">ks</span> <span class="main">∧</span> disjoint <span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> member_rec<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> restrict_nonempty_product<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_bounded_semilattice_sup_bot.sup_monoid.add_assoc restrict_sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_times<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_disjoint_left restrict_disjoint_right matrix_bounded_semilattice_sup_bot.sup_monoid.add_0_right<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> restrict_nonempty_product<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_bounded_semilattice_sup_bot.sup_monoid.add_assoc restrict_sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_times<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_disjoint_left restrict_disjoint_right matrix_bounded_semilattice_sup_bot.sup_monoid.add_0_right matrix_bounded_semilattice_sup_bot.sup_monoid.add_0_left<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> restrict_nonempty_product<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_bounded_semilattice_sup_bot.sup_monoid.add_assoc restrict_sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_times<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_disjoint_left restrict_disjoint_right matrix_bounded_semilattice_sup_bot.sup_monoid.add_0_right matrix_bounded_semilattice_sup_bot.sup_monoid.add_0_left<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> restrict_nonempty_product<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_bounded_semilattice_sup_bot.sup_monoid.add_assoc restrict_sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_times<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_disjoint_left restrict_disjoint_right matrix_bounded_semilattice_sup_bot.sup_monoid.add_0_left<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_times<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> restrict_nonempty_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 3 4 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemma gives a componentwise characterisation of the inequality of a matrix and a product of two matrices.
›</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_nonempty_product_less_eq"><span class="command">lemma</span></span> restrict_nonempty_product_less_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>idempotent_semiring<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> List.member <span class="free">ks</span> <span class="free">k</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> List.member <span class="free">ls</span> <span class="free">l</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> List.member <span class="free">ms</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">≼</span> <span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">≼</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">≼</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">≼</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">≼</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms restrict_nonempty_product_eq restrict_times<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms restrict_nonempty_product_eq restrict_times<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms restrict_nonempty_product_eq restrict_times<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">=</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms restrict_nonempty_product_eq restrict_times<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">≼</span> <span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">≼</span> <span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_times<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">≼</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">≼</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">≼</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span> <span class="main">⊙</span> <span class="main">(</span><span class="free">l</span><span class="main">#</span><span class="free">ls</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">≼</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> restrict_nonempty_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">≼</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">≼</span> <span class="main">[</span><span class="free">k</span><span class="main">]</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">≼</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">∧</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⊕</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">⊙</span> <span class="free">ls</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">≼</span> <span class="free">ks</span><span class="main">⟨</span><span class="free">h</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 3 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The Kleene star induction laws hold for matrices with a single entry on the diagonal.
The matrix <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>g›</span></span></span></span> can actually contain a whole row/colum at the appropriate index.
›</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_star_left_induct"><span class="command">lemma</span></span> restrict_star_left_induct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>kleene_algebra<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ms</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">≼</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span> <span class="main">≼</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_empty_right<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ms</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="skolem">ms</span> <span class="main">≼</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="skolem">ms</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="skolem">ms</span> <span class="main">≼</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="skolem">ms</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">≼</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span> <span class="main">≼</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="skolem">ms</span> <span class="main">≼</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="skolem">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> matrix_semilattice_sup.sup.bounded_iff member_def member_rec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> restrict_nonempty_product_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="skolem">ms</span> <span class="main">≼</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="skolem">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="skolem">m</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="skolem">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_singleton_product restrict_singleton less_eq_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="skolem">m</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="skolem">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_left_induct_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span> <span class="main">≼</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">l</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">l</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_singleton o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sup_monoid.sum.cong<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">l</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="skolem">m</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_singleton<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">≼</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> matrix_idempotent_semiring.mult_left_dist_sup matrix_semilattice_sup.sup.mono restrict_nonempty_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_star_right_induct"><span class="command">lemma</span></span> restrict_star_right_induct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>kleene_algebra<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ms</span> <span class="main">⟹</span> <span class="free">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">≼</span> <span class="free">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">≼</span> <span class="free">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_empty_left<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ms</span> <span class="main">⟹</span> <span class="skolem">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">≼</span> <span class="skolem">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⟹</span> <span class="skolem">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">≼</span> <span class="skolem">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">≼</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">≼</span> <span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">≼</span> <span class="skolem">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> matrix_semilattice_sup.sup.bounded_iff member_def member_rec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> restrict_nonempty_product_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">≼</span> <span class="skolem">ms</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="skolem">m</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">m</span><span class="main">,</span><span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_singleton_product restrict_singleton less_eq_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="skolem">m</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">m</span><span class="main">,</span><span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_right_induct_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">≼</span> <span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">l</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="keyword1">else</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_singleton o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sup_monoid.sum.cong<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">m</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_singleton<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">⊙</span> <span class="main">[</span><span class="free">l</span><span class="main">]</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span> <span class="main">≼</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span><span class="main">⟨</span><span class="free">g</span><span class="main">⟩</span><span class="main">[</span><span class="free">l</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> matrix_idempotent_semiring.mult_right_dist_sup matrix_semilattice_sup.sup.mono restrict_nonempty_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Kleene_Algebras-restrict_pp"><span class="command">lemma</span></span> restrict_pp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>p_algebra<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ks</span><span class="main">⟨</span><span class="main">⊖</span><span class="main">⊖</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span> <span class="main">=</span> <span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span><span class="free">ks</span><span class="main">⟨</span><span class="free">f</span><span class="main">⟩</span><span class="free">ls</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> restrict_matrix_def uminus_matrix_def<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Matrix_Kleene_Algebras-pp_star_commute"><span class="command">lemma</span></span> pp_star_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>stone_kleene_relation_algebra<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span>star <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> star <span class="keyword1">o</span> <span class="main">⊖</span><span class="main">⊖</span><span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_matrix_def o_def pp_dist_star<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Matrices form a Kleene Algebra›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Matrices over Kleene algebras form a Kleene algebra using Conway's construction.
It remains to prove one unfold and two induction axioms of the Kleene star.
Each proof is by induction over the size of the matrix represented by an index list.
›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_kleene_algebra<span class="main">:</span> kleene_algebra_var <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>kleene_algebra<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted">one_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> times <span class="main">=</span> <span class="quoted">times_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> star <span class="main">=</span> <span class="quoted">star_matrix</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"enum_class.enum<span class="main">::</span><span class="tfree">'a</span> list"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?o</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mone</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> distinct <span class="var">?e</span> <span class="main">⟶</span> <span class="main">(</span><span class="var">?e</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?e</span> <span class="main">⊕</span> <span class="var">?e</span><span class="main">⟨</span><span class="bound">g</span><span class="main">⟩</span><span class="var">?e</span> <span class="main">⊙</span> star_matrix' <span class="var">?e</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>star_matrix' <span class="var">?e</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_empty_left<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">k</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">#</span><span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> distinct <span class="skolem">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">⊕</span> <span class="skolem">s</span><span class="main">⟨</span><span class="bound">g</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">⊙</span> star_matrix' <span class="skolem">s</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>star_matrix' <span class="skolem">s</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> distinct <span class="var">?t</span> <span class="main">⟶</span> <span class="main">(</span><span class="var">?t</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊕</span> <span class="var">?t</span><span class="main">⟨</span><span class="bound">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> star_matrix' <span class="var">?t</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>star_matrix' <span class="var">?t</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="var">?t</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">k</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="var">?a</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ds</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"star_matrix' <span class="skolem">s</span> <span class="var">?d</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?es</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="var">?e</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"star_matrix' <span class="skolem">s</span> <span class="var">?f</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="var">?ds</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">=</span> <span class="var">?ds</span> <span class="main">∧</span> <span class="skolem">s</span><span class="main">⟨</span><span class="var">?fs</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">=</span> <span class="var">?fs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_star<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span><span class="var">?e</span><span class="main">⟩</span><span class="var">?r</span> <span class="main">=</span> <span class="var">?e</span> <span class="main">∧</span> <span class="skolem">s</span><span class="main">⟨</span><span class="var">?f</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">=</span> <span class="var">?f</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> restrict_one_left_unit restrict_sup restrict_times<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"disjoint <span class="skolem">s</span> <span class="var">?r</span> <span class="main">∧</span> disjoint <span class="var">?r</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_set_member member_rec<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">=</span> <span class="var">?r</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?r</span> <span class="main">⊕</span> <span class="skolem">s</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> restrict_one<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">=</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">=</span> <span class="main">(</span><span class="var">?a</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊕</span> <span class="var">?d</span><span class="main">)</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_nonempty<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_disjoint<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">=</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">=</span> <span class="main">(</span><span class="var">?a</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊕</span> <span class="var">?d</span><span class="main">)</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_nonempty<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_disjoint<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">=</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">=</span> <span class="main">(</span><span class="var">?a</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊕</span> <span class="var">?d</span><span class="main">)</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_nonempty<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> times_disjoint matrix_idempotent_semiring.mult_left_zero restrict_star matrix_bounded_semilattice_sup_bot.sup_monoid.add_0_right matrix_bounded_semilattice_sup_bot.sup_monoid.add_0_left<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">=</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">=</span> <span class="main">(</span><span class="var">?a</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊕</span> <span class="var">?d</span><span class="main">)</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_nonempty<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> times_disjoint restrict_star matrix_bounded_semilattice_sup_bot.sup_monoid.add_0_right matrix_bounded_semilattice_sup_bot.sup_monoid.add_0_left<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊕</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> star_matrix' <span class="var">?t</span> <span class="skolem">g</span> <span class="main">=</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊕</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="main">(</span><span class="var">?es</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?fs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_matrix'.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?t</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊕</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_dist_sup matrix_monoid.mult_assoc matrix_semilattice_sup.sup_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?r</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?r</span> <span class="main">⊕</span> <span class="skolem">s</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">⊕</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 5 6 7 8 9 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_semilattice_sup.sup.assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?r</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?r</span> <span class="main">⊕</span> <span class="main">(</span><span class="var">?a</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="skolem">s</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">⊕</span> <span class="main">(</span><span class="var">?d</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> matrix_semilattice_sup.sup_assoc matrix_semilattice_sup.sup_commute matrix_semilattice_sup.sup_left_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?r</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?r</span> <span class="main">⊕</span> <span class="main">(</span><span class="var">?a</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="var">?r</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?r</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="skolem">s</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="skolem">s</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">⊕</span> <span class="main">(</span><span class="var">?d</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_one_left_unit<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?r</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?r</span> <span class="main">⊕</span> <span class="var">?e</span> <span class="main">⊙</span> <span class="var">?es</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="var">?r</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?r</span> <span class="main">⊕</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?as</span><span class="main">)</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?ds</span><span class="main">)</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="skolem">s</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">⊕</span> <span class="var">?f</span> <span class="main">⊙</span> <span class="var">?fs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?r</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?r</span> <span class="main">⊕</span> <span class="var">?e</span> <span class="main">⊙</span> <span class="var">?es</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="var">?r</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?r</span> <span class="main">⊕</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?as</span><span class="main">)</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?ds</span><span class="main">)</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span><span class="main">)</span> <span class="main">⊕</span> <span class="var">?fs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?r</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?r</span> <span class="main">⊕</span> <span class="var">?e</span> <span class="main">⊙</span> <span class="var">?es</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="var">?r</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?r</span> <span class="main">⊕</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?as</span><span class="main">)</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span><span class="main">)</span> <span class="main">⊕</span> <span class="var">?fs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> restrict_superlist<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="var">?r</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?r</span> <span class="main">⊕</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?as</span><span class="main">)</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span><span class="main">)</span> <span class="main">⊕</span> <span class="var">?fs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_star_unfold<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?fs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> restrict_one_left_unit restrict_star_unfold restrict_times<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> star_matrix' <span class="var">?t</span> <span class="skolem">g</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_matrix'.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="var">?o</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊕</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> star_matrix' <span class="var">?t</span> <span class="skolem">g</span> <span class="main">=</span> star_matrix' <span class="var">?t</span> <span class="skolem">g</span>"</span></span>
        <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?o</span> <span class="main">⊕</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span> <span class="main">≼</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enum_distinct restrict_all<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"enum_class.enum<span class="main">::</span><span class="tfree">'a</span> list"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="bound">h</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> <span class="main">∀</span><span class="bound">zs</span> <span class="main">.</span> distinct <span class="var">?e</span> <span class="main">∧</span> distinct <span class="bound">zs</span> <span class="main">⟶</span> <span class="main">(</span><span class="var">?e</span><span class="main">⟨</span><span class="bound">g</span><span class="main">⟩</span><span class="var">?e</span> <span class="main">⊙</span> <span class="var">?e</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="bound">zs</span> <span class="main">≼</span> <span class="var">?e</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="bound">zs</span> <span class="main">⟶</span> star_matrix' <span class="var">?e</span> <span class="bound">g</span> <span class="main">⊙</span> <span class="var">?e</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="bound">zs</span> <span class="main">≼</span> <span class="var">?e</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="bound">zs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_empty_left<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">k</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">#</span><span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="bound">h</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> <span class="main">∀</span><span class="bound">zs</span> <span class="main">.</span> distinct <span class="skolem">s</span> <span class="main">∧</span> distinct <span class="bound">zs</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s</span><span class="main">⟨</span><span class="bound">g</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">⊙</span> <span class="skolem">s</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="bound">zs</span> <span class="main">≼</span> <span class="skolem">s</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="bound">zs</span> <span class="main">⟶</span> star_matrix' <span class="skolem">s</span> <span class="bound">g</span> <span class="main">⊙</span> <span class="skolem">s</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="bound">zs</span> <span class="main">≼</span> <span class="skolem">s</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="bound">zs</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="bound">h</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> <span class="main">∀</span><span class="bound">zs</span> <span class="main">.</span> distinct <span class="var">?t</span> <span class="main">∧</span> distinct <span class="bound">zs</span> <span class="main">⟶</span> <span class="main">(</span><span class="var">?t</span><span class="main">⟨</span><span class="bound">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="bound">zs</span> <span class="main">≼</span> <span class="var">?t</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="bound">zs</span> <span class="main">⟶</span> star_matrix' <span class="var">?t</span> <span class="bound">g</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="bound">zs</span> <span class="main">≼</span> <span class="var">?t</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="bound">zs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">zs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?t</span> <span class="main">∧</span> distinct <span class="skolem">zs</span> <span class="main">⟶</span> <span class="main">(</span><span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">≼</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">⟶</span> star_matrix' <span class="var">?t</span> <span class="skolem">g</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">≼</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">zs</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_empty_right restrict_star restrict_times<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?t</span> <span class="main">∧</span> distinct <span class="skolem">zs</span> <span class="main">⟶</span> <span class="main">(</span><span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">≼</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">⟶</span> star_matrix' <span class="var">?t</span> <span class="skolem">g</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">≼</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="var">?t</span> <span class="main">∧</span> distinct <span class="skolem">zs</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">s</span> <span class="main">∧</span> distinct <span class="skolem">ys</span> <span class="main">∧</span> <span class="main">¬</span> List.member <span class="skolem">s</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="main">¬</span> List.member <span class="skolem">ys</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> List.member_def<span class="main">)</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">k</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="var">?a</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ds</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"star_matrix' <span class="skolem">s</span> <span class="var">?d</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?es</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="var">?e</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"star_matrix' <span class="skolem">s</span> <span class="var">?f</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ha</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?y</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?hb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">ys</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?hc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?y</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?hd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">ys</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">≼</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">≼</span> <span class="var">?ha</span> <span class="main">∧</span> <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?hd</span> <span class="main">≼</span> <span class="var">?hb</span> <span class="main">∧</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">≼</span> <span class="var">?hc</span> <span class="main">∧</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?d</span> <span class="main">⊙</span> <span class="var">?hd</span> <span class="main">≼</span> <span class="var">?hd</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 2 3 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_nonempty_product_less_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="var">?ds</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">=</span> <span class="var">?ds</span> <span class="main">∧</span> <span class="skolem">s</span><span class="main">⟨</span><span class="var">?fs</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">=</span> <span class="var">?fs</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_star<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span><span class="var">?e</span><span class="main">⟩</span><span class="var">?r</span> <span class="main">=</span> <span class="var">?e</span> <span class="main">∧</span> <span class="skolem">s</span><span class="main">⟨</span><span class="var">?f</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">=</span> <span class="var">?f</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> restrict_one_left_unit restrict_sup restrict_times<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"disjoint <span class="skolem">s</span> <span class="var">?r</span> <span class="main">∧</span> disjoint <span class="var">?r</span> <span class="skolem">s</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_set_member member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> member_rec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?es</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">=</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?es</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">=</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="main">(</span><span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?hd</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_nonempty<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_dist_sup<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_disjoint<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">=</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">=</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="main">(</span><span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?hd</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_nonempty<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_dist_sup<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="main">(</span><span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?ha</span><span class="main">)</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="main">(</span><span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hb</span><span class="main">)</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="keyword1">mbot</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="keyword1">mbot</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 6 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> times_disjoint<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">=</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">=</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="main">(</span><span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?hd</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_nonempty<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_dist_sup<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="main">(</span><span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hc</span><span class="main">)</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="main">(</span><span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hd</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="keyword1">mbot</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="keyword1">mbot</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> times_disjoint<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">=</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">=</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="main">(</span><span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?hd</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_nonempty<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_dist_sup<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 6 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> times_disjoint matrix_bounded_semilattice_sup_bot.sup_monoid.add_0_left<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">≼</span> <span class="var">?ha</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">≼</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?hc</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?hc</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 3 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc member_rec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?ha</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">≼</span> <span class="var">?ha</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_star_left_induct<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">≼</span> <span class="var">?hb</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">≼</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 4 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hb</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">≼</span> <span class="var">?hb</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 4 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_star_left_induct<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">≼</span> <span class="var">?hc</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">≼</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?ha</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?ha</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc restrict_star_left_induct restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hc</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">≼</span> <span class="var">?hc</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 3 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span> <span class="main">≼</span> <span class="var">?hd</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?hd</span> <span class="main">≼</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?hb</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?hb</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 4 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc restrict_star_left_induct restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">⊙</span> <span class="var">?hd</span> <span class="main">≼</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 4 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">≼</span> <span class="var">?ha</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">≼</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?hc</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 15 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?ha</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?ha</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_star_left_induct restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span> <span class="main">≼</span> <span class="var">?hb</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span> <span class="main">≼</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 16 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?hb</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hb</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 4 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_star_left_induct restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 19<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">≼</span> <span class="var">?hc</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">≼</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?ha</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 13 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?hc</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hc</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 3 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">≼</span> <span class="var">?hd</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">≼</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?hb</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 14 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_isotone matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 4 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">≼</span> <span class="var">?ha</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 13 17 matrix_semilattice_sup.le_supI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> 22<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span> <span class="main">≼</span> <span class="var">?hb</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 14 18 matrix_semilattice_sup.le_supI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> 23<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">≼</span> <span class="var">?hc</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 15 19 matrix_semilattice_sup.le_supI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> 24<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span> <span class="main">≼</span> <span class="var">?hd</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 16 20 matrix_semilattice_sup.le_supI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"star_matrix' <span class="var">?t</span> <span class="skolem">g</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">=</span> <span class="main">(</span><span class="var">?es</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?fs</span><span class="main">)</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_matrix'.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">⊕</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 9 10 11 12 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> matrix_semilattice_sup.sup_assoc<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hc</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊙</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?fs</span> <span class="main">⊙</span> <span class="var">?hd</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> matrix_semilattice_sup.sup_assoc matrix_semilattice_sup.sup_commute matrix_semilattice_sup.sup_left_commute<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?hd</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 21 22 23 24 matrix_semilattice_sup.sup.mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_nonempty<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"star_matrix' <span class="var">?t</span> <span class="skolem">g</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span> <span class="main">≼</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">zs</span>"</span></span>
            <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">zs</span> <span class="main">.</span> distinct <span class="bound">zs</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="var">?e</span><span class="main">⟨</span><span class="skolem">x</span><span class="main">⟩</span><span class="bound">zs</span> <span class="main">≼</span> <span class="var">?e</span><span class="main">⟨</span><span class="skolem">x</span><span class="main">⟩</span><span class="bound">zs</span> <span class="main">⟶</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span> <span class="main">⊙</span> <span class="var">?e</span><span class="main">⟨</span><span class="skolem">x</span><span class="main">⟩</span><span class="bound">zs</span> <span class="main">≼</span> <span class="var">?e</span><span class="main">⟨</span><span class="skolem">x</span><span class="main">⟩</span><span class="bound">zs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enum_distinct restrict_all<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">≼</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">≼</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_all enum_distinct<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"enum_class.enum<span class="main">::</span><span class="tfree">'a</span> list"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="bound">h</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> <span class="main">∀</span><span class="bound">zs</span> <span class="main">.</span> distinct <span class="var">?e</span> <span class="main">∧</span> distinct <span class="bound">zs</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">zs</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="var">?e</span> <span class="main">⊙</span> <span class="var">?e</span><span class="main">⟨</span><span class="bound">g</span><span class="main">⟩</span><span class="var">?e</span> <span class="main">≼</span> <span class="bound">zs</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="var">?e</span> <span class="main">⟶</span> <span class="bound">zs</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="var">?e</span> <span class="main">⊙</span> star_matrix' <span class="var">?e</span> <span class="bound">g</span> <span class="main">≼</span> <span class="bound">zs</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="var">?e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>list.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_empty_left<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">k</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">#</span><span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="bound">h</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> <span class="main">∀</span><span class="bound">zs</span> <span class="main">.</span> distinct <span class="skolem">s</span> <span class="main">∧</span> distinct <span class="bound">zs</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">zs</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">⊙</span> <span class="skolem">s</span><span class="main">⟨</span><span class="bound">g</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">≼</span> <span class="bound">zs</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">⟶</span> <span class="bound">zs</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">⊙</span> star_matrix' <span class="skolem">s</span> <span class="bound">g</span> <span class="main">≼</span> <span class="bound">zs</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="bound">h</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> <span class="main">∀</span><span class="bound">zs</span> <span class="main">.</span> distinct <span class="var">?t</span> <span class="main">∧</span> distinct <span class="bound">zs</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">zs</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="bound">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">≼</span> <span class="bound">zs</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⟶</span> <span class="bound">zs</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> star_matrix' <span class="var">?t</span> <span class="bound">g</span> <span class="main">≼</span> <span class="bound">zs</span><span class="main">⟨</span><span class="bound">h</span><span class="main">⟩</span><span class="var">?t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">zs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?t</span> <span class="main">∧</span> distinct <span class="skolem">zs</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">≼</span> <span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⟶</span> <span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> star_matrix' <span class="var">?t</span> <span class="skolem">g</span> <span class="main">≼</span> <span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">zs</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_empty_left restrict_star restrict_times<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?t</span> <span class="main">∧</span> distinct <span class="skolem">zs</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">≼</span> <span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⟶</span> <span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> star_matrix' <span class="var">?t</span> <span class="skolem">g</span> <span class="main">≼</span> <span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="var">?t</span> <span class="main">∧</span> distinct <span class="skolem">zs</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">s</span> <span class="main">∧</span> distinct <span class="skolem">ys</span> <span class="main">∧</span> <span class="main">¬</span> List.member <span class="skolem">s</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="main">¬</span> List.member <span class="skolem">ys</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> List.member_def<span class="main">)</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">k</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="var">?a</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ds</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"star_matrix' <span class="skolem">s</span> <span class="var">?d</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?es</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="var">?e</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"star_matrix' <span class="skolem">s</span> <span class="var">?f</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ha</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?hb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?hc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?hd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="skolem">s</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?t</span><span class="main">⟨</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">≼</span> <span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?a</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">≼</span> <span class="var">?ha</span> <span class="main">∧</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?d</span> <span class="main">≼</span> <span class="var">?hb</span> <span class="main">∧</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?a</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">≼</span> <span class="var">?hc</span> <span class="main">∧</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?d</span> <span class="main">≼</span> <span class="var">?hd</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 2 3 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_nonempty_product_less_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="var">?ds</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">=</span> <span class="var">?ds</span> <span class="main">∧</span> <span class="skolem">s</span><span class="main">⟨</span><span class="var">?fs</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">=</span> <span class="var">?fs</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_star<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span><span class="var">?e</span><span class="main">⟩</span><span class="var">?r</span> <span class="main">=</span> <span class="var">?e</span> <span class="main">∧</span> <span class="skolem">s</span><span class="main">⟨</span><span class="var">?f</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">=</span> <span class="var">?f</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> restrict_one_left_unit restrict_sup restrict_times<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"disjoint <span class="skolem">s</span> <span class="var">?r</span> <span class="main">∧</span> disjoint <span class="var">?r</span> <span class="skolem">s</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_set_member member_rec<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">=</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">=</span> <span class="main">(</span><span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?hd</span><span class="main">)</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_nonempty<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_disjoint<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">=</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">=</span> <span class="main">(</span><span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?hd</span><span class="main">)</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_nonempty<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="keyword1">mbot</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="keyword1">mbot</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> times_disjoint<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">=</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">=</span> <span class="main">(</span><span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?hd</span><span class="main">)</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_nonempty<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">mbot</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="keyword1">mbot</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 6 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> times_disjoint<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">=</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">=</span> <span class="main">(</span><span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?hd</span><span class="main">)</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_nonempty<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 6 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> times_disjoint matrix_bounded_semilattice_sup_bot.sup_monoid.add_0_right matrix_bounded_semilattice_sup_bot.sup_monoid.add_0_left<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">≼</span> <span class="var">?ha</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">≼</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_isotone<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?c</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 4 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_isotone restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?ha</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?e</span> <span class="main">≼</span> <span class="var">?ha</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_dist_sup matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_star_right_induct<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">≼</span> <span class="var">?hb</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">≼</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_semilattice_sup.le_supE matrix_idempotent_semiring.mult_left_isotone<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?b</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_isotone restrict_star_right_induct restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hb</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?f</span> <span class="main">≼</span> <span class="var">?hb</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_dist_sup matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 3 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">≼</span> <span class="var">?hc</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">≼</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_isotone<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?c</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 4 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_isotone restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hc</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?e</span> <span class="main">≼</span> <span class="var">?hc</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_dist_sup matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 4 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_star_right_induct<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">≼</span> <span class="var">?hd</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">≼</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_isotone<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?b</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 4 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_isotone restrict_star_right_induct restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?f</span> <span class="main">≼</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_dist_sup matrix_monoid.mult_assoc<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 4 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">≼</span> <span class="var">?ha</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">≼</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 4 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_isotone restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_isotone<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?ha</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">≼</span> <span class="var">?hb</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">≼</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_isotone restrict_star_right_induct restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_isotone<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hb</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 19<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">≼</span> <span class="var">?hc</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">≼</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 4 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_isotone restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?es</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_isotone<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hc</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 15 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">≼</span> <span class="var">?hd</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">≼</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 4 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_isotone restrict_star_right_induct restrict_sublist<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_isotone<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?hd</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> 16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> 21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">≼</span> <span class="var">?ha</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 13 17 matrix_semilattice_sup.le_supI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> 22<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">≼</span> <span class="var">?hb</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 14 18 matrix_semilattice_sup.le_supI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> 23<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">≼</span> <span class="var">?hc</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 15 19 matrix_semilattice_sup.le_supI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> 24<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">≼</span> <span class="var">?hd</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 16 20 matrix_semilattice_sup.le_supI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> star_matrix' <span class="var">?t</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="main">(</span><span class="var">?es</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?fs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_matrix'.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_left_dist_sup matrix_monoid.mult_assoc<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?fs</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 9 10 11 12 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_semilattice_sup.sup_assoc<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="var">?ha</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊙</span> <span class="var">?fs</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="var">?hc</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?hd</span> <span class="main">⊙</span> <span class="var">?fs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 9 10 11 12 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> matrix_semilattice_sup.sup_assoc matrix_semilattice_sup.sup_commute matrix_semilattice_sup.sup_left_commute<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="var">?ha</span> <span class="main">⊕</span> <span class="var">?hb</span> <span class="main">⊕</span> <span class="var">?hc</span> <span class="main">⊕</span> <span class="var">?hd</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 21 22 23 24 matrix_semilattice_sup.sup.mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_nonempty<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span> <span class="main">⊙</span> star_matrix' <span class="var">?t</span> <span class="skolem">g</span> <span class="main">≼</span> <span class="skolem">zs</span><span class="main">⟨</span><span class="skolem">h</span><span class="main">⟩</span><span class="var">?t</span>"</span></span>
            <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">zs</span> <span class="main">.</span> distinct <span class="bound">zs</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">zs</span><span class="main">⟨</span><span class="skolem">x</span><span class="main">⟩</span><span class="var">?e</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">≼</span> <span class="bound">zs</span><span class="main">⟨</span><span class="skolem">x</span><span class="main">⟩</span><span class="var">?e</span> <span class="main">⟶</span> <span class="bound">zs</span><span class="main">⟨</span><span class="skolem">x</span><span class="main">⟩</span><span class="var">?e</span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span> <span class="main">≼</span> <span class="bound">zs</span><span class="main">⟨</span><span class="skolem">x</span><span class="main">⟩</span><span class="var">?e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enum_distinct restrict_all<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">≼</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span> <span class="main">≼</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_all enum_distinct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Matrices form a Stone-Kleene Relation Algebra›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Matrices over Stone-Kleene relation algebras form a Stone-Kleene relation algebra.
It remains to prove the axiom about the interaction of Kleene star and double complement.
›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_stone_kleene_relation_algebra<span class="main">:</span> stone_kleene_relation_algebra <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>stone_kleene_relation_algebra<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">=</span> <span class="quoted">uminus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted">one_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> times <span class="main">=</span> <span class="quoted">times_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> conv <span class="main">=</span> <span class="quoted">conv_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> star <span class="main">=</span> <span class="quoted">star_matrix</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"enum_class.enum<span class="main">::</span><span class="tfree">'a</span> list"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?o</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mone</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_order.order_antisym<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> distinct <span class="var">?e</span> <span class="main">⟶</span> <span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span>star_matrix' <span class="var">?e</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> star_matrix' <span class="var">?e</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="bound">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">k</span> <span class="skolem">s</span><span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">#</span><span class="skolem">s</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> distinct <span class="skolem">s</span> <span class="main">⟶</span> <span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span>star_matrix' <span class="skolem">s</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> star_matrix' <span class="skolem">s</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> distinct <span class="var">?t</span> <span class="main">⟶</span> <span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span>star_matrix' <span class="var">?t</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> star_matrix' <span class="var">?t</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="var">?t</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">k</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">g</span><span class="main">⟩</span><span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">g</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">g</span><span class="main">⟩</span><span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="var">?a</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ds</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"star_matrix' <span class="skolem">s</span> <span class="var">?d</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">⊕</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?es</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span><span class="main">⟨</span>star <span class="keyword1">o</span> <span class="var">?e</span><span class="main">⟩</span><span class="var">?r</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">⊕</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"star_matrix' <span class="skolem">s</span> <span class="var">?f</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⟨</span><span class="var">?ds</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">=</span> <span class="var">?ds</span> <span class="main">∧</span> <span class="skolem">s</span><span class="main">⟨</span><span class="var">?fs</span><span class="main">⟩</span><span class="skolem">s</span> <span class="main">=</span> <span class="var">?fs</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_star<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">⊖</span><span class="var">?a</span> <span class="main">=</span> <span class="var">?a</span> <span class="main">∧</span> <span class="main">⊖</span><span class="main">⊖</span><span class="var">?b</span> <span class="main">=</span> <span class="var">?b</span> <span class="main">∧</span> <span class="main">⊖</span><span class="main">⊖</span><span class="var">?c</span> <span class="main">=</span> <span class="var">?c</span> <span class="main">∧</span> <span class="main">⊖</span><span class="main">⊖</span><span class="var">?d</span> <span class="main">=</span> <span class="var">?d</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_p_algebra.regular_closed_p restrict_pp<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">⊖</span><span class="var">?as</span> <span class="main">=</span> <span class="var">?as</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pp_star_commute restrict_pp<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">⊖</span><span class="var">?f</span> <span class="main">=</span> <span class="var">?f</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_stone_algebra.regular_closed_sup matrix_stone_relation_algebra.regular_mult_closed<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">⊖</span><span class="var">?fs</span> <span class="main">=</span> <span class="var">?fs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">⊖</span><span class="var">?ds</span> <span class="main">=</span> <span class="var">?ds</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_pp<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">⊖</span><span class="var">?e</span> <span class="main">=</span> <span class="var">?e</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_stone_algebra.regular_closed_sup matrix_stone_relation_algebra.regular_mult_closed<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">⊖</span><span class="var">?es</span> <span class="main">=</span> <span class="var">?es</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pp_star_commute restrict_pp<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span>star_matrix' <span class="var">?t</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span><span class="var">?es</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?fs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_matrix'.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⊖</span><span class="main">⊖</span><span class="var">?es</span> <span class="main">⊕</span> <span class="main">⊖</span><span class="main">⊖</span><span class="var">?as</span> <span class="main">⊙</span> <span class="main">⊖</span><span class="main">⊖</span><span class="var">?b</span> <span class="main">⊙</span> <span class="main">⊖</span><span class="main">⊖</span><span class="var">?fs</span> <span class="main">⊕</span> <span class="main">⊖</span><span class="main">⊖</span><span class="var">?ds</span> <span class="main">⊙</span> <span class="main">⊖</span><span class="main">⊖</span><span class="var">?c</span> <span class="main">⊙</span> <span class="main">⊖</span><span class="main">⊖</span><span class="var">?es</span> <span class="main">⊕</span> <span class="main">⊖</span><span class="main">⊖</span><span class="var">?fs</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_stone_relation_algebra.pp_dist_comp<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?as</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?fs</span> <span class="main">⊕</span> <span class="var">?ds</span> <span class="main">⊙</span> <span class="var">?c</span> <span class="main">⊙</span> <span class="var">?es</span> <span class="main">⊕</span> <span class="var">?fs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 3 4 5 6 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span>star_matrix' <span class="var">?t</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> star_matrix' <span class="var">?t</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">g</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_matrix'.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span> <span class="main">=</span> <span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span><span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enum_distinct restrict_all<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span><span class="main">)</span> <span class="main">≼</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_kleene_algebra.star.circ_isotone matrix_p_algebra.pp_increasing matrix_p_algebra.pp_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?o</span> <span class="main">⊕</span> <span class="main">⊖</span><span class="main">⊖</span><span class="skolem">x</span> <span class="main">⊙</span> <span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span><span class="main">)</span> <span class="main">≼</span> <span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_kleene_algebra.star_left_unfold_equal matrix_p_algebra.sup_pp_semi_commute matrix_stone_relation_algebra.pp_dist_comp<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span> <span class="main">≼</span> <span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⊙</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> matrix_kleene_algebra.star_left_induct <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div>