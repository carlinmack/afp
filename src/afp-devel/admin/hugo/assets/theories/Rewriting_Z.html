<div id="Z">
<div class="head">
<h1>Theory Z</h1>
</div>
<pre class="source"><span class="comment1">(*
 * Title:      Z  
 * Author:     Bertram Felgenhauer (2016)
 * Author:     Julian Nagele (2016)
 * Author:     Vincent van Oostrom (2016)
 * Author:     Christian Sternagel (2016)
 * Maintainer: Bertram Felgenhauer &lt;bertram.felgenhauer@uibk.ac.at&gt;
 * Maintainer: Juilan Nagele &lt;julian.nagele@uibk.ac.at&gt;
 * Maintainer: Christian Sternagel &lt;c.sternagel@gmail.com&gt;
 * License:    BSD
 *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Z property›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Z
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../Abstract-Rewriting/Abstract_Rewriting.html">Abstract-Rewriting.Abstract_Rewriting</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> z_property <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">bullet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>∙</sup></span>"</span> <span class="main">[</span>1000<span class="main">]</span> 1000<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> <span class="main">(</span><span class="free">a</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">,</span> <span class="free">b</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Z-monotonicity"><span class="command">lemma</span></span> monotonicity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">,</span> <span class="free">b</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Z<span class="main">)</span>

<span class="keyword1" id="Z-semi_confluence"><span class="command">lemma</span></span> semi_confluence<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span><span class="main">¯</span> <span class="keyword1">O</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>↓</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subrelI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> relcompEpair<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> converseD<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="skolem">a</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>↓</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">b</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">,</span> <span class="skolem">b</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monotonicity<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">b</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Z<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Z<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Z-CR"><span class="command">lemma</span></span> CR<span class="main">:</span> <span class="quoted"><span class="quoted">"CR <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> semi_confluence_imp_CR semi_confluence<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">R<span class="hidden">⇩</span><sub>d</sub></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> angle_property <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">bullet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>∙</sup></span>"</span> <span class="main">[</span>1000<span class="main">]</span> 1000<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">R<span class="hidden">⇩</span><sub>d</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> intermediate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="free">R<span class="hidden">⇩</span><sub>d</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">R<span class="hidden">⇩</span><sub>d</sub></span> <span class="main">⊆</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> angle<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R<span class="hidden">⇩</span><sub>d</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">R<span class="hidden">⇩</span><sub>d</sub></span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> angle_property <span class="main">⊆</span> z_property
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> angle intermediate <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">R<span class="hidden">⇩</span><sub>d</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">,</span> <span class="skolem">b</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">R<span class="hidden">⇩</span><sub>d</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">,</span> <span class="skolem">b</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> intermediate <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> z_property <span class="main">⊆</span> angle_property <span class="quoted"><span class="free">bullet</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"z_property.R<span class="hidden">⇩</span><sub>d</sub> <span class="free">bullet</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> R<span class="hidden">⇩</span><sub>d</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"R<span class="hidden">⇩</span><sub>d</sub> <span class="main">⊆</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R<span class="hidden">⇩</span><sub>d</sub>_def <span class="keyword1"><span class="command">using</span></span> Z <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> R<span class="hidden">⇩</span><sub>d</sub>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span><span class="main">)</span> <span class="main">∈</span> R<span class="hidden">⇩</span><sub>d</sub>"</span></span> <span class="keyword1"><span class="command">using</span></span> monotonicity <span class="keyword1"><span class="command">unfolding</span></span> R<span class="hidden">⇩</span><sub>d</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Lambda_Z">
<div class="head">
<h1>Theory Lambda_Z</h1>
</div>
<pre class="source"><span class="comment1">(*
 * Title:      Z  
 * Author:     Bertram Felgenhauer (2016)
 * Author:     Julian Nagele (2016)
 * Author:     Vincent van Oostrom (2016)
 * Author:     Christian Sternagel (2016)
 * Maintainer: Bertram Felgenhauer &lt;bertram.felgenhauer@uibk.ac.at&gt;
 * Maintainer: Juilan Nagele &lt;julian.nagele@uibk.ac.at&gt;
 * Maintainer: Christian Sternagel &lt;c.sternagel@gmail.com&gt;
 * License:    BSD
 *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Lambda Calculus has the Church-Rosser property›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Lambda_Z
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../nominal2/theories/#Nominal2">Nominal2.Nominal2</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Eisbach/Eisbach.html">HOL-Eisbach.Eisbach</a>"</span>
  <a href="#Z">Z</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">atom_decl</span></span> name

<span class="keyword1"><span class="command">nominal_datatype</span></span> <span class="quoted">"term"</span> <span class="main">=</span>
  Var <span class="quoted">name</span>
<span class="main">|</span> App <span class="quoted"><span class="quoted">"term"</span></span> <span class="quoted"><span class="quoted">"term"</span></span>
<span class="main">|</span> Abs x<span class="main">::</span><span class="quoted">name</span> t<span class="main">::</span><span class="quoted"><span class="quoted">"term"</span></span> <span class="keyword2"><span class="keyword">binds</span></span> <span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword">in</span></span> t

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ad-hoc methods for nominal-functions over lambda terms›</span></span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">graph_aux_tac</span> <span class="entity">ctxt</span> <span class="main">=</span>
  SUBGOAL <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">subgoal</span><span class="main">,</span> <span class="entity">i</span><span class="main">)</span> <span class="main">=&gt;</span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">subgoal</span> <span class="keyword2"><span class="keyword">of</span></span>
      Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Trueprop<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> eqvt<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ Free <span class="main">(</span><span class="entity">f</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span>
        <span class="entity">full_simp_tac</span> <span class="main">(</span>
          <span class="entity">ctxt</span> addsimps <span class="main">[</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> eqvt_def<span class="antiquote">}</span></span></span><span class="main">,</span> Proof_Context.get_thm <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">f</span> ^ <span class="inner_quoted">"_def"</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="entity">i</span>
    <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> no_tac<span class="main">)</span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">method_setup</span></span> eqvt_graph_aux <span class="main">=</span>
  <span class="quoted">‹Scan.succeed <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">=&gt;</span> <span class="entity">SIMPLE_METHOD'</span> <span class="main">(</span><span class="entity">graph_aux_tac</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span>›</span>
  <span class="quoted">"show equivariance of auxilliary graph construction for nominal functions"</span>

<span class="keyword1"><span class="command">method</span></span> without_alpha_lst <span class="keyword2"><span class="keyword">methods</span></span> m <span class="main">=</span>
  <span class="main">(</span><span class="operator">match</span> termI <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> H <span class="main"><span class="main">[</span></span><span class="operator">simproc</span> <span class="quasi_keyword"><span class="quasi_keyword">del</span></span><span class="main"><span class="main"><span class="main">:</span></span></span> alpha_lst<span class="main"><span class="main">]</span></span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="main">_</span></span> <span class="main"><span class="main">⇒</span></span> <span class="quoted">‹<span class="operator">m</span>›</span><span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> Abs_lst <span class="main">=</span>
  <span class="main">(</span><span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span>
    <span class="quoted"><span class="quoted">"atom <span class="var">?x</span> <span class="main">♯</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P <span class="main"><span class="main">[</span></span><span class="operator">thin</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">[</span>atom <span class="main">_</span><span class="main">]</span><span class="keyword1">]lst.</span> <span class="main">_</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span>atom <span class="main">_</span><span class="main">]</span><span class="keyword1">]lst.</span> <span class="main">_</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">c</span> <span class="main"><span class="main">::</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>fs"</span></span> <span class="main"><span class="main">⇒</span></span>
      <span class="quoted">‹<span class="operator">rule</span> Abs_lst1_fcb2' <span class="main">[</span><span class="operator">where</span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="operator">OF</span> P<span class="main">]</span>›</span>
  <span class="main"><span class="main">¦</span></span> P <span class="main"><span class="main">[</span></span><span class="operator">thin</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">[</span>atom <span class="main">_</span><span class="main">]</span><span class="keyword1">]lst.</span> <span class="main">_</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span>atom <span class="main">_</span><span class="main">]</span><span class="keyword1">]lst.</span> <span class="main">_</span>"</span></span> <span class="main"><span class="main">⇒</span></span> <span class="quoted">‹<span class="operator">rule</span> Abs_lst1_fcb2' <span class="main">[</span><span class="operator">where</span> c <span class="main"><span class="main">=</span></span> <span class="quoted">"<span class="main">()</span>"</span><span class="main">,</span> <span class="operator">OF</span> P<span class="main">]</span>›</span><span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> pat_comp_aux <span class="main">=</span>
  <span class="main">(</span><span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span>
    <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">_</span> <span class="main">::</span> term<span class="main">)</span> <span class="main">⟹</span> <span class="main">_</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">x</span> <span class="main"><span class="main">⇒</span></span> <span class="quoted">‹<span class="operator">rule</span> term.strong_exhaust <span class="main">[</span><span class="operator">where</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword"><span class="quasi_keyword">and</span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>›</span>
  <span class="main"><span class="main">¦</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span>Var <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">_</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">x</span> <span class="main"><span class="main">::</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">::</span> fs"</span></span> <span class="main"><span class="main">⇒</span></span>
    <span class="quoted">‹<span class="operator">rule</span> term.strong_exhaust <span class="main">[</span><span class="operator">where</span> y <span class="main"><span class="main">=</span></span> <span class="quoted">"fst <span class="free">x</span>"</span> <span class="quasi_keyword"><span class="quasi_keyword">and</span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>›</span>
  <span class="main"><span class="main">¦</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> Var <span class="main">_</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">_</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">x</span> <span class="main"><span class="main">::</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">::</span> fs"</span></span> <span class="main"><span class="main">⇒</span></span>
    <span class="quoted">‹<span class="operator">rule</span> term.strong_exhaust <span class="main">[</span><span class="operator">where</span> y <span class="main"><span class="main">=</span></span> <span class="quoted">"snd <span class="free">x</span>"</span> <span class="quasi_keyword"><span class="quasi_keyword">and</span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>›</span>
  <span class="main"><span class="main">¦</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> Var <span class="main">_</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">_</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">x</span> <span class="main"><span class="main">::</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">::</span> fs"</span></span> <span class="main"><span class="main">⇒</span></span>
    <span class="quoted">‹<span class="operator">rule</span> term.strong_exhaust <span class="main">[</span><span class="operator">where</span> y <span class="main"><span class="main">=</span></span> <span class="quoted">"snd <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span>"</span> <span class="quasi_keyword"><span class="quasi_keyword">and</span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>›</span><span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> pat_comp <span class="main">=</span> <span class="main">(</span><span class="operator">pat_comp_aux</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fresh_star_def fresh_Pair_elim<span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> freshness <span class="keyword2"><span class="keyword">uses</span></span> fresh <span class="main">=</span>
  <span class="main">(</span><span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">conclusion</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span>
    <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">♯</span> <span class="main">_</span>"</span></span> <span class="main"><span class="main">⇒</span></span> <span class="quoted">‹<span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main">:</span> fresh_Unit fresh_Pair <span class="dynamic"><span class="dynamic">fresh</span></span>›</span>
  <span class="main"><span class="main">¦</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">♯*</span> <span class="main">_</span>"</span></span> <span class="main"><span class="main">⇒</span></span> <span class="quoted">‹<span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main">:</span> fresh_star_def fresh_Unit fresh_Pair <span class="dynamic"><span class="dynamic">fresh</span></span>›</span><span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> solve_eqvt_at <span class="main">=</span>
  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eqvt_at_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perm_supp_eq fresh_star_Pair<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">method</span></span> nf <span class="keyword2"><span class="keyword">uses</span></span> fresh <span class="main">=</span> <span class="operator">without_alpha_lst</span> <span class="quoted">‹
  <span class="operator">eqvt_graph_aux</span><span class="keyword3">,</span> <span class="operator">rule</span> TrueI<span class="keyword3">,</span> <span class="operator">pat_comp</span><span class="keyword3">,</span> <span class="operator">auto</span><span class="keyword3">,</span> <span class="operator">Abs_lst</span><span class="keyword3">,</span>
  <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> Abs_fresh_iff pure_fresh perm_supp_eq<span class="keyword3">,</span>
  (<span class="operator">freshness</span> <span class="quasi_keyword">fresh</span><span class="main">:</span> <span class="dynamic"><span class="dynamic">fresh</span></span>)<span class="keyword3">+</span><span class="keyword3">,</span>
  <span class="operator">solve_eqvt_at</span><span class="keyword3">?</span>›</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Substitutions›</span></span>

<span class="keyword1"><span class="command">nominal_function</span></span> <span class="entity">subst</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">else</span> Var <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">=</span> App <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"atom <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">♯</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Abs <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> Abs <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">nf</span>
<span class="keyword1"><span class="command">nominal_termination</span></span> <span class="main">(</span>eqvt<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">lexicographic_order</span>

<span class="keyword1" id="Lambda_Z-fresh_subst"><span class="command">lemma</span></span> fresh_subst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atom <span class="free">z</span> <span class="main">♯</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∨</span> atom <span class="free">z</span> <span class="main">♯</span> <span class="free">t</span> <span class="main">⟹</span> atom <span class="free">z</span> <span class="main">♯</span> subst <span class="free">y</span> <span class="free">s</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nominal_induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">avoiding</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> term.strong_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Lambda_Z-fresh_subst_id"><span class="command">lemma</span></span> fresh_subst_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"atom <span class="free">x</span> <span class="main">♯</span> <span class="free">t</span> <span class="main">⟹</span> subst <span class="free">x</span> <span class="free">s</span> <span class="free">t</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nominal_induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">avoiding</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> term.strong_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fresh_at_base<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The substitution lemma.›</span></span>
<span class="keyword1" id="Lambda_Z-subst_subst"><span class="command">lemma</span></span> subst_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"atom <span class="free">x</span> <span class="main">♯</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subst <span class="free">y</span> <span class="free">u</span> <span class="main">(</span>subst <span class="free">x</span> <span class="free">s</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> subst <span class="free">x</span> <span class="main">(</span>subst <span class="free">y</span> <span class="free">u</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">y</span> <span class="free">u</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nominal_induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">avoiding</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> term.strong_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fresh_subst<span class="main">)</span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">Beta</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">{→<span class="hidden">⇩</span><sub>β</sub>}</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  root<span class="main">:</span> <span class="quoted"><span class="quoted">"atom <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">♯</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="main">(</span>App <span class="main">(</span>Abs <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> subst <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1"><span class="free">{→<span class="hidden">⇩</span><sub>β</sub>}</span></span>"</span></span>
<span class="main">|</span> Appl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1"><span class="free">{→<span class="hidden">⇩</span><sub>β</sub>}</span></span> <span class="main">⟹</span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> App <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1"><span class="free">{→<span class="hidden">⇩</span><sub>β</sub>}</span></span>"</span></span>
<span class="main">|</span> Appr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1"><span class="free">{→<span class="hidden">⇩</span><sub>β</sub>}</span></span> <span class="main">⟹</span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> App <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1"><span class="free">{→<span class="hidden">⇩</span><sub>β</sub>}</span></span>"</span></span>
<span class="main">|</span> Abs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1"><span class="free">{→<span class="hidden">⇩</span><sub>β</sub>}</span></span> <span class="main">⟹</span> <span class="main">(</span>Abs <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> Abs <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1"><span class="free">{→<span class="hidden">⇩</span><sub>β</sub>}</span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">beta</span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub></span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>56<span class="main">,</span> 56<span class="main">]</span> 55<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1"><span class="free">→<span class="hidden">⇩</span><sub>β</sub></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">{→<span class="hidden">⇩</span><sub>β</sub>}</span>"</span></span>

<span class="keyword1"><span class="command">equivariance</span></span> <span class="quoted">Betap</span>
<span class="keyword1"><span class="command">lemmas</span></span> Beta_eqvt <span class="main">=</span> Betap.eqvt <span class="main">[</span><span class="operator">to_set</span><span class="main">]</span>

<span class="keyword1"><span class="command">nominal_inductive</span></span> Betap
  <span class="keyword2"><span class="keyword">avoids</span></span> Abs<span class="main">:</span> <span class="quoted"><span class="free">x</span></span>
       <span class="main">|</span> root<span class="main">:</span> <span class="quoted"><span class="free">x</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fresh_star_def fresh_subst<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> Beta_strong_induct <span class="main">=</span> Betap.strong_induct <span class="main">[</span><span class="operator">to_set</span><span class="main">]</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">betas</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1"><span class="free">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">{→<span class="hidden">⇩</span><sub>β</sub>}</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>

<span class="keyword1"><span class="command">nominal_function</span></span> <span class="entity">app_beta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"term <span class="main">⇒</span> term <span class="main">⇒</span> term"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"atom <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">♯</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟹</span> <span class="free">app_beta</span> <span class="main">(</span>Abs <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> subst <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">app_beta</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> App <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">app_beta</span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> App <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nf</span> <span class="quasi_keyword">fresh</span><span class="main"><span class="main">:</span></span> fresh_subst<span class="main">)</span>
<span class="keyword1"><span class="command">nominal_termination</span></span> <span class="main">(</span>eqvt<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">lexicographic_order</span>

<span class="keyword1"><span class="command">nominal_function</span></span> <span class="entity">bullet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"term <span class="main">⇒</span> term"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>∙</sup></span>"</span> <span class="main">[</span>1000<span class="main">]</span> 1000<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span> <span class="main">=</span> Var <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Abs <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span> <span class="main">=</span> Abs <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span> <span class="main">=</span> app_beta <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∙</sup></span></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">nf</span>
<span class="keyword1"><span class="command">nominal_termination</span></span> <span class="main">(</span>eqvt<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">lexicographic_order</span>

<span class="keyword1" id="Lambda_Z-app_beta_exhaust"><span class="command">lemma</span></span> app_beta_exhaust <span class="main">[</span><span class="operator">case_names</span> Redex no_Redex<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> fs"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">s'</span><span class="main">.</span> atom <span class="bound">x</span> <span class="main">♯</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">=</span> Abs <span class="bound">x</span> <span class="bound">s'</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> app_beta <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> App <span class="free">s</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">thesis</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> term.strong_exhaust <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fresh_star_def fresh_Pair <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1" id="Lambda_Z-App_Betas"><span class="command">lemma</span></span> App_Betas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"App <span class="free">s</span> <span class="free">u</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> App <span class="free">t</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Beta.intros rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Beta.intros rtrancl_into_rtrancl<span class="main">)</span>

<span class="keyword1" id="Lambda_Z-Abs_Betas"><span class="command">lemma</span></span> Abs_Betas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Abs <span class="free">x</span> <span class="free">s</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> Abs <span class="free">x</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Beta.intros rtrancl_into_rtrancl<span class="main">)</span>

<span class="keyword1" id="Lambda_Z-self"><span class="command">lemma</span></span> self<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">nominal_induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> term.strong_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>App <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> app_beta_exhaust<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> App_Betas Beta.intros rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Abs_Betas<span class="main">)</span>

<span class="keyword1" id="Lambda_Z-fresh_atom_bullet"><span class="command">lemma</span></span> fresh_atom_bullet<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atom <span class="main">(</span><span class="free">x</span><span class="main">::</span>name<span class="main">)</span> <span class="main">♯</span> <span class="free">t</span> <span class="main">⟹</span> atom <span class="free">x</span> <span class="main">♯</span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">nominal_induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">avoiding</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> term.strong_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>App <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> app_beta_exhaust<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fresh_subst<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Lambda_Z-subst_Beta"><span class="command">lemma</span></span> subst_Beta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub></span> <span class="free">t'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subst <span class="free">x</span> <span class="free">s</span> <span class="free">t</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub></span> subst <span class="free">x</span> <span class="free">s</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">nominal_induct</span> <span class="quasi_keyword">avoiding</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Beta_strong_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">y</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subst_subst fresh_subst <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Beta.root<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Beta.intros<span class="main">)</span>

<span class="keyword1" id="Lambda_Z-Beta_in_subst"><span class="command">lemma</span></span> Beta_in_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub></span> <span class="free">s'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subst <span class="free">x</span> <span class="free">s</span> <span class="free">t</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> subst <span class="free">x</span> <span class="free">s'</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nominal_induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">avoiding</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">s'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> term.strong_induct<span class="main">)</span>
   <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> App_Betas Abs_Betas<span class="main">)</span>

<span class="keyword1" id="Lambda_Z-subst_Betas"><span class="command">lemma</span></span> subst_Betas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">t'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subst <span class="free">x</span> <span class="free">s</span> <span class="free">t</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> subst <span class="free">x</span> <span class="free">s'</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subst_Beta <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Beta_in_subst <span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">t'</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Lambda_Z-Beta_fresh"><span class="command">lemma</span></span> Beta_fresh<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">name</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub></span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"atom <span class="free">x</span> <span class="main">♯</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"atom <span class="free">x</span> <span class="main">♯</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nominal_induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Beta_strong_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fresh_subst<span class="main">)</span>

<span class="keyword1" id="Lambda_Z-Abs_BetaD"><span class="command">lemma</span></span> Abs_BetaD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Abs <span class="free">x</span> <span class="free">s</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub></span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> Abs <span class="free">x</span> <span class="bound">u</span> <span class="main">∧</span> <span class="free">s</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub></span> <span class="bound">u</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">nominal_induct</span> <span class="quoted"><span class="quoted">"Abs <span class="free">x</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">avoiding</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Beta_strong_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Abs <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Abs1_eq_iff Beta_fresh fresh_permute_left <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="main">↔</span> <span class="free">x</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">v</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">metis</span> Abs1_eq_iff<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Beta_eqvt flip_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Lambda_Z-Abs_BetaE"><span class="command">lemma</span></span> Abs_BetaE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Abs <span class="free">x</span> <span class="free">s</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub></span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">u</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> Abs <span class="free">x</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub></span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Abs_BetaD<span class="main">)</span>

<span class="keyword1" id="Lambda_Z-Abs_BetasE"><span class="command">lemma</span></span> Abs_BetasE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Abs <span class="free">x</span> <span class="free">s</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">u</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> Abs <span class="free">x</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"Abs <span class="free">x</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Abs_BetaE <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>

<span class="keyword1" id="Lambda_Z-bullet_App"><span class="command">lemma</span></span> bullet_App<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>App <span class="free">s</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span><span class="main">,</span> <span class="main">(</span>App <span class="free">s</span> <span class="free">t</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">{→<span class="hidden">⇩</span><sub>β</sub>}</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> term.strong_exhaust<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fresh_star_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Beta.root<span class="main">)</span>

<span class="keyword1" id="Lambda_Z-rhs"><span class="command">lemma</span></span> rhs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subst <span class="free">x</span> <span class="free">s</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>subst <span class="free">x</span> <span class="free">s</span> <span class="free">t</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">nominal_induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">avoiding</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> term.strong_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>App <span class="skolem">t<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">t<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t<span class="hidden">⇩</span><sub>1</sub></span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> app_beta_exhaust<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">t<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Redex <span class="skolem">y</span> <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Abs <span class="skolem">y</span> <span class="main">(</span>subst <span class="skolem">x</span> <span class="skolem">s</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>subst <span class="skolem">x</span> <span class="skolem">s</span> <span class="skolem">t<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> App<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fresh_star_def fresh_atom_bullet<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Abs_BetasE <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subst <span class="skolem">x</span> <span class="skolem">s</span> <span class="skolem">t<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span> <span class="main">=</span> Abs <span class="skolem">y</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" subst <span class="skolem">x</span> <span class="skolem">s</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span> <span class="skolem">u</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> subst_subst <span class="keyword2"><span class="keyword">and</span></span> subst_Betas <span class="keyword2"><span class="keyword">and</span></span> App<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> Redex
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fresh_atom_bullet fresh_subst<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_Redex<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst <span class="skolem">x</span> <span class="skolem">s</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span> <span class="main">(</span><span class="main">(</span>App <span class="skolem">t<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">t<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> App <span class="main">(</span><span class="main">(</span>subst <span class="skolem">x</span> <span class="skolem">s</span> <span class="skolem">t<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>subst <span class="skolem">x</span> <span class="skolem">s</span> <span class="skolem">t<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> App <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> App_Betas<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> bullet_App <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> fresh_atom_bullet <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Abs_Betas<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Lambda_Z-Betas_fresh"><span class="command">lemma</span></span> Betas_fresh<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">name</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"atom <span class="free">x</span> <span class="main">♯</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"atom <span class="free">x</span> <span class="main">♯</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Beta_fresh<span class="main">)</span>

<span class="keyword1" id="Lambda_Z-Var_BetaD"><span class="command">lemma</span></span> Var_BetaD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Var <span class="free">x</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub></span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">False</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"Var <span class="free">x</span>"</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>

<span class="keyword1" id="Lambda_Z-Var_BetasD"><span class="command">lemma</span></span> Var_BetasD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Var <span class="free">x</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> Var <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Var_BetaD<span class="main">)</span>

<span class="keyword1" id="Lambda_Z-app_beta_Betas"><span class="command">lemma</span></span> app_beta_Betas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">t'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"app_beta <span class="free">s</span> <span class="free">t</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> app_beta <span class="free">s'</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> term.strong_exhaust <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>App <span class="skolem">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">s'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> app_beta_exhaust <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> root rtrancl_into_rtrancl App_Betas<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fresh_star_def Betas_fresh subst_Betas <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Abs_BetasE <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> App_Betas <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Var_BetasD<span class="main">)</span>

<span class="keyword1" id="Lambda_Z-lambda_Z"><span class="command">lemma</span></span> lambda_Z<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub></span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">s</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span> <span class="main">∧</span> <span class="free">s</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">t</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">nominal_induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Beta_strong_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Appl <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"App <span class="skolem">t</span> <span class="skolem">u</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> App <span class="skolem">s</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span> <span class="skolem">u</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> self <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> App_Betas<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"App <span class="skolem">s</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span> <span class="skolem">u</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>App <span class="skolem">s</span> <span class="skolem">u</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bullet_App <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Appl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> App_Betas app_beta_Betas<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Appr <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"App <span class="skolem">u</span> <span class="skolem">t</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> App <span class="skolem">u</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span> <span class="skolem">s</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> self <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> App_Betas<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"App <span class="skolem">u</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span> <span class="skolem">s</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>β</sub><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>App <span class="skolem">u</span> <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∙</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bullet_App <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Appr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> App_Betas app_beta_Betas<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Abs_Betas subst_Betas rhs <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> self fresh_atom_bullet<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> lambda_z<span class="main">:</span> z_property <span class="quoted">bullet</span> <span class="quoted">Beta</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main">)</span> <span class="main">(</span><span class="operator">fact</span> lambda_Z<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CL_Z">
<div class="head">
<h1>Theory CL_Z</h1>
</div>
<pre class="source"><span class="comment1">(*
 * Title:      Z  
 * Author:     Bertram Felgenhauer (2016)
 * Author:     Julian Nagele (2016)
 * Author:     Vincent van Oostrom (2016)
 * Author:     Christian Sternagel (2016)
 * Maintainer: Bertram Felgenhauer &lt;bertram.felgenhauer@uibk.ac.at&gt;
 * Maintainer: Juilan Nagele &lt;julian.nagele@uibk.ac.at&gt;
 * Maintainer: Christian Sternagel &lt;c.sternagel@gmail.com&gt;
 * License:    BSD
 *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Combinatory Logic has the Church-Rosser property›</span></span>

<span class="keyword1"><span class="command">theory</span></span> CL_Z <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Z">Z</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span> CL <span class="main">=</span> S <span class="main">|</span> K <span class="main">|</span> I <span class="main">|</span> App <span class="quoted">CL</span> <span class="quoted">CL</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">`</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ _"</span> <span class="main">[</span>999<span class="main">,</span> 999<span class="main">]</span> 999<span class="main">)</span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">red</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"CL rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">red</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">`</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">red</span>"</span></span>
<span class="main">|</span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">red</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">`</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">red</span>"</span></span>
<span class="main">|</span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">`</span> <span class="main">`</span> <span class="main">`</span> S <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">,</span> <span class="main">`</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">red</span>"</span></span>
<span class="main">|</span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">`</span> <span class="main">`</span> K <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">red</span>"</span></span>
<span class="main">|</span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">`</span> I <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">red</span>"</span></span>

<span class="keyword1" id="CL_Z-App_mono"><span class="command">lemma</span></span> App_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">t'</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">u'</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">`</span> <span class="free">t</span> <span class="free">u</span><span class="main">,</span> <span class="main">`</span> <span class="free">t'</span> <span class="free">u'</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">t'</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">`</span> <span class="free">t</span> <span class="free">u</span><span class="main">,</span> <span class="main">`</span> <span class="free">t'</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl red.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">u'</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">`</span> <span class="free">t'</span> <span class="free">u</span><span class="main">,</span> <span class="main">`</span> <span class="free">t'</span> <span class="free">u'</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">u'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl red.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">bullet_app</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"CL <span class="main">⇒</span> CL <span class="main">⇒</span> CL"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bullet_app</span> <span class="main">(</span><span class="main">`</span> <span class="main">`</span> S <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> <span class="main">`</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bullet_app</span> <span class="main">(</span><span class="main">`</span> K <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bullet_app</span> I <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bullet_app</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>

<span class="keyword1" id="CL_Z-bullet_app_red"><span class="command">lemma</span></span> bullet_app_red<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">`</span> <span class="free">t</span> <span class="free">u</span><span class="main">,</span> bullet_app <span class="free">t</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> bullet_app.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> red.intros<span class="main">)</span>

<span class="keyword1" id="CL_Z-bullet_app_redsI"><span class="command">lemma</span></span> bullet_app_redsI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="main">`</span> <span class="free">t</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> bullet_app <span class="free">t</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> bullet_app_red<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="CL_Z-bullet_app_redL"><span class="command">lemma</span></span> bullet_app_redL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">t'</span><span class="main">)</span> <span class="main">∈</span> red <span class="main">⟹</span> <span class="main">(</span>bullet_app <span class="free">t</span> <span class="free">u</span><span class="main">,</span> bullet_app <span class="free">t'</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> bullet_app.induct<span class="main">)</span>
   <span class="main">(</span><span class="operator">auto</span> 0 6 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> App_mono bullet_app_redsI <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> red.cases <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bullet_app.simps<span class="main">)</span>

<span class="keyword1" id="CL_Z-bullet_app_redR"><span class="command">lemma</span></span> bullet_app_redR<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">u'</span><span class="main">)</span> <span class="main">∈</span> red <span class="main">⟹</span> <span class="main">(</span>bullet_app <span class="free">t</span> <span class="free">u</span><span class="main">,</span> bullet_app <span class="free">t</span> <span class="free">u'</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> bullet_app.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> App_mono<span class="main">)</span>

<span class="keyword1" id="CL_Z-bullet_app_mono"><span class="command">lemma</span></span> bullet_app_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">t'</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">u'</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bullet_app <span class="free">t</span> <span class="free">u</span><span class="main">,</span> bullet_app <span class="free">t'</span> <span class="free">u'</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bullet_app <span class="free">t</span> <span class="free">u</span><span class="main">,</span> bullet_app <span class="free">t'</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_trans bullet_app_redL<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bullet_app <span class="free">t'</span> <span class="free">u</span><span class="main">,</span> bullet_app <span class="free">t'</span> <span class="free">u'</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">u'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_trans bullet_app_redR<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">bullet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"CL <span class="main">⇒</span> CL"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bullet</span> <span class="main">(</span><span class="main">`</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">=</span> bullet_app <span class="main">(</span><span class="free">bullet</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">bullet</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bullet</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1" id="CL_Z-bullet_incremental"><span class="command">lemma</span></span> bullet_incremental<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span> bullet <span class="free">t</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> bullet.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> App_mono bullet_app_redsI<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> CL<span class="main">:</span>z_property <span class="quoted">bullet</span> <span class="quoted">red</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> red"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> bullet <span class="skolem">t</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> bullet.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> 1 App_mono bullet_app_redsI bullet_incremental<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> red.cases<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> red"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bullet <span class="skolem">t</span><span class="main">,</span> bullet <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> red<span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> red.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> App_mono bullet_app_mono bullet_app_redsI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> CR_red <span class="main">=</span> CL.CR

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>