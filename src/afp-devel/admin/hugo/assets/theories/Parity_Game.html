<div id="MoreCoinductiveList">
<div class="head">
<h1>Theory MoreCoinductiveList</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary Lemmas for Coinductive Lists›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some lemmas to allow better reasoning with coinductive lists.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> MoreCoinductiveList
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <a href="../../coinductive/theories/#Coinductive_List">Coinductive.Coinductive_List</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"lset"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="MoreCoinductiveList-lset_lnth"><span class="command">lemma</span></span> lset_lnth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> lset <span class="free">xs</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> lnth <span class="free">xs</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> llist.set_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> lnth_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> lnth_Suc_LCons<span class="main">)</span>

<span class="keyword1" id="MoreCoinductiveList-lset_lnth_member"><span class="command">lemma</span></span> lset_lnth_member<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> lset <span class="free">xs</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">;</span> enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span> lnth <span class="free">xs</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> contra_subsetD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lset <span class="free">xs</span>"</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> in_lset_conv_lnth<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="MoreCoinductiveList-lset_nth_member_inf"><span class="command">lemma</span></span> lset_nth_member_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span>lfinite <span class="free">xs</span><span class="main">;</span> lset <span class="free">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> lnth <span class="free">xs</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> contra_subsetD inf_llist_lnth lset_inf_llist rangeI<span class="main">)</span>

<span class="keyword1" id="MoreCoinductiveList-lset_intersect_lnth"><span class="command">lemma</span></span> lset_intersect_lnth<span class="main">:</span> <span class="quoted"><span class="quoted">"lset <span class="free">xs</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> enat <span class="bound">n</span> <span class="main">&lt;</span> llength <span class="free">xs</span> <span class="main">∧</span> lnth <span class="free">xs</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjoint_iff_not_equal in_lset_conv_lnth<span class="main">)</span>

<span class="keyword1" id="MoreCoinductiveList-lset_ltake_Suc"><span class="command">lemma</span></span> lset_ltake_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"lnth <span class="free">xs</span> <span class="main">0</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="free">n</span><span class="main">)</span> <span class="main">(</span>ltl <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ltake <span class="main">(</span>eSuc <span class="main">(</span>enat <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>LCons <span class="free">x</span> <span class="main">(</span>ltl <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"LCons <span class="free">x</span> <span class="main">(</span>ltl <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lnth_0 ltl_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> not_lnull_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="MoreCoinductiveList-lfinite_lset"><span class="command">lemma</span></span> lfinite_lset<span class="main">:</span> <span class="quoted"><span class="quoted">"lfinite <span class="free">xs</span> <span class="main">⟹</span> <span class="main">¬</span>lnull <span class="free">xs</span> <span class="main">⟹</span> llast <span class="free">xs</span> <span class="main">∈</span> lset <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> lfinite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="main">(</span>ltl <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"llast <span class="main">(</span>ltl <span class="skolem">xs</span><span class="main">)</span> <span class="main">∈</span> lset <span class="main">(</span>ltl <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LCons.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"llast <span class="main">(</span>ltl <span class="skolem">xs</span><span class="main">)</span> <span class="main">∈</span> lset <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_lset_ltlD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> * LCons.prems lhd_LCons_ltl llast_LCons2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">metis</span> LCons.prems lhd_LCons_ltl llast_LCons llist.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="MoreCoinductiveList-lset_subset"><span class="command">lemma</span></span> lset_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>lset <span class="free">xs</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> enat <span class="bound">n</span> <span class="main">&lt;</span> llength <span class="free">xs</span> <span class="main">∧</span> lnth <span class="free">xs</span> <span class="bound">n</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_lset_conv_lnth subsetI<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"llength"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="MoreCoinductiveList-enat_Suc_ltl"><span class="command">lemma</span></span> enat_Suc_ltl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="main">(</span>ltl <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eSuc <span class="main">(</span>enat <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"enat <span class="free">n</span> <span class="main">&lt;</span> epred <span class="main">(</span>llength <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eSuc_le_iff ileI1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> epred_llength<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="MoreCoinductiveList-enat_ltl_Suc"><span class="command">lemma</span></span> enat_ltl_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="main">(</span>ltl <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eSuc_enat ldrop_ltl leD leI lnull_ldrop<span class="main">)</span>

<span class="keyword1" id="MoreCoinductiveList-infinite_small_llength"><span class="command">lemma</span></span> infinite_small_llength <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lfinite <span class="free">xs</span> <span class="main">⟹</span> enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> enat_iless lfinite_conv_llength_enat neq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="MoreCoinductiveList-lnull_0_llength"><span class="command">lemma</span></span> lnull_0_llength<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free">xs</span> <span class="main">⟹</span> enat <span class="main">0</span> <span class="main">&lt;</span> llength <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_enat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="MoreCoinductiveList-Suc_llength"><span class="command">lemma</span></span> Suc_llength<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">xs</span> <span class="main">⟹</span> enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dual_order.strict_trans enat_ord_simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ltake"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="MoreCoinductiveList-ltake_lnth"><span class="command">lemma</span></span> ltake_lnth<span class="main">:</span> <span class="quoted"><span class="quoted">"ltake <span class="free">n</span> <span class="free">xs</span> <span class="main">=</span> ltake <span class="free">n</span> <span class="free">ys</span> <span class="main">⟹</span> enat <span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> lnth <span class="free">xs</span> <span class="free">m</span> <span class="main">=</span> lnth <span class="free">ys</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lnth_ltake<span class="main">)</span>

<span class="keyword1" id="MoreCoinductiveList-lset_ltake_prefix"><span class="command">lemma</span></span> lset_ltake_prefix <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">⟹</span> lset <span class="main">(</span>ltake <span class="free">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> lset <span class="main">(</span>ltake <span class="free">m</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lprefix_lsetD<span class="main">)</span>

<span class="keyword1" id="MoreCoinductiveList-lset_ltake"><span class="command">lemma</span></span> lset_ltake<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> lnth <span class="free">xs</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="free">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ltake <span class="main">(</span>enat <span class="main">0</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">=</span> LNil"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_enat_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> LNil"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> LCons <span class="skolem">x</span> <span class="skolem">xs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> neq_LNil_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">m</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lnth <span class="skolem">xs</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lnth <span class="skolem">xs'</span> <span class="skolem">m</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ltake <span class="main">(</span>enat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">=</span> LCons <span class="skolem">x</span> <span class="main">(</span>ltake <span class="main">(</span>enat <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xs ltake_eSuc_LCons<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">xs'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> eSuc_enat<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems xs <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="MoreCoinductiveList-llength_ltake'"><span class="command">lemma</span></span> llength_ltake'<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="free">xs</span> <span class="main">⟹</span> llength <span class="main">(</span>ltake <span class="main">(</span>enat <span class="free">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> enat <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> llength_ltake min.strict_order_iff<span class="main">)</span>

<span class="keyword1" id="MoreCoinductiveList-llast_ltake"><span class="command">lemma</span></span> llast_ltake<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"llast <span class="main">(</span>ltake <span class="main">(</span>enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> lnth <span class="free">xs</span> <span class="free">n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"llast <span class="var">?A</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> llast_def <span class="keyword1"><span class="command">using</span></span> llength_ltake'<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lnth_ltake<span class="main">)</span>

<span class="keyword1" id="MoreCoinductiveList-lset_ltake_ltl"><span class="command">lemma</span></span> lset_ltake_ltl<span class="main">:</span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="free">n</span><span class="main">)</span> <span class="main">(</span>ltl <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> LCons <span class="skolem">v0</span> <span class="main">(</span>ltl <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lhd_LCons_ltl<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ltake <span class="main">(</span>eSuc <span class="main">(</span>enat <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> LCons <span class="skolem">v0</span> <span class="main">(</span>ltake <span class="main">(</span>enat <span class="free">n</span><span class="main">)</span> <span class="main">(</span>ltl <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltake_eSuc_LCons<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> lset <span class="main">(</span>LCons <span class="skolem">v0</span> <span class="main">(</span>ltake <span class="main">(</span>enat <span class="free">n</span><span class="main">)</span> <span class="main">(</span>ltl <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lset_LCons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v0</span></span> <span class="quoted"><span class="quoted">"ltake <span class="main">(</span>enat <span class="free">n</span><span class="main">)</span> <span class="main">(</span>ltl <span class="free">xs</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lnull_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ldropn"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="MoreCoinductiveList-ltl_ldrop"><span class="command">lemma</span></span> ltl_ldrop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">xs</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>ltl <span class="bound">xs</span><span class="main">)</span><span class="main">;</span> <span class="free">P</span> <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>ldropn <span class="free">n</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ldropn_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"lfinite"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="MoreCoinductiveList-lfinite_drop_set"><span class="command">lemma</span></span> lfinite_drop_set<span class="main">:</span> <span class="quoted"><span class="quoted">"lfinite <span class="free">xs</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> lset <span class="main">(</span>ldrop <span class="bound">n</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ldrop_inf lmember_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lset_lmember<span class="main">)</span>

<span class="keyword1" id="MoreCoinductiveList-index_infinite_set"><span class="command">lemma</span></span> index_infinite_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span>lfinite <span class="free">x</span><span class="main">;</span> lnth <span class="free">x</span> <span class="free">m</span> <span class="main">=</span> <span class="free">y</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> lnth <span class="free">x</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">m</span></span> <span class="main">&gt;</span> <span class="bound">i</span><span class="main">.</span> lnth <span class="free">x</span> <span class="bound">m</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> lset <span class="main">(</span>ldropn <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> lset_nth_member_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> LCons <span class="skolem">a</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lnull_imp_lfinite not_lnull_conv<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"lnth <span class="skolem">x</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lnth <span class="skolem">xs</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lnth_LCons' j<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> not_less0 x<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lnth <span class="skolem">xs</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lnth <span class="skolem">x</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="skolem">i</span><span class="main">.</span> lnth <span class="skolem">xs</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Suc_lessE lnth_Suc_LCons x<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps Suc.prems<span class="main">(</span>1<span class="main">)</span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"lmap"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="MoreCoinductiveList-lnth_lmap_ldropn"><span class="command">lemma</span></span> lnth_lmap_ldropn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="free">xs</span> <span class="main">⟹</span> lnth <span class="main">(</span>lmap <span class="free">f</span> <span class="main">(</span>ldropn <span class="free">n</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> lnth <span class="main">(</span>lmap <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lhd_ldropn lnth_0_conv_lhd<span class="main">)</span>

<span class="keyword1" id="MoreCoinductiveList-lnth_lmap_ldropn_Suc"><span class="command">lemma</span></span> lnth_lmap_ldropn_Suc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">xs</span> <span class="main">⟹</span> lnth <span class="main">(</span>lmap <span class="free">f</span> <span class="main">(</span>ldropn <span class="free">n</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> lnth <span class="main">(</span>lmap <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_llength ldropn_ltl leD llist.map_disc_iff lnth_lmap_ldropn
                                lnth_ltl lnull_ldropn ltl_ldropn ltl_lmap<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Notation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We introduce the notation \$ to denote <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"lnth"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">notation</span></span> lnth <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">$</span>"</span> 61<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ParityGame">
<div class="head">
<h1>Theory ParityGame</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Parity Games›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ParityGame
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <a href="#MoreCoinductiveList">MoreCoinductiveList</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the node type.  Edges are pairs of nodes.›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> Edge <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A path is a possibly infinite list of nodes.›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> Path <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Graphs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define graphs as a locale over a record.
  The record contains nodes (AKA vertices) and edges.
  The locale adds the assumption that the edges are pairs of nodes.
›</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'a</span> Graph <span class="main">=</span>
  verts <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">V</span>ı"</span><span class="main">)</span>
  arcs <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Edge set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">E</span>ı"</span><span class="main">)</span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">is_arc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Graph_scheme <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">→</span>ı"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main"><span class="free">→</span></span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">G</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">E</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">G</span></span></span></sub><span class="hidden">⇙</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> Digraph <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="main">(</span><span class="keyword2"><span class="keyword">structure</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid_edge_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">E</span> <span class="main">⊆</span> <span class="keyword1">V</span> <span class="main">×</span> <span class="keyword1">V</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="ParityGame-edges_are_in_V"><span class="command">lemma</span></span> edges_are_in_V <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">→</span><span class="free">w</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">→</span><span class="free">w</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_edge_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A node without successors is a \emph{deadend}.›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">deadend</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">deadend</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">→</span> <span class="bound">w</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Valid Paths›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We say that a path is \emph{valid} if it is empty or if it starts in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="keyword1"><span class="quoted"><span class="keyword1">V</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and walks along edges.
›</span></span>
<span class="keyword1"><span class="command">coinductive</span></span> <span class="entity">valid_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Path <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  valid_path_base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">valid_path</span> LNil"</span></span>
<span class="main">|</span> valid_path_base'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">⟹</span> <span class="free">valid_path</span> <span class="main">(</span>LCons <span class="free"><span class="bound"><span class="entity">v</span></span></span> LNil<span class="main">)</span>"</span></span>
<span class="main">|</span> valid_path_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="keyword1">V</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∈</span> <span class="keyword1">V</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">→</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">;</span> <span class="free">valid_path</span> <span class="free"><span class="bound"><span class="entity">Ps</span></span></span><span class="main">;</span> <span class="main">¬</span>lnull <span class="free"><span class="bound"><span class="entity">Ps</span></span></span><span class="main">;</span> lhd <span class="free"><span class="bound"><span class="entity">Ps</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">⟧</span>
    <span class="main">⟹</span> <span class="free">valid_path</span> <span class="main">(</span>LCons <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">Ps</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_simps</span></span> valid_path_cons_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>LCons <span class="free">x</span> <span class="free">xs</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ParityGame-valid_path_ltl'"><span class="command">lemma</span></span> valid_path_ltl'<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>LCons <span class="free">v</span> <span class="free">Ps</span><span class="main">)</span> <span class="main">⟹</span> valid_path <span class="free">Ps</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_path.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="ParityGame-valid_path_ltl"><span class="command">lemma</span></span> valid_path_ltl<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span> <span class="main">⟹</span> valid_path <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> llist.exhaust_sel ltl_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid_path_ltl'<span class="main">)</span>
<span class="keyword1" id="ParityGame-valid_path_drop"><span class="command">lemma</span></span> valid_path_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span> <span class="main">⟹</span> valid_path <span class="main">(</span>ldropn <span class="free">n</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_ltl ltl_ldrop<span class="main">)</span>

<span class="keyword1" id="ParityGame-valid_path_in_V"><span class="command">lemma</span></span> valid_path_in_V<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> lset <span class="free">P</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> llist.set_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> valid_path.cases<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1" id="ParityGame-valid_path_finite_in_V"><span class="command">lemma</span></span> valid_path_finite_in_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_path <span class="free">P</span><span class="main">;</span> enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">$</span> <span class="free">n</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_path_in_V lset_lnth_member <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="ParityGame-valid_path_edges'"><span class="command">lemma</span></span> valid_path_edges'<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>LCons <span class="free">v</span> <span class="main">(</span>LCons <span class="free">w</span> <span class="free">Ps</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">v</span><span class="main">→</span><span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_path.cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1" id="ParityGame-valid_path_edges"><span class="command">lemma</span></span> valid_path_edges<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="free">n</span> <span class="main">→</span> <span class="free">P</span> <span class="main">$</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> ldropn <span class="free">n</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> enat_ord_simps<span class="main">(</span>2<span class="main">)</span> less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="free">P</span> <span class="main">$</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">$</span> Suc <span class="main">0</span> <span class="main">=</span> <span class="free">P</span> <span class="main">$</span> Suc <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def P'_def Suc_eq_plus1 add.commute assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lnth_ldropn<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Ps</span><span class="main">.</span> <span class="skolem">P'</span> <span class="main">=</span> LCons <span class="main">(</span><span class="free">P</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>LCons <span class="main">(</span><span class="free">P</span> <span class="main">$</span> Suc <span class="free">n</span><span class="main">)</span> <span class="bound">Ps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P'_def <span class="quoted"><span class="quoted">‹enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="free">P</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ldropn_Suc_conv_ldropn<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P'_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid_path_drop<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_path_edges' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ParityGame-valid_path_coinduct"><span class="command">lemma</span></span> valid_path_coinduct <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> base step<span class="main">,</span> <span class="operator">coinduct</span> <span class="quasi_keyword"><span class="quasi_keyword">pred</span></span><span class="main"><span class="main"><span class="main">:</span></span></span> valid_path<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> major<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">P</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span>LCons <span class="bound">v</span> LNil<span class="main">)</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">w</span> <span class="bound">P</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span>LCons <span class="bound">v</span> <span class="main">(</span>LCons <span class="bound">w</span> <span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">(</span>LCons <span class="bound">w</span> <span class="bound">P</span><span class="main">)</span> <span class="main">∨</span> valid_path <span class="main">(</span>LCons <span class="bound">w</span> <span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> major <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> valid_path
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≠</span> LNil"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">=</span> LCons <span class="bound">v</span> LNil <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> LCons <span class="skolem">v</span> <span class="main">(</span>LCons <span class="skolem">w</span> <span class="skolem">P'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neq_LNil_conv base valid_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step valid_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ParityGame-valid_path_no_deadends"><span class="command">lemma</span></span> valid_path_no_deadends<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_path <span class="free">P</span><span class="main">;</span> enat <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span>deadend <span class="main">(</span><span class="free">P</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_path_edges <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="ParityGame-valid_path_ends_on_deadend"><span class="command">lemma</span></span> valid_path_ends_on_deadend<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_path <span class="free">P</span><span class="main">;</span> enat <span class="free">i</span> <span class="main">&lt;</span> llength <span class="free">P</span><span class="main">;</span> deadend <span class="main">(</span><span class="free">P</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> enat <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> llength <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_path_no_deadends <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> enat_iless enat_ord_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> neq_iff not_less_eq<span class="main">)</span>

<span class="keyword1" id="ParityGame-valid_path_prefix"><span class="command">lemma</span></span> valid_path_prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_path <span class="free">P</span><span class="main">;</span> lprefix <span class="free">P'</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> valid_path <span class="free">P'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P'</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">P''</span> <span class="skolem">P'</span> <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ps<span class="main">:</span> <span class="quoted"><span class="quoted">"LCons <span class="skolem">v</span> <span class="main">(</span>LCons <span class="skolem">w</span> <span class="skolem">Ps</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LCons_lprefix_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>LCons <span class="skolem">w</span> <span class="skolem">Ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_path_ltl' step<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lprefix <span class="main">(</span>LCons <span class="skolem">w</span> <span class="skolem">P''</span><span class="main">)</span> <span class="main">(</span>LCons <span class="skolem">w</span> <span class="skolem">Ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ps step<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Ps step<span class="main">(</span>2<span class="main">)</span> valid_path_edges' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">metis</span> LCons_lprefix_conv valid_path_cons_simp<span class="main">)</span>

<span class="keyword1" id="ParityGame-valid_path_lappend"><span class="command">lemma</span></span> valid_path_lappend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span>lnull <span class="free">P</span><span class="main">;</span> <span class="main">¬</span>lnull <span class="free">P'</span> <span class="main">⟧</span> <span class="main">⟹</span> llast <span class="free">P</span><span class="main">→</span>lhd <span class="free">P'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>lappend <span class="free">P</span> <span class="free">P'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free">P'</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P'</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">P''</span> <span class="skolem">P'</span> <span class="skolem">P</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lnull <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>5<span class="main">,</span>6<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lhd_LCons lhd_LCons_ltl lhd_lappend llast_singleton
                  llist.collapse<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ltl_lappend ltl_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ltl <span class="main">(</span>lappend <span class="skolem">P</span> <span class="skolem">P'</span><span class="main">)</span> <span class="main">=</span> lappend <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span> <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>
            lhd_LCons lhd_LCons_ltl lhd_lappend llast_LCons ltl_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
            valid_path_edges' valid_path_ltl<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">metis</span> llist.disc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lnull_lappend ltl_lappend ltl_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> lappend_lnull1 lappend_lnull2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A valid path is still valid in a supergame.›</span></span>
<span class="keyword1" id="ParityGame-valid_path_supergame"><span class="command">lemma</span></span> valid_path_supergame<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> G'<span class="main">:</span> <span class="quoted"><span class="quoted">"Digraph <span class="free">G'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">V</span> <span class="main">⊆</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="free">G'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">E</span> <span class="main">⊆</span> <span class="keyword1">E</span><span class="hidden">⇘</span><sub><span class="free">G'</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Digraph.valid_path <span class="free">G'</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span>
  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Digraph.valid_path_coinduct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> G'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">case_names</span> base step<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> G'<span class="main">(</span>2<span class="main">)</span> valid_path_cons_simp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">meson</span> G'<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subset_eq valid_path_edges' valid_path_ltl'<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Maximal Paths›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We say that a path is \emph{maximal} if it is empty or if it ends in a deadend.
›</span></span>
<span class="keyword1"><span class="command">coinductive</span></span> <span class="entity">maximal_path</span> <span class="keyword2"><span class="keyword">where</span></span>
  maximal_path_base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">maximal_path</span> LNil"</span></span>
<span class="main">|</span> maximal_path_base'<span class="main">:</span> <span class="quoted"><span class="quoted">"deadend <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟹</span> <span class="free">maximal_path</span> <span class="main">(</span>LCons <span class="free"><span class="bound"><span class="entity">v</span></span></span> LNil<span class="main">)</span>"</span></span>
<span class="main">|</span> maximal_path_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free"><span class="bound"><span class="entity">Ps</span></span></span> <span class="main">⟹</span> <span class="free">maximal_path</span> <span class="free"><span class="bound"><span class="entity">Ps</span></span></span> <span class="main">⟹</span> <span class="free">maximal_path</span> <span class="main">(</span>LCons <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">Ps</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ParityGame-maximal_no_deadend"><span class="command">lemma</span></span> maximal_no_deadend<span class="main">:</span> <span class="quoted"><span class="quoted">"maximal_path <span class="main">(</span>LCons <span class="free">v</span> <span class="free">Ps</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span>deadend <span class="free">v</span> <span class="main">⟹</span> <span class="main">¬</span>lnull <span class="free">Ps</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lhd_LCons llist.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ltl_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> maximal_path.simps<span class="main">)</span>
<span class="keyword1" id="ParityGame-maximal_ltl"><span class="command">lemma</span></span> maximal_ltl<span class="main">:</span> <span class="quoted"><span class="quoted">"maximal_path <span class="free">P</span> <span class="main">⟹</span> maximal_path <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltl_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ltl_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> maximal_path.simps<span class="main">)</span>
<span class="keyword1" id="ParityGame-maximal_drop"><span class="command">lemma</span></span> maximal_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"maximal_path <span class="free">P</span> <span class="main">⟹</span> maximal_path <span class="main">(</span>ldropn <span class="free">n</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maximal_ltl ltl_ldrop<span class="main">)</span>

<span class="keyword1" id="ParityGame-maximal_path_lappend"><span class="command">lemma</span></span> maximal_path_lappend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free">P'</span>"</span></span> <span class="quoted"><span class="quoted">"maximal_path <span class="free">P'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"maximal_path <span class="main">(</span>lappend <span class="free">P</span> <span class="free">P'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free">P</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P'</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> maximal_path.coinduct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>maximal_path <span class="skolem">P'</span> <span class="skolem">P</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lappend <span class="skolem">P</span> <span class="skolem">P'</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">=</span> LNil <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="var">?P</span> <span class="main">=</span> LCons <span class="bound">v</span> LNil <span class="main">∧</span> deadend <span class="bound">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ps</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">=</span> LCons <span class="skolem">v</span> <span class="skolem">Ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> neq_LNil_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ps</span> <span class="main">=</span> lappend <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span> <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lappend_ltl maximal_path<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Ps1</span> <span class="bound">P'</span><span class="main">.</span> <span class="skolem">Ps</span> <span class="main">=</span> lappend <span class="bound">Ps1</span> <span class="bound">P'</span> <span class="main">∧</span> <span class="main">¬</span>lnull <span class="bound">P'</span> <span class="main">∧</span> maximal_path <span class="bound">P'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> maximal_path<span class="main">(</span>2<span class="main">)</span> maximal_path<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> P lappend_lnull1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lappend_lnull1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">P'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="ParityGame-maximal_ends_on_deadend"><span class="command">lemma</span></span> maximal_ends_on_deadend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"maximal_path <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"lfinite <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"deadend <span class="main">(</span>llast <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lfinite <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lnull <span class="free">P</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"llength <span class="free">P</span> <span class="main">=</span> enat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> enat_ord_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> gr0_implies_Suc lfinite_llength_enat lnull_0_llength<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> ldropn <span class="skolem">n</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"maximal_path <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> maximal_drop <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> maximal_path.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>maximal_path_base' <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"deadend <span class="main">(</span>llast <span class="skolem">P'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">using</span></span> llast_ldropn<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> n
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P'_def ldropn_eq_LConsD local.maximal_path_base'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>maximal_path_cons <span class="skolem">P''</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ldropn <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">P</span> <span class="main">=</span> <span class="skolem">P''</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ldrop_eSuc_ltl ltl_ldropn ltl_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n maximal_path_cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P'_def n ldropn_eq_LNil<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ParityGame-maximal_ends_on_deadend'"><span class="command">lemma</span></span> maximal_ends_on_deadend'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> lfinite <span class="free">P</span><span class="main">;</span> deadend <span class="main">(</span>llast <span class="free">P</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> maximal_path <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> maximal_path.coinduct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>maximal_path <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≠</span> LNil"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> LCons <span class="skolem">v</span> <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> neq_LNil_conv<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> LNil"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> P' maximal_path<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">metis</span> P' lfinite_LCons llast_LCons llist.collapse<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> maximal_path<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ParityGame-infinite_path_is_maximal"><span class="command">lemma</span></span> infinite_path_is_maximal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_path <span class="free">P</span><span class="main">;</span> <span class="main">¬</span>lfinite <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> maximal_path <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> maximal_path.coinduct<span class="main">)</span>
     <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> valid_path.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹locale Digraph›</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Parity Games›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Parity games are games played by two players, called \Even and \Odd.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> Player <span class="main">=</span> Even <span class="main">|</span> Odd

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">other_player</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Even <span class="keyword1">then</span> Odd <span class="keyword1">else</span> Even<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> other_player <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">**</span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 1000<span class="main">)</span>
<span class="keyword1" id="ParityGame-other_other_player"><span class="command">lemma</span></span> other_other_player <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">**</span><span class="main">**</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Player.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A parity game is tuple $(V,E,V_0,\omega)$, where $(V,E)$ is a graph, $V_0 \subseteq V$
  and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ω</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a function from $V \to \mathbb{N}$ with finite image.
›</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'a</span> ParityGame <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Graph"</span></span> <span class="main">+</span>
  player0 <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">V0</span>ı"</span><span class="main">)</span>
  priority <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">ω</span>ı"</span><span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> ParityGame <span class="main">=</span> Digraph <span class="quoted"><span class="free">G</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> ParityGame_scheme"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">structure</span></span><span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid_player0_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">V0</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> priorities_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="keyword1">ω</span> <span class="main">`</span> <span class="keyword1">V</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>VV p›</span></span></span></span> is the set of nodes belonging to player <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">VV</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Player <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">VV</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Even <span class="keyword1">then</span> <span class="keyword1">V0</span> <span class="keyword1">else</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="keyword1">V0</span><span class="main">)</span>"</span></span>
<span class="keyword1" id="ParityGame-VVp_to_V"><span class="command">lemma</span></span> VVp_to_V <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_player0_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1" id="ParityGame-VV_impl1"><span class="command">lemma</span></span> VV_impl1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∉</span> VV <span class="free">p</span><span class="main">**</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="ParityGame-VV_impl2"><span class="command">lemma</span></span> VV_impl2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">**</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∉</span> VV <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="ParityGame-VV_equivalence"><span class="command">lemma</span></span> VV_equivalence <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∉</span> VV <span class="free">p</span> <span class="main">⟷</span> <span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">**</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="ParityGame-VV_cases"><span class="command">lemma</span></span> VV_cases <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">**</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sets of Deadends›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">deadends</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> VV <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">.</span> deadend <span class="bound">v</span><span class="main">}</span>"</span></span>
<span class="keyword1" id="ParityGame-deadends_in_V"><span class="command">lemma</span></span> deadends_in_V<span class="main">:</span> <span class="quoted"><span class="quoted">"deadends <span class="free">p</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> deadends_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Subgames›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define a subgame by restricting the set of nodes to a given subset.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subgame</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subgame</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">≡</span> <span class="free">G</span><span class="main">⦇</span>
    verts   <span class="main">:=</span> <span class="keyword1">V</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main">,</span>
    arcs    <span class="main">:=</span> <span class="keyword1">E</span> <span class="main">∩</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">×</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main">)</span><span class="main">,</span>
    player0 <span class="main">:=</span> <span class="keyword1">V0</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">⦈</span>"</span></span>

<span class="keyword1" id="ParityGame-subgame_V"><span class="command">lemma</span></span> subgame_V <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> subgame_E <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">E</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span> <span class="main">⊆</span> <span class="keyword1">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> subgame_ω<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ω</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="keyword1">ω</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subgame_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> subgame_V' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">V'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> subgame_E' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">E</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="keyword1">E</span> <span class="main">∩</span> <span class="main">(</span><span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span> <span class="main">×</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subgame_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ParityGame-subgame_VV"><span class="command">lemma</span></span> subgame_VV <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ParityGame.VV <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="free">V'</span> <span class="main">∩</span> VV <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ParityGame.VV <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span> Even <span class="main">=</span> <span class="free">V'</span> <span class="main">∩</span> VV Even"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgame_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ParityGame.VV <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span> Odd <span class="main">=</span> <span class="free">V'</span> <span class="main">∩</span> VV Odd"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V'</span> <span class="main">∩</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">V0</span> <span class="main">∩</span> <span class="free">V'</span><span class="main">)</span> <span class="main">=</span> <span class="free">V'</span> <span class="main">∩</span> <span class="keyword1">V</span> <span class="main">∩</span> <span class="main">(</span><span class="keyword1">V</span> <span class="main">-</span> <span class="keyword1">V0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgame_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">corollary</span></span> subgame_VV_subset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ParityGame.VV <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span> <span class="free">p</span> <span class="main">⊆</span> VV <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ParityGame-subgame_finite"><span class="command">lemma</span></span> subgame_finite <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="keyword1">ω</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span> <span class="main">`</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="keyword1">ω</span> <span class="main">`</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgame_V priorities_finite
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_subset image_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subgame_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ParityGame-subgame_ω_subset"><span class="command">lemma</span></span> subgame_ω_subset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ω</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span> <span class="main">`</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span> <span class="main">⊆</span> <span class="keyword1">ω</span> <span class="main">`</span> <span class="keyword1">V</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_mono subgame_ω<span class="main">)</span>

<span class="keyword1" id="ParityGame-subgame_Digraph"><span class="command">lemma</span></span> subgame_Digraph<span class="main">:</span> <span class="quoted"><span class="quoted">"Digraph <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subgame_def<span class="main">)</span>

<span class="keyword1" id="ParityGame-subgame_ParityGame"><span class="command">lemma</span></span> subgame_ParityGame<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ParityGame <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">E</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span> <span class="main">⊆</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span> <span class="main">×</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subgame_Digraph<span class="main">[</span><span class="operator">unfolded</span> Digraph_def<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">V0</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span> <span class="main">⊆</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgame_def <span class="keyword1"><span class="command">using</span></span> valid_player0_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="keyword1">ω</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span> <span class="main">`</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ParityGame-subgame_valid_path"><span class="command">lemma</span></span> subgame_valid_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="free">V'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Digraph.valid_path <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P<span class="main">(</span>1<span class="main">)</span> valid_path_in_V <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgame_def <span class="keyword1"><span class="command">using</span></span> P<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> P<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span>
    <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Digraph.valid_path.coinduct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> subgame_Digraph<span class="main"><span class="main">,</span></span> <span class="operator">case_names</span> IH<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> IH
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> valid_path.cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>valid_path_cons <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">Ps</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> local.valid_path_cons<span class="main">(</span>4<span class="main">)</span> subgame_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">Ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>1<span class="main">)</span> valid_path_ltl' local.valid_path_cons<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ParityGame-subgame_maximal_path"><span class="command">lemma</span></span> subgame_maximal_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> V'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"maximal_path <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="free">V'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Digraph.maximal_path <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgame_def <span class="keyword1"><span class="command">using</span></span> P<span class="main">(</span>2<span class="main">)</span> V' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> P<span class="main">(</span>1<span class="main">)</span> V' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Digraph.maximal_path.coinduct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> subgame_Digraph<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> maximal_path.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Priorities Occurring Infinitely Often›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The set of priorities that occur infinitely often on a given path.  We need this to define the
  winning condition of parity games.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">path_inf_priorities</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Path <span class="main">⇒</span> nat set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">path_inf_priorities</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> lset <span class="main">(</span>ldropn <span class="bound">n</span> <span class="main">(</span>lmap <span class="keyword1">ω</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Because <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="keyword1"><span class="quoted"><span class="keyword1">ω</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is image-finite, by the pigeon-hole principle every infinite path has at least
  one priority that occurs infinitely often.
›</span></span>
<span class="keyword1" id="ParityGame-path_inf_priorities_is_nonempty"><span class="command">lemma</span></span> path_inf_priorities_is_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lfinite <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> path_inf_priorities <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Define a map from indices to priorities on the path.›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="keyword1">ω</span> <span class="main">(</span><span class="free">P</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">f</span> <span class="main">⊆</span> <span class="keyword1">ω</span> <span class="main">`</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def
    <span class="keyword1"><span class="command">using</span></span> valid_path_in_V<span class="main">[</span><span class="operator">OF</span> P<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> lset_nth_member_inf<span class="main">[</span><span class="operator">OF</span> P<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>range <span class="skolem">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> priorities_finite finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n0</span></span> <span class="keyword2"><span class="keyword">where</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">n0</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pigeonhole_infinite<span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">n0</span>"</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The priority <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> occurs infinitely often.›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lmap <span class="keyword1">ω</span> <span class="free">P</span> <span class="main">$</span> <span class="skolem">n0</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def k_def
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_small_llength<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lmap <span class="keyword1">ω</span> <span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span> <span class="main">&gt;</span> <span class="skolem">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n'</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">using</span></span> n0 infinite_nat_iff_unbounded <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span> <span class="main">&gt;</span> <span class="skolem">n</span><span class="main">.</span> lmap <span class="keyword1">ω</span> <span class="free">P</span> <span class="main">$</span> <span class="bound">n'</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_small_llength<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">k</span> <span class="main">∈</span> lset <span class="main">(</span>ldropn <span class="bound">n</span> <span class="main">(</span>lmap <span class="keyword1">ω</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> index_infinite_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lmap <span class="keyword1">ω</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="skolem">n0</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> P<span class="main">(</span>2<span class="main">)</span> lfinite_lmap
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_inf_priorities_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ParityGame-path_inf_priorities_at_least_min_prio"><span class="command">lemma</span></span> path_inf_priorities_at_least_min_prio<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> path_inf_priorities <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span><span class="keyword1">ω</span> <span class="main">`</span> <span class="keyword1">V</span><span class="main">)</span> <span class="main">≤</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> lset <span class="main">(</span>ldropn <span class="main">0</span> <span class="main">(</span>lmap <span class="keyword1">ω</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">unfolding</span></span> path_inf_priorities_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="keyword1">ω</span> <span class="main">`</span> lset <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> P valid_path_in_V priorities_finite Min_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ParityGame-path_inf_priorities_LCons"><span class="command">lemma</span></span> path_inf_priorities_LCons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"path_inf_priorities <span class="free">P</span> <span class="main">=</span> path_inf_priorities <span class="main">(</span>LCons <span class="free">v</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">∈</span> lset <span class="main">(</span>ldropn <span class="bound">n</span> <span class="main">(</span>lmap <span class="keyword1">ω</span> <span class="main">(</span>LCons <span class="free">v</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> path_inf_priorities_def
      <span class="keyword1"><span class="command">using</span></span> in_lset_ltlD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_ldropn<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_inf_priorities_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">∈</span> lset <span class="main">(</span>ldropn <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>lmap <span class="keyword1">ω</span> <span class="main">(</span>LCons <span class="free">v</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> path_inf_priorities_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_inf_priorities_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">corollary</span></span> path_inf_priorities_ltl<span class="main">:</span> <span class="quoted"><span class="quoted">"path_inf_priorities <span class="free">P</span> <span class="main">=</span> path_inf_priorities <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> llist.exhaust ltl_simps path_inf_priorities_LCons<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Winning Condition›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Let $G = (V,E,V_0,\omega)$ be a parity game.
  An infinite path $v_0,v_1,\ldots$ in $G$ is winning for player \Even (\Odd) if the minimum
  priority occurring infinitely often is even (odd).
  A finite path is winning for player <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> iff the last node on the path belongs to the other
  player.

  Empty paths are irrelevant, but it is useful to assign a fixed winner to them in order to get
  simpler lemmas.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">winning_priority</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Even <span class="keyword1">then</span> even <span class="keyword1">else</span> odd<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">winning_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Player <span class="main">⇒</span> <span class="tfree">'a</span> Path <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">winning_path</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="main">¬</span>lfinite <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> path_inf_priorities <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">.</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> path_inf_priorities <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∧</span> winning_priority <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span>lnull <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> lfinite <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> llast <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∈</span> VV <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">**</span><span class="main">)</span>
    <span class="main">∨</span> <span class="main">(</span>lnull <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Even<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Every path has a unique winner.›</span></span>
<span class="keyword1" id="ParityGame-paths_are_winning_for_one_player"><span class="command">lemma</span></span> paths_are_winning_for_one_player<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="free">P</span> <span class="main">⟷</span> <span class="main">¬</span>winning_path <span class="free">p</span><span class="main">**</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free">P</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lfinite <span class="free">P</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms lfinite_lset valid_path_in_V
      <span class="keyword1"><span class="command">unfolding</span></span> winning_path_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lfinite <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> path_inf_priorities <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∉</span> path_inf_priorities <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms ex_least_nat_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> path_inf_priorities <span class="free">P</span>"</span></span><span class="main">]</span> path_inf_priorities_is_nonempty
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">.</span> winning_priority <span class="bound">q</span> <span class="skolem">a</span> <span class="main">⟷</span> winning_path <span class="bound">q</span> <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> winning_path_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lnull <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_antisym not_le<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">.</span> winning_priority <span class="free">p</span> <span class="bound">q</span> <span class="main">⟷</span> <span class="main">¬</span>winning_priority <span class="free">p</span><span class="main">**</span> <span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> winning_path_def<span class="main">)</span>

<span class="keyword1" id="ParityGame-winning_path_ltl"><span class="command">lemma</span></span> winning_path_ltl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lfinite <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"llast <span class="free">P</span> <span class="main">=</span> llast <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> P<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> llast_LCons2 ltl_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> not_lnull_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> winning_path_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lfinite <span class="free">P</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> winning_path_def path_inf_priorities_ltl P<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> winning_path_drop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="main">(</span>ldropn <span class="free">n</span> <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="main">(</span>ldropn <span class="skolem">n</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dual_order.strict_trans enat_ord_simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ltl <span class="main">(</span>ldropn <span class="skolem">n</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> ldropn <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ldrop_eSuc_ltl ltl_ldropn<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="main">(</span>ldropn <span class="skolem">n</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> leD lnull_ldropn lnull_ltlI<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> winning_path_ltl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"ldropn <span class="skolem">n</span> <span class="free">P</span>"</span></span><span class="main">]</span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">corollary</span></span> winning_path_drop_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="main">(</span>ldropn <span class="free">n</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms paths_are_winning_for_one_player valid_path_drop winning_path_drop <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="ParityGame-winning_path_LCons"><span class="command">lemma</span></span> winning_path_LCons<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="main">(</span>LCons <span class="free">v</span> <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lfinite <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"llast <span class="free">P</span> <span class="main">=</span> llast <span class="main">(</span>LCons <span class="free">v</span> <span class="free">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> P<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> llast_LCons2 not_lnull_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">unfolding</span></span> winning_path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lfinite <span class="free">P</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> P path_inf_priorities_LCons <span class="keyword1"><span class="command">unfolding</span></span> winning_path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ParityGame-winning_path_supergame"><span class="command">lemma</span></span> winning_path_supergame<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> G'<span class="main">:</span> <span class="quoted"><span class="quoted">"ParityGame <span class="free">G'</span>"</span></span> <span class="quoted"><span class="quoted">"VV <span class="free">p</span><span class="main">**</span> <span class="main">⊆</span> ParityGame.VV <span class="free">G'</span> <span class="free">p</span><span class="main">**</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ω</span> <span class="main">=</span> <span class="keyword1">ω</span><span class="hidden">⇘</span><sub><span class="free">G'</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ParityGame.winning_path <span class="free">G'</span> <span class="free">p</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> G'<span class="main">:</span> ParityGame <span class="quoted"><span class="free">G'</span></span> <span class="keyword1"><span class="command">using</span></span> G'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> lfinite <span class="free">P</span><span class="main">;</span> <span class="main">¬</span>lnull <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> llast <span class="free">P</span> <span class="main">∈</span> G'.VV <span class="free">p</span><span class="main">**</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lnull <span class="free">P</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">=</span> Even"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> winning_path_def <span class="keyword1"><span class="command">using</span></span> G'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'.winning_path_def
    <span class="keyword1"><span class="command">using</span></span> lnull_imp_lfinite assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> winning_path_def path_inf_priorities_def G'.path_inf_priorities_def G'<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹locale ParityGame›</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Valid Maximal Paths›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Define a locale for valid maximal paths, because we need them often.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> vm_path <span class="main">=</span> ParityGame <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="free">v0</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P_not_null <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P_valid    <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P_maximal  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"maximal_path <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P_v0       <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lhd <span class="free">P</span> <span class="main">=</span> <span class="free">v0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="ParityGame-P_LCons"><span class="command">lemma</span></span> P_LCons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> LCons <span class="free">v0</span> <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lhd_LCons_ltl<span class="main">[</span><span class="operator">OF</span> P_not_null<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ParityGame-P_len"><span class="command">lemma</span></span> P_len <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">0</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lnull_0_llength<span class="main">)</span>
<span class="keyword1" id="ParityGame-P_0"><span class="command">lemma</span></span> P_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="free">v0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lnth_0_conv_lhd<span class="main">)</span>
<span class="keyword1" id="ParityGame-P_lnth_Suc"><span class="command">lemma</span></span> P_lnth_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> Suc <span class="free">n</span> <span class="main">=</span> ltl <span class="free">P</span> <span class="main">$</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lnth_ltl<span class="main">)</span>
<span class="keyword1" id="ParityGame-P_no_deadends"><span class="command">lemma</span></span> P_no_deadends<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">P</span> <span class="main">⟹</span> <span class="main">¬</span>deadend <span class="main">(</span><span class="free">P</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_path_no_deadends <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1" id="ParityGame-P_no_deadend_v0"><span class="command">lemma</span></span> P_no_deadend_v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span>deadend <span class="free">v0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P_LCons P_valid edges_are_in_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> not_lnull_conv valid_path_edges'<span class="main">)</span>
<span class="keyword1" id="ParityGame-P_no_deadend_v0_llength"><span class="command">lemma</span></span> P_no_deadend_v0_llength<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">P</span> <span class="main">⟹</span> <span class="main">¬</span>deadend <span class="free">v0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P_0 P_len P_valid enat_ord_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> not_less_eq valid_path_ends_on_deadend zero_less_Suc<span class="main">)</span>
<span class="keyword1" id="ParityGame-P_ends_on_deadend"><span class="command">lemma</span></span> P_ends_on_deadend<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="free">P</span><span class="main">;</span> deadend <span class="main">(</span><span class="free">P</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> llength <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P_valid valid_path_ends_on_deadend <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="ParityGame-P_lnull_ltl_deadend_v0"><span class="command">lemma</span></span> P_lnull_ltl_deadend_v0<span class="main">:</span> <span class="quoted"><span class="quoted">"lnull <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> deadend <span class="free">v0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P_LCons maximal_no_deadend <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1" id="ParityGame-P_lnull_ltl_LCons"><span class="command">lemma</span></span> P_lnull_ltl_LCons<span class="main">:</span> <span class="quoted"><span class="quoted">"lnull <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">=</span> LCons <span class="free">v0</span> LNil"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P_LCons lnull_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1" id="ParityGame-P_deadend_v0_LCons"><span class="command">lemma</span></span> P_deadend_v0_LCons<span class="main">:</span> <span class="quoted"><span class="quoted">"deadend <span class="free">v0</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">=</span> LCons <span class="free">v0</span> LNil"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P_lnull_ltl_LCons P_no_deadend_v0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="ParityGame-Ptl_valid"><span class="command">lemma</span></span> Ptl_valid <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_path_ltl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="ParityGame-Ptl_maximal"><span class="command">lemma</span></span> Ptl_maximal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"maximal_path <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> maximal_ltl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ParityGame-Pdrop_valid"><span class="command">lemma</span></span> Pdrop_valid <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>ldropn <span class="free">n</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_path_drop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="ParityGame-Pdrop_maximal"><span class="command">lemma</span></span> Pdrop_maximal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"maximal_path <span class="main">(</span>ldropn <span class="free">n</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> maximal_drop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ParityGame-prefix_valid"><span class="command">lemma</span></span> prefix_valid <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>ltake <span class="free">n</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_path_prefix<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ParityGame-extension_valid"><span class="command">lemma</span></span> extension_valid <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">→</span><span class="free">v0</span> <span class="main">⟹</span> valid_path <span class="main">(</span>LCons <span class="free">v</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P_not_null P_v0 P_valid valid_path_cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="ParityGame-extension_maximal"><span class="command">lemma</span></span> extension_maximal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"maximal_path <span class="main">(</span>LCons <span class="free">v</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maximal_path_cons<span class="main">)</span>
<span class="keyword1" id="ParityGame-lappend_maximal"><span class="command">lemma</span></span> lappend_maximal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"maximal_path <span class="main">(</span>lappend <span class="free">P'</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maximal_path_lappend<span class="main">)</span>

<span class="keyword1" id="ParityGame-v0_V"><span class="command">lemma</span></span> v0_V <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P_LCons P_valid valid_path_cons_simp<span class="main">)</span>
<span class="keyword1" id="ParityGame-v0_lset_P"><span class="command">lemma</span></span> v0_lset_P <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> lset <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P_not_null P_v0 llist.set_sel<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="ParityGame-v0_VV"><span class="command">lemma</span></span> v0_VV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">∨</span> <span class="free">v0</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">**</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1" id="ParityGame-lset_P_V"><span class="command">lemma</span></span> lset_P_V <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_in_V<span class="main">)</span>
<span class="keyword1" id="ParityGame-lset_ltl_P_V"><span class="command">lemma</span></span> lset_ltl_P_V <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_in_V<span class="main">)</span>

<span class="keyword1" id="ParityGame-finite_llast_deadend"><span class="command">lemma</span></span> finite_llast_deadend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lfinite <span class="free">P</span> <span class="main">⟹</span> deadend <span class="main">(</span>llast <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P_maximal P_not_null maximal_ends_on_deadend <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="ParityGame-finite_llast_V"><span class="command">lemma</span></span> finite_llast_V <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lfinite <span class="free">P</span> <span class="main">⟹</span> llast <span class="free">P</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P_not_null lfinite_lset lset_P_V <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If a path visits a deadend, it is winning for the other player.›</span></span>
<span class="keyword1" id="ParityGame-visits_deadend"><span class="command">lemma</span></span> visits_deadend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">∩</span> deadends <span class="free">p</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span><span class="main">**</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">n</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">∈</span> deadends <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lset_intersect_lnth<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> llength <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P_ends_on_deadend <span class="keyword1"><span class="command">unfolding</span></span> deadends_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"llast <span class="free">P</span> <span class="main">=</span> <span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat llast_conv_lnth<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"llast <span class="free">P</span> <span class="main">∈</span> deadends <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lfinite <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * llength_eq_enat_lfiniteD <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> winning_path_def deadends_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Strategy">
<div class="head">
<h1>Theory Strategy</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Positional Strategies›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Strategy
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <a href="#ParityGame">ParityGame</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A \emph{strategy} is simply a function from nodes to nodes
  We only consider positional strategies.
›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> Strategy <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A \emph{valid} strategy for player <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a function assigning a successor to each node
  in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">VV</span></span> <span class="free"><span class="free">p</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ParityGame<span class="main">)</span> <span class="entity">strategy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Player <span class="main">⇒</span> <span class="tfree">'a</span> Strategy <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">strategy</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> VV <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">.</span> <span class="main">¬</span>deadend <span class="bound">v</span> <span class="main">⟶</span> <span class="bound">v</span><span class="main">→</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">v</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ParityGame<span class="main">)</span> strategyI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">v</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">;</span> <span class="main">¬</span>deadend <span class="bound">v</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">v</span><span class="main">→</span><span class="free">σ</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⟹</span> strategy <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Strategy-Conforming Paths›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">path_conforms_with_strategy</span></span> <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">P</span></span> <span class="free"><span class="free">σ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> holds, then we call <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> a
  \emph{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-path}.
  This means that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> follows <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> on all nodes of player <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  except maybe the last node on the path.
›</span></span>
<span class="keyword1"><span class="command">coinductive</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ParityGame<span class="main">)</span> <span class="entity">path_conforms_with_strategy</span>
  <span class="main">::</span> <span class="quoted"><span class="quoted">"Player <span class="main">⇒</span> <span class="tfree">'a</span> Path <span class="main">⇒</span> <span class="tfree">'a</span> Strategy <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  path_conforms_LNil<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">path_conforms_with_strategy</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> LNil <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> path_conforms_LCons_LNil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">path_conforms_with_strategy</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>LCons <span class="free"><span class="bound"><span class="entity">v</span></span></span> LNil<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> path_conforms_VVp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> VV <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">;</span> <span class="free">path_conforms_with_strategy</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>LCons <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">Ps</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟧</span>
    <span class="main">⟹</span> <span class="free">path_conforms_with_strategy</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>LCons <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>LCons <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">Ps</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> path_conforms_VVpstar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∉</span> VV <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span> <span class="free">path_conforms_with_strategy</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Ps</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟧</span>
    <span class="main">⟹</span> <span class="free">path_conforms_with_strategy</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>LCons <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">Ps</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Define a locale for valid maximal paths that conform to a given strategy, because we need
  this concept quite often.  However, we are not yet able to add interesting lemmas to this locale.
  We will do this at the end of this section, where we have more lemmas available.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> vmc_path <span class="main">=</span> vm_path <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">σ</span> <span class="keyword2"><span class="keyword">assumes</span></span> P_conforms <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Similary, define a locale for valid maximal paths that conform to given strategies for both
  players.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> vmc2_path <span class="main">=</span> comp<span class="main">?</span><span class="main">:</span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">**</span>"</span></span> <span class="quoted"><span class="free">σ'</span></span> <span class="main">+</span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span> <span class="free">P</span> <span class="free">v0</span> <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹An Arbitrary Strategy›</span></span>

<span class="keyword1"><span class="command">context</span></span> ParityGame <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Define an arbitrary strategy.  This is useful to define other strategies by overriding part of
  this strategy.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ_arbitrary</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">v</span><span class="main">→</span><span class="bound">w</span>"</span></span>

<span class="keyword1" id="Strategy-valid_arbitrary_strategy"><span class="command">lemma</span></span> valid_arbitrary_strategy <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> σ_arbitrary"</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→</span> σ_arbitrary <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> σ_arbitrary_def <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">v</span><span class="main">→</span><span class="bound">w</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Valid Strategies›</span></span>

<span class="keyword1" id="Strategy-valid_strategy_updates"><span class="command">lemma</span></span> valid_strategy_updates<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> strategy <span class="free">p</span> <span class="free">σ</span><span class="main">;</span> <span class="free">v0</span><span class="main">→</span><span class="free">w0</span> <span class="main">⟧</span> <span class="main">⟹</span> strategy <span class="free">p</span> <span class="main">(</span><span class="free">σ</span><span class="main">(</span><span class="free">v0</span> <span class="main">:=</span> <span class="free">w0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Strategy-valid_strategy_updates_set"><span class="command">lemma</span></span> valid_strategy_updates_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="bound">v</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">;</span> <span class="main">¬</span>deadend <span class="bound">v</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">v</span><span class="main">→</span><span class="free">σ'</span> <span class="bound">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="main">(</span>override_on <span class="free">σ</span> <span class="free">σ'</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms override_on_def strategy_def<span class="main">)</span>

<span class="keyword1" id="Strategy-valid_strategy_updates_set_strong"><span class="command">lemma</span></span> valid_strategy_updates_set_strong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="main">(</span>override_on <span class="free">σ</span> <span class="free">σ'</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> strategy_def<span class="main">]</span> valid_strategy_updates_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Strategy-subgame_strategy_stays_in_subgame"><span class="command">lemma</span></span> subgame_strategy_stays_in_subgame<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"ParityGame.strategy <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> ParityGame.VV <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>Digraph.deadend <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> G'<span class="main">:</span> ParityGame <span class="quoted"><span class="quoted">"subgame <span class="free">V'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgame_ParityGame <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> G'.strategy_def G'.edges_are_in_V<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff IntE subgame_VV Player.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Strategy-valid_strategy_supergame"><span class="command">lemma</span></span> valid_strategy_supergame<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> σ'<span class="main">:</span> <span class="quoted"><span class="quoted">"ParityGame.strategy <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span> <span class="free">p</span> <span class="free">σ'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> G'_no_deadends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V'</span> <span class="main">⟹</span> <span class="main">¬</span>Digraph.deadend <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span> <span class="bound">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="main">(</span>override_on <span class="free">σ</span> <span class="free">σ'</span> <span class="free">V'</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="var">?σ</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> G'<span class="main">:</span> ParityGame <span class="quoted"><span class="quoted">"subgame <span class="free">V'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgame_ParityGame <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→</span> <span class="var">?σ</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> G'.VV <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgame_VV <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> VV <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>G'.deadend <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G'_no_deadends <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span> <span class="free">σ'</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ' <span class="keyword1"><span class="command">unfolding</span></span> G'.strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ'</span> <span class="skolem">v</span> <span class="main">=</span> <span class="var">?σ</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgame_E subsetCE<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> <span class="free">V'</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> v σ <span class="keyword1"><span class="command">unfolding</span></span> strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Strategy-valid_strategy_in_V"><span class="command">lemma</span></span> valid_strategy_in_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> strategy <span class="free">p</span> <span class="free">σ</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">;</span> <span class="main">¬</span>deadend <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strategy_def <span class="keyword1"><span class="command">using</span></span> valid_edge_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Strategy-valid_strategy_only_in_V"><span class="command">lemma</span></span> valid_strategy_only_in_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> strategy <span class="free">p</span> <span class="free">σ</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">σ'</span> <span class="bound">v</span> <span class="main">⟧</span> <span class="main">⟹</span> strategy <span class="free">p</span> <span class="free">σ'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strategy_def <span class="keyword1"><span class="command">using</span></span> edges_are_in_V<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Conforming Strategies›</span></span>

<span class="keyword1" id="Strategy-path_conforms_with_strategy_ltl"><span class="command">lemma</span></span> path_conforms_with_strategy_ltl <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ</span> <span class="main">⟹</span> path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> path_conforms_with_strategy.cases<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_conforms_with_strategy.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Strategy-path_conforms_with_strategy_drop"><span class="command">lemma</span></span> path_conforms_with_strategy_drop<span class="main">:</span>
  <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ</span> <span class="main">⟹</span> path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>ldropn <span class="free">n</span> <span class="free">P</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_conforms_with_strategy_ltl ltl_ldrop<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">P</span><span class="main">.</span> path_conforms_with_strategy <span class="free">p</span> <span class="bound">P</span> <span class="free">σ</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Strategy-path_conforms_with_strategy_prefix"><span class="command">lemma</span></span> path_conforms_with_strategy_prefix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ</span> <span class="main">⟹</span> lprefix <span class="free">P'</span> <span class="free">P</span> <span class="main">⟹</span> path_conforms_with_strategy <span class="free">p</span> <span class="free">P'</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">P'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path_conforms_with_strategy <span class="skolem">P</span> <span class="skolem">P'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path_conforms_with_strategy.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> path_conforms_LNil
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> path_conforms_with_strategy<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> path_conforms_LCons_LNil
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lprefix_LCons_conv lprefix_antisym lprefix_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> path_conforms_with_strategy<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path_conforms_VVp <span class="skolem">v</span> <span class="skolem">w</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">≠</span> LNil <span class="main">∧</span> <span class="skolem">P'</span> <span class="main">≠</span> LCons <span class="skolem">v</span> LNil"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">.</span> <span class="skolem">P'</span> <span class="main">=</span> LCons <span class="skolem">v</span> <span class="main">(</span>LCons <span class="skolem">w</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.path_conforms_VVp<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lprefix_LCons_conv path_conforms_with_strategy<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> local.path_conforms_VVp<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> path_conforms_with_strategy<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path_conforms_VVpstar <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">≠</span> LNil"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">.</span> <span class="skolem">P'</span> <span class="main">=</span> LCons <span class="skolem">v</span> <span class="bound">Q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> local.path_conforms_VVpstar<span class="main">(</span>1<span class="main">)</span> lprefix_LCons_conv path_conforms_with_strategy<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> local.path_conforms_VVpstar path_conforms_with_strategy<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Strategy-path_conforms_with_strategy_irrelevant"><span class="command">lemma</span></span> path_conforms_with_strategy_irrelevant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> lset <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="main">(</span><span class="free">σ</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> path_conforms_with_strategy.cases<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Strategy-path_conforms_with_strategy_irrelevant_deadend"><span class="command">lemma</span></span> path_conforms_with_strategy_irrelevant_deadend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"deadend <span class="free">v</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">∉</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="main">(</span><span class="free">σ</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path_conforms_with_strategy <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path_conforms_with_strategy.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path_conforms_VVp <span class="skolem">v'</span> <span class="skolem">w</span> <span class="skolem">Ps</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="var">?σ</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> local.path_conforms_VVp<span class="main">(</span>1<span class="main">)</span> valid_path_cons_simp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> local.path_conforms_VVp<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="var">?σ</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.path_conforms_VVp<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> LCons <span class="skolem">w</span> <span class="skolem">Ps</span> <span class="main">=</span> <span class="bound">P</span> <span class="main">∧</span> path_conforms_with_strategy <span class="free">p</span> <span class="bound">P</span> <span class="free">σ</span> <span class="main">∧</span> <span class="main">(</span>deadend <span class="free">v</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">∉</span> VV <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> valid_path <span class="bound">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>LCons <span class="skolem">w</span> <span class="skolem">Ps</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> local.path_conforms_VVp<span class="main">(</span>1<span class="main">)</span> path_conforms_with_strategy<span class="main">(</span>3<span class="main">)</span> valid_path_ltl' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> local.path_conforms_VVp<span class="main">(</span>4<span class="main">)</span> path_conforms_with_strategy<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> local.path_conforms_VVp<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path_conforms_VVpstar <span class="skolem">v'</span> <span class="skolem">Ps</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> path_conforms_with_strategy <span class="free">p</span> <span class="skolem">Ps</span> <span class="free">σ</span> <span class="main">∧</span> <span class="main">(</span>deadend <span class="free">v</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">∉</span> VV <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> valid_path <span class="skolem">Ps</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> local.path_conforms_VVpstar<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> path_conforms_with_strategy<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> valid_path_ltl' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.path_conforms_VVpstar<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Strategy-path_conforms_with_strategy_irrelevant_updates"><span class="command">lemma</span></span> path_conforms_with_strategy_irrelevant_updates<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> lset <span class="free">P</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">σ'</span> <span class="bound">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path_conforms_with_strategy <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path_conforms_with_strategy.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path_conforms_VVp <span class="skolem">v'</span> <span class="skolem">w</span> <span class="skolem">Ps</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="free">σ'</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> local.path_conforms_VVp<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> path_conforms_with_strategy<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> local.path_conforms_VVp<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> path_conforms_with_strategy<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Strategy-path_conforms_with_strategy_irrelevant'"><span class="command">lemma</span></span> path_conforms_with_strategy_irrelevant'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="main">(</span><span class="free">σ</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> lset <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms fun_upd_triv fun_upd_upd path_conforms_with_strategy_irrelevant<span class="main">)</span>

<span class="keyword1" id="Strategy-path_conforms_with_strategy_irrelevant_deadend'"><span class="command">lemma</span></span> path_conforms_with_strategy_irrelevant_deadend'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="main">(</span><span class="free">σ</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"deadend <span class="free">v</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">∉</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms fun_upd_triv fun_upd_upd path_conforms_with_strategy_irrelevant_deadend<span class="main">)</span>

<span class="keyword1" id="Strategy-path_conforms_with_strategy_start"><span class="command">lemma</span></span> path_conforms_with_strategy_start<span class="main">:</span>
  <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>LCons <span class="free">v</span> <span class="main">(</span>LCons <span class="free">w</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="free">v</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> path_conforms_with_strategy.cases<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Strategy-path_conforms_with_strategy_lappend"><span class="command">lemma</span></span> path_conforms_with_strategy_lappend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    P<span class="main">:</span> <span class="quoted"><span class="quoted">"lfinite <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free">P'</span>"</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P'</span> <span class="free">σ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> conforms<span class="main">:</span> <span class="quoted"><span class="quoted">"llast <span class="free">P</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">(</span>llast <span class="free">P</span><span class="main">)</span> <span class="main">=</span> lhd <span class="free">P'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>lappend <span class="free">P</span> <span class="free">P'</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">P</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> lfinite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lnull <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v0</span></span> <span class="keyword2"><span class="keyword">where</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> LCons <span class="skolem">v0</span> LNil"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LCons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lhd_LCons_ltl llist.collapse<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>LCons <span class="main">(</span>lhd <span class="skolem">P</span><span class="main">)</span> <span class="free">P'</span><span class="main">)</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lhd <span class="skolem">P</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> v0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lhd <span class="free">P'</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">(</span>lhd <span class="skolem">P</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> LCons.prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> path_conforms_VVp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lhd <span class="skolem">P</span>"</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"lhd <span class="free">P'</span>"</span></span> <span class="quoted"><span class="free">σ</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> LCons.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lnull <span class="free">P'</span>›</span></span> lhd_LCons_ltl<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lhd <span class="skolem">P</span> <span class="main">∉</span> VV <span class="free">p</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> path_conforms_VVpstar <span class="keyword1"><span class="command">using</span></span> LCons.prems<span class="main">(</span>4<span class="main">)</span> v0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v0<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>lappend <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span> <span class="free">P'</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LCons.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> LCons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> LCons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> LCons.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> LCons.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span>
                assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> lhd_LCons_ltl llast_LCons2 path_conforms_with_strategy_ltl<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>LCons <span class="main">(</span>lhd <span class="skolem">P</span><span class="main">)</span> <span class="main">(</span>lappend <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span> <span class="free">P'</span><span class="main">)</span><span class="main">)</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lhd <span class="skolem">P</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"lhd <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">(</span>lhd <span class="skolem">P</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LCons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> LCons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lnull <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span>›</span></span>
                  lhd_LCons_ltl path_conforms_with_strategy_start<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> path_conforms_VVp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lhd <span class="skolem">P</span>"</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"lhd <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">σ</span></span><span class="main">]</span> * <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lnull <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lappend_code<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lhd_LCons_ltl<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lhd <span class="skolem">P</span> <span class="main">∉</span> VV <span class="free">p</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"*"</span> path_conforms_VVpstar<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lnull <span class="skolem">P</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>lappend <span class="skolem">P</span> <span class="free">P'</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lappend_code<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lhd_LCons_ltl<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Strategy-path_conforms_with_strategy_VVpstar"><span class="command">lemma</span></span> path_conforms_with_strategy_VVpstar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> VV <span class="free">p</span><span class="main">**</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path_conforms_with_strategy <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">Ps</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">=</span> LCons <span class="bound">v</span> <span class="bound">Ps</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_conforms_with_strategy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> LNil"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> lnull_def not_lnull_conv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Strategy-subgame_path_conforms_with_strategy"><span class="command">lemma</span></span> subgame_path_conforms_with_strategy<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> V'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="free">V'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ParityGame.path_conforms_with_strategy <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span> <span class="free">p</span> <span class="free">P</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgame_def <span class="keyword1"><span class="command">using</span></span> P<span class="main">(</span>2<span class="main">)</span> V' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> P<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ParityGame.path_conforms_with_strategy.coinduct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> subgame_ParityGame<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path_conforms_with_strategy.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vmc_path<span class="main">)</span> subgame_path_vmc_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> V'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="free">V'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span> <span class="free">P</span> <span class="free">v0</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> G'<span class="main">:</span> ParityGame <span class="quoted"><span class="quoted">"subgame <span class="free">V'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgame_ParityGame <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"G'.valid_path <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgame_valid_path P_valid P <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"G'.maximal_path <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgame_maximal_path V' P_maximal P <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"G'.path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subgame_path_conforms_with_strategy V' P_conforms P <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Greedy Conforming Path›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Given a starting point and two strategies, there exists a path conforming to both strategies.
  Here we define this path.  Incidentally, this also shows that the assumptions of the locales
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vmc_path›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vmc2_path›</span></span></span></span> are satisfiable.

  We are only interested in proving the existence of such a path, so the definition
  (i.e., the implementation) and most lemmas are private.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">greedy_conforming_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Player <span class="main">⇒</span> <span class="tfree">'a</span> Strategy <span class="main">⇒</span> <span class="tfree">'a</span> Strategy <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> Path"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">greedy_conforming_path</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span> <span class="free"><span class="bound"><span class="entity">v0</span></span></span> <span class="main">=</span>
    LCons <span class="free"><span class="bound"><span class="entity">v0</span></span></span> <span class="main">(</span><span class="keyword1">if</span> deadend <span class="free"><span class="bound"><span class="entity">v0</span></span></span>
      <span class="keyword1">then</span> LNil
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">v0</span></span></span> <span class="main">∈</span> VV <span class="free"><span class="bound"><span class="entity">p</span></span></span>
        <span class="keyword1">then</span> <span class="free">greedy_conforming_path</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v0</span></span></span><span class="main">)</span>
        <span class="keyword1">else</span> <span class="free">greedy_conforming_path</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ'</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ'</span></span></span> <span class="free"><span class="bound"><span class="entity">v0</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Strategy-greedy_path_LNil"><span class="command">lemma</span></span> greedy_path_LNil<span class="main">:</span> <span class="quoted"><span class="quoted">"greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span> <span class="main">≠</span> LNil"</span></span>
  <span class="keyword1"><span class="command">using</span></span> greedy_conforming_path.disc_iff llist.discI<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Strategy-greedy_path_lhd"><span class="command">lemma</span></span> greedy_path_lhd<span class="main">:</span> <span class="quoted"><span class="quoted">"greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span> <span class="main">=</span> LCons <span class="free">v</span> <span class="free">P</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> greedy_conforming_path.code <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Strategy-greedy_path_deadend_v0"><span class="command">lemma</span></span> greedy_path_deadend_v0<span class="main">:</span> <span class="quoted"><span class="quoted">"greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span> <span class="main">=</span> LCons <span class="free">v</span> <span class="free">P</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">=</span> LNil <span class="main">⟷</span> deadend <span class="free">v0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> greedy_conforming_path.disc_iff
      greedy_conforming_path.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> llist.disc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ltl_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">corollary</span></span> greedy_path_deadend_v<span class="main">:</span>
  <span class="quoted"><span class="quoted">"greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span> <span class="main">=</span> LCons <span class="free">v</span> <span class="free">P</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">=</span> LNil <span class="main">⟷</span> deadend <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> greedy_path_deadend_v0 greedy_path_lhd <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">corollary</span></span> greedy_path_deadend_v'<span class="main">:</span> <span class="quoted"><span class="quoted">"greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span> <span class="main">=</span> LCons <span class="free">v</span> LNil <span class="main">⟹</span> deadend <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> greedy_path_deadend_v <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Strategy-greedy_path_ltl"><span class="command">lemma</span></span> greedy_path_ltl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span> <span class="main">=</span> LCons <span class="free">v</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> LNil <span class="main">∨</span> <span class="free">P</span> <span class="main">=</span> greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="main">(</span><span class="free">σ</span> <span class="free">v0</span><span class="main">)</span> <span class="main">∨</span> <span class="free">P</span> <span class="main">=</span> greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="main">(</span><span class="free">σ'</span> <span class="free">v0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">frule</span> greedy_path_lhd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"deadend <span class="free">v0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> greedy_conforming_path.code<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> greedy_conforming_path.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ltl_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Strategy-greedy_path_ltl_ex"><span class="command">lemma</span></span> greedy_path_ltl_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span> <span class="main">=</span> LCons <span class="free">v</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> LNil <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="free">P</span> <span class="main">=</span> greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms greedy_path_ltl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Strategy-greedy_path_ltl_VVp"><span class="command">lemma</span></span> greedy_path_ltl_VVp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span> <span class="main">=</span> LCons <span class="free">v0</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="free">v0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="free">v0</span> <span class="main">=</span> lhd <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms greedy_conforming_path.code <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Strategy-greedy_path_ltl_VVpstar"><span class="command">lemma</span></span> greedy_path_ltl_VVpstar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span> <span class="main">=</span> LCons <span class="free">v0</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">**</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="free">v0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ'</span> <span class="free">v0</span> <span class="main">=</span> lhd <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms greedy_conforming_path.code <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Strategy-greedy_conforming_path_properties"><span class="command">lemma</span></span> greedy_conforming_path_properties<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span><span class="main">**</span> <span class="free">σ'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
        greedy_path_not_null<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="main">(</span>greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greedy_path_v0<span class="main">:</span>        <span class="quoted"><span class="quoted">"greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="free">v0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greedy_path_valid<span class="main">:</span>     <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greedy_path_maximal<span class="main">:</span>   <span class="quoted"><span class="quoted">"maximal_path <span class="main">(</span>greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greedy_path_conforms<span class="main">:</span>  <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> greedy_path_conforms'<span class="main">:</span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span><span class="main">**</span> <span class="main">(</span>greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span><span class="main">)</span> <span class="free">σ'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="skolem">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="free">v0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lnth_0_conv_lhd<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v0</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="skolem">v0</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="var">?P</span> <span class="main">=</span> LCons <span class="bound">v</span> LNil<span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">=</span> LCons <span class="skolem">v0</span> <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> greedy_path_LNil greedy_path_lhd neq_LNil_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm greedy_path_deadend_v0 <span class="quoted"><span class="quoted">‹<span class="skolem">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> P' <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm llist.collapse<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>›</span></span> greedy_path_deadend_v0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> P' <span class="quoted"><span class="quoted">‹<span class="main">¬</span>deadend <span class="skolem">v0</span>›</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span><span class="main">→</span>lhd <span class="skolem">P'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> strategy_def <span class="keyword1"><span class="command">using</span></span> greedy_path_ltl_VVp greedy_path_ltl_VVpstar
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"lhd <span class="skolem">P'</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">P'</span> <span class="main">=</span> greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P' calculation<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> greedy_conforming_path.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> greedy_path_ltl_ex lnull_def<span class="main">)</span>
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The conjunction of all the above.›</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P'</span><span class="main">.</span> <span class="var">?P</span> <span class="main">=</span> LCons <span class="skolem">v0</span> <span class="bound">P'</span> <span class="main">∧</span> <span class="main">¬</span>lnull <span class="bound">P'</span> <span class="main">∧</span> <span class="skolem">v0</span><span class="main">→</span>lhd <span class="bound">P'</span> <span class="main">∧</span> lhd <span class="bound">P'</span> <span class="main">∈</span> <span class="keyword1">V</span>
        <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="bound">P'</span> <span class="main">=</span> greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> P' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> coinduction_helper <span class="main">=</span> this

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> P_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> valid_path.coinduct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>valid_path <span class="skolem">v0</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>›</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> coinduction_helper<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v0</span></span><span class="main">]</span> greedy_path_lhd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"maximal_path <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> P_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v0</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>maximal_path <span class="skolem">v0</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>›</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> coinduction_helper<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v0</span></span><span class="main">]</span> greedy_path_deadend_v' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p''</span> <span class="skolem">σ''</span> <span class="keyword3"><span class="command">assume</span></span> p''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p''</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∧</span> <span class="skolem">σ''</span> <span class="main">=</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">p''</span> <span class="main">=</span> <span class="free">p</span><span class="main">**</span> <span class="main">∧</span> <span class="skolem">σ''</span> <span class="main">=</span> <span class="free">σ'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy <span class="skolem">p''</span> <span class="skolem">σ''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="skolem">p''</span> <span class="skolem">P</span> <span class="skolem">σ''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v0</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path_conforms_with_strategy <span class="skolem">v0</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">∈</span> VV <span class="skolem">p''</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="skolem">v0</span> <span class="main">=</span> LCons <span class="bound">v</span> LNil<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
            P'<span class="main">:</span> <span class="quoted"><span class="quoted">"greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="skolem">v0</span> <span class="main">=</span> LCons <span class="skolem">v0</span> <span class="skolem">P'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="skolem">P'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span><span class="main">→</span>lhd <span class="skolem">P'</span>"</span></span>
                <span class="quoted"><span class="quoted">"lhd <span class="skolem">P'</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">P'</span> <span class="main">=</span> greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> coinduction_helper <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v0</span> <span class="main">∈</span> VV <span class="skolem">p''</span>›</span></span> p'' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ''</span> <span class="skolem">v0</span> <span class="main">=</span> lhd <span class="skolem">P'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> greedy_path_ltl_VVp greedy_path_ltl_VVpstar <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v0</span> <span class="main">∈</span> VV <span class="skolem">p''</span>›</span></span> P'<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?path_conforms_VVp</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> greedy_conforming_path.code path_conforms_with_strategy<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> coinduction_helper<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v0</span></span><span class="main">]</span> path_conforms_with_strategy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="skolem">P</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span><span class="main">**</span> <span class="skolem">P</span> <span class="free">σ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> strategy_conforming_path_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span><span class="main">**</span> <span class="free">σ'</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">P</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vmc2_path <span class="free">G</span> <span class="free">P</span> <span class="free">v0</span> <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vmc2_path <span class="free">G</span> <span class="main">(</span>greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span> <span class="free">v0</span><span class="main">)</span> <span class="free">v0</span> <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> greedy_conforming_path_properties<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> strategy_conforming_path_exists_single<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">P</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="free">P</span> <span class="free">v0</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="main">(</span>greedy_conforming_path <span class="free">p</span> <span class="free">σ</span> σ_arbitrary <span class="free">v0</span><span class="main">)</span> <span class="free">v0</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> greedy_conforming_path_properties<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Valid Maximal Conforming Paths›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now is the time to add some lemmas to the locale <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vmc_path›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">context</span></span> vmc_path <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="Strategy-Ptl_conforms"><span class="command">lemma</span></span> Ptl_conforms <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P_conforms path_conforms_with_strategy_ltl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="Strategy-Pdrop_conforms"><span class="command">lemma</span></span> Pdrop_conforms <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>ldropn <span class="free">n</span> <span class="free">P</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P_conforms path_conforms_with_strategy_drop <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="Strategy-prefix_conforms"><span class="command">lemma</span></span> prefix_conforms <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>ltake <span class="free">n</span> <span class="free">P</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P_conforms path_conforms_with_strategy_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="Strategy-extension_conforms"><span class="command">lemma</span></span> extension_conforms <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v'</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="free">v'</span> <span class="main">=</span> <span class="free">v0</span><span class="main">)</span> <span class="main">⟹</span> path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>LCons <span class="free">v'</span> <span class="free">P</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P_LCons P_conforms path_conforms_VVp path_conforms_VVpstar<span class="main">)</span>

<span class="keyword1" id="Strategy-extension_valid_maximal_conforming"><span class="command">lemma</span></span> extension_valid_maximal_conforming<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">→</span><span class="free">v0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="free">v'</span> <span class="main">=</span> <span class="free">v0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="main">(</span>LCons <span class="free">v'</span> <span class="free">P</span><span class="main">)</span> <span class="free">v'</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Strategy-vmc_path_ldropn"><span class="command">lemma</span></span> vmc_path_ldropn<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="main">(</span>ldropn <span class="free">n</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="free">P</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lhd_ldropn<span class="main">)</span>

<span class="keyword1" id="Strategy-conforms_to_another_strategy"><span class="command">lemma</span></span> conforms_to_another_strategy<span class="main">:</span>
  <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ'</span> <span class="main">⟹</span> vmc_path <span class="free">G</span> <span class="free">P</span> <span class="free">v0</span> <span class="free">p</span> <span class="free">σ'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P_not_null P_valid P_maximal P_v0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ParityGame<span class="main">)</span> valid_maximal_conforming_path_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"maximal_path <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="free">P</span> <span class="main">(</span><span class="free">P</span> <span class="main">$</span> <span class="main">0</span><span class="main">)</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lnth_0_conv_lhd<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Valid Maximal Conforming Paths with One Edge›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define a locale for valid maximal conforming paths that contain at least one edge.
  This is equivalent to the first node being no deadend.  This assumption allows us to prove
  much stronger lemmas about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ltl <span class="free"><span class="free">P</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> compared to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"vmc_path"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> vmc_path_no_deadend <span class="main">=</span> vmc_path <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> v0_no_deadend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="free">v0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">w0</span> <span class="main">≡</span> lhd <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Strategy-Ptl_not_null"><span class="command">lemma</span></span> Ptl_not_null <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P_LCons P_maximal maximal_no_deadend v0_no_deadend <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1" id="Strategy-Ptl_LCons"><span class="command">lemma</span></span> Ptl_LCons<span class="main">:</span> <span class="quoted"><span class="quoted">"ltl <span class="free">P</span> <span class="main">=</span> LCons w0 <span class="main">(</span>ltl <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> w0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1" id="Strategy-P_LCons'"><span class="command">lemma</span></span> P_LCons'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> LCons <span class="free">v0</span> <span class="main">(</span>LCons w0 <span class="main">(</span>ltl <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P_LCons Ptl_LCons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1" id="Strategy-v0_edge_w0"><span class="command">lemma</span></span> v0_edge_w0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span><span class="main">→</span>w0"</span></span> <span class="keyword1"><span class="command">using</span></span> P_valid P_LCons' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_path_edges'<span class="main">)</span>

<span class="keyword1" id="Strategy-Ptl_0"><span class="command">lemma</span></span> Ptl_0<span class="main">:</span> <span class="quoted"><span class="quoted">"ltl <span class="free">P</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> lhd <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lhd_conv_lnth<span class="main">)</span>
<span class="keyword1" id="Strategy-P_Suc_0"><span class="command">lemma</span></span> P_Suc_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> Suc <span class="main">0</span> <span class="main">=</span> w0"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_lnth_Suc Ptl_0 w0_def<span class="main">)</span>
<span class="keyword1" id="Strategy-Ptl_edge"><span class="command">lemma</span></span> Ptl_edge <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">→</span> lhd <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P_LCons' P_valid valid_path_edges' w0_def<span class="main">)</span>

<span class="keyword1" id="Strategy-v0_conforms"><span class="command">lemma</span></span> v0_conforms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="free">v0</span> <span class="main">=</span> w0"</span></span>
  <span class="keyword1"><span class="command">using</span></span> path_conforms_with_strategy_start <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P_LCons' P_conforms<span class="main">)</span>

<span class="keyword1" id="Strategy-w0_V"><span class="command">lemma</span></span> w0_V <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"w0 <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ptl_LCons Ptl_valid valid_path_cons_simp<span class="main">)</span>
<span class="keyword1" id="Strategy-w0_lset_P"><span class="command">lemma</span></span> w0_lset_P <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"w0 <span class="main">∈</span> lset <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P_LCons' lset_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lset_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Strategy-vmc_path_ltl"><span class="command">lemma</span></span> vmc_path_ltl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span> w0 <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> w0_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> vmc_path <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Strategy-vmc_path_lnull_ltl_no_deadend"><span class="command">lemma</span></span> vmc_path_lnull_ltl_no_deadend<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> vmc_path_no_deadend <span class="free">G</span> <span class="free">P</span> <span class="free">v0</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P_0 P_no_deadends <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> enat_ltl_Suc lnull_0_llength<span class="main">)</span>

<span class="keyword1" id="Strategy-vmc_path_conforms"><span class="command">lemma</span></span> vmc_path_conforms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="free">n</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">(</span><span class="free">P</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">$</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> ldropn <span class="free">n</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> P'<span class="main">:</span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P'</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">using</span></span> vmc_path_ldropn assms<span class="main">(</span>1<span class="main">)</span> Suc_llength <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="main">(</span><span class="free">P</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> P_no_deadends <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> P'<span class="main">:</span> vmc_path_no_deadend <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P'</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">(</span><span class="free">P</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> P'.w0"</span></span> <span class="keyword1"><span class="command">using</span></span> P'.v0_conforms assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> P'_def P'.P_Suc_0 assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">lset</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> Induction Schemas for Paths›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Let us define an induction schema useful for proving <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"lset <span class="free"><span class="free">P</span></span> <span class="main"><span class="main">⊆</span></span> <span class="free"><span class="free">S</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Strategy-vmc_path_lset_induction"><span class="command">lemma</span></span> vmc_path_lset_induction <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> base step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> step_assumption<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span> <span class="bound">v0</span><span class="main">.</span> <span class="main">⟦</span> vmc_path_no_deadend <span class="free">G</span> <span class="bound">P</span> <span class="bound">v0</span> <span class="free">p</span> <span class="free">σ</span><span class="main">;</span> <span class="bound">v0</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">P</span> <span class="main">⟧</span>
      <span class="main">⟹</span> <span class="free">Q</span> <span class="main">(</span>ltl <span class="bound">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>vmc_path_no_deadend.w0 <span class="bound">P</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> lset <span class="free">P</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vmc_path_axioms assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> llist_set_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>find <span class="skolem">P</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">P</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lnull <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> LCons <span class="skolem">v</span> LNil"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> llist.disc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lset_cases step.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> step.prems<span class="main">(</span>3<span class="main">)</span> P_LCons <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path_no_deadend <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span>
        <span class="keyword1"><span class="command">using</span></span> vmc_path_lnull_ltl_no_deadend <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> step.hyps<span class="main">(</span>3<span class="main">)</span>
              step_assumption<span class="main">[</span><span class="operator">OF</span> vmc_path_no_deadend_axioms <span class="quoted"><span class="quoted">‹<span class="skolem">v0</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Q</span> <span class="skolem">P</span>›</span></span><span class="main">]</span>
              vmc_path_ltl
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> vmc_path_lset_induction<span class="antiquote"><span class="antiquote">}</span></span></span></span> without the Q predicate.›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> vmc_path_lset_induction_simple <span class="main">[</span><span class="operator">case_names</span> base step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span> <span class="bound">v0</span><span class="main">.</span> <span class="main">⟦</span> vmc_path_no_deadend <span class="free">G</span> <span class="bound">P</span> <span class="bound">v0</span> <span class="free">p</span> <span class="free">σ</span><span class="main">;</span> <span class="bound">v0</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟧</span>
      <span class="main">⟹</span> vmc_path_no_deadend.w0 <span class="bound">P</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms vmc_path_lset_induction<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">P</span><span class="main">.</span> True"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Another induction schema for proving <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"lset <span class="free"><span class="free">P</span></span> <span class="main"><span class="main">⊆</span></span> <span class="free"><span class="free">S</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> based on closure properties.›</span></span>

<span class="keyword1" id="Strategy-vmc_path_lset_induction_closed_subset"><span class="command">lemma</span></span> vmc_path_lset_induction_closed_subset <span class="main">[</span><span class="operator">case_names</span> VVp VVpstar v0 disjoint<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> VVp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="main">¬</span>deadend <span class="bound">v</span><span class="main">;</span> <span class="bound">v</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">T</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> VVpstar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="main">¬</span>deadend <span class="bound">v</span><span class="main">;</span> <span class="bound">v</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">**</span> <span class="main">;</span> <span class="bound">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">T</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">∩</span> <span class="free">T</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> disjoint <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vmc_path_lset_induction<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">P</span> <span class="skolem">v0</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> vmc_path_no_deadend <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">using</span></span> step.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span> <span class="main">∩</span> <span class="free">T</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step.hyps<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> disjoint_eq_subset_Compl lset_ltl order.trans<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"w0 <span class="main">∈</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">v0</span></span></span></span><span class="main">]</span> step.hyps<span class="main">(</span>2<span class="main">)</span> v0_no_deadend v0_conforms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step.hyps<span class="main">(</span>3<span class="main">)</span> w0_lset_P <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> v0<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="AttractingStrategy">
<div class="head">
<h1>Theory AttractingStrategy</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Attracting Strategies›</span></span>

<span class="keyword1"><span class="command">theory</span></span> AttractingStrategy
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <a href="#Strategy">Strategy</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here we introduce the concept of attracting strategies.›</span></span>

<span class="keyword1"><span class="command">context</span></span> ParityGame <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Paths Visiting a Set›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A path that stays in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>A›</span></span></span></span> until eventually it visits <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>W›</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">visits_via</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> enat <span class="bound">n</span> <span class="main">&lt;</span> llength <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">$</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">∧</span> lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="bound">n</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1" id="AttractingStrategy-visits_via_monotone"><span class="command">lemma</span></span> visits_via_monotone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> visits_via <span class="free">P</span> <span class="free">A</span> <span class="free">W</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A'</span> <span class="main">⟧</span> <span class="main">⟹</span> visits_via <span class="free">P</span> <span class="free">A'</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> visits_via_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="AttractingStrategy-visits_via_visits"><span class="command">lemma</span></span> visits_via_visits<span class="main">:</span> <span class="quoted"><span class="quoted">"visits_via <span class="free">P</span> <span class="free">A</span> <span class="free">W</span> <span class="main">⟹</span> lset <span class="free">P</span> <span class="main">∩</span> <span class="free">W</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> visits_via_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> disjoint_iff_not_equal in_lset_conv_lnth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vmc_path<span class="main">)</span> visits_via_trivial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> visits_via <span class="free">P</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> visits_via_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> zero_enat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="AttractingStrategy-visits_via_LCons"><span class="command">lemma</span></span> visits_via_LCons<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="free">P</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="main">(</span>LCons <span class="free">v0</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span>insert <span class="free">v0</span> <span class="free">A</span><span class="main">)</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">n</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="skolem">n</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> visits_via_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> LCons <span class="free">v0</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ldropn_Suc_LCons ldropn_Suc_conv_ldropn ldropn_eq_LConsD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">$</span> Suc <span class="skolem">n</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">P'</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="free">v0</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lset_ltake_Suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P'</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> visits_via_def P'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vmc_path_no_deadend<span class="main">)</span> visits_via_ltl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="free">P</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∉</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">n</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="skolem">n</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> visits_via_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v0 n<span class="main">(</span>2<span class="main">)</span> DiffE <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nat.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> enat <span class="bound">n</span> <span class="main">&lt;</span> llength <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">∧</span> lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>ltl <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> n n' enat_Suc_ltl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> P_lnth_Suc lset_ltake_ltl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> visits_via_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vm_path<span class="main">)</span> visits_via_deadend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="free">P</span> <span class="free">A</span> <span class="main">(</span>deadends <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span><span class="main">**</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms visits_via_visits visits_deadend <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Attracting Strategy from a Single Node›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  All <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-paths starting from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">v0</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> visit <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">W</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and until then they stay in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">strategy_attracts_via</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Player <span class="main">⇒</span> <span class="tfree">'a</span> Strategy <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">strategy_attracts_via</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v0</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">P</span><span class="main">.</span> vmc_path <span class="free">G</span> <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">v0</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟶</span> visits_via <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vmc_path<span class="main">)</span> strategy_attracts_viaE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="free">P</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> strategy_attracts_via_def assms vmc_path_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vmc_path<span class="main">)</span> strategy_attracts_via_SucE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span> <span class="free">A</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∉</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> enat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">P</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">$</span> Suc <span class="bound">n</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">∧</span> lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">n</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="skolem">n</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strategy_attracts_viaE<span class="main">[</span><span class="operator">unfolded</span> visits_via_def<span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> n<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P_0<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n not0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vmc_path<span class="main">)</span> strategy_attracts_via_lset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">∩</span> <span class="free">W</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">THEN</span> strategy_attracts_viaE<span class="main">,</span> <span class="operator">unfolded</span> visits_via_def<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> disjoint_iff_not_equal lset_lnth_member subset_refl<span class="main">)</span>

<span class="keyword1" id="AttractingStrategy-strategy_attracts_via_v0"><span class="command">lemma</span></span> strategy_attracts_via_v0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="free">v0</span> <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> strategy_conforming_path_exists_single assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">n</span> <span class="main">&lt;</span> llength <span class="skolem">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="skolem">n</span><span class="main">)</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> σ<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> strategy_attracts_via_def visits_via_def<span class="main">]</span> vmc_path_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lhd <span class="main">(</span>ltake <span class="main">(</span>enat <span class="skolem">n</span><span class="main">)</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> lhd <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enat_0_iff<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="skolem">n</span><span class="main">)</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> P_not_null P_v0 enat_0_iff<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> llist.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ltake.disc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">corollary</span></span> strategy_attracts_not_outside<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">v0</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span><span class="main">;</span> strategy <span class="free">p</span> <span class="free">σ</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span>strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> strategy_attracts_via_v0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="AttractingStrategy-strategy_attracts_viaI"><span class="command">lemma</span></span> strategy_attracts_viaI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> vmc_path <span class="free">G</span> <span class="bound">P</span> <span class="free">v0</span> <span class="free">p</span> <span class="free">σ</span> <span class="main">⟹</span> visits_via <span class="bound">P</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strategy_attracts_via_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="AttractingStrategy-strategy_attracts_via_no_deadends"><span class="command">lemma</span></span> strategy_attracts_via_no_deadends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="free">v</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"deadend <span class="free">v</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> LCons <span class="free">v</span> LNil"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span>›</span></span> valid_path_base' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"maximal_path <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹deadend <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maximal_path.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="skolem">P</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_conforms_LCons_LNil<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="skolem">P</span> <span class="free">A</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> strategy_attracts_viaE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"llength <span class="skolem">P</span> <span class="main">=</span> eSuc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="main">0</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enat_0_iff<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> visits_via_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="AttractingStrategy-attractor_strategy_on_extends"><span class="command">lemma</span></span> attractor_strategy_on_extends<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span> <span class="free">A</span> <span class="free">W</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A'</span> <span class="main">⟧</span> <span class="main">⟹</span> strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span> <span class="free">A'</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strategy_attracts_via_def <span class="keyword1"><span class="command">using</span></span> visits_via_monotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="AttractingStrategy-strategy_attracts_via_trivial"><span class="command">lemma</span></span> strategy_attracts_via_trivial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="free">v0</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="skolem">P</span> <span class="free">A</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> visits_via_trivial <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v0</span> <span class="main">∈</span> <span class="free">W</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="AttractingStrategy-strategy_attracts_via_successor"><span class="command">lemma</span></span> strategy_attracts_via_successor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> w0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span><span class="main">→</span><span class="free">w0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="free">v0</span> <span class="main">=</span> <span class="free">w0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="free">w0</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="free">w0</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">w0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> LCons <span class="free">v0</span> <span class="skolem">P</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> P'<span class="main">:</span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P'</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span>
    <span class="keyword1"><span class="command">using</span></span> extension_valid_maximal_conforming w0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> P'<span class="main">:</span> vmc_path_no_deadend <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P'</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v0</span><span class="main">→</span><span class="free">w0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="skolem">P'</span> <span class="free">A</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ<span class="main">(</span>2<span class="main">)</span> P'.strategy_attracts_viaE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="skolem">P</span> <span class="free">A</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P'.visits_via_ltl v0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="AttractingStrategy-strategy_attracts_VVp"><span class="command">lemma</span></span> strategy_attracts_VVp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="free">v0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="free">v0</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span><span class="main">→</span><span class="free">σ</span> <span class="free">v0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> strategy_def<span class="main">]</span> v<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="main">(</span><span class="free">σ</span> <span class="free">v0</span><span class="main">)</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strategy_attracts_via_successor σ v<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> strategy_attracts_via_v0 <span class="quoted"><span class="quoted">‹<span class="free">v0</span><span class="main">→</span><span class="free">σ</span> <span class="free">v0</span>›</span></span> σ<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="AttractingStrategy-strategy_attracts_VVpstar"><span class="command">lemma</span></span> strategy_attracts_VVpstar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∉</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w0</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">v0</span> <span class="main">→</span> <span class="free">w0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms strategy_attracts_not_outside strategy_attracts_via_successor<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Attracting strategy from a set of nodes›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  All <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-paths starting from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> visit <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">W</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and until then they stay in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">strategy_attracts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Player <span class="main">⇒</span> <span class="tfree">'a</span> Strategy <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">strategy_attracts</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">v0</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> strategy_attracts_via <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">v0</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vmc_path<span class="main">)</span> strategy_attractsE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="free">p</span> <span class="free">σ</span> <span class="free">A</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="free">P</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> strategy_attracts_def<span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> strategy_attracts_viaE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="AttractingStrategy-strategy_attractsI"><span class="command">lemma</span></span> strategy_attractsI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span> <span class="bound">v</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> vmc_path <span class="free">G</span> <span class="bound">P</span> <span class="bound">v</span> <span class="free">p</span> <span class="free">σ</span> <span class="main">⟧</span> <span class="main">⟹</span> visits_via <span class="bound">P</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="free">p</span> <span class="free">σ</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strategy_attracts_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vmc_path<span class="main">)</span> strategy_attracts_lset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="free">p</span> <span class="free">σ</span> <span class="free">A</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">∩</span> <span class="free">W</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> strategy_attracts_def<span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> strategy_attracts_via_lset<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">W</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="AttractingStrategy-strategy_attracts_empty"><span class="command">lemma</span></span> strategy_attracts_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="free">p</span> <span class="free">σ</span> <span class="main">{}</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="AttractingStrategy-strategy_attracts_invalid_path"><span class="command">lemma</span></span> strategy_attracts_invalid_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> LCons <span class="free">v</span> <span class="main">(</span>LCons <span class="free">w</span> <span class="free">P'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>visits_via <span class="free">P</span> <span class="free">A</span> <span class="free">W</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">n</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="skolem">n</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> visits_via_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>›</span></span> n<span class="main">(</span>2<span class="main">)</span> P<span class="main">(</span>1<span class="main">)</span> DiffD2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">W</span>›</span></span> n<span class="main">(</span>2<span class="main">)</span> P<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ltake <span class="main">(</span>enat <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> contra_subsetD enat_ord_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lset_ltake_prefix lset_lnth_member lset_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="main">(</span>ltake <span class="main">(</span>eSuc <span class="main">(</span>eSuc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> n<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> enat_ord_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> le_less_linear less_le_trans neq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"llength <span class="main">(</span>ltake <span class="main">(</span>enat <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> min <span class="main">(</span>enat <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>llength <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"llength <span class="main">(</span>ltake <span class="main">(</span>enat <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> enat <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_absorb1<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat zero_enat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ltake <span class="main">(</span>enat <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span> <span class="main">$</span> Suc <span class="main">0</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lset_lnth_member<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> Suc <span class="main">0</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lnth_ltake<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> P<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is an attractor set of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">W</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and an edge leaves <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> without going through
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">W</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> belongs to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"VV <span class="free"><span class="free">p</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and the attractor strategy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> avoids
  this edge.  All other cases give a contradiction.
›</span></span>
<span class="keyword1" id="AttractingStrategy-strategy_attracts_does_not_leave"><span class="command">lemma</span></span> strategy_attracts_does_not_leave<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="free">p</span> <span class="free">σ</span> <span class="free">A</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">→</span><span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">∧</span> <span class="free">σ</span> <span class="free">v</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> contra<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">∧</span> <span class="free">σ</span> <span class="free">v</span> <span class="main">≠</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="comment1">(* Define a strategy for p** which tries to take this edge. *)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">σ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="main">=</span> σ_arbitrary<span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span><span class="main">**</span> <span class="skolem">σ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span><span class="main">→</span><span class="free">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_strategy_updates<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"vmc2_path <span class="free">G</span> <span class="skolem">P</span> <span class="free">v</span> <span class="free">p</span> <span class="free">σ</span> <span class="skolem">σ'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span><span class="main">→</span><span class="free">w</span>›</span></span> strategy_conforming_path_exists σ<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc2_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="skolem">σ'</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> vmc_path_no_deadend <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span><span class="main">→</span><span class="free">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> comp<span class="main">:</span> vmc_path_no_deadend <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">**</span>"</span></span> <span class="quoted"><span class="skolem">σ'</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span><span class="main">→</span><span class="free">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> w0"</span></span> <span class="keyword1"><span class="command">using</span></span> contra σ'_def v0_conforms comp.v0_conforms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>visits_via <span class="skolem">P</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strategy_attracts_invalid_path<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="quoted">"ltl <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span>"</span></span><span class="main">]</span> v<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> P_LCons' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> DiffE σ<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> strategy_attractsE v<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Given an attracting strategy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, we can turn every strategy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">σ'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> into an attracting
  strategy by overriding <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">σ'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> on a suitable subset of the nodes.  This also means that
  an attracting strategy is still attracting if we override it outside of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">A</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">W</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1" id="AttractingStrategy-strategy_attracts_irrelevant_override"><span class="command">lemma</span></span> strategy_attracts_irrelevant_override<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="free">p</span> <span class="free">σ</span> <span class="free">A</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="free">p</span> <span class="main">(</span>override_on <span class="free">σ'</span> <span class="free">σ</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">W</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> strategy_attractsI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">v</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"override_on <span class="free">σ'</span> <span class="free">σ</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="skolem">v</span> <span class="free">p</span> <span class="var">?σ</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="free">p</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="main">0</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> contra<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>visits_via <span class="skolem">P</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="main">0</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> visits_via_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> DiffI P_len not_less0 lset_ltake<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> lset <span class="skolem">P</span> <span class="main">⟹</span> override_on <span class="free">σ'</span> <span class="free">σ</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">W</span><span class="main">)</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">σ</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="skolem">P</span> <span class="free">σ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> path_conforms_with_strategy_irrelevant_updates<span class="main">[</span><span class="operator">OF</span> P_conforms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">$</span> <span class="main">0</span><span class="main">)</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> conforms_to_another_strategy P_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> contra <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">$</span> <span class="main">0</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> vmc_path.strategy_attractsE<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> enat <span class="bound">n</span> <span class="main">&lt;</span> llength <span class="skolem">P</span> <span class="main">∧</span> <span class="skolem">P</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lset_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">n</span> <span class="main">&lt;</span> llength <span class="skolem">P</span> <span class="main">∧</span> <span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span>enat <span class="bound">i</span> <span class="main">&lt;</span> llength <span class="skolem">P</span> <span class="main">∧</span> <span class="skolem">P</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_least_nat_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> enat <span class="bound">n</span> <span class="main">&lt;</span> llength <span class="skolem">P</span> <span class="main">∧</span> <span class="skolem">P</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> n_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dual_order.strict_trans enat_ord_simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">$</span> <span class="main">0</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>›</span></span> n<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n'</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_min <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n'</span> <span class="main">→</span> <span class="skolem">P</span> <span class="main">$</span> Suc <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P_valid n<span class="main">(</span>1<span class="main">)</span> n' valid_path_edges <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> Suc <span class="skolem">n'</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">∉</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> contra n<span class="main">(</span>1<span class="main">)</span> n_min <span class="keyword1"><span class="command">unfolding</span></span> visits_via_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Diff_subset lset_ltake subsetCE<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n<span class="main">(</span>1<span class="main">)</span> n' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n'</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">∧</span> <span class="free">σ</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">P</span> <span class="main">$</span> Suc <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strategy_attracts_does_not_leave<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">W</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> Suc <span class="skolem">n'</span>"</span></span><span class="main">]</span>
          assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> n<span class="main">(</span>1<span class="main">)</span> n' vmc_path_conforms <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n'</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> override_on_apply_in<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="AttractingStrategy-strategy_attracts_trivial"><span class="command">lemma</span></span> strategy_attracts_trivial <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="free">p</span> <span class="free">σ</span> <span class="free">W</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strategy_attracts_def strategy_attracts_via_trivial<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-conforming path <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> hits an attractor <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, it will visit <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">W</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vmc_path<span class="main">)</span> attracted_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="free">p</span> <span class="free">σ</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> P_hits_A<span class="main">:</span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">∩</span> <span class="free">W</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">n</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P_hits_A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lset_intersect_lnth<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> ldropn <span class="skolem">n</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P'</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">using</span></span> vmc_path_ldropn n<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="skolem">P'</span> <span class="free">A</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ n<span class="main">(</span>2<span class="main">)</span> strategy_attractsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">using</span></span> visits_via_visits in_lset_ldropnD<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="AttractingStrategy-attracted_strategy_step"><span class="command">lemma</span></span> attracted_strategy_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="free">p</span> <span class="free">σ</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="free">v0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="free">v0</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffD1 strategy_attracts_VVp assms strategy_attracts_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vmc_path_no_deadend<span class="main">)</span> attracted_path_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="free">p</span> <span class="free">σ</span> <span class="free">A</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"w0 <span class="main">∈</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> DiffD1 P_LCons' σ strategy_attractsE strategy_attracts_invalid_path v0<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context ParityGame›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Attractor">
<div class="head">
<h1>Theory Attractor</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Attractor Sets›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\label{sec:attractor}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Attractor
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <a href="#AttractingStrategy">AttractingStrategy</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here we define the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-attractor of a set of nodes.›</span></span>

<span class="keyword1"><span class="command">context</span></span> ParityGame <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the conditions for a node to be directly attracted from a given set.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">directly_attracted</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Player <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">directly_attracted</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="main">¬</span>deadend <span class="bound">v</span> <span class="main">∧</span>
      <span class="main">(</span><span class="bound">v</span> <span class="main">∈</span> VV <span class="free"><span class="bound"><span class="entity">p</span></span></span>   <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="bound">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="bound">v</span> <span class="main">∈</span> VV <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">**</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">⟶</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">attractor_step</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∪</span> directly_attracted <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span>-attractor set of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>W›</span></span></span></span>, defined as a least fixed point.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">attractor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Player <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">attractor</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">=</span> lfp <span class="main">(</span>attractor_step <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> directly_attracted<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Show a few basic properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> directly_attracted<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1" id="Attractor-directly_attracted_disjoint"><span class="command">lemma</span></span> directly_attracted_disjoint     <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"directly_attracted <span class="free">p</span> <span class="free">W</span> <span class="main">∩</span> <span class="free">W</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> directly_attracted_empty        <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"directly_attracted <span class="free">p</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> directly_attracted_V_empty      <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"directly_attracted <span class="free">p</span> <span class="keyword1">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> directly_attracted_bounded_by_V <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"directly_attracted <span class="free">p</span> <span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> directly_attracted_contains_no_deadends <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> directly_attracted <span class="free">p</span> <span class="free">W</span> <span class="main">⟹</span> <span class="main">¬</span>deadend <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> directly_attracted_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>attractor_step›</span></span></span></span>›</span></span>

<span class="keyword1" id="Attractor-attractor_step_empty"><span class="command">lemma</span></span> attractor_step_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"attractor_step <span class="free">p</span> <span class="main">{}</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> attractor_step_bounded_by_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">V</span><span class="main">;</span> <span class="free">S</span> <span class="main">⊆</span> <span class="keyword1">V</span> <span class="main">⟧</span> <span class="main">⟹</span> attractor_step <span class="free">p</span> <span class="free">W</span> <span class="free">S</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The definition of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> attractor<span class="antiquote"><span class="antiquote">}</span></span></span></span> uses <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> lfp<span class="antiquote"><span class="antiquote">}</span></span></span></span>.  For this to be well-defined, we
  need show that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>attractor_step›</span></span></span></span> is monotone.
›</span></span>

<span class="keyword1" id="Attractor-attractor_step_mono"><span class="command">lemma</span></span> attractor_step_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span>attractor_step <span class="free">p</span> <span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> directly_attracted_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monoI<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Properties of an Attractor›</span></span>

<span class="keyword1" id="Attractor-attractor_unfolding"><span class="command">lemma</span></span> attractor_unfolding<span class="main">:</span> <span class="quoted"><span class="quoted">"attractor <span class="free">p</span> <span class="free">W</span> <span class="main">=</span> attractor_step <span class="free">p</span> <span class="free">W</span> <span class="main">(</span>attractor <span class="free">p</span> <span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> attractor_def <span class="keyword1"><span class="command">using</span></span> attractor_step_mono lfp_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="Attractor-attractor_lowerbound"><span class="command">lemma</span></span> attractor_lowerbound<span class="main">:</span> <span class="quoted"><span class="quoted">"attractor_step <span class="free">p</span> <span class="free">W</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">⟹</span> attractor <span class="free">p</span> <span class="free">W</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> attractor_def <span class="keyword1"><span class="command">using</span></span> attractor_step_mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lfp_lowerbound<span class="main">)</span>
<span class="keyword1" id="Attractor-attractor_set_non_empty"><span class="command">lemma</span></span> attractor_set_non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> attractor <span class="free">p</span> <span class="free">W</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> attractor_set_base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> attractor <span class="free">p</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> attractor_unfolding <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="Attractor-attractor_in_V"><span class="command">lemma</span></span> attractor_in_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">V</span> <span class="main">⟹</span> attractor <span class="free">p</span> <span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> attractor_lowerbound attractor_step_bounded_by_V <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Attractor Set Extensions›</span></span>

<span class="keyword1" id="Attractor-attractor_set_VVp"><span class="command">lemma</span></span> attractor_set_VVp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">→</span><span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> attractor <span class="free">p</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> attractor <span class="free">p</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> attractor_unfolding<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> directly_attracted_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Attractor-attractor_set_VVpstar"><span class="command">lemma</span></span> attractor_set_VVpstar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="free">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∈</span> attractor <span class="free">p</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> attractor <span class="free">p</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> attractor_unfolding<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> directly_attracted_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Removing an Attractor›</span></span>

<span class="keyword1" id="Attractor-removing_attractor_induces_no_deadends"><span class="command">lemma</span></span> removing_attractor_induces_no_deadends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> attractor <span class="free">p</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">→</span><span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">**</span><span class="main">;</span> <span class="free">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> attractor <span class="free">p</span> <span class="free">W</span><span class="main">.</span> <span class="free">v</span><span class="main">→</span><span class="bound">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span><span class="main">→</span><span class="free">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> VV_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> attractor_set_VVp assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">**</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> attractor_set_VVpstar assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff edges_are_in_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Removing the attractor sets of deadends leaves a subgame without deadends.›</span></span>

<span class="keyword1" id="Attractor-subgame_without_deadends"><span class="command">lemma</span></span> subgame_without_deadends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> V'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V'</span> <span class="main">=</span> <span class="keyword1">V</span> <span class="main">-</span> attractor <span class="free">p</span> <span class="main">(</span>deadends <span class="free">p</span><span class="main">**</span><span class="main">)</span> <span class="main">-</span> attractor <span class="free">p</span><span class="main">**</span> <span class="main">(</span>deadends <span class="free">p</span><span class="main">**</span><span class="main">**</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">V'</span> <span class="main">=</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="var">?A</span> <span class="main">-</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>subgame <span class="free">V'</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>Digraph.deadend <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"deadend <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="var">?A</span> <span class="main">-</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">unfolding</span></span> V'_def subgame_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> VV <span class="skolem">p'</span><span class="main">**</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> attractor <span class="skolem">p'</span> <span class="main">(</span>deadends <span class="skolem">p'</span><span class="main">**</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹deadend <span class="free">v</span>›</span></span> attractor_set_base<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"deadends <span class="skolem">p'</span><span class="main">**</span>"</span></span> <span class="quoted"><span class="skolem">p'</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> deadends_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p'</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="var">?A</span> <span class="main">-</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">unfolding</span></span> V'_def subgame_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G'</span> <span class="main">=</span> subgame <span class="free">V'</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> G'<span class="main">:</span> ParityGame <span class="quoted"><span class="skolem">G'</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">using</span></span> subgame_ParityGame <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Digraph.deadend <span class="main">(</span>subgame <span class="free">V'</span><span class="main">)</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"G'.deadend <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> all_in_attractor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="free">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∈</span> <span class="var">?A</span> <span class="main">∨</span> <span class="bound">w</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">→</span><span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">w</span> <span class="main">∈</span> <span class="var">?A</span> <span class="main">∨</span> <span class="skolem">w</span> <span class="main">∈</span> <span class="var">?B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="free">V'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> V'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def subgame_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span><span class="main">→</span><span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span><span class="main">→</span><span class="skolem">w</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def subgame_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹G'.deadend <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> VV <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="free">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> attractor <span class="skolem">p'</span> <span class="main">(</span>deadends <span class="skolem">p'</span><span class="main">**</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> attractor <span class="skolem">p'</span> <span class="main">(</span>deadends <span class="skolem">p'</span><span class="main">**</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> VV <span class="skolem">p'</span>›</span></span> attractor_set_VVp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p'</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="free">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∈</span> attractor <span class="skolem">p'</span><span class="main">**</span> <span class="main">(</span>deadends <span class="skolem">p'</span><span class="main">**</span><span class="main">**</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> all_in_attractor <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p'</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> attractor <span class="skolem">p'</span><span class="main">**</span> <span class="main">(</span>deadends <span class="skolem">p'</span><span class="main">**</span><span class="main">**</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>deadend <span class="free">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> VV <span class="skolem">p'</span>›</span></span> attractor_set_VVpstar <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p'</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Attractor Set Induction›</span></span>

<span class="keyword1" id="Attractor-mono_restriction_is_mono"><span class="command">lemma</span></span> mono_restriction_is_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">f</span> <span class="main">⟹</span> mono <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">S</span> <span class="main">∩</span> <span class="keyword1">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mono_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf_mono monoD subset_refl<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Here we prove a powerful induction schema for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">attractor</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.  Being able to prove this is the
  only reason why we do not use \texttt{inductive\_set} to define the attractor set.

  See also \url{https://lists.cam.ac.uk/pipermail/cl-isabelle-users/2015-October/msg00123.html}
›</span></span>
<span class="keyword1" id="Attractor-attractor_set_induction"><span class="command">lemma</span></span> attractor_set_induction <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> step union<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="keyword1">V</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">S</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>attractor_step <span class="free">p</span> <span class="free">W</span> <span class="bound">S</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">S</span> <span class="main">∈</span> <span class="bound">M</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="keyword1">V</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">S</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>attractor <span class="free">p</span> <span class="free">W</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">S</span> <span class="main">∩</span> <span class="keyword1">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">S</span><span class="main">.</span> attractor_step <span class="free">p</span> <span class="free">W</span> <span class="main">(</span><span class="bound">S</span> <span class="main">∩</span> <span class="keyword1">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lfp <span class="var">?f</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lfp <span class="main">(</span>attractor_step <span class="free">p</span> <span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mono_restriction_is_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"attractor_step <span class="free">p</span> <span class="free">W</span>"</span></span><span class="main">]</span> attractor_step_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> P_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> lfp_ordinal_induct_set<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">S</span> <span class="main">⟹</span> <span class="var">?P</span> <span class="main">(</span><span class="free">W</span> <span class="main">∪</span> <span class="main">(</span><span class="bound">S</span> <span class="main">∩</span> <span class="keyword1">V</span><span class="main">)</span> <span class="main">∪</span> directly_attracted <span class="free">p</span> <span class="main">(</span><span class="bound">S</span> <span class="main">∩</span> <span class="keyword1">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> attractor_step_bounded_by_V inf.absorb1 inf_le2 local.step<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">S</span> <span class="main">∈</span> <span class="bound">M</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">S</span> <span class="main">⟹</span> <span class="var">?P</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">S</span> <span class="main">∩</span> <span class="keyword1">V</span> <span class="main">|</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="skolem">M</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">S</span><span class="main">∈</span><span class="skolem">M</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">S</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">S</span> <span class="main">∈</span> <span class="var">?M</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="keyword1">V</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="main">⋃</span><span class="var">?M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="var">?M</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="skolem">M</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="main">⋃</span><span class="skolem">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> f_mono<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">V</span> <span class="main">∩</span> <span class="keyword1">V</span><span class="main">)</span> <span class="main">∪</span> directly_attracted <span class="free">p</span> <span class="main">(</span><span class="keyword1">V</span> <span class="main">∩</span> <span class="keyword1">V</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> attractor_step_bounded_by_V <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lfp_lowerbound<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?f</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f_mono lfp_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="free">W</span> <span class="main">∪</span> <span class="main">(</span><span class="var">?A</span> <span class="main">∩</span> <span class="keyword1">V</span><span class="main">)</span> <span class="main">∪</span> directly_attracted <span class="free">p</span> <span class="main">(</span><span class="var">?A</span> <span class="main">∩</span> <span class="keyword1">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?A</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"attractor_step <span class="free">p</span> <span class="free">W</span> <span class="var">?A</span> <span class="main">⊆</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?A</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> inf.absorb1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> attractor_step <span class="free">p</span> <span class="free">W</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> attractor_step_mono lfp_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="var">?B</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?B</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> equalityD2 le_iff_inf<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="var">?B</span> <span class="main">⊆</span> <span class="var">?B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lfp_lowerbound<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lfp_lowerbound<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P_A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> attractor_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?B</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> attractor_def le_iff_inf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context ParityGame›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="WinningStrategy">
<div class="head">
<h1>Theory WinningStrategy</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Winning Strategies›</span></span>

<span class="keyword1"><span class="command">theory</span></span> WinningStrategy
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <a href="#Strategy">Strategy</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> ParityGame <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Here we define winning strategies.

  A strategy is winning for player <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">v0</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> if every maximal <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-path
  starting in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">v0</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is winning.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">winning_strategy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Player <span class="main">⇒</span> <span class="tfree">'a</span> Strategy <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">winning_strategy</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v0</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">P</span><span class="main">.</span> vmc_path <span class="free">G</span> <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">v0</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟶</span> winning_path <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">P</span>"</span></span>

<span class="keyword1" id="WinningStrategy-winning_strategyI"><span class="command">lemma</span></span> winning_strategyI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> vmc_path <span class="free">G</span> <span class="bound">P</span> <span class="free">v0</span> <span class="free">p</span> <span class="free">σ</span> <span class="main">⟹</span> winning_path <span class="free">p</span> <span class="bound">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> winning_strategy_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vmc_path<span class="main">)</span> paths_hits_winning_strategy_is_winning<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> lset <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">n</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> in_lset_conv_lnth<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> P'<span class="main">:</span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"ldropn <span class="skolem">n</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">using</span></span> n vmc_path_ldropn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="main">(</span>ldropn <span class="skolem">n</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> winning_strategy_def P'.vmc_path_axioms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> winning_path_drop_add P_valid n<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹There cannot exist winning strategies for both players for the same node.›</span></span>

<span class="keyword1" id="WinningStrategy-winning_strategy_only_for_one_player"><span class="command">lemma</span></span> winning_strategy_only_for_one_player<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> σ'<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span><span class="main">**</span> <span class="free">σ'</span>"</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span><span class="main">**</span> <span class="free">σ'</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vmc2_path <span class="free">G</span> <span class="skolem">P</span> <span class="free">v</span> <span class="free">p</span> <span class="free">σ</span> <span class="free">σ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms strategy_conforming_path_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc2_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="free">σ'</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> paths_hits_winning_strategy_is_winning σ<span class="main">(</span>2<span class="main">)</span> v0_lset_P <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span><span class="main">**</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp.paths_hits_winning_strategy_is_winning σ'<span class="main">(</span>2<span class="main">)</span> v0_lset_P <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> P_valid paths_are_winning_for_one_player <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Deadends›</span></span>

<span class="keyword1" id="WinningStrategy-no_winning_strategy_on_deadends"><span class="command">lemma</span></span> no_winning_strategy_on_deadends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"deadend <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>winning_strategy <span class="free">p</span> <span class="free">σ</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="free">v</span> <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> strategy_conforming_path_exists_single assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> LCons <span class="free">v</span> LNil"</span></span> <span class="keyword1"><span class="command">using</span></span> P_deadend_v0_LCons <span class="quoted"><span class="quoted">‹deadend <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>winning_path <span class="free">p</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> winning_path_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> winning_strategy_def vmc_path_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="WinningStrategy-winning_strategy_on_deadends"><span class="command">lemma</span></span> winning_strategy_on_deadends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"deadend <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span><span class="main">**</span> <span class="free">σ</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="free">v</span> <span class="free">p</span><span class="main">**</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">**</span>"</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> LCons <span class="free">v</span> LNil"</span></span> <span class="keyword1"><span class="command">using</span></span> P_deadend_v0_LCons <span class="quoted"><span class="quoted">‹deadend <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span><span class="main">**</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> winning_path_def
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span>›</span></span> P_valid paths_are_winning_for_one_player <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Extension Theorems›</span></span>

<span class="keyword1" id="WinningStrategy-strategy_extends_VVp"><span class="command">lemma</span></span> strategy_extends_VVp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="free">v0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ</span> <span class="main">(</span><span class="free">σ</span> <span class="free">v0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="main">(</span><span class="free">σ</span> <span class="free">v0</span><span class="main">)</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="free">v0</span>"</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span><span class="main">→</span><span class="free">σ</span> <span class="free">v0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v0 σ<span class="main">(</span>1<span class="main">)</span> strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="main">(</span>LCons <span class="free">v0</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> σ<span class="main">(</span>2<span class="main">)</span> extension_valid_maximal_conforming winning_strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> winning_path_ltl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"LCons <span class="free">v0</span> <span class="skolem">P</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="WinningStrategy-strategy_extends_VVpstar"><span class="command">lemma</span></span> strategy_extends_VVpstar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">**</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span><span class="main">→</span><span class="free">w0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ</span> <span class="free">w0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="free">w0</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">w0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="main">(</span>LCons <span class="free">v0</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> extension_valid_maximal_conforming VV_impl1 σ v0 winning_strategy_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> winning_path_ltl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"LCons <span class="free">v0</span> <span class="skolem">P</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="WinningStrategy-strategy_extends_backwards_VVpstar"><span class="command">lemma</span></span> strategy_extends_backwards_VVpstar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">**</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="free">v0</span><span class="main">→</span><span class="bound">w</span> <span class="main">⟹</span> winning_strategy <span class="free">p</span> <span class="free">σ</span> <span class="bound">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="free">v0</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"deadend <span class="free">v0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> P_deadend_v0_LCons winning_path_def v0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="free">v0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path_no_deadend <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command">interpret</span></span> ltlP<span class="main">:</span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"ltl <span class="skolem">P</span>"</span></span> <span class="quoted">w0</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">using</span></span> vmc_path_ltl <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> σ<span class="main">(</span>2<span class="main">)</span> v0_edge_w0 vmc_path_ltl winning_strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> winning_path_LCons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P_LCons' ltlP.P_LCons ltlP.P_not_null<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="WinningStrategy-strategy_extends_backwards_VVp"><span class="command">lemma</span></span> strategy_extends_backwards_VVp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="free">v0</span> <span class="main">=</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span><span class="main">→</span><span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="free">v0</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="free">v0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v0</span><span class="main">→</span><span class="free">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path_no_deadend <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> σ<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> winning_strategy_def<span class="main">]</span> v0<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> v0_conforms vmc_path_ltl <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> winning_path_LCons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P_LCons Ptl_not_null<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context ParityGame›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="WellOrderedStrategy">
<div class="head">
<h1>Theory WellOrderedStrategy</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Well-Ordered Strategy›</span></span>

<span class="keyword1"><span class="command">theory</span></span> WellOrderedStrategy
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <a href="#Strategy">Strategy</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Constructing a uniform strategy from a set of strategies on a set of nodes often works by
  well-ordering the strategies and then choosing the minimal strategy on each node.
  Then every path eventually follows one strategy because we choose the strategies along the path
  to be non-increasing in the well-ordering.

  The following locale formalizes this idea.

  We will use this to construct uniform attractor and winning strategies.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> WellOrderedStrategies <span class="main">=</span> ParityGame <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">Player</span>
    <span class="comment1">― ‹The set of good strategies on a node <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">v</span></span><span class="antiquote">}</span></span>›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">good</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> Strategy set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> Strategy <span class="main">×</span> <span class="tfree">'a</span> Strategy<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> S_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
    <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">r</span></span><span class="antiquote">}</span></span> is a wellorder on the set of all strategies which are good somewhere.›</span>
    <span class="keyword2"><span class="keyword">and</span></span> r_wo<span class="main">:</span> <span class="quoted"><span class="quoted">"well_order_on <span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">∈</span> <span class="free">good</span> <span class="bound">v</span><span class="main">}</span> <span class="free">r</span>"</span></span>
    <span class="comment1">― ‹Every node has a good strategy.›</span>
    <span class="keyword2"><span class="keyword">and</span></span> good_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">∈</span> <span class="free">good</span> <span class="bound">v</span>"</span></span>
    <span class="comment1">― ‹good strategies are well-formed strategies.›</span>
    <span class="keyword2"><span class="keyword">and</span></span> good_strategies<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">∈</span> <span class="free">good</span> <span class="bound">v</span> <span class="main">⟹</span> strategy <span class="free">p</span> <span class="bound">σ</span>"</span></span>
    <span class="comment1">― ‹A good strategy on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">v</span></span><span class="antiquote">}</span></span> is also good on possible successors of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">v</span></span><span class="antiquote">}</span></span>.›</span>
    <span class="keyword2"><span class="keyword">and</span></span> strategies_continue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">w</span> <span class="bound">σ</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="bound">v</span><span class="main">→</span><span class="bound">w</span><span class="main">;</span> <span class="bound">v</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">⟹</span> <span class="bound">σ</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">w</span><span class="main">;</span> <span class="bound">σ</span> <span class="main">∈</span> <span class="free">good</span> <span class="bound">v</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">σ</span> <span class="main">∈</span> <span class="free">good</span> <span class="bound">w</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The set of all strategies which are good somewhere.›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Strategies</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">∈</span> <span class="free">good</span> <span class="bound">v</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minimal_good_strategy</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">minimal_good_strategy</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">∈</span> <span class="free">good</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">σ'</span><span class="main">.</span> <span class="main">(</span><span class="bound">σ'</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">-</span> Id <span class="main">⟶</span> <span class="bound">σ'</span> <span class="main">∉</span> <span class="free">good</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> binomial <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">choose</span>"</span> 65<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Among the good strategies on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, choose the minimum.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">choose</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">choose</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">THE</span> <span class="bound">σ</span><span class="main">.</span> minimal_good_strategy <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="bound">σ</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Define a strategy which uses the minimum strategy on all nodes of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  Of course, we need to prove that this is a well-formed strategy.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">well_ordered_strategy</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">well_ordered_strategy</span> <span class="main">≡</span> override_on σ_arbitrary <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> choose <span class="bound">v</span> <span class="bound">v</span><span class="main">)</span> <span class="free">S</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Show some simple properties of the binary relation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> on the set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Strategies<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1" id="WellOrderedStrategy-r_refl"><span class="command">lemma</span></span> r_refl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"refl_on Strategies <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> r_wo <span class="keyword1"><span class="command">unfolding</span></span> well_order_on_def linear_order_on_def partial_order_on_def preorder_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="WellOrderedStrategy-r_total"><span class="command">lemma</span></span> r_total <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"total_on Strategies <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> r_wo <span class="keyword1"><span class="command">unfolding</span></span> well_order_on_def linear_order_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="WellOrderedStrategy-r_trans"><span class="command">lemma</span></span> r_trans <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> r_wo <span class="keyword1"><span class="command">unfolding</span></span> well_order_on_def linear_order_on_def partial_order_on_def preorder_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="WellOrderedStrategy-r_wf"><span class="command">lemma</span></span> r_wf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span><span class="free">r</span> <span class="main">-</span> Id<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> well_order_on_def r_wo <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> choose<span class="antiquote"><span class="antiquote">}</span></span></span></span> always chooses a minimal good strategy on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1" id="WellOrderedStrategy-choose_works"><span class="command">lemma</span></span> choose_works<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"minimal_good_strategy <span class="free">v</span> <span class="main">(</span>choose <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span><span class="free">r</span> <span class="main">-</span> Id<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> well_order_on_def r_wo <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> σ1<span class="main">:</span> <span class="quoted"><span class="quoted">"minimal_good_strategy <span class="free">v</span> <span class="skolem">σ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> minimal_good_strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> good_ex<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> <span class="free">S</span>›</span></span><span class="main"><span class="main">]</span></span> wf wf_eq_minimal<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">∈</span> <span class="free">good</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">σ'</span><span class="main">.</span> <span class="main">(</span><span class="bound">σ'</span><span class="main">,</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">-</span> Id <span class="main">⟹</span> <span class="bound">σ'</span> <span class="main">∉</span> <span class="free">good</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> minimal_good_strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"minimal_good_strategy <span class="free">v</span> <span class="skolem">σ'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> σ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="main">∈</span> <span class="free">good</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">σ</span><span class="main">.</span> <span class="main">(</span><span class="bound">σ</span><span class="main">,</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">-</span> Id <span class="main">⟹</span> <span class="bound">σ</span> <span class="main">∉</span> <span class="free">good</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> minimal_good_strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">σ</span><span class="main">,</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∉</span> <span class="free">r</span> <span class="main">-</span> Id"</span></span> <span class="keyword1"><span class="command">using</span></span> σ<span class="main">(</span>1<span class="main">)</span> σ'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">σ'</span><span class="main">,</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∉</span> <span class="free">r</span> <span class="main">-</span> Id"</span></span> <span class="keyword1"><span class="command">using</span></span> σ<span class="main">(</span>2<span class="main">)</span> σ'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">∈</span> Strategies"</span></span> <span class="keyword1"><span class="command">using</span></span> σ<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="main">∈</span> Strategies"</span></span> <span class="keyword1"><span class="command">using</span></span> σ'<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="main">=</span> <span class="skolem">σ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r_wo Linear_order_in_diff_Id well_order_on_Field well_order_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> σ1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">σ</span><span class="main">.</span> minimal_good_strategy <span class="free">v</span> <span class="bound">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> theI'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"minimal_good_strategy <span class="free">v</span>"</span></span><span class="main">,</span> <span class="operator">folded</span> choose_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> choose_good<span class="main">:</span> <span class="quoted"><span class="quoted">"choose <span class="free">v</span> <span class="main">∈</span> <span class="free">good</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> choose_minimal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">σ'</span><span class="main">.</span> <span class="main">(</span><span class="bound">σ'</span><span class="main">,</span> choose <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">-</span> Id <span class="main">⟹</span> <span class="bound">σ'</span> <span class="main">∉</span> <span class="free">good</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> choose_strategy<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="main">(</span>choose <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> choose_works<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">unfolded</span> minimal_good_strategy_def<span class="main">]</span> good_strategies <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">corollary</span></span> choose_in_Strategies<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> choose <span class="free">v</span> <span class="main">∈</span> Strategies"</span></span> <span class="keyword1"><span class="command">using</span></span> choose_good <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="WellOrderedStrategy-well_ordered_strategy_valid"><span class="command">lemma</span></span> well_ordered_strategy_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> well_ordered_strategy"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="main">(</span>choose <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> choose_works<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="free">S</span>›</span></span><span class="main">,</span> <span class="operator">unfolded</span> minimal_good_strategy_def<span class="main">,</span> <span class="operator">THEN</span> conjunct1<span class="main">]</span> good_strategies
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">→</span><span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> choose <span class="bound">v</span> <span class="bound">v</span><span class="main">)</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> well_ordered_strategy_def <span class="keyword1"><span class="command">using</span></span> valid_strategy_updates_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Strategies on a Path›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Maps a path to its strategies.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">path_strategies</span> <span class="main">≡</span> lmap choose"</span></span>

<span class="keyword1" id="WellOrderedStrategy-path_strategies_in_Strategies"><span class="command">lemma</span></span> path_strategies_in_Strategies<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>path_strategies <span class="free">P</span><span class="main">)</span> <span class="main">⊆</span> Strategies"</span></span>
  <span class="keyword1"><span class="command">using</span></span> path_strategies_def assms choose_in_Strategies <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="WellOrderedStrategy-path_strategies_good"><span class="command">lemma</span></span> path_strategies_good<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_strategies <span class="free">P</span> <span class="main">$</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">good</span> <span class="main">(</span><span class="free">P</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_strategies_def assms choose_good lset_lnth_member<span class="main">)</span>

<span class="keyword1" id="WellOrderedStrategy-path_strategies_strategy"><span class="command">lemma</span></span> path_strategies_strategy<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"enat <span class="free">n</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="main">(</span>path_strategies <span class="free">P</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> path_strategies_good assms good_strategies <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="WellOrderedStrategy-path_strategies_monotone_Suc"><span class="command">lemma</span></span> path_strategies_monotone_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> well_ordered_strategy"</span></span>
    <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>path_strategies <span class="free">P</span> <span class="main">$</span> Suc <span class="free">n</span><span class="main">,</span> path_strategies <span class="free">P</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> ldropn <span class="free">n</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> enat_ltl_Suc ldrop_eSuc_ltl ldropn_Suc_conv_ldropn llist.disc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lnull_0_llength ltl_ldropn<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">Ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> vw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> LCons <span class="skolem">v</span> <span class="main">(</span>LCons <span class="skolem">w</span> <span class="skolem">Ps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ldropn_0 ldropn_Suc_conv_ldropn ldropn_lnull lnull_0_llength<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P'</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">using</span></span> P<span class="main">(</span>1<span class="main">)</span> lset_ldropn_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">→</span><span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_path_edges'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">Ps</span></span><span class="main">,</span> <span class="operator">folded</span> vw<span class="main">]</span> valid_path_drop<span class="main">[</span><span class="operator">OF</span> P<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> P'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"choose <span class="skolem">v</span> <span class="main">∈</span> <span class="free">good</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> choose_good <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">⟹</span> choose <span class="skolem">v</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="skolem">P'</span> well_ordered_strategy"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">using</span></span> path_conforms_with_strategy_drop P<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_ordered_strategy <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vw path_conforms_with_strategy_start <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"choose <span class="skolem">v</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> well_ordered_strategy_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"choose <span class="skolem">v</span> <span class="main">∈</span> <span class="free">good</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> strategies_continue <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>choose <span class="skolem">v</span><span class="main">,</span> choose <span class="skolem">w</span><span class="main">)</span> <span class="main">∉</span> <span class="free">r</span> <span class="main">-</span> Id"</span></span> <span class="keyword1"><span class="command">using</span></span> choose_minimal <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>choose <span class="skolem">w</span><span class="main">,</span> choose <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"choose <span class="skolem">v</span> <span class="main">=</span> choose <span class="skolem">w</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> r_refl refl_onD choose_in_Strategies<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="free">S</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"choose <span class="skolem">v</span> <span class="main">≠</span> choose <span class="skolem">w</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * r_total choose_in_Strategies<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="free">S</span>›</span></span><span class="main">]</span> choose_in_Strategies<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="free">S</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> Linear_order_in_diff_Id r_wo well_order_on_Field well_order_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>path_strategies <span class="skolem">P'</span> <span class="main">$</span> Suc <span class="main">0</span><span class="main">,</span> path_strategies <span class="skolem">P'</span> <span class="main">$</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> path_strategies_def <span class="keyword1"><span class="command">using</span></span> vw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_strategies_def P'_def
    <span class="keyword1"><span class="command">using</span></span> lnth_lmap_ldropn<span class="main">[</span><span class="operator">OF</span> Suc_llength<span class="main"><span class="main">[</span></span><span class="operator">OF</span> P<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted">choose</span><span class="main">]</span>
          lnth_lmap_ldropn_Suc<span class="main">[</span><span class="operator">OF</span> P<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted">choose</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="WellOrderedStrategy-path_strategies_monotone"><span class="command">lemma</span></span> path_strategies_monotone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> well_ordered_strategy"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"enat <span class="free">m</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>path_strategies <span class="free">P</span> <span class="main">$</span> <span class="free">m</span><span class="main">,</span> path_strategies <span class="free">P</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">-</span> <span class="free">n</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> path_strategies_monotone_Suc<span class="main">[</span><span class="operator">OF</span> P<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Suc.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> Suc_diff_Suc Suc_inject Suc_leI diff_is_0_eq diffs0_imp_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> m'<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">m'</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">m'</span> <span class="main">-</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">m'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>path_strategies <span class="free">P</span> <span class="main">$</span> <span class="skolem">m'</span><span class="main">,</span> path_strategies <span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m'</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">,</span> <span class="operator">OF</span> _ P<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> Suc.prems<span class="main">(</span>5<span class="main">)</span> dual_order.strict_trans enat_ord_simps<span class="main">(</span>2<span class="main">)</span> m'
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> m' path_strategies_monotone_Suc<span class="main">[</span><span class="operator">OF</span> P<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> r_trans trans_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="WellOrderedStrategy-path_strategies_eventually_constant"><span class="command">lemma</span></span> path_strategies_eventually_constant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lfinite <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> well_ordered_strategy"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="bound">n</span><span class="main">.</span> path_strategies <span class="free">P</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">=</span> path_strategies <span class="free">P</span> <span class="main">$</span> <span class="bound">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">σ_set</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ_set</span> <span class="main">=</span> lset <span class="main">(</span>path_strategies <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">∈</span> <span class="skolem">σ_set</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> σ_set_def path_strategies_def
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> lfinite_lmap lset_nth_member_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> σ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="main">∈</span> <span class="skolem">σ_set</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">τ</span><span class="main">.</span> <span class="main">(</span><span class="bound">τ</span><span class="main">,</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">-</span> Id <span class="main">⟹</span> <span class="bound">τ</span> <span class="main">∉</span> <span class="skolem">σ_set</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wfE_min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">-</span> Id"</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">σ_set</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"path_strategies <span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">σ'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> σ'<span class="main">(</span>1<span class="main">)</span> lset_lnth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">σ'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> σ_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_strategies <span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">=</span> path_strategies <span class="free">P</span> <span class="main">$</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"path_strategies <span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">≠</span> path_strategies <span class="free">P</span> <span class="main">$</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_imp_less_or_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> path_strategies_monotone <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>path_strategies <span class="free">P</span> <span class="main">$</span> <span class="skolem">m</span><span class="main">,</span> path_strategies <span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_small_llength<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>path_strategies <span class="free">P</span> <span class="main">$</span> <span class="skolem">m</span><span class="main">,</span> path_strategies <span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">-</span> Id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> σ'<span class="main">(</span>2<span class="main">)</span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_strategies <span class="free">P</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">∉</span> <span class="skolem">σ_set</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> σ_set_def path_strategies_def
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> lfinite_lmap lset_nth_member_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Eventually One Strategy›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The key lemma: Every path that stays in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and follows <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> well_ordered_strategy<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  eventually follows one strategy because the strategies are well-ordered and non-increasing
  along the path.
›</span></span>

<span class="keyword1" id="WellOrderedStrategy-path_eventually_conforms_to_σ_map_n"><span class="command">lemma</span></span> path_eventually_conforms_to_σ_map_n<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="free">P</span> well_ordered_strategy"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>ldropn <span class="bound">n</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span>path_strategies <span class="free">P</span> <span class="main">$</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lfinite <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"llength <span class="free">P</span> <span class="main">=</span> enat <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lfinite_llength_enat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ldropn <span class="skolem">n</span> <span class="free">P</span> <span class="main">=</span> LNil"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> path_conforms_LNil<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lfinite <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="bound">m</span> <span class="main">⟹</span> path_strategies <span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">=</span> path_strategies <span class="free">P</span> <span class="main">$</span> <span class="bound">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_strategies_eventually_constant assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted">well_ordered_strategy</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> ldropn <span class="skolem">n</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> lset <span class="skolem">P'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lset <span class="free">P</span> <span class="main">⊆</span> <span class="free">S</span>›</span></span> P'_def in_lset_ldropnD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> lset <span class="skolem">P'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">m</span> <span class="main">&lt;</span> llength <span class="skolem">P'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> in_lset_conv_lnth<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="free">P</span>›</span></span> infinite_small_llength<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?σ</span> <span class="skolem">v</span> <span class="main">=</span> choose <span class="skolem">v</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> well_ordered_strategy_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?σ</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>path_strategies <span class="free">P</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> path_strategies_def <span class="keyword1"><span class="command">using</span></span> infinite_small_llength<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="free">P</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?σ</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>path_strategies <span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">+</span> <span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="skolem">P'</span> well_ordered_strategy"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> path_conforms_with_strategy_drop<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> path_conforms_with_strategy_irrelevant_updates P'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹WellOrderedStrategies›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="WinningRegion">
<div class="head">
<h1>Theory WinningRegion</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Winning Regions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> WinningRegion
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <a href="#WinningStrategy">WinningStrategy</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Here we define winning regions of parity games.  The winning region for player <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> is the
  set of nodes from which <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> has a positional winning strategy.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> ParityGame <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">winning_region</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">{</span> <span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> <span class="keyword1">V</span><span class="main">.</span> <span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> strategy <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">σ</span> <span class="main">∧</span> winning_strategy <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">σ</span> <span class="bound">v</span> <span class="main">}</span>"</span></span>

<span class="keyword1" id="WinningRegion-winning_regionI"><span class="command">lemma</span></span> winning_regionI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> winning_region <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="WinningRegion-winning_region_in_V"><span class="command">lemma</span></span> winning_region_in_V <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"winning_region <span class="free">p</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="WinningRegion-winning_region_deadends"><span class="command">lemma</span></span> winning_region_deadends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"deadend <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> winning_region <span class="free">p</span><span class="main">**</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span><span class="main">**</span> σ_arbitrary <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms winning_strategy_on_deadends <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Paths in Winning Regions›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vmc_path<span class="main">)</span> paths_stay_in_winning_region<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ'<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ'</span>"</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ'</span> <span class="free">v0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> winning_region <span class="free">p</span> <span class="main">⟹</span> <span class="free">σ'</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">σ</span> <span class="bound">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">⊆</span> winning_region <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> lset <span class="free">P</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> winning_region <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms vmc_path_axioms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> llist_set_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>find <span class="skolem">P</span> <span class="skolem">v0</span><span class="main">)</span>
    <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">using</span></span> find.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> P_v0 σ'<span class="main">(</span>1<span class="main">)</span> find.prems<span class="main">(</span>2<span class="main">)</span> v0_V <span class="keyword1"><span class="command">unfolding</span></span> winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">P</span> <span class="skolem">x</span> <span class="skolem">v0</span><span class="main">)</span>
    <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">using</span></span> step.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lnull <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> P_lnull_ltl_LCons step.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path_no_deadend <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">using</span></span> P_no_deadend_v0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ'</span> w0"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ'</span> <span class="main">(</span><span class="free">σ'</span> <span class="skolem">v0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> strategy_extends_VVp local.step<span class="main">(</span>4<span class="main">)</span> step.prems<span class="main">(</span>2<span class="main">)</span> v0_no_deadend <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="skolem">v0</span> <span class="main">=</span> w0"</span></span> <span class="keyword1"><span class="command">using</span></span> v0_conforms <span class="quoted"><span class="quoted">‹<span class="skolem">v0</span> <span class="main">∈</span> VV <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ'</span> <span class="skolem">v0</span> <span class="main">=</span> <span class="free">σ</span> <span class="skolem">v0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> σ assms<span class="main">(</span>1<span class="main">)</span> step.prems<span class="main">(</span>2<span class="main">)</span> v0_V <span class="keyword1"><span class="command">unfolding</span></span> winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">∉</span> VV <span class="free">p</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> v0_V strategy_extends_VVpstar step<span class="main">(</span>4<span class="main">)</span> step.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> step.hyps<span class="main">(</span>3<span class="main">)</span> step<span class="main">(</span>4<span class="main">)</span> σ vmc_path_ltl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vmc_path<span class="main">)</span> path_hits_winning_region_is_winning<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ'<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> winning_region <span class="free">p</span> <span class="main">⟹</span> winning_strategy <span class="free">p</span> <span class="free">σ'</span> <span class="bound">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> winning_region <span class="free">p</span> <span class="main">⟹</span> <span class="free">σ'</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">σ</span> <span class="bound">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"lset <span class="free">P</span> <span class="main">∩</span> winning_region <span class="free">p</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">n</span> <span class="main">&lt;</span> llength <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">∈</span> winning_region <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lset_intersect_lnth<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> ldropn <span class="skolem">n</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> P'<span class="main">:</span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P'</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">using</span></span> vmc_path_ldropn n<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ'</span> <span class="main">(</span><span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ'<span class="main">(</span>2<span class="main">)</span> n<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P'</span> <span class="main">⊆</span> winning_region <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> P'.paths_stay_in_winning_region<span class="main">[</span><span class="operator">OF</span> σ'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> _ σ<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> lset <span class="skolem">P'</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">σ'</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="skolem">P'</span> <span class="free">σ'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_conforms_with_strategy_irrelevant_updates P'.P_conforms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> P'<span class="main">:</span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P'</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">$</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ'</span></span> <span class="keyword1"><span class="command">using</span></span> P'.conforms_to_another_strategy <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ'<span class="main">(</span>2<span class="main">)</span> n<span class="main">(</span>2<span class="main">)</span> P'.vmc_path_axioms winning_strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">using</span></span> winning_path_drop_add n<span class="main">(</span>1<span class="main">)</span> P_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Irrelevant Updates›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Updating a winning strategy outside of the winning region is irrelevant.›</span></span>

<span class="keyword1" id="WinningRegion-winning_strategy_updates"><span class="command">lemma</span></span> winning_strategy_updates<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> winning_region <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">→</span><span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="main">(</span><span class="free">σ</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="free">v0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="free">v0</span> <span class="free">p</span> <span class="main">(</span><span class="free">σ</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v'</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">∈</span> winning_region <span class="free">p</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="bound">v'</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="bound">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> lset <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v paths_stay_in_winning_region σ <span class="keyword1"><span class="command">unfolding</span></span> winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="skolem">P</span> <span class="free">σ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> P_conforms path_conforms_with_strategy_irrelevant' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conforms_to_another_strategy σ<span class="main">(</span>2<span class="main">)</span> winning_strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Extending Winning Regions›</span></span>

<span class="keyword1" id="WinningRegion-winning_region_extends_VVp"><span class="command">lemma</span></span> winning_region_extends_VVp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">→</span><span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> winning_region <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> winning_region <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="skolem">σ</span>"</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="skolem">σ</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> w <span class="keyword1"><span class="command">unfolding</span></span> winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span><span class="main">(</span><span class="free">v</span> <span class="main">:=</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> contra<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> winning_region <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="var">?σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_strategy_updates σ<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">v</span><span class="main">→</span><span class="free">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="var">?σ</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> winning_strategy_updates σ contra v strategy_extends_backwards_VVp
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span><span class="main">→</span><span class="free">w</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Unfortunately, we cannot prove the corresponding theorem <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>winning_region_extends_VVpstar›</span></span></span></span>
  for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"VV <span class="free"><span class="free">p</span></span><span class="main"><span class="main">**</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-nodes yet.
  First, we need to show that there exists a uniform winning strategy on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"winning_region <span class="free"><span class="free">p</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  We will prove <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>winning_region_extends_VVpstar›</span></span></span></span> as soon as we have this.
›</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context ParityGame›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="UniformStrategy">
<div class="head">
<h1>Theory UniformStrategy</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Uniform Strategies›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorems about how to get a uniform strategy given strategies for each node.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> UniformStrategy
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <a href="#AttractingStrategy">AttractingStrategy</a> <a href="#WinningStrategy">WinningStrategy</a> <a href="#WellOrderedStrategy">WellOrderedStrategy</a> <a href="#WinningRegion">WinningRegion</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> ParityGame <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A Uniform Attractor Strategy›</span></span>

<span class="keyword1" id="UniformStrategy-merge_attractor_strategies"><span class="command">lemma</span></span> merge_attractor_strategies<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> strategies_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> strategy <span class="free">p</span> <span class="bound">σ</span> <span class="main">∧</span> strategy_attracts_via <span class="free">p</span> <span class="bound">σ</span> <span class="bound">v</span> <span class="free">S</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> strategy <span class="free">p</span> <span class="bound">σ</span> <span class="main">∧</span> strategy_attracts <span class="free">p</span> <span class="bound">σ</span> <span class="free">S</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">good</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">good</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">{</span><span class="bound">σ</span><span class="main">.</span> strategy <span class="free">p</span> <span class="bound">σ</span> <span class="main">∧</span> strategy_attracts_via <span class="free">p</span> <span class="bound">σ</span> <span class="skolem">v</span> <span class="free">S</span> <span class="free">W</span> <span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">∈</span> <span class="skolem">good</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"well_order_on <span class="var">?G</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> well_order_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">interpret</span></span> WellOrderedStrategies <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">good</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">-</span> <span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">∈</span> <span class="skolem">good</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> good_def <span class="keyword1"><span class="command">using</span></span> strategies_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">∈</span> <span class="skolem">good</span> <span class="bound">v</span> <span class="main">⟹</span> strategy <span class="free">p</span> <span class="bound">σ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> good_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">σ</span> <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">→</span><span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">⟹</span> <span class="skolem">σ</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">∈</span> <span class="skolem">good</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="skolem">σ</span>"</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="skolem">σ</span> <span class="skolem">v</span> <span class="free">S</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> good_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="skolem">σ</span> <span class="skolem">w</span> <span class="free">S</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> strategy_attracts_via_successor v <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">∈</span> <span class="skolem">good</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> good_def <span class="keyword1"><span class="command">using</span></span> σ<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> r<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> S_W_no_deadends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span> <span class="main">⟹</span> <span class="main">¬</span>deadend <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strategy_attracts_via_no_deadends<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">W</span></span><span class="main">]</span> strategies_ex
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Diff_iff S_V rev_subsetD<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v0</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="skolem">v0</span> <span class="free">p</span> well_ordered_strategy"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted">well_ordered_strategy</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="skolem">P</span> <span class="free">S</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> contra<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>visits_via <span class="skolem">P</span> <span class="free">S</span> <span class="free">W</span>"</span></span>

      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vmc_path_lset_induction<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> base
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v0</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> contra visits_via_trivial <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">P</span> <span class="skolem">v0</span><span class="main">)</span>
        <span class="keyword1"><span class="command">interpret</span></span> vmc_path_no_deadend <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted">well_ordered_strategy</span> <span class="keyword1"><span class="command">using</span></span> step.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">v0</span> <span class="free">S</span> <span class="main">=</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>visits_via <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span> <span class="free">S</span> <span class="free">W</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> visits_via_LCons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ltl <span class="skolem">P</span>"</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">W</span></span> <span class="quoted"><span class="skolem">v0</span></span><span class="main">,</span> <span class="operator">folded</span> P_LCons<span class="main">]</span> step.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"w0 <span class="main">∉</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vmc_path.visits_via_trivial<span class="main">[</span><span class="operator">OF</span> vmc_path_ltl<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"w0 <span class="main">∈</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"well_ordered_strategy <span class="skolem">v0</span> <span class="main">=</span> w0"</span></span> <span class="keyword1"><span class="command">using</span></span> v0_conforms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"choose <span class="skolem">v0</span> <span class="skolem">v0</span> <span class="main">=</span> w0"</span></span> <span class="keyword1"><span class="command">using</span></span> step.hyps<span class="main">(</span>2<span class="main">)</span> well_ordered_strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="main">(</span>choose <span class="skolem">v0</span><span class="main">)</span> <span class="skolem">v0</span> <span class="free">S</span> <span class="free">W</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> choose_good good_def step.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> strategy_attracts_via_successor strategy_attracts_via_v0
                      choose_strategy step.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> v0_edge_w0 w0_V<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">metis</span> DiffD1 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> step.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> strategy_attracts_via_successor
                   strategy_attracts_via_v0 v0_edge_w0 w0_V<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> * ** <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lfinite <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lfinite <span class="skolem">P</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"deadend <span class="main">(</span>llast <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P_maximal P_not_null maximal_ends_on_deadend <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"llast <span class="skolem">P</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span>›</span></span> P_not_null <span class="quoted"><span class="quoted">‹lfinite <span class="skolem">P</span>›</span></span> lfinite_lset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> S_W_no_deadends <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>ldropn <span class="skolem">n</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">(</span>path_strategies <span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> path_eventually_conforms_to_σ_map_n<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span>›</span></span> P_valid P_conforms<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">σ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="main">=</span> path_strategies <span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> ldropn <span class="skolem">n</span> <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P'</span></span> <span class="quoted"><span class="quoted">"lhd <span class="skolem">P'</span>"</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">σ'</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> lfinite_ldropn lnull_imp_lfinite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="skolem">σ'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> σ'_def
        <span class="keyword1"><span class="command">using</span></span> path_strategies_strategy <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> infinite_small_llength
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="skolem">σ'</span> <span class="main">(</span>lhd <span class="skolem">P'</span><span class="main">)</span> <span class="free">S</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> lset_nth_member_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="main">∈</span> <span class="skolem">good</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> path_strategies_good σ'_def <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="skolem">σ'</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">S</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> good_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">using</span></span> P_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> infinite_small_llength<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P'</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">using</span></span> lset_ldropn_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">P</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> strategy_attracts_via_lset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> well_ordered_strategy_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A Uniform Winning Strategy›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Let <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> be the winning region of player <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  Then there exists a uniform winning strategy on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1" id="UniformStrategy-merge_winning_strategies"><span class="command">lemma</span></span> merge_winning_strategies<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> strategy <span class="free">p</span> <span class="bound">σ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> winning_region <span class="free">p</span><span class="main">.</span> winning_strategy <span class="free">p</span> <span class="bound">σ</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">good</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">good</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">{</span><span class="bound">σ</span><span class="main">.</span> strategy <span class="free">p</span> <span class="bound">σ</span> <span class="main">∧</span> winning_strategy <span class="free">p</span> <span class="bound">σ</span> <span class="skolem">v</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> winning_region <span class="free">p</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">∈</span> <span class="skolem">good</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"well_order_on <span class="var">?G</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> well_order_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> no_VVp_deadends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">v</span> <span class="main">∈</span> winning_region <span class="free">p</span><span class="main">;</span> <span class="bound">v</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span>deadend <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_winning_strategy_on_deadends <span class="keyword1"><span class="command">unfolding</span></span> winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">interpret</span></span> WellOrderedStrategies <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"winning_region <span class="free">p</span>"</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">good</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> winning_region <span class="free">p</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">∈</span> <span class="skolem">good</span> <span class="bound">v</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> good_def winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">∈</span> <span class="skolem">good</span> <span class="bound">v</span> <span class="main">⟹</span> strategy <span class="free">p</span> <span class="bound">σ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> good_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">σ</span> <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> winning_region <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">→</span><span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="free">p</span> <span class="main">⟹</span> <span class="skolem">σ</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">∈</span> <span class="skolem">good</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="skolem">σ</span>"</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="skolem">σ</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> good_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="skolem">σ</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_VVp_deadends <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> VV <span class="free">p</span>›</span></span> v<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> * ** <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> strategy_extends_VVp σ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> VV <span class="free">p</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> strategy_extends_VVpstar σ <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">→</span><span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">∈</span> <span class="skolem">good</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> good_def <span class="keyword1"><span class="command">using</span></span> σ<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> winning_region_in_V r<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v0</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">∈</span> winning_region <span class="free">p</span>"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="skolem">v0</span> <span class="free">p</span> well_ordered_strategy"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted">well_ordered_strategy</span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P</span> <span class="main">⊆</span> winning_region <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vmc_path_lset_induction_simple<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">P</span> <span class="skolem">v0</span><span class="main">)</span>
      <span class="keyword1"><span class="command">interpret</span></span> vmc_path_no_deadend <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted">well_ordered_strategy</span> <span class="keyword1"><span class="command">using</span></span> step.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"well_ordered_strategy <span class="skolem">v0</span> <span class="main">=</span> w0"</span></span> <span class="keyword1"><span class="command">using</span></span> v0_conforms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"choose <span class="skolem">v0</span> <span class="skolem">v0</span> <span class="main">=</span> w0"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> well_ordered_strategy_def<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"choose <span class="skolem">v0</span> <span class="main">∈</span> <span class="skolem">good</span> w0"</span></span> <span class="keyword1"><span class="command">using</span></span> strategies_continue choose_good step.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> good_def winning_region_def <span class="keyword1"><span class="command">using</span></span> w0_V <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v0</span> <span class="main">∈</span> winning_region <span class="free">p</span>›</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> contra<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>winning_path <span class="free">p</span> <span class="skolem">P</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lfinite <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lfinite <span class="skolem">P</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"deadend <span class="main">(</span>llast <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> maximal_ends_on_deadend <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"llast <span class="skolem">P</span> <span class="main">∈</span> winning_region <span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">⊆</span> winning_region <span class="free">p</span>›</span></span> P_not_null <span class="quoted"><span class="quoted">‹lfinite <span class="skolem">P</span>›</span></span> lfinite_lset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"llast <span class="skolem">P</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> contra paths_are_winning_for_one_player <span class="quoted"><span class="quoted">‹lfinite <span class="skolem">P</span>›</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> winning_path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> no_VVp_deadends <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="free">p</span> <span class="main">(</span>ldropn <span class="skolem">n</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">(</span>path_strategies <span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> path_eventually_conforms_to_σ_map_n<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">⊆</span> winning_region <span class="free">p</span>›</span></span> P_valid P_conforms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">σ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="main">=</span> path_strategies <span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> ldropn <span class="skolem">n</span> <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">interpret</span></span> P'<span class="main">:</span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P'</span></span> <span class="quoted"><span class="quoted">"lhd <span class="skolem">P'</span>"</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">σ'</span></span> <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def
          <span class="keyword1"><span class="command">using</span></span> lfinite_ldropn lnull_imp_lfinite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="skolem">σ'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> σ'_def
        <span class="keyword1"><span class="command">using</span></span> path_strategies_strategy <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">⊆</span> winning_region <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="skolem">σ'</span> <span class="main">(</span>lhd <span class="skolem">P'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">∈</span> winning_region <span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">⊆</span> winning_region <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> lset_nth_member_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="main">∈</span> <span class="skolem">good</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> path_strategies_good choose_good σ'_def <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">⊆</span> winning_region <span class="free">p</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="skolem">σ'</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> good_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">using</span></span> P_0 <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_small_llength lhd_ldropn<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="free">p</span> <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> winning_strategy_def
        <span class="keyword1"><span class="command">using</span></span> P'.vmc_path_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lfinite <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> P'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> contra winning_path_drop_add<span class="main">[</span><span class="operator">OF</span> P_valid<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> winning_strategy_def <span class="keyword1"><span class="command">using</span></span> well_ordered_strategy_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Extending Winning Regions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Now we are finally able to prove the complement of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>winning_region_extends_VVp›</span></span></span></span> for
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"VV <span class="free"><span class="free">p</span></span><span class="main"><span class="main">**</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> nodes, which was still missing.
›</span></span>

<span class="keyword1" id="UniformStrategy-winning_region_extends_VVpstar"><span class="command">lemma</span></span> winning_region_extends_VVpstar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">**</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="free">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∈</span> winning_region <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> winning_region <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="skolem">σ</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> winning_region <span class="free">p</span> <span class="main">⟹</span> winning_strategy <span class="free">p</span> <span class="skolem">σ</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> merge_winning_strategies <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="free">p</span> <span class="skolem">σ</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> strategy_extends_backwards_VVpstar<span class="main">[</span><span class="operator">OF</span> v σ<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> σ<span class="main">(</span>2<span class="main">)</span> w <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> winning_region_def <span class="keyword1"><span class="command">using</span></span> v σ<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹It immediately follows that removing a winning region cannot create new deadends.›</span></span>

<span class="keyword1" id="UniformStrategy-removing_winning_region_induces_no_deadends"><span class="command">lemma</span></span> removing_winning_region_induces_no_deadends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> winning_region <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> winning_region <span class="free">p</span><span class="main">.</span> <span class="free">v</span><span class="main">→</span><span class="bound">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms winning_region_extends_VVp winning_region_extends_VVpstar <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context ParityGame›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="AttractorStrategy">
<div class="head">
<h1>Theory AttractorStrategy</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Attractor Strategies›</span></span>

<span class="keyword1"><span class="command">theory</span></span> AttractorStrategy
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <a href="#Attractor">Attractor</a> <a href="#UniformStrategy">UniformStrategy</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This section proves that every attractor set has an attractor strategy.›</span></span>

<span class="keyword1"><span class="command">context</span></span> ParityGame <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="AttractorStrategy-strategy_attracts_extends_VVp"><span class="command">lemma</span></span> strategy_attracts_extends_VVp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="free">p</span> <span class="free">σ</span> <span class="free">S</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> directly_attracted <span class="free">p</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∉</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> strategy <span class="free">p</span> <span class="bound">σ</span> <span class="main">∧</span> strategy_attracts_via <span class="free">p</span> <span class="bound">σ</span> <span class="free">v0</span> <span class="main">(</span>insert <span class="free">v0</span> <span class="free">S</span><span class="main">)</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> v0<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span><span class="main">→</span><span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> directly_attracted_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> σ<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="skolem">w</span> <span class="free">S</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strategy_attracts_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="free">v0</span> <span class="main">:=</span> <span class="skolem">w</span><span class="main">)</span>"</span></span> <span class="comment1">― ‹Extend <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">σ</span></span><span class="antiquote">}</span></span> to the new node.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy <span class="free">p</span> <span class="var">?σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">v0</span><span class="main">→</span><span class="skolem">w</span>›</span></span> valid_strategy_updates <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="var">?σ</span> <span class="free">v0</span> <span class="main">(</span>insert <span class="free">v0</span> <span class="free">S</span><span class="main">)</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="free">v0</span> <span class="free">p</span> <span class="var">?σ</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="free">v0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v0</span><span class="main">→</span><span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path_no_deadend <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P''</span> <span class="main">=</span> ltl <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lhd <span class="skolem">P''</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v0<span class="main">(</span>1<span class="main">)</span> v0_conforms w0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P''</span> <span class="skolem">w</span> <span class="free">p</span> <span class="var">?σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vmc_path_ltl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> w0_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∉</span> <span class="free">S</span> <span class="main">-</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v0</span> <span class="main">∉</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"override_on <span class="main">(</span><span class="free">σ</span><span class="main">(</span><span class="free">v0</span> <span class="main">:=</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="free">σ</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="free">W</span><span class="main">)</span> <span class="main">=</span> <span class="var">?σ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> * fun_upd_def override_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="free">p</span> <span class="var">?σ</span> <span class="free">S</span> <span class="free">W</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> strategy_attracts_irrelevant_override<span class="main">[</span><span class="operator">OF</span> σ<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹strategy <span class="free">p</span> <span class="var">?σ</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="var">?σ</span> <span class="skolem">w</span> <span class="free">S</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strategy_attracts_def
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="skolem">P''</span> <span class="free">S</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strategy_attracts_via_def
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹vmc_path <span class="free">G</span> <span class="skolem">P''</span> <span class="skolem">w</span> <span class="free">p</span> <span class="var">?σ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="skolem">P</span> <span class="main">(</span>insert <span class="free">v0</span> <span class="free">S</span><span class="main">)</span> <span class="free">W</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> visits_via_LCons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ltl <span class="skolem">P</span>"</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">W</span></span> <span class="quoted"><span class="free">v0</span></span><span class="main">]</span> P_LCons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="AttractorStrategy-strategy_attracts_extends_VVpstar"><span class="command">lemma</span></span> strategy_attracts_extends_VVpstar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="free">p</span> <span class="free">σ</span> <span class="free">S</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∉</span> VV <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> directly_attracted <span class="free">p</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="free">p</span> <span class="free">σ</span> <span class="free">v0</span> <span class="main">(</span>insert <span class="free">v0</span> <span class="free">S</span><span class="main">)</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="free">v0</span> <span class="free">p</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="free">v0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v0<span class="main">(</span>2<span class="main">)</span> directly_attracted_contains_no_deadends <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path_no_deadend <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="main">(</span>ltl <span class="skolem">P</span><span class="main">)</span> <span class="free">S</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vmc_path.strategy_attractsE<span class="main">[</span><span class="operator">OF</span> vmc_path_ltl σ<span class="main">]</span> v0 directly_attracted_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"visits_via <span class="skolem">P</span> <span class="main">(</span>insert <span class="free">v0</span> <span class="free">S</span><span class="main">)</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> visits_via_LCons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ltl <span class="skolem">P</span>"</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">W</span></span> <span class="quoted"><span class="free">v0</span></span><span class="main">]</span> P_LCons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="AttractorStrategy-attractor_has_strategy_single"><span class="command">lemma</span></span> attractor_has_strategy_single<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v0_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> attractor <span class="free">p</span> <span class="free">W</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> strategy <span class="free">p</span> <span class="bound">σ</span> <span class="main">∧</span> strategy_attracts_via <span class="free">p</span> <span class="bound">σ</span> <span class="free">v0</span> <span class="var">?A</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> attractor_set_induction<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">S</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> strategy <span class="free">p</span> <span class="bound">σ</span> <span class="main">∧</span> strategy_attracts_via <span class="free">p</span> <span class="bound">σ</span> <span class="skolem">v0</span> <span class="main">{}</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strategy_attracts_via_trivial valid_arbitrary_strategy <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">∈</span> directly_attracted <span class="free">p</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">∉</span> <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> step.hyps<span class="main">(</span>1<span class="main">)</span> step.hyps<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> strategy <span class="free">p</span> <span class="bound">σ</span> <span class="main">∧</span> strategy_attracts <span class="free">p</span> <span class="bound">σ</span> <span class="skolem">S</span> <span class="free">W</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> merge_attractor_strategies <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> *
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> strategy <span class="free">p</span> <span class="bound">σ</span> <span class="main">∧</span> strategy_attracts_via <span class="free">p</span> <span class="bound">σ</span> <span class="skolem">v0</span> <span class="main">(</span>insert <span class="skolem">v0</span> <span class="skolem">S</span><span class="main">)</span> <span class="free">W</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> strategy_attracts_extends_VVp strategy_attracts_extends_VVpstar <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> step.prems step.hyps<span class="main">(</span>2<span class="main">)</span>
    attractor_strategy_on_extends<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">v0</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">v0</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="free">W</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">∪</span> directly_attracted <span class="free">p</span> <span class="skolem">S</span>"</span></span><span class="main">]</span>
    attractor_strategy_on_extends<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">v0</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span>"</span></span>           <span class="quoted"><span class="free">W</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">∪</span> directly_attracted <span class="free">p</span> <span class="skolem">S</span>"</span></span><span class="main">]</span>
    attractor_strategy_on_extends<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">v0</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span>          <span class="quoted"><span class="free">W</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">∪</span> directly_attracted <span class="free">p</span> <span class="skolem">S</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>union <span class="skolem">M</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="skolem">M</span> <span class="main">∧</span> <span class="skolem">v0</span> <span class="main">∈</span> <span class="bound">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Union_upper attractor_strategy_on_extends union.hyps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Existence›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Prove that every attractor set has an attractor strategy.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> attractor_has_strategy<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> strategy <span class="free">p</span> <span class="bound">σ</span> <span class="main">∧</span> strategy_attracts <span class="free">p</span> <span class="bound">σ</span> <span class="main">(</span>attractor <span class="free">p</span> <span class="free">W</span><span class="main">)</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"attractor <span class="free">p</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> attractor_in_V<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="var">?A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> strategy <span class="free">p</span> <span class="bound">σ</span> <span class="main">∧</span> strategy_attracts_via <span class="free">p</span> <span class="bound">σ</span> <span class="bound">v</span> <span class="var">?A</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> attractor_has_strategy_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> merge_attractor_strategies <span class="quoted"><span class="quoted">‹<span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context ParityGame›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PositionalDeterminacy">
<div class="head">
<h1>Theory PositionalDeterminacy</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Positional Determinacy of Parity Games›</span></span>

<span class="keyword1"><span class="command">theory</span></span> PositionalDeterminacy
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <a href="#AttractorStrategy">AttractorStrategy</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> ParityGame <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Induction Step›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The proof of positional determinacy is by induction over the size of the finite set
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">ω</span></span> <span class="main"><span class="main">`</span></span> <span class="keyword1"><span class="keyword1">V</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the set of priorities.  The following lemma is the induction step.

  For now, we assume there are no deadends in the graph.  Later we will get rid of this assumption.
›</span></span>

<span class="keyword1" id="PositionalDeterminacy-positional_strategy_induction_step"><span class="command">lemma</span></span> positional_strategy_induction_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> no_deadends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">⟹</span> <span class="main">¬</span>deadend <span class="bound">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">G</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> ParityGame_scheme<span class="main">)</span> <span class="bound">v</span><span class="main">.</span>
      <span class="main">⟦</span> card <span class="main">(</span><span class="keyword1">ω</span><span class="hidden">⇘</span><sub><span class="bound">G</span></sub><span class="hidden">⇙</span> <span class="main">`</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="bound">G</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="keyword1">ω</span> <span class="main">`</span> <span class="keyword1">V</span><span class="main">)</span><span class="main">;</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="bound">G</span></sub><span class="hidden">⇙</span><span class="main">;</span>
        ParityGame <span class="bound">G</span><span class="main">;</span>
        <span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="bound">G</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span> <span class="main">¬</span>Digraph.deadend <span class="bound">G</span> <span class="bound">v</span>  <span class="main">⟧</span>
      <span class="main">⟹</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> ParityGame.winning_region <span class="bound">G</span> <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="free">v</span> <span class="main">∈</span> winning_region <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First, we determine the minimum priority and the player who likes it.›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">min_prio</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_prio</span> <span class="main">=</span> Min <span class="main">(</span><span class="keyword1">ω</span> <span class="main">`</span> <span class="keyword1">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> winning_priority <span class="bound">p</span> <span class="skolem">min_prio</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"winning_priority <span class="skolem">p</span> <span class="skolem">min_prio</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Then we define the tentative winning region of player <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">p</span></span><span class="main"><span class="main">**</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
    The rest of the proof is to show that this is the complete winning region.
›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">W1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W1</span> <span class="main">=</span> winning_region <span class="skolem">p</span><span class="main">**</span>"</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For this, we define several more sets of nodes.
    First, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>U›</span></span></span></span> is the tentative winning region of player <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">W1</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">K</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">∩</span> <span class="main">(</span><span class="keyword1">ω</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">min_prio</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">V'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">-</span> attractor <span class="skolem">p</span> <span class="skolem">K</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G'</span> <span class="main">=</span> subgame <span class="skolem">V'</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> G'<span class="main">:</span> ParityGame <span class="quoted"><span class="skolem">G'</span></span> <span class="keyword1"><span class="command">using</span></span> subgame_ParityGame <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> U_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">⟷</span> <span class="bound">v</span> <span class="main">∉</span> winning_region <span class="skolem">p</span><span class="main">**</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> U_def W1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> U_def V'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">E</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">⊆</span> <span class="keyword1">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ω</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="keyword1">ω</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subgame_ω<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G'.VV <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">V'</span> <span class="main">∩</span> VV <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">using</span></span> subgame_VV <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> V_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">V</span> <span class="main">=</span> attractor <span class="skolem">p</span> <span class="skolem">K</span> <span class="main">∪</span> <span class="skolem">V'</span> <span class="main">∪</span> <span class="skolem">W1</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">V</span> <span class="main">⊆</span> attractor <span class="skolem">p</span> <span class="skolem">K</span> <span class="main">∪</span> <span class="skolem">V'</span> <span class="main">∪</span> <span class="skolem">W1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> V'_def U_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"attractor <span class="skolem">p</span> <span class="skolem">K</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> attractor_in_V<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">K</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> K_def U_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> W1_def winning_region_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> G'_no_deadends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span> <span class="main">¬</span>G'.deadend <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">-</span> attractor <span class="skolem">p</span> <span class="skolem">K</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>›</span></span> V'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">.</span> <span class="skolem">v</span><span class="main">→</span><span class="bound">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> removing_winning_region_induces_no_deadends<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">**</span>"</span></span><span class="main">]</span> no_deadends U_equiv U_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="main">⟦</span> <span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span><span class="main">**</span><span class="main">;</span> <span class="skolem">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * U_equiv winning_region_extends_VVp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> <span class="skolem">V'</span><span class="main">.</span> <span class="skolem">v</span><span class="main">→</span><span class="bound">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> U_equiv winning_region_extends_VVp removing_attractor_induces_no_deadends V'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>G'.deadend <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    By definition of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">W1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, we obtain a winning strategy on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">W1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for player <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">p</span></span><span class="main"><span class="main">**</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σW1</span></span> <span class="keyword2"><span class="keyword">where</span></span> σW1<span class="main">:</span>
    <span class="quoted"><span class="quoted">"strategy <span class="skolem">p</span><span class="main">**</span> <span class="skolem">σW1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">W1</span> <span class="main">⟹</span> winning_strategy <span class="skolem">p</span><span class="main">**</span> <span class="skolem">σW1</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> W1_def <span class="keyword1"><span class="command">using</span></span> merge_winning_strategies <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>"</span></span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Apply the induction hypothesis to get the winning strategy for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">v</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">G'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
    <span class="keyword1"><span class="command">have</span></span> G'_winning_strategy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">∈</span> G'.winning_region <span class="bound">p</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="keyword1">ω</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">`</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="keyword1">ω</span> <span class="main">`</span> <span class="keyword1">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_prio</span> <span class="main">∈</span> <span class="keyword1">ω</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">`</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ω</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">min_prio</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">ω</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">min_prio</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">ω</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="keyword1">ω</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> V'_def K_def attractor_set_base <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>›</span></span> v<span class="main">(</span>1<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffD1 DiffD2 IntI contra_subsetD<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_prio</span> <span class="main">∉</span> <span class="keyword1">ω</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">`</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_prio</span> <span class="main">∈</span> <span class="keyword1">ω</span> <span class="main">`</span> <span class="keyword1">V</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> min_prio_def <span class="keyword1"><span class="command">using</span></span> priorities_finite Min_in assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ω</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">`</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">⊆</span> <span class="keyword1">ω</span> <span class="main">`</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> priorities_finite psubsetI psubset_card_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">G'</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>›</span></span> G'_no_deadends G'.ParityGame_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
      It turns out the winning region of player <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">p</span></span><span class="main"><span class="main">**</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is empty, so we have a strategy
      for player <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> G'.winning_region <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"G'.strategy <span class="skolem">p'</span> <span class="skolem">σ</span>"</span></span> <span class="quoted"><span class="quoted">"G'.winning_strategy <span class="skolem">p'</span> <span class="skolem">σ</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> G'_winning_strategy <span class="keyword1"><span class="command">unfolding</span></span> G'.winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">≠</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'.winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">**</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">p'</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> p' <span class="keyword1"><span class="command">have</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"G'.strategy <span class="skolem">p</span><span class="main">**</span> <span class="skolem">σ</span>"</span></span> <span class="quoted"><span class="quoted">"G'.winning_strategy <span class="skolem">p</span><span class="main">**</span> <span class="skolem">σ</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> winning_region <span class="skolem">p</span><span class="main">**</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">σ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="main">=</span> override_on <span class="main">(</span>override_on σ_arbitrary <span class="skolem">σW1</span> <span class="skolem">W1</span><span class="main">)</span> <span class="skolem">σ</span> <span class="skolem">V'</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"strategy <span class="skolem">p</span><span class="main">**</span> <span class="skolem">σ'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> valid_strategy_updates_set_strong valid_arbitrary_strategy σW1<span class="main">(</span>1<span class="main">)</span>
                valid_strategy_supergame σ<span class="main">(</span>1<span class="main">)</span> G'_no_deadends <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>›</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="skolem">p</span><span class="main">**</span> <span class="skolem">σ'</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> winning_strategyI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="skolem">v</span> <span class="skolem">p</span><span class="main">**</span> <span class="skolem">σ'</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">**</span>"</span></span> <span class="quoted"><span class="skolem">σ'</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>winning_path <span class="skolem">p</span><span class="main">**</span> <span class="skolem">P</span>"</span></span>
          <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
            First we show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> stays in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">V'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, because if it stays in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">V'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
            then it conforms to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, so it must be winning for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">p</span></span><span class="main"><span class="main">**</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vmc_path_lset_induction_closed_subset<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span><span class="main">**</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> ParityGame.VV <span class="main">(</span>subgame <span class="skolem">V'</span><span class="main">)</span> <span class="skolem">p</span><span class="main">**</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>G'.deadend <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G'_no_deadends <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> subgame_strategy_stays_in_subgame p'<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">**</span>›</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span> <span class="main">∪</span> <span class="skolem">W1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> σ'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span><span class="main">**</span><span class="main">**</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">→</span><span class="skolem">w</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="skolem">V'</span> <span class="main">∪</span> <span class="skolem">W1</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∉</span> <span class="skolem">V'</span> <span class="main">∪</span> <span class="skolem">W1</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> attractor <span class="skolem">p</span> <span class="skolem">K</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> V_decomp <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">→</span><span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> attractor <span class="skolem">p</span> <span class="skolem">K</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span><span class="main">**</span><span class="main">**</span>›</span></span> attractor_set_VVp <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">→</span><span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span> V'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">W1</span> <span class="main">⟹</span> <span class="skolem">σW1</span> <span class="bound">v</span> <span class="main">=</span> <span class="skolem">σ'</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> σ'_def V'_def U_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P</span> <span class="main">∩</span> <span class="skolem">W1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> path_hits_winning_region_is_winning σW1 <span class="quoted"><span class="quoted">‹<span class="main">¬</span>winning_path <span class="skolem">p</span><span class="main">**</span> <span class="skolem">P</span>›</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> W1_def
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This concludes the proof of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem"><span class="skolem">P</span></span> <span class="main"><span class="main">⊆</span></span> <span class="skolem"><span class="skolem">V'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"G'.valid_path <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgame_valid_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G'.maximal_path <span class="skolem">P</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="skolem">V'</span>›</span></span> subgame_maximal_path <span class="quoted"><span class="quoted">‹<span class="skolem">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G'.path_conforms_with_strategy <span class="skolem">p</span><span class="main">**</span> <span class="skolem">P</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G'.path_conforms_with_strategy <span class="skolem">p</span><span class="main">**</span> <span class="skolem">P</span> <span class="skolem">σ'</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> subgame_path_conforms_with_strategy <span class="quoted"><span class="quoted">‹<span class="skolem">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="skolem">V'</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> lset <span class="skolem">P</span> <span class="main">⟹</span> <span class="skolem">σ'</span> <span class="bound">v</span> <span class="main">=</span> <span class="skolem">σ</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="skolem">V'</span>›</span></span> σ'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> G'.path_conforms_with_strategy_irrelevant_updates <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G'.winning_path <span class="skolem">p</span><span class="main">**</span> <span class="skolem">P</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> σ<span class="main">(</span>2<span class="main">)</span> G'.winning_strategy_def G'.valid_maximal_conforming_path_0 P_0 P_not_null
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G'.VV <span class="skolem">p</span><span class="main">**</span><span class="main">**</span> <span class="main">⊆</span> VV <span class="skolem">p</span><span class="main">**</span><span class="main">**</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgame_VV_subset G'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> G'.winning_path_supergame<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">**</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">ω</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="keyword1">ω</span>›</span></span>
                  <span class="quoted"><span class="quoted">‹<span class="main">¬</span>winning_path <span class="skolem">p</span><span class="main">**</span> <span class="skolem">P</span>›</span></span> ParityGame_axioms
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">W1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> W1_def winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> U_def V'_def <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> recursion <span class="main">=</span> this

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We compose a winning strategy for player <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">V</span></span> <span class="main"><span class="main">-</span></span> <span class="skolem"><span class="skolem">W1</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> out of three pieces.
›</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    First, if we happen to land in the attractor region of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">K</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, we follow the attractor
    strategy.  This is good because the priority of the nodes in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">K</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is good for
    player <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, so he likes to go there.›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ1</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> σ1<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="skolem">p</span> <span class="skolem">σ1</span>"</span></span>
              <span class="quoted"><span class="quoted">"strategy_attracts <span class="skolem">p</span> <span class="skolem">σ1</span> <span class="main">(</span>attractor <span class="skolem">p</span> <span class="skolem">K</span><span class="main">)</span> <span class="skolem">K</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> attractor_has_strategy<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">K</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> K_def U_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next, on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">G'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> we follow the winning strategy whose existence we proved earlier.›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G'.winning_region <span class="skolem">p</span> <span class="main">=</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> recursion <span class="keyword1"><span class="command">unfolding</span></span> G'.winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ2</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> σ2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span> G'.strategy <span class="skolem">p</span> <span class="skolem">σ2</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span> G'.winning_strategy <span class="skolem">p</span> <span class="skolem">σ2</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> G'.merge_winning_strategies <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    As a last option we choose an arbitrary successor but avoid entering <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">W1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
    In particular, this defines the strategy on the set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">K</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">succ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">succ</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">w</span><span class="main">.</span> <span class="skolem">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">W1</span> <span class="main">∨</span> <span class="bound">w</span> <span class="main">∉</span> <span class="skolem">W1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Compose the three pieces.›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">=</span> override_on <span class="main">(</span>override_on <span class="skolem">succ</span> <span class="skolem">σ2</span> <span class="skolem">V'</span><span class="main">)</span> <span class="skolem">σ1</span> <span class="main">(</span>attractor <span class="skolem">p</span> <span class="skolem">K</span> <span class="main">-</span> <span class="skolem">K</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"attractor <span class="skolem">p</span> <span class="skolem">K</span> <span class="main">∩</span> <span class="skolem">W1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"attractor <span class="skolem">p</span> <span class="skolem">K</span> <span class="main">∩</span> <span class="skolem">W1</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> attractor <span class="skolem">p</span> <span class="skolem">K</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">W1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> W1_def winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vmc2_path <span class="free">G</span> <span class="skolem">P</span> <span class="skolem">v</span> <span class="skolem">p</span> <span class="skolem">σ1</span> <span class="skolem">σW1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> strategy_conforming_path_exists σW1<span class="main">(</span>1<span class="main">)</span> σ1<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc2_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">σ1</span></span> <span class="quoted"><span class="skolem">σW1</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy_attracts_via <span class="skolem">p</span> <span class="skolem">σ1</span> <span class="skolem">v</span> <span class="main">(</span>attractor <span class="skolem">p</span> <span class="skolem">K</span><span class="main">)</span> <span class="skolem">K</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v<span class="main">(</span>1<span class="main">)</span> σ1<span class="main">(</span>2<span class="main">)</span> strategy_attracts_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P</span> <span class="main">∩</span> <span class="skolem">K</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> strategy_attracts_viaE visits_via_visits <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="skolem">W1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> K_def U_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> W1_def <span class="keyword1"><span class="command">using</span></span> comp.paths_stay_in_winning_region σW1 v<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹On specific sets, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> behaves like one of the three pieces.›</span></span>
  <span class="keyword1"><span class="command">have</span></span> σ_σ1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> attractor <span class="skolem">p</span> <span class="skolem">K</span> <span class="main">-</span> <span class="skolem">K</span> <span class="main">⟹</span> <span class="skolem">σ</span> <span class="bound">v</span> <span class="main">=</span> <span class="skolem">σ1</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> σ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> σ_σ2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V'</span> <span class="main">⟹</span> <span class="skolem">σ</span> <span class="bound">v</span> <span class="main">=</span> <span class="skolem">σ2</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> σ_def V'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> σ_K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">K</span> <span class="main">∪</span> <span class="skolem">W1</span> <span class="main">⟹</span> <span class="skolem">σ</span> <span class="bound">v</span> <span class="main">=</span> <span class="skolem">succ</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">K</span> <span class="main">∪</span> <span class="skolem">W1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> V'_def U_def <span class="keyword1"><span class="command">using</span></span> attractor_set_base <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> v <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">succ</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> σ_def U_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹attractor <span class="skolem">p</span> <span class="skolem">K</span> <span class="main">∩</span> <span class="skolem">W1</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Diff_iff IntI UnE override_on_def override_on_emptyset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">succ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> succeeds in avoiding entering <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">W1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_deadends <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">W1</span> <span class="main">∨</span> <span class="bound">w</span> <span class="main">∉</span> <span class="skolem">W1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">W1</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> no_deadends <span class="quoted"><span class="quoted">‹<span class="main">¬</span>deadend <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> <span class="skolem">W1</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">W1</span> <span class="main">∨</span> <span class="bound">w</span> <span class="main">∉</span> <span class="skolem">W1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">⟹</span> winning_strategy <span class="skolem">p</span><span class="main">**</span> <span class="skolem">σW1</span> <span class="bound">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σW1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="skolem">p</span><span class="main">**</span> <span class="skolem">σW1</span> <span class="skolem">v</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> strategy_extends_backwards_VVpstar σW1<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">W1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> W1_def winning_region_def <span class="keyword1"><span class="command">using</span></span> σW1<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>deadend <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∉</span> <span class="skolem">W1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">→</span><span class="skolem">succ</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">W1</span> <span class="main">∨</span> <span class="skolem">succ</span> <span class="skolem">v</span> <span class="main">∉</span> <span class="skolem">W1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> succ_def
      <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">W1</span> <span class="main">∨</span> <span class="bound">w</span> <span class="main">∉</span> <span class="skolem">W1</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> succ_works <span class="main">=</span> this

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy <span class="skolem">p</span> <span class="skolem">σ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> attractor <span class="skolem">p</span> <span class="skolem">K</span> <span class="main">-</span> <span class="skolem">K</span> <span class="main">⟹</span> <span class="skolem">v</span><span class="main">→</span><span class="skolem">σ</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ_σ1 σ1<span class="main">(</span>1<span class="main">)</span> v <span class="keyword1"><span class="command">unfolding</span></span> strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span> <span class="main">⟹</span> <span class="skolem">v</span><span class="main">→</span><span class="skolem">σ</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> G'.VV <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹G'.VV <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">V'</span> <span class="main">∩</span> VV <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>Digraph.deadend <span class="skolem">G'</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G'_no_deadends <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="skolem">σ2</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ2<span class="main">(</span>1<span class="main">)</span> G'.strategy_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">σ2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">→</span><span class="skolem">σ</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">E</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">⊆</span> <span class="keyword1">E</span>›</span></span> σ_σ2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subsetCE<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">K</span> <span class="main">∪</span> <span class="skolem">W1</span> <span class="main">⟹</span> <span class="skolem">v</span><span class="main">→</span><span class="skolem">σ</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> succ_works<span class="main">(</span>1<span class="main">)</span> v σ_K <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">→</span><span class="skolem">σ</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> V_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> σ_attracts<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="skolem">p</span> <span class="skolem">σ</span> <span class="main">(</span>attractor <span class="skolem">p</span> <span class="skolem">K</span><span class="main">)</span> <span class="skolem">K</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="skolem">p</span> <span class="main">(</span>override_on <span class="skolem">σ</span> <span class="skolem">σ1</span> <span class="main">(</span>attractor <span class="skolem">p</span> <span class="skolem">K</span> <span class="main">-</span> <span class="skolem">K</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>attractor <span class="skolem">p</span> <span class="skolem">K</span><span class="main">)</span> <span class="skolem">K</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> strategy_attracts_irrelevant_override σ1 <span class="quoted"><span class="quoted">‹strategy <span class="skolem">p</span> <span class="skolem">σ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">=</span> override_on <span class="skolem">σ</span> <span class="skolem">σ1</span> <span class="main">(</span>attractor <span class="skolem">p</span> <span class="skolem">K</span> <span class="main">-</span> <span class="skolem">K</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> override_on_def σ_σ1<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a winning strategy on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">V</span></span> <span class="main"><span class="main">-</span></span> <span class="skolem"><span class="skolem">W1</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">W1</span><span class="main">.</span> winning_strategy <span class="skolem">p</span> <span class="skolem">σ</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI winning_strategyI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">W1</span>"</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="skolem">v</span> <span class="skolem">p</span> <span class="skolem">σ</span>"</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">σ</span></span> <span class="keyword1"><span class="command">using</span></span> P<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">W1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vmc_path_lset_induction_closed_subset<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">W1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">W1</span> <span class="main">∪</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">W1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹strategy <span class="skolem">p</span> <span class="skolem">σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>deadend <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span>›</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> strategy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> <span class="skolem">K</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> succ_works<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">W1</span>›</span></span> σ_K <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> attractor <span class="skolem">p</span> <span class="skolem">K</span> <span class="main">-</span> <span class="skolem">K</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> attractor <span class="skolem">p</span> <span class="skolem">K</span> <span class="main">-</span> <span class="skolem">K</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">v</span> <span class="main">∈</span> attractor <span class="skolem">p</span> <span class="skolem">K</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> attracted_strategy_step <span class="quoted"><span class="quoted">‹strategy <span class="skolem">p</span> <span class="skolem">σ</span>›</span></span> σ_attracts <span class="quoted"><span class="quoted">‹<span class="main">¬</span>deadend <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span>›</span></span>
                  attractor_set_base
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">W1</span>›</span></span> <span class="quoted"><span class="quoted">‹attractor <span class="skolem">p</span> <span class="skolem">K</span> <span class="main">∩</span> <span class="skolem">W1</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ2</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> G'.valid_strategy_in_V<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">σ2</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">v</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>G'.deadend <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G'_no_deadends <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"G'.strategy <span class="skolem">p</span> <span class="skolem">σ2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ2<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> G'.VV <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹G'.VV <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">V'</span> <span class="main">∩</span> VV <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span> σ_σ2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">W1</span>›</span></span> V'_def U_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">W1</span>›</span></span> V_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">W1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span><span class="main">**</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">→</span><span class="skolem">w</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">W1</span> <span class="main">∪</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="skolem">W1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">→</span><span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">σW1</span><span class="main">(</span><span class="skolem">v</span> <span class="main">:=</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="skolem">p</span><span class="main">**</span> <span class="skolem">σW1</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="skolem">W1</span>›</span></span> σW1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> strategy <span class="skolem">p</span><span class="main">**</span> <span class="bound">σ</span> <span class="main">∧</span> winning_strategy <span class="skolem">p</span><span class="main">**</span> <span class="bound">σ</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">W1</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> W1_def winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="skolem">p</span><span class="main">**</span> <span class="var">?σ</span> <span class="skolem">w</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> winning_strategy_updates<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">**</span>"</span></span> <span class="quoted"><span class="skolem">σW1</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> σW1<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">→</span><span class="skolem">w</span>›</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy <span class="skolem">p</span><span class="main">**</span> <span class="var">?σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">→</span><span class="skolem">w</span>›</span></span> σW1<span class="main">(</span>1<span class="main">)</span> valid_strategy_updates <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="skolem">p</span><span class="main">**</span> <span class="var">?σ</span> <span class="skolem">v</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> strategy_extends_backwards_VVp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">**</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span>
                <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span><span class="main">**</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">→</span><span class="skolem">w</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">W1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> W1_def winning_region_def
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹strategy <span class="skolem">p</span><span class="main">**</span> <span class="var">?σ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">W1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">W1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> P<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This concludes the proof of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem"><span class="skolem">P</span></span> <span class="main"><span class="main">⊆</span></span> <span class="keyword1"><span class="keyword1">V</span></span> <span class="main"><span class="main">-</span></span> <span class="skolem"><span class="skolem">W1</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P</span> <span class="main">⊆</span> attractor <span class="skolem">p</span> <span class="skolem">K</span> <span class="main">∪</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> V_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lfinite <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> no_deadends lfinite_lset maximal_ends_on_deadend<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P</span></span><span class="main">]</span> P_maximal P_not_null lset_P_V
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
      Every <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-conforming path starting in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">V</span></span> <span class="main"><span class="main">-</span></span> <span class="skolem"><span class="skolem">W1</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is winning.
      We distinguish two cases:
      \begin{enumerate}
        \item <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> eventually stays in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">V'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
          Then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is winning because <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">σ2</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is winning.
        \item <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> visits <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">K</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> infinitely often.
          Then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is winning because of the priority of the nodes in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">K</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
      \end{enumerate}
›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="skolem">p</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> lset <span class="main">(</span>ldropn <span class="bound">n</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">V'</span>"</span></span>
      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The first case: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> eventually stays in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">V'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ldropn <span class="skolem">n</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> ldropn <span class="skolem">n</span> <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P'</span> <span class="main">⊆</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">interpret</span></span> vmc_path'<span class="main">:</span> vmc_path <span class="quoted"><span class="skolem">G'</span></span> <span class="quoted"><span class="skolem">P'</span></span> <span class="quoted"><span class="quoted">"lhd <span class="skolem">P'</span>"</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">σ2</span></span> <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lnull <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> lfinite_ldropn lnull_imp_lfinite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"G'.valid_path <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> subgame_valid_path <span class="quoted"><span class="quoted">‹lset <span class="skolem">P'</span> <span class="main">⊆</span> <span class="skolem">V'</span>›</span></span> G'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"G'.maximal_path <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maximal_path <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> subgame_maximal_path <span class="quoted"><span class="quoted">‹lset <span class="skolem">P'</span> <span class="main">⊆</span> <span class="skolem">V'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> G'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"G'.path_conforms_with_strategy <span class="skolem">p</span> <span class="skolem">P'</span> <span class="skolem">σ2</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="skolem">p</span> <span class="skolem">P'</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"path_conforms_with_strategy <span class="skolem">p</span> <span class="skolem">P'</span> <span class="skolem">σ2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> path_conforms_with_strategy_irrelevant_updates <span class="quoted"><span class="quoted">‹lset <span class="skolem">P'</span> <span class="main">⊆</span> <span class="skolem">V'</span>›</span></span> σ_σ2
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> subgame_path_conforms_with_strategy <span class="quoted"><span class="quoted">‹lset <span class="skolem">P'</span> <span class="main">⊆</span> <span class="skolem">V'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> G'_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G'.winning_strategy <span class="skolem">p</span> <span class="skolem">σ2</span> <span class="main">(</span>lhd <span class="skolem">P'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lset <span class="skolem">P'</span> <span class="main">⊆</span> <span class="skolem">V'</span>›</span></span> vmc_path'.P_not_null σ2<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lhd <span class="skolem">P'</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>›</span></span> llist.set_sel<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"G'.winning_path <span class="skolem">p</span> <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G'.winning_strategy_def vmc_path'.vmc_path_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G'.VV <span class="skolem">p</span><span class="main">**</span> <span class="main">⊆</span> VV <span class="skolem">p</span><span class="main">**</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">using</span></span> subgame_VV <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="skolem">p</span> <span class="skolem">P'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> G'.winning_path_supergame<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">P'</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">ω</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="keyword1">ω</span>›</span></span> ParityGame_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> P'_def
        <span class="keyword1"><span class="command">using</span></span> infinite_small_llength<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span><span class="main">]</span>
              winning_path_drop_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> P_valid
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> lset <span class="main">(</span>ldropn <span class="bound">n</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">V'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The second case: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> visits <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">K</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> infinitely often.
        Then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">min_prio</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> occurs infinitely often on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_prio</span> <span class="main">∈</span> path_inf_priorities <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> path_inf_priorities_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> CollectI allI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k1</span></span> <span class="keyword2"><span class="keyword">where</span></span> k1<span class="main">:</span> <span class="quoted"><span class="quoted">"ldropn <span class="skolem">n</span> <span class="skolem">P</span> <span class="main">$</span> <span class="skolem">k1</span> <span class="main">∉</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lset_lnth subsetI<span class="main">)</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">+</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"ldropn <span class="skolem">k2</span> <span class="skolem">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="skolem">k2</span>"</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">σ</span></span>
          <span class="keyword1"><span class="command">using</span></span> vmc_path_ldropn infinite_small_llength <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="skolem">k2</span> <span class="main">∉</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k2_def
          <span class="keyword1"><span class="command">using</span></span> k1 lnth_ldropn infinite_small_llength<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="skolem">k2</span> <span class="main">∈</span> attractor <span class="skolem">p</span> <span class="skolem">K</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">W1</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffI U_def V'_def lset_nth_member_inf<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k3</span></span> <span class="keyword2"><span class="keyword">where</span></span> k3<span class="main">:</span> <span class="quoted"><span class="quoted">"ldropn <span class="skolem">k2</span> <span class="skolem">P</span> <span class="main">$</span> <span class="skolem">k3</span> <span class="main">∈</span> <span class="skolem">K</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> σ_attracts strategy_attractsE <span class="keyword1"><span class="command">unfolding</span></span> G'.visits_via_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k4</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k4</span> <span class="main">=</span> <span class="skolem">k3</span> <span class="main">+</span> <span class="skolem">k2</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">$</span> <span class="skolem">k4</span> <span class="main">∈</span> <span class="skolem">K</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> k3 lnth_ldropn infinite_small_llength<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k4</span> <span class="main">≥</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k4_def k2_def
          <span class="keyword1"><span class="command">using</span></span> le_add2 le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ldropn <span class="skolem">n</span> <span class="skolem">P</span> <span class="main">$</span> <span class="skolem">k4</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">P</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">k4</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> lnth_ldropn infinite_small_llength <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ldropn <span class="skolem">n</span> <span class="skolem">P</span> <span class="main">$</span> <span class="skolem">k4</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lset <span class="main">(</span>ldropn <span class="skolem">n</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">K</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span> lfinite_ldropn in_lset_conv_lnth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ldropn <span class="skolem">n</span> <span class="skolem">P</span> <span class="main">$</span> <span class="skolem">k4</span> <span class="main">-</span> <span class="skolem">n</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_prio</span> <span class="main">∈</span> lset <span class="main">(</span>ldropn <span class="skolem">n</span> <span class="main">(</span>lmap <span class="keyword1">ω</span> <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> K_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> winning_path_def
        <span class="keyword1"><span class="command">using</span></span> path_inf_priorities_at_least_min_prio<span class="main">[</span><span class="operator">OF</span> P_valid<span class="main">,</span> <span class="operator">folded</span> min_prio_def<span class="main">]</span>
              <span class="quoted"><span class="quoted">‹winning_priority <span class="skolem">p</span> <span class="skolem">min_prio</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>lfinite <span class="skolem">P</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span> <span class="bound">σ</span><span class="main">.</span> strategy <span class="bound">p</span> <span class="bound">σ</span> <span class="main">∧</span> winning_strategy <span class="bound">p</span> <span class="bound">σ</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> W1_def winning_region_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹strategy <span class="skolem">p</span> <span class="skolem">σ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="bound">σ</span><span class="main">.</span> strategy <span class="bound">p</span> <span class="bound">σ</span> <span class="main">∧</span> winning_strategy <span class="bound">p</span> <span class="bound">σ</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> winning_region_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Positional Determinacy without Deadends›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> positional_strategy_exists_without_deadends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span> <span class="main">⟹</span> <span class="main">¬</span>deadend <span class="bound">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="free">v</span> <span class="main">∈</span> winning_region <span class="bound">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ParityGame_axioms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="keyword1">ω</span> <span class="main">`</span> <span class="keyword1">V</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">rule</span> ParityGame.positional_strategy_induction_step<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Positional Determinacy with Deadends›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Prove a stronger version of the previous theorem: Allow deadends.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> positional_strategy_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="free">v0</span> <span class="main">∈</span> winning_region <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> attractor <span class="skolem">p</span> <span class="main">(</span>deadends <span class="skolem">p</span><span class="main">**</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> v0_in_attractor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> attractor <span class="skolem">p</span> <span class="main">(</span>deadends <span class="skolem">p</span><span class="main">**</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="skolem">p</span> <span class="skolem">σ</span>"</span></span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="skolem">p</span> <span class="skolem">σ</span> <span class="skolem">A</span> <span class="main">(</span>deadends <span class="skolem">p</span><span class="main">**</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> attractor_has_strategy<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"deadends <span class="skolem">p</span><span class="main">**</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span>"</span></span><span class="main">]</span> A_def deadends_in_V <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A_def <span class="keyword1"><span class="command">using</span></span> attractor_in_V deadends_in_V <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">-</span> deadends <span class="skolem">p</span><span class="main">**</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="skolem">p</span> <span class="skolem">σ</span> <span class="free">v0</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> winning_strategy_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="free">v0</span> <span class="skolem">p</span> <span class="skolem">σ</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">σ</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"winning_path <span class="skolem">p</span> <span class="skolem">P</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> visits_deadend<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">**</span>"</span></span><span class="main">]</span> σ<span class="main">(</span>2<span class="main">)</span> strategy_attracts_lset v0_in_attractor
        <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="bound">σ</span><span class="main">.</span> strategy <span class="bound">p</span> <span class="bound">σ</span> <span class="main">∧</span> winning_strategy <span class="bound">p</span> <span class="bound">σ</span> <span class="free">v0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> lemma_path_to_deadend <span class="main">=</span> this
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="skolem">p</span> <span class="main">=</span> attractor <span class="skolem">p</span> <span class="main">(</span>deadends <span class="skolem">p</span><span class="main">**</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Remove the attractor sets of the sets of deadends.›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">V'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">A</span> Even <span class="main">-</span> <span class="skolem">A</span> Odd"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="skolem">V'</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G'</span> <span class="main">=</span> subgame <span class="skolem">V'</span>"</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> G'<span class="main">:</span> ParityGame <span class="quoted"><span class="skolem">G'</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">using</span></span> subgame_ParityGame <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v0</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> V'_no_deadends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span> <span class="main">¬</span>G'.deadend <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="keyword1">V</span> <span class="main">-</span> <span class="skolem">A</span> Even <span class="main">-</span> <span class="skolem">A</span> Even<span class="main">**</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> V'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>G'.deadend <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> subgame_without_deadends <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def G'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"G'.strategy <span class="skolem">p</span> <span class="skolem">σ</span>"</span></span> <span class="quoted"><span class="quoted">"G'.winning_strategy <span class="skolem">p</span> <span class="skolem">σ</span> <span class="free">v0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> G'.positional_strategy_exists_without_deadends
      <span class="keyword1"><span class="command">unfolding</span></span> G'.winning_region_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> V'_no_deadends'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V'</span> <span class="main">⟹</span> <span class="main">¬</span>deadend <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>G'.deadend <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> V'_no_deadends <span class="quoted"><span class="quoted">‹<span class="skolem">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ_attr</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> σ_attr<span class="main">:</span> <span class="quoted"><span class="quoted">"strategy <span class="skolem">p</span> <span class="skolem">σ_attr</span>"</span></span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="skolem">p</span> <span class="skolem">σ_attr</span> <span class="main">(</span><span class="skolem">A</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>deadends <span class="skolem">p</span><span class="main">**</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> attractor_has_strategy<span class="main">[</span><span class="operator">OF</span> deadends_in_V<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">σ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="main">=</span> override_on <span class="skolem">σ</span> <span class="skolem">σ_attr</span> <span class="main">(</span><span class="skolem">A</span> Even <span class="main">∪</span> <span class="skolem">A</span> Odd<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> σ'_is_σ_on_V'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V'</span> <span class="main">⟹</span> <span class="skolem">σ'</span> <span class="bound">v</span> <span class="main">=</span> <span class="skolem">σ</span> <span class="bound">v</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> V'_def σ'_def A_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy <span class="skolem">p</span> <span class="skolem">σ'</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="main">=</span> override_on <span class="skolem">σ_attr</span> <span class="skolem">σ</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="skolem">A</span> Even <span class="main">-</span> <span class="skolem">A</span> Odd<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> σ'_def override_on_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy <span class="skolem">p</span> <span class="main">(</span>override_on <span class="skolem">σ_attr</span> <span class="skolem">σ</span> <span class="skolem">V'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_strategy_supergame σ_attr<span class="main">(</span>1<span class="main">)</span> σ<span class="main">(</span>1<span class="main">)</span> V'_no_deadends <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_strategy_only_in_V V'_def override_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winning_strategy <span class="skolem">p</span> <span class="skolem">σ'</span> <span class="free">v0</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> winning_strategyI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vmc_path <span class="free">G</span> <span class="skolem">P</span> <span class="free">v0</span> <span class="skolem">p</span> <span class="skolem">σ'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">σ'</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">interpret</span></span> vmc_path_no_deadend <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">σ'</span></span>
        <span class="keyword1"><span class="command">using</span></span> V'_no_deadends' <span class="quoted"><span class="quoted">‹<span class="free">v0</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
      <span class="keyword3"><span class="command">assume</span></span> contra<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>winning_path <span class="skolem">p</span> <span class="skolem">P</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P</span> <span class="main">⊆</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vmc_path_lset_induction_closed_subset<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> G'.VV <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>G'.deadend <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> V'_no_deadends <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G'.strategy <span class="skolem">p</span> <span class="skolem">σ'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> G'.valid_strategy_only_in_V σ'_def σ'_is_σ_on_V' σ<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgame_strategy_stays_in_subgame
          <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span><span class="main">**</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">→</span><span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∉</span> <span class="skolem">A</span> <span class="skolem">p</span><span class="main">**</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="skolem">p</span><span class="main">**</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="skolem">p</span><span class="main">**</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> VV <span class="skolem">p</span><span class="main">**</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">→</span><span class="skolem">w</span>›</span></span> attractor_set_VVp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> V'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="skolem">V'</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> V'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">→</span><span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P</span> <span class="main">∩</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P</span> <span class="main">∩</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="skolem">p</span> <span class="main">(</span>override_on <span class="skolem">σ'</span> <span class="skolem">σ_attr</span> <span class="main">(</span><span class="skolem">A</span> <span class="skolem">p</span> <span class="main">-</span> deadends <span class="skolem">p</span><span class="main">**</span><span class="main">)</span><span class="main">)</span>
                                    <span class="main">(</span><span class="skolem">A</span> <span class="skolem">p</span><span class="main">)</span>
                                    <span class="main">(</span>deadends <span class="skolem">p</span><span class="main">**</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> strategy_attracts_irrelevant_override<span class="main">[</span><span class="operator">OF</span> σ_attr<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> σ_attr<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹strategy <span class="skolem">p</span> <span class="skolem">σ'</span>›</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"override_on <span class="skolem">σ'</span> <span class="skolem">σ_attr</span> <span class="main">(</span><span class="skolem">A</span> <span class="skolem">p</span> <span class="main">-</span> deadends <span class="skolem">p</span><span class="main">**</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">σ'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> σ'_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> override_on_def<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategy_attracts <span class="skolem">p</span> <span class="skolem">σ'</span> <span class="main">(</span><span class="skolem">A</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>deadends <span class="skolem">p</span><span class="main">**</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lset <span class="skolem">P</span> <span class="main">∩</span> deadends <span class="skolem">p</span><span class="main">**</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lset <span class="skolem">P</span> <span class="main">∩</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> attracted_path<span class="main">[</span><span class="operator">OF</span> deadends_in_V<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> contra visits_deadend<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">**</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="free">v0</span> <span class="main">∈</span> <span class="skolem">V'</span>›</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="skolem">G'</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">σ'</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">using</span></span> subgame_path_vmc_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">V'</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G'.path_conforms_with_strategy <span class="skolem">p</span> <span class="skolem">P</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> lset <span class="skolem">P</span> <span class="main">⟹</span> <span class="skolem">σ'</span> <span class="bound">v</span> <span class="main">=</span> <span class="skolem">σ</span> <span class="bound">v</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> σ'_is_σ_on_V' <span class="quoted"><span class="quoted">‹<span class="keyword1">V</span><span class="hidden">⇘</span><sub><span class="skolem">G'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">V'</span>›</span></span> lset_P_V <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"G'.path_conforms_with_strategy <span class="skolem">p</span> <span class="skolem">P</span> <span class="skolem">σ</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> P_conforms G'.path_conforms_with_strategy_irrelevant_updates <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> vmc_path <span class="quoted"><span class="skolem">G'</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="free">v0</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">σ</span></span> <span class="keyword1"><span class="command">using</span></span> conforms_to_another_strategy <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G'.winning_path <span class="skolem">p</span> <span class="skolem">P</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> σ<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> G'.winning_strategy_def<span class="main">]</span> vmc_path_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>winning_path <span class="skolem">p</span> <span class="skolem">P</span>›</span></span>
           G'.winning_path_supergame<span class="main">[</span><span class="operator">OF</span> this ParityGame_axioms<span class="main">,</span> <span class="operator">unfolded</span> G'_def<span class="main">]</span>
           subgame_VV_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">**</span>"</span></span> <span class="quoted"><span class="skolem">V'</span></span><span class="main">]</span>
           subgame_ω<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">V'</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> winning_region_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∉</span> <span class="skolem">V'</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> attractor <span class="skolem">p</span> <span class="main">(</span>deadends <span class="skolem">p</span><span class="main">**</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> V'_def A_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> winning_region_def
      <span class="keyword1"><span class="command">using</span></span> lemma_path_to_deadend <span class="quoted"><span class="quoted">‹<span class="free">v0</span> <span class="main">∈</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Main Theorem: Positional Determinacy›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\label{subsec:positional_determinacy}›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Prove the main theorem: The winning regions of player \Even and \Odd are a partition of the set
  of nodes <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="keyword1"><span class="quoted"><span class="keyword1">V</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> partition_into_winning_regions<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">V</span> <span class="main">=</span> winning_region Even <span class="main">∪</span> winning_region Odd"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"winning_region Even <span class="main">∩</span> winning_region Odd <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">V</span> <span class="main">⊆</span> winning_region Even <span class="main">∪</span> winning_region Odd"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Un_iff other_other_player positional_strategy_exists<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"winning_region Even <span class="main">∪</span> winning_region Odd <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> Un_iff subsetCE winning_region_in_V<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"winning_region Even <span class="main">∩</span> winning_region Odd <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> winning_strategy_only_for_one_player<span class="main">[</span><span class="operator">of</span> <span class="quoted">Even</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> winning_region_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context ParityGame›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="AttractorInductive">
<div class="head">
<h1>Theory AttractorInductive</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Defining the Attractor with \texttt{inductive\_set}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> AttractorInductive
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <a href="#Attractor">Attractor</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> ParityGame <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In section \ref{sec:attractor} we defined <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> attractor<span class="antiquote"><span class="antiquote">}</span></span></span></span> manually via <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> lfp<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  We can also define it with \texttt{inductive\_set}.  In this section, we do exactly this and
  prove that the new definition yields the same set as the old definition.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">attractor_inductive</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The attractor set of a given set of nodes, defined inductively.›</span></span>
<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">attractor_inductive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Player <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">p</span> <span class="main">::</span> <span class="quoted">Player</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">W</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  Base <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free">attractor_inductive</span> <span class="free">p</span> <span class="free">W</span>"</span></span>
<span class="main">|</span> VVp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">;</span> <span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">→</span><span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">attractor_inductive</span> <span class="free">p</span> <span class="free">W</span> <span class="main">⟧</span>
    <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free">attractor_inductive</span> <span class="free">p</span> <span class="free">W</span>"</span></span>
<span class="main">|</span> VVpstar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">**</span><span class="main">;</span> <span class="main">¬</span>deadend <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">;</span> <span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">→</span><span class="bound">w</span> <span class="main">⟶</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">attractor_inductive</span> <span class="free">p</span> <span class="free">W</span> <span class="main">⟧</span>
    <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free">attractor_inductive</span> <span class="free">p</span> <span class="free">W</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We show that the inductive definition and the definition via least fixed point are the same.
›</span></span>
<span class="keyword1" id="AttractorInductive-attractor_inductive_is_attractor"><span class="command">lemma</span></span> attractor_inductive_is_attractor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"attractor_inductive <span class="free">p</span> <span class="free">W</span> <span class="main">=</span> attractor <span class="free">p</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"attractor_inductive <span class="free">p</span> <span class="free">W</span> <span class="main">⊆</span> attractor <span class="free">p</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> attractor_inductive <span class="free">p</span> <span class="free">W</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> attractor <span class="free">p</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> attractor_inductive.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Base <span class="skolem">v</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> attractor_set_base <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>VVp <span class="skolem">v</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> attractor_set_VVp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>VVpstar <span class="skolem">v</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> attractor_set_VVpstar <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"attractor <span class="free">p</span> <span class="free">W</span> <span class="main">⊆</span> attractor_inductive <span class="free">p</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">S</span> <span class="main">⟷</span> <span class="skolem">S</span> <span class="main">⊆</span> attractor_inductive <span class="free">p</span> <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">S</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span>attractor <span class="free">p</span> <span class="free">W</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> attractor_set_induction<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">S</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> attractor_inductive <span class="free">p</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">∪</span> directly_attracted <span class="free">p</span> <span class="skolem">S</span> <span class="main">⊆</span> attractor_inductive <span class="free">p</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">∪</span> directly_attracted <span class="free">p</span> <span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> attractor_inductive <span class="free">p</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> attractor_inductive <span class="free">p</span> <span class="free">W</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> attractor_inductive <span class="free">p</span> <span class="free">W</span>›</span></span> rev_subsetD<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> v_attracted<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> directly_attracted <span class="free">p</span> <span class="skolem">S</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="keyword1">V</span>›</span></span> attractor_step_bounded_by_V <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> attractor_inductive <span class="free">p</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> VV_cases<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="free">p</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v_attracted directly_attracted_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> attractor_inductive <span class="free">p</span> <span class="free">W</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> attractor_inductive <span class="free">p</span> <span class="free">W</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> VV <span class="free">p</span>›</span></span> attractor_inductive.VVp<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">**</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">⟶</span> <span class="bound">w</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v_attracted directly_attracted_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>deadend <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v_attracted directly_attracted_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> attractor_inductive <span class="free">p</span> <span class="free">W</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∉</span> attractor_inductive <span class="free">p</span> <span class="free">W</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> attractor_inductive.VVpstar <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> VV <span class="free">p</span><span class="main">**</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>deadend <span class="skolem">v</span>›</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">v</span><span class="main">→</span><span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∉</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> attractor_inductive <span class="free">p</span> <span class="free">W</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subsetCE<span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> attractor_inductive <span class="free">p</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UnE<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="free">W</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">∪</span> directly_attracted <span class="free">p</span> <span class="skolem">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_def Sup_least<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Graph_TheoryCompatibility">
<div class="head">
<h1>Theory Graph_TheoryCompatibility</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Compatibility with the Graph Theory Package›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Graph_TheoryCompatibility
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#ParityGame">ParityGame</a>
  <a href="../../graph_theory/theories/#Digraph">Graph_Theory.Digraph</a>
  <a href="../../graph_theory/theories/#Digraph_Isomorphism">Graph_Theory.Digraph_Isomorphism</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we show that our <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">locale</span></span> Digraph<span class="antiquote"><span class="antiquote">}</span></span></span></span> locale is compatible to the
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">locale</span></span> nomulti_digraph<span class="antiquote"><span class="antiquote">}</span></span></span></span> locale from the graph theory package from the Archive of Formal Proofs.

  For this, we will define two functions converting between the different types and show that with
  these conversion functions the locales interpret each other.  Together, this indicates that our
  definition of digraph is reasonable.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹To Graph Theory›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can easily convert our graphs into <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> pre_digraph<span class="antiquote"><span class="antiquote">}</span></span></span></span> objects.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">to_pre_digraph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Graph_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> pre_digraph"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">to_pre_digraph</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">⦇</span>
    pre_digraph.verts <span class="main">=</span> Graph.verts <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span>
    pre_digraph.arcs <span class="main">=</span> Graph.arcs <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span>
    tail <span class="main">=</span> fst<span class="main">,</span>
    head <span class="main">=</span> snd
  <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  With this conversion function, our <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">locale</span></span> Digraph<span class="antiquote"><span class="antiquote">}</span></span></span></span> locale contains the locale
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">locale</span></span> nomulti_digraph<span class="antiquote"><span class="antiquote">}</span></span></span></span> from the graph theory package.
›</span></span>
<span class="keyword1"><span class="command">context</span></span> Digraph <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> is_nomulti_digraph<span class="main">:</span> nomulti_digraph <span class="quoted"><span class="quoted">"to_pre_digraph <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> pre_digraph.arcs <span class="main">(</span>to_pre_digraph <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tail <span class="main">(</span>to_pre_digraph <span class="free">G</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">∈</span> pre_digraph.verts <span class="main">(</span>to_pre_digraph <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> * edges_are_in_V<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> pre_digraph.ext_inject pre_digraph.surjective prod.collapse to_pre_digraph_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"head <span class="main">(</span>to_pre_digraph <span class="free">G</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">∈</span> pre_digraph.verts <span class="main">(</span>to_pre_digraph <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> * edges_are_in_V<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pre_digraph.ext_inject pre_digraph.surjective prod.collapse to_pre_digraph_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arc_to_ends_def to_pre_digraph_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹From Graph Theory›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can also convert in the other direction.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">from_pre_digraph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="tfree">'a</span> Graph"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">from_pre_digraph</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">⦇</span>
    Graph.verts <span class="main">=</span> pre_digraph.verts <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span>
    Graph.arcs <span class="main">=</span> arcs_ends <span class="free"><span class="bound"><span class="entity">G</span></span></span>
  <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> nomulti_digraph <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> is_Digraph<span class="main">:</span> Digraph <span class="quoted"><span class="quoted">"from_pre_digraph <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">E</span><span class="hidden">⇘</span><sub>from_pre_digraph <span class="free">G</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> pre_digraph.arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> from_pre_digraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>from_pre_digraph <span class="free">G</span></sub><span class="hidden">⇙</span> <span class="main">×</span> <span class="keyword1">V</span><span class="hidden">⇘</span><sub>from_pre_digraph <span class="free">G</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> from_pre_digraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Digraph <span class="main">(</span>from_pre_digraph <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Digraph.intro subrelI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Isomorphisms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We also show that our conversion functions make sense.  That is, we show that they are nearly
  inverses of each other.  Unfortunately, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> from_pre_digraph<span class="antiquote"><span class="antiquote">}</span></span></span></span> irretrievably loses information
  about the arcs, and only keeps tail/head intact, so the best we can get for this case is that the
  back-and-forth converted graphs are isomorphic.
›</span></span>

<span class="keyword1" id="Graph_TheoryCompatibility-graph_conversion_bij"><span class="command">lemma</span></span> graph_conversion_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">=</span> from_pre_digraph <span class="main">(</span>to_pre_digraph <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> to_pre_digraph_def from_pre_digraph_def arcs_ends_def arc_to_ends_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> nomulti_digraph<span class="main">)</span> graph_conversion_bij2<span class="main">:</span> <span class="quoted"><span class="quoted">"digraph_iso <span class="free">G</span> <span class="main">(</span>to_pre_digraph <span class="main">(</span>from_pre_digraph <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">iso</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">iso</span> <span class="main">=</span> <span class="main">⦇</span>
      iso_verts <span class="main">=</span> id <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">,</span>
      iso_arcs <span class="main">=</span> arc_to_ends <span class="free">G</span><span class="main">,</span>
      iso_head <span class="main">=</span> snd<span class="main">,</span>
      iso_tail <span class="main">=</span> fst
    <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>iso_verts <span class="skolem">iso</span><span class="main">)</span> <span class="main">(</span>pre_digraph.verts <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> iso_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>iso_arcs <span class="skolem">iso</span><span class="main">)</span> <span class="main">(</span>pre_digraph.arcs <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> iso_def arc_to_ends_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arc_to_ends_def inj_onI no_multi_arcs<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> pre_digraph.arcs <span class="free">G</span><span class="main">.</span>
    iso_verts <span class="skolem">iso</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> iso_tail <span class="skolem">iso</span> <span class="main">(</span>iso_arcs <span class="skolem">iso</span> <span class="bound">a</span><span class="main">)</span>
    <span class="main">∧</span> iso_verts <span class="skolem">iso</span> <span class="main">(</span>head <span class="free">G</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> iso_head <span class="skolem">iso</span> <span class="main">(</span>iso_arcs <span class="skolem">iso</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> iso_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arc_to_ends_def<span class="main">)</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="skolem">iso</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> digraph_isomorphism_def <span class="keyword1"><span class="command">using</span></span> arc_to_ends_def wf_digraph_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_pre_digraph <span class="main">(</span>from_pre_digraph <span class="free">G</span><span class="main">)</span> <span class="main">=</span> app_iso <span class="skolem">iso</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> to_pre_digraph_def from_pre_digraph_def iso_def app_iso_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arcs_ends_def<span class="main">)</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> digraph_iso_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>