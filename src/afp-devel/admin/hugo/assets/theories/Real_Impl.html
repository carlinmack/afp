<div id="Real_Impl_Auxiliary">
<div class="head">
<h1>Theory Real_Impl_Auxiliary</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Implementing field extensions of the form Q[sqrt(b)]
    Author:      René Thiemann       &lt;rene.thiemann@uibk.ac.at&gt;
    Maintainer:  René Thiemann
    License:     LGPL
*)</span>

<span class="comment1">(*
Copyright 2009-2014 René Thiemann

This file is part of IsaFoR/CeTA.

IsaFoR/CeTA is free software: you can redistribute it and/or modify it under the
terms of the GNU Lesser General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any later
version.

IsaFoR/CeTA is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License along
with IsaFoR/CeTA. If not, see &lt;http://www.gnu.org/licenses/&gt;.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary lemmas which might be moved into the Isabelle distribution.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Real_Impl_Auxiliary
<span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Primes.html">HOL-Computational_Algebra.Primes</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Real_Impl_Auxiliary-multiplicity_prime"><span class="command">lemma</span></span> multiplicity_prime<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="free">i</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ji<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">j</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_refl prime_nat_iff multiplicity_eq_zero_iff 
        multiplicity_unit_left multiplicity_zero<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Prime_Product">
<div class="head">
<h1>Theory Prime_Product</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Implementing field extensions of the form Q[sqrt(b)]
    Author:      René Thiemann       &lt;rene.thiemann@uibk.ac.at&gt;
    Maintainer:  René Thiemann
    License:     LGPL
*)</span>

<span class="comment1">(*
Copyright 2009-2014 René Thiemann

This file is part of IsaFoR/CeTA.

IsaFoR/CeTA is free software: you can redistribute it and/or modify it under the
terms of the GNU Lesser General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any later
version.

IsaFoR/CeTA is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License along
with IsaFoR/CeTA. If not, see &lt;http://www.gnu.org/licenses/&gt;.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Prime products›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Prime_Product
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="#Real_Impl_Auxiliary">Real_Impl_Auxiliary</a>
  <a href="../../sqrt_babylonian/theories/#Sqrt_Babylonian">Sqrt_Babylonian.Sqrt_Babylonian</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Prime products are natural numbers where no prime factor occurs more than once.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prime_product</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">prime_product</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">⟶</span> multiplicity <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The main property is that whenever $b_1$ and $b_2$ are different prime products,
  then $p_1 + q_1 \sqrt{b_1} = p_2 + q_2 \sqrt{b_2}$ implies $(p_1,q_1,b_1) = (p_2,q_2,b_2)$
  for all rational numbers $p_1,q_1,p_2,q_2$. This is the key property to uniquely
  represent numbers in $\ratsb$ by triples. In the following we develop an algorithm
  to decompose any natural number $n$ into $n = s^2 \cdot p$ for some $s$ and prime product $p$.
›</span></span>


<span class="comment1">(* factor a number into square * a prime product *)</span>
<span class="keyword1"><span class="command">function</span></span> <span class="entity">prime_product_factor_main</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">×</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prime_product_factor_main</span> <span class="free"><span class="bound"><span class="entity">factor_sq</span></span></span> <span class="free"><span class="bound"><span class="entity">factor_pr</span></span></span> <span class="free"><span class="bound"><span class="entity">limit</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">limit</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≥</span> <span class="numeral">2</span> <span class="keyword1">then</span>
       <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">dvd</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> 
           <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">n'</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">in</span> 
             <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">dvd</span> <span class="bound">n'</span> <span class="keyword1">then</span>
                <span class="keyword1">let</span> <span class="bound">n''</span> <span class="main">=</span> <span class="bound">n'</span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">in</span> 
                  <span class="free">prime_product_factor_main</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">factor_sq</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">factor_pr</span></span></span> <span class="main">(</span>nat <span class="main">(</span>root_nat_floor <span class="numeral">3</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span> <span class="bound">n''</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>
                <span class="keyword1">else</span>
                  <span class="main">(</span><span class="keyword1">case</span> sqrt_nat <span class="bound">n'</span> <span class="keyword1">of</span> 
                    Cons <span class="bound">sn</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">factor_sq</span></span></span> <span class="main">*</span> <span class="bound">sn</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">factor_pr</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>
                  <span class="main">|</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="free">prime_product_factor_main</span> <span class="free"><span class="bound"><span class="entity">factor_sq</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">factor_pr</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>nat <span class="main">(</span>root_nat_floor <span class="numeral">3</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="bound">n'</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>
                  <span class="main">)</span>
             <span class="main">)</span>              
           <span class="main">)</span>
         <span class="keyword1">else</span> 
           <span class="free">prime_product_factor_main</span> <span class="free"><span class="bound"><span class="entity">factor_sq</span></span></span> <span class="free"><span class="bound"><span class="entity">factor_pr</span></span></span> <span class="free"><span class="bound"><span class="entity">limit</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>
       <span class="keyword1">else</span>
         <span class="main">(</span><span class="free"><span class="bound"><span class="entity">factor_sq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">factor_pr</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">termination</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">factor_sq</span> <span class="main">::</span> nat<span class="main">,</span><span class="bound">factor_pr</span> <span class="main">::</span> nat<span class="main">,</span><span class="bound">limit</span> <span class="main">::</span> nat<span class="main">,</span><span class="bound">n</span> <span class="main">::</span> nat<span class="main">,</span><span class="bound">i</span> <span class="main">::</span> nat<span class="main">)</span><span class="main">.</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">factor_sq</span><span class="main">,</span><span class="bound">factor_pr</span><span class="main">,</span><span class="bound">limit</span><span class="main">,</span><span class="bound">n</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>Suc <span class="bound">limit</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">⟹</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> one_less_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> wf_measures <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?m1</span><span class="main">,</span> <span class="var">?m2</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> * <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Prime_Product-prime_product_factor_main"><span class="command">lemma</span></span> prime_product_factor_main<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">*</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">limit</span> <span class="main">=</span> nat <span class="main">(</span>root_nat_floor <span class="numeral">3</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">factor_sq</span> <span class="main">*</span> <span class="free">factor_sq</span> <span class="main">*</span> <span class="free">factor_pr</span> <span class="main">*</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime_product_factor_main <span class="free">factor_sq</span> <span class="free">factor_pr</span> <span class="free">limit</span> <span class="free">n</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">sq</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≥</span> <span class="numeral">2</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="bound">j</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">j</span><span class="main">.</span> prime <span class="bound">j</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">⟹</span> multiplicity <span class="bound">j</span> <span class="free">factor_pr</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">j</span><span class="main">.</span> prime <span class="bound">j</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">≥</span> <span class="free">i</span> <span class="main">⟹</span> multiplicity <span class="bound">j</span> <span class="free">factor_pr</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">factor_pr</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">sq</span> <span class="main">*</span> <span class="free">sq</span> <span class="main">*</span> <span class="free">p</span> <span class="main">∧</span> prime_product <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">factor_sq</span></span> <span class="quoted"><span class="free">factor_pr</span></span> <span class="quoted"><span class="free">limit</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prime_product_factor_main.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">factor_sq</span> <span class="skolem">factor_pr</span> <span class="skolem">limit</span> <span class="skolem">n</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> prems <span class="main">=</span> 1<span class="main">(</span>4-<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> prems<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> prime_product_factor_main.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">factor_sq</span></span> <span class="quoted"><span class="skolem">factor_pr</span></span> <span class="quoted"><span class="skolem">limit</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">limit</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> i <span class="main">=</span> this
    <span class="keyword1"><span class="command">with</span></span> prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">limit</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">limit</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> IH<span class="main">[</span><span class="operator">OF</span> cond<span class="main">]</span>
    <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> simp<span class="main">[</span><span class="operator">unfolded</span> * if_True<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">dvd</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> simp<span class="main">[</span><span class="operator">unfolded</span> * if_False<span class="main">]</span>      
      <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> IH<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> False prems<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> simp<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
        <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> prems<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> j False
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">j</span> <span class="keyword1">dvd</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="main">::</span> <span class="quoted">nat</span>
        <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> prems<span class="main">(</span>7-8<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">j</span></span></span></span><span class="main">]</span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">j</span> <span class="skolem">factor_pr</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> prems<span class="main"><span class="main">(</span></span>8-9<span class="main"><span class="main">)</span></span> cond<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> mod <span class="main">=</span> this
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> simp<span class="main">[</span><span class="operator">unfolded</span> this if_True Let_def<span class="main">]</span>
      <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> IH<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> True refl<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span> <span class="keyword1">div</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> mod True <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">*</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n'_def dvd_eq_mod_eq_0<span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> simp<span class="main">[</span><span class="operator">unfolded</span> * if_True split<span class="main">]</span>
        <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> True refl _ refl _ simp prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> _ prems<span class="main"><span class="main">(</span></span>7-9<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="skolem">factor_sq</span> <span class="main">*</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">factor_sq</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">factor_pr</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span> <span class="keyword1">div</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> prems<span class="main">(</span>3<span class="main">)</span> n'_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
            <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> prems<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">j</span> <span class="keyword1">dvd</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">j</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span> <span class="keyword1">div</span> <span class="skolem">i</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_mult n n'_def mult.commute<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">*</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span> <span class="keyword1">div</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">*</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span> <span class="keyword1">div</span> <span class="skolem">i</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span> <span class="keyword1">div</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False        
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> mod True <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">*</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n'_def dvd_eq_mod_eq_0<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> prime<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">i</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> prime_nat_iff
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI allI impI<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
          <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">dvd</span> <span class="skolem">i</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">dvd</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> prems<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> choice<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">m</span> <span class="main">≥</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
          <span class="keyword1"><span class="command">from</span></span> m prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_0_left_iff le0 le_antisym neq0_conv zero_neq_numeral<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> choice <span class="keyword1"><span class="command">have</span></span> choice<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">m</span> <span class="main">≥</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
          <span class="keyword1"><span class="command">from</span></span> m prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False div_by_0 dvd_refl dvd_imp_le gr0I<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> choice
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> simp<span class="main">[</span><span class="operator">unfolded</span> this if_False<span class="main">]</span>
        <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> False _ _ refl<span class="main">]</span>
        <span class="keyword1"><span class="command">from</span></span> prime <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>

        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sqrt_nat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">s</span><span class="main">)</span>
          <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> simp<span class="main">[</span><span class="operator">unfolded</span> Cons list.simps<span class="main">]</span>
          <span class="keyword1"><span class="command">hence</span></span> sq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sq</span> <span class="main">=</span> <span class="skolem">factor_sq</span> <span class="main">*</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">factor_pr</span> <span class="main">*</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>          
          <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> Cons<span class="main">,</span> <span class="operator">of</span> <span class="quoted">set</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> pp<span class="main">:</span> <span class="quoted"><span class="quoted">"prime_product <span class="main">(</span><span class="skolem">factor_pr</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> prime_product_def
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">m</span>"</span></span>
            <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> <span class="skolem">m</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">m</span> <span class="main">(</span><span class="skolem">factor_pr</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="main">(</span><span class="operator">insert</span> prems<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">m</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> prems<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">m</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> prems<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> prime m<span class="main"><span class="keyword3">,</span></span>
                          <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> multiplicity_prime prime_elem_multiplicity_mult_distrib<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sq p prems<span class="main">(</span>3<span class="main">)</span> n <span class="keyword1"><span class="command">unfolding</span></span> n'_def s<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
            <span class="keyword1"><span class="command">using</span></span> pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> Nil
          <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> simp<span class="main">[</span><span class="operator">unfolded</span> Nil list.simps<span class="main">]</span>
          <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> Nil<span class="main">,</span> <span class="operator">of</span> <span class="quoted">set</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> IH<span class="main">[</span><span class="operator">OF</span> Nil this  _ simp<span class="main">]</span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="skolem">factor_sq</span> <span class="main">*</span> <span class="skolem">factor_sq</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">factor_pr</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">unfolding</span></span> prems<span class="main">(</span>3<span class="main">)</span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
            <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="skolem">i</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">j</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="keyword1">dvd</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">i</span>"</span></span>
              <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> prems<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> j
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> n
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_mult n n'_def mult.commute<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="main">::</span> <span class="quoted">nat</span> 
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_prime<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">j</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">j</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prime j <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicity_prime<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">j</span> <span class="main">(</span><span class="skolem">factor_pr</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
              <span class="keyword1"><span class="command">unfolding</span></span> prems<span class="main">(</span>8<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> j_prime ij<span class="main">]</span> 0 
              <span class="keyword1"><span class="command">using</span></span> prime j_prime j <span class="quoted"><span class="quoted">‹ <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">factor_pr</span>›</span></span> <span class="quoted"><span class="quoted">‹multiplicity <span class="skolem">j</span> <span class="skolem">factor_pr</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_elem_multiplicity_mult_distrib<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> multiplicity_prime<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> 
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_prime<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">j</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">j</span> <span class="main">(</span><span class="skolem">factor_pr</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> 
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
              <span class="keyword1"><span class="command">with</span></span> prems<span class="main">(</span>8<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> prime j_prime <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">factor_pr</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_elem_multiplicity_mult_distrib<span class="main">)</span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> ji<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> prems<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> j_prime ji<span class="main">]</span> multiplicity_prime<span class="main">[</span><span class="operator">OF</span> prime this<span class="main">]</span>
                   prime j_prime <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">factor_pr</span>›</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_elem_multiplicity_mult_distrib<span class="main">)</span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">limit</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> simp<span class="main">[</span><span class="operator">unfolded</span> this if_False<span class="main">]</span>
    <span class="keyword1"><span class="command">hence</span></span> sq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sq</span> <span class="main">=</span> <span class="skolem">factor_sq</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">factor_pr</span> <span class="main">*</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">sq</span> <span class="main">*</span> <span class="free">sq</span> <span class="main">*</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sq p prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prime_product <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> prime_product_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">m</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">nat</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> <span class="skolem">limit</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="skolem">i</span> <span class="main">≥</span> root_nat_floor <span class="numeral">3</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">(</span>root_nat_floor <span class="numeral">3</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> root_nat_floor_upper<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> int <span class="skolem">i</span> <span class="main">^</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> less<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">3</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> n_i3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">^</span> <span class="numeral">3</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_nat_less_iff of_nat_power <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
          <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">m</span> <span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> mp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> prime_factors <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> md<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">dvd</span> <span class="skolem">n</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">from</span></span> mp <span class="keyword1"><span class="command">have</span></span> pm<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_nat_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> prems<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> m2<span class="main">]</span> md <span class="keyword1"><span class="command">have</span></span> mi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">m</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> multiplicity <span class="skolem">m</span> <span class="skolem">n</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> mult<span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">m</span> <span class="skolem">n</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
            <span class="keyword1"><span class="command">from</span></span> n0 n <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> mult m0 k n m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">m</span> <span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_elem_multiplicity_mult_distrib<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> m <span class="keyword1"><span class="command">have</span></span> mp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> prime_factors <span class="skolem">k</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> md<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">dvd</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> k<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> kml<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">*</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
            <span class="keyword1"><span class="command">note</span></span> n <span class="main">=</span> n<span class="main">[</span><span class="operator">unfolded</span> kml<span class="main">]</span>
            <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="keyword1">dvd</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> prems<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">l</span> <span class="main">≥</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
            <span class="keyword1"><span class="command">with</span></span> n n0 <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">l</span> <span class="main">≥</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> n prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> l <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> mult_le_mono<span class="main">[</span><span class="operator">OF</span> mult_le_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mi mi<span class="main"><span class="main">]</span></span> l<span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">i</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power3_eq_cube<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> n_i3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">with</span></span> mi m
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">m</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">m</span> <span class="main">≥</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> n <span class="main">=</span> this
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">m</span> <span class="free">p</span> <span class="main">=</span> multiplicity <span class="skolem">m</span> <span class="skolem">factor_pr</span> <span class="main">+</span> multiplicity <span class="skolem">m</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">using</span></span> prems<span class="main">(</span>1<span class="main">,</span>9<span class="main">)</span> m <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_elem_multiplicity_mult_distrib<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">from</span></span> prems<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> n<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> True m <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> prems<span class="main">(</span>8<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> m<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main">]</span> n<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> m <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">m</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prime_product_factor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">×</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prime_product_factor</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> sqrt_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span> 
     <span class="main">(</span>Cons <span class="bound">s</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="main">1</span><span class="main">)</span>
   <span class="main">|</span> <span class="main">[]</span> <span class="main">⇒</span> prime_product_factor_main <span class="main">1</span> <span class="main">1</span> <span class="main">(</span>nat <span class="main">(</span>root_nat_floor <span class="numeral">3</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="numeral">2</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Prime_Product-prime_product_one"><span class="command">lemma</span></span> prime_product_one<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"prime_product <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> prime_product_def multiplicity_one_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Prime_Product-prime_product_factor"><span class="command">lemma</span></span> prime_product_factor<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> pf<span class="main">:</span> <span class="quoted"><span class="quoted">"prime_product_factor <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">sq</span><span class="main">,</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">sq</span> <span class="main">*</span> <span class="free">sq</span> <span class="main">*</span> <span class="free">p</span> <span class="main">∧</span> prime_product <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sqrt_nat <span class="free">n</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">s</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> pf<span class="main">[</span><span class="operator">unfolded</span> prime_product_factor_def Cons<span class="main">]</span> arg_cong<span class="main">[</span><span class="operator">OF</span> Cons<span class="main">,</span> <span class="operator">of</span> <span class="quoted">set</span><span class="main">]</span>
    prime_product_one
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> Nil<span class="main">,</span> <span class="operator">of</span> <span class="quoted">set</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> nsq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">*</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prime_product_factor_main<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nsq refl<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> multiplicity_one<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">insert</span> pf<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> prime_product_factor_def Nil<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Real_Impl">
<div class="head">
<h1>Theory Real_Impl</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Implementing field extensions of the form Q[sqrt(b)]
    Author:      René Thiemann       &lt;rene.thiemann@uibk.ac.at&gt;
    Maintainer:  René Thiemann
    License:     LGPL
*)</span>

<span class="comment1">(*
Copyright 2009-2014 René Thiemann

This file is part of IsaFoR/CeTA.

IsaFoR/CeTA is free software: you can redistribute it and/or modify it under the
terms of the GNU Lesser General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any later
version.

IsaFoR/CeTA is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License along
with IsaFoR/CeTA. If not, see &lt;http://www.gnu.org/licenses/&gt;.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹A representation of real numbers via triples›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Real_Impl
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../sqrt_babylonian/theories/#Sqrt_Babylonian">Sqrt_Babylonian.Sqrt_Babylonian</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We represent real numbers of the form $p + q \cdot \sqrt{b}$ for $p,q \in \rats$, $n \in \nats$
by triples $(p,q,b)$. However, we require the invariant that $\sqrt{b}$ is irrational.
Most binary operations are implemented via partial functions where the common the restriction is that
the numbers $b$ in both triples have to be identical. So, we support addition of $\sqrt{2} + \sqrt{2}$,
but not $\sqrt{2} + \sqrt{3}$.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The set of natural numbers whose sqrt is irrational›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">sqrt_irrat</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">q</span> <span class="main">::</span> nat<span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">*</span> <span class="bound">p</span> <span class="main">=</span> rat_of_nat <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Real_Impl-sqrt_irrat"><span class="command">lemma</span></span> sqrt_irrat<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> choice<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">∈</span> sqrt_irrat"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">p</span> <span class="main">+</span> real_of_rat <span class="free">q</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> choice
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> choice <span class="keyword1"><span class="command">have</span></span> sqrt_irrat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> sqrt_irrat"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">q</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="free">b</span><span class="main">)</span> <span class="main">=</span> real_of_rat <span class="main">(</span><span class="main">-</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">q</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="free">b</span><span class="main">)</span> <span class="main">=</span> real_of_rat <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="main">(</span>of_nat <span class="free">b</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    real_of_rat <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> of_rat_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>of_nat <span class="free">b</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="free">b</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> rat_of_nat <span class="free">b</span><span class="main">)</span> <span class="main">=</span> real_of_rat <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span>rat_of_nat <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> rat_of_nat <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> sqrt_irrat <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sqrt_irrat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To represent  numbers of the form $p + q \cdot \sqrt{b}$, use mini algebraic numbers, i.e.,
  triples $(p,q,b)$ with irrational $\sqrt{b}$.›</span></span>
<span class="keyword1"><span class="command">typedef</span></span> mini_alg <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span><span class="bound">p</span> <span class="main">::</span> rat<span class="main">)</span> <span class="main">(</span><span class="bound">q</span> <span class="main">::</span> rat<span class="main">)</span> <span class="main">(</span><span class="bound">b</span> <span class="main">::</span> nat<span class="main">)</span><span class="main">.</span>
  <span class="bound">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">b</span> <span class="main">∈</span> sqrt_irrat<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_mini_alg

<span class="keyword1"><span class="command">lift_definition</span></span> real_of <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> of_rat <span class="bound">p</span> <span class="main">+</span> of_rat <span class="bound">q</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> ma_of_rat <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> mini_alg"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lift_definition</span></span> ma_rat <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">fst</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> ma_base <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"snd <span class="keyword1">o</span> snd"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> ma_coeff <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"fst <span class="keyword1">o</span> snd"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> ma_uminus <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> mini_alg"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">p1</span><span class="main">,</span><span class="bound">q1</span><span class="main">,</span><span class="bound">b1</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="bound">p1</span><span class="main">,</span> <span class="main">-</span> <span class="bound">q1</span><span class="main">,</span> <span class="bound">b1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lift_definition</span></span> ma_compatible <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> mini_alg <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">p1</span><span class="main">,</span><span class="bound">q1</span><span class="main">,</span><span class="bound">b1</span><span class="main">)</span> <span class="main">(</span><span class="bound">p2</span><span class="main">,</span><span class="bound">q2</span><span class="main">,</span><span class="bound">b2</span><span class="main">)</span><span class="main">.</span> <span class="bound">q1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">q2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">b1</span> <span class="main">=</span> <span class="bound">b2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ma_normalize</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">×</span> rat <span class="main">×</span> nat <span class="main">⇒</span> rat <span class="main">×</span> rat <span class="main">×</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ma_normalize</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span> <span class="main">⇒</span> <span class="keyword1">if</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Real_Impl-ma_normalize_case"><span class="command">lemma</span></span> ma_normalize_case<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> ma_normalize <span class="free">r</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span> <span class="main">⇒</span> real_of_rat <span class="bound">a</span> <span class="main">+</span> real_of_rat <span class="bound">b</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="bound">c</span><span class="main">)</span><span class="main">)</span>
  <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">r</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span> <span class="main">⇒</span> real_of_rat <span class="bound">a</span> <span class="main">+</span> real_of_rat <span class="bound">b</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="bound">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ma_normalize_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> ma_plus <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> mini_alg <span class="main">⇒</span> mini_alg"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">p1</span><span class="main">,</span><span class="bound">q1</span><span class="main">,</span><span class="bound">b1</span><span class="main">)</span> <span class="main">(</span><span class="bound">p2</span><span class="main">,</span><span class="bound">q2</span><span class="main">,</span><span class="bound">b2</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">q1</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span>
    <span class="main">(</span><span class="bound">p1</span> <span class="main">+</span> <span class="bound">p2</span><span class="main">,</span> <span class="bound">q2</span><span class="main">,</span> <span class="bound">b2</span><span class="main">)</span> <span class="keyword1">else</span> ma_normalize <span class="main">(</span><span class="bound">p1</span> <span class="main">+</span> <span class="bound">p2</span><span class="main">,</span> <span class="bound">q1</span> <span class="main">+</span> <span class="bound">q2</span><span class="main">,</span> <span class="bound">b1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ma_normalize_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> ma_times <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> mini_alg <span class="main">⇒</span> mini_alg"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">p1</span><span class="main">,</span><span class="bound">q1</span><span class="main">,</span><span class="bound">b1</span><span class="main">)</span> <span class="main">(</span><span class="bound">p2</span><span class="main">,</span><span class="bound">q2</span><span class="main">,</span><span class="bound">b2</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">q1</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span>
    ma_normalize <span class="main">(</span><span class="bound">p1</span><span class="main">*</span><span class="bound">p2</span><span class="main">,</span> <span class="bound">p1</span><span class="main">*</span><span class="bound">q2</span><span class="main">,</span> <span class="bound">b2</span><span class="main">)</span> <span class="keyword1">else</span>
    ma_normalize <span class="main">(</span><span class="bound">p1</span><span class="main">*</span><span class="bound">p2</span> <span class="main">+</span> of_nat <span class="bound">b2</span><span class="main">*</span><span class="bound">q1</span><span class="main">*</span><span class="bound">q2</span><span class="main">,</span> <span class="bound">p1</span><span class="main">*</span><span class="bound">q2</span> <span class="main">+</span> <span class="bound">q1</span><span class="main">*</span><span class="bound">p2</span><span class="main">,</span> <span class="bound">b1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ma_normalize_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> ma_inverse <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> mini_alg"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">let</span> <span class="bound">d</span> <span class="main">=</span> inverse <span class="main">(</span><span class="bound">p</span> <span class="main">*</span> <span class="bound">p</span> <span class="main">-</span> of_nat <span class="bound">b</span> <span class="main">*</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">q</span><span class="main">)</span> <span class="keyword1">in</span>
   ma_normalize <span class="main">(</span><span class="bound">p</span> <span class="main">*</span> <span class="bound">d</span><span class="main">,</span> <span class="main">-</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">d</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def ma_normalize_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> ma_floor <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">case</span> <span class="main">(</span>quotient_of <span class="bound">p</span><span class="main">,</span>quotient_of <span class="bound">q</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="main">(</span><span class="bound">z1</span><span class="main">,</span><span class="bound">n1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">z2</span><span class="main">,</span><span class="bound">n2</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="keyword1">let</span> <span class="bound">z2n1</span> <span class="main">=</span> <span class="bound">z2</span> <span class="main">*</span> <span class="bound">n1</span><span class="main">;</span> <span class="bound">z1n2</span> <span class="main">=</span> <span class="bound">z1</span> <span class="main">*</span> <span class="bound">n2</span><span class="main">;</span> <span class="bound">n12</span> <span class="main">=</span> <span class="bound">n1</span> <span class="main">*</span> <span class="bound">n2</span><span class="main">;</span> <span class="bound">prod</span> <span class="main">=</span> <span class="bound">z2n1</span> <span class="main">*</span> <span class="bound">z2n1</span> <span class="main">*</span> int <span class="bound">b</span> <span class="keyword1">in</span>
    <span class="main">(</span><span class="bound">z1n2</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">z2n1</span> <span class="main">≥</span> <span class="main">0</span> <span class="keyword1">then</span> sqrt_int_floor_pos <span class="bound">prod</span> <span class="keyword1">else</span> <span class="main">-</span> sqrt_int_ceiling_pos <span class="bound">prod</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="bound">n12</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> ma_sqrt <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> mini_alg"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">=</span> quotient_of <span class="bound">p</span><span class="main">;</span> <span class="bound">aa</span> <span class="main">=</span> abs <span class="main">(</span><span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="keyword1">in</span>
   <span class="keyword1">case</span> sqrt_int <span class="bound">aa</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span>inverse <span class="main">(</span>of_int <span class="bound">b</span><span class="main">)</span><span class="main">,</span>nat <span class="bound">aa</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span>Cons <span class="bound">s</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>of_int <span class="bound">s</span> <span class="main">/</span> of_int <span class="bound">b</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Let_def<span class="main">)</span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">prod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">×</span> rat <span class="main">×</span> nat"</span></span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> prod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">prod</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">prod</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">prod</span> <span class="keyword1">of</span>
                     <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⇒</span>
                       <span class="keyword1">case</span> quotient_of <span class="bound">p</span> <span class="keyword1">of</span>
                       <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⇒</span>
                         <span class="main">(</span><span class="keyword1">case</span> sqrt_int <span class="main">¦</span><span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span><span class="main">¦</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> inverse <span class="main">(</span>of_int <span class="bound">b</span><span class="main">)</span><span class="main">,</span> nat <span class="main">¦</span><span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span><span class="main">¦</span><span class="main">)</span>
                         <span class="main">|</span> <span class="bound">s</span> <span class="main">#</span> <span class="bound">x</span> <span class="main">⇒</span> <span class="main">(</span>of_int <span class="bound">s</span> <span class="main">/</span> of_int <span class="bound">b</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                    <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="bound">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">b</span> <span class="main">∈</span> sqrt_irrat<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sqrt_int <span class="main">(</span>abs <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword3"><span class="command">case</span></span> Nil
     <span class="keyword1"><span class="command">from</span></span> sqrt_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span><span class="main">]</span> Nil <span class="keyword1"><span class="command">have</span></span> irrat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">¦</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">¦</span> <span class="main">∈</span> sqrt_irrat"</span></span>
     <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">¦</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">¦</span> <span class="main">∉</span> sqrt_irrat"</span></span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="main">::</span> <span class="quoted">rat</span>
       <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> rat_of_nat <span class="main">(</span>nat <span class="main">¦</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sqrt_irrat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> rat_of_int <span class="main">¦</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">from</span></span> sqr_rat_of_int<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> irrat <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod p<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod p Cons<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> ma_equal <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> mini_alg <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">p1</span><span class="main">,</span><span class="bound">q1</span><span class="main">,</span><span class="bound">b1</span><span class="main">)</span> <span class="main">(</span><span class="bound">p2</span><span class="main">,</span><span class="bound">q2</span><span class="main">,</span><span class="bound">b2</span><span class="main">)</span><span class="main">.</span>
   <span class="bound">p1</span> <span class="main">=</span> <span class="bound">p2</span> <span class="main">∧</span> <span class="bound">q1</span> <span class="main">=</span> <span class="bound">q2</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">q1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">b1</span> <span class="main">=</span> <span class="bound">b2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> ma_ge_0 <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">let</span> <span class="bound">bqq</span> <span class="main">=</span> of_nat <span class="bound">b</span> <span class="main">*</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">q</span><span class="main">;</span> <span class="bound">pp</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">*</span> <span class="bound">p</span> <span class="keyword1">in</span>
  <span class="main">0</span> <span class="main">≤</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">bqq</span> <span class="main">≤</span> <span class="bound">pp</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">pp</span> <span class="main">≤</span> <span class="bound">bqq</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> ma_is_rat <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ge_0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ge_0</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Real_Impl-ma_ge_0"><span class="command">lemma</span></span> ma_ge_0<span class="main">:</span> <span class="quoted"><span class="quoted">"ge_0 <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> ma_ge_0 <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p'</span> <span class="skolem">q'</span> <span class="main">::</span> <span class="quoted">rat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b'</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> b'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">b'</span> <span class="main">∈</span> sqrt_irrat"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> real_of_nat <span class="skolem">b'</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> real_of_rat <span class="skolem">p'</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> real_of_rat <span class="skolem">q'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> b' <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">b'</span> <span class="main">∈</span> sqrt_irrat"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qb</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> sqrt<span class="main">:</span> <span class="quoted"><span class="quoted">"sqrt <span class="skolem">b</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> b<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sqrt_irrat_def b_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> real_of_rat <span class="main">(</span>of_nat <span class="skolem">b'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">qb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">∧</span> abs <span class="skolem">qb</span> <span class="main">≤</span> abs <span class="skolem">p</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">qb</span> <span class="main">∧</span> abs <span class="skolem">p</span> <span class="main">≤</span> abs <span class="skolem">qb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">∧</span> <span class="skolem">qb</span> <span class="main">*</span> <span class="skolem">qb</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">qb</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="skolem">qb</span> <span class="main">*</span> <span class="skolem">qb</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> abs_lesseq_square <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qb</span> <span class="main">*</span> <span class="skolem">qb</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qb_def
    <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">qb</span> <span class="main">⟷</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qb_def <span class="keyword1"><span class="command">using</span></span> sqrt disj
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_cases mult_eq_0_iff mult_nonneg_nonneg mult_nonpos_nonneg order_class.order.antisym  qb_def real_sqrt_eq_zero_cancel_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">q</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">q</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span>
    <span class="main">⟷</span> <span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="skolem">p'</span> <span class="main">∧</span> of_nat <span class="skolem">b'</span> <span class="main">*</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="skolem">q'</span> <span class="main">≤</span> <span class="skolem">p'</span> <span class="main">*</span> <span class="skolem">p'</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">q'</span> <span class="main">∧</span> <span class="skolem">p'</span> <span class="main">*</span> <span class="skolem">p'</span> <span class="main">≤</span> of_nat <span class="skolem">b'</span> <span class="main">*</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="skolem">q'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qb_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> bdef p_def q_def of_rat_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> of_rat_less_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ge_0 <span class="main">(</span>real_of_rat <span class="skolem">p'</span> <span class="main">+</span> real_of_rat <span class="skolem">q'</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="skolem">p'</span> <span class="main">∧</span> of_nat <span class="skolem">b'</span> <span class="main">*</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="skolem">q'</span> <span class="main">≤</span> <span class="skolem">p'</span> <span class="main">*</span> <span class="skolem">p'</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">q'</span> <span class="main">∧</span> <span class="skolem">p'</span> <span class="main">*</span> <span class="skolem">p'</span> <span class="main">≤</span> of_nat <span class="skolem">b'</span> <span class="main">*</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="skolem">q'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ge_0_def p_def b_def q_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_add of_rat_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Real_Impl-ma_0"><span class="command">lemma</span></span> ma_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> real_of <span class="main">(</span>ma_of_rat <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Real_Impl-ma_1"><span class="command">lemma</span></span> ma_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> real_of <span class="main">(</span>ma_of_rat <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Real_Impl-ma_uminus"><span class="command">lemma</span></span> ma_uminus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> real_of <span class="main">(</span>ma_uminus <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_minus<span class="main">)</span>

<span class="keyword1" id="Real_Impl-ma_inverse"><span class="command">lemma</span></span> ma_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>real_of <span class="free">r</span><span class="main">)</span> <span class="main">=</span> real_of <span class="main">(</span>ma_inverse <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p'</span> <span class="skolem">q'</span> <span class="main">::</span> <span class="quoted">rat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b'</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> b'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">b'</span> <span class="main">∈</span> sqrt_irrat"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> real_of_nat <span class="skolem">b'</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> real_of_rat <span class="skolem">p'</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> real_of_rat <span class="skolem">q'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> b' <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">b'</span> <span class="main">∈</span> sqrt_irrat"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> sqrt_irrat<span class="main">[</span><span class="operator">OF</span> b'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">p'</span></span><span class="main">]</span> b_def p_def q_def False <span class="keyword1"><span class="command">have</span></span> nnull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mult_left_cancel<span class="main">[</span><span class="operator">OF</span> nnull<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nnull <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> right_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span><span class="skolem">p'</span> <span class="main">*</span> <span class="skolem">p'</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">q'</span> <span class="main">*</span> <span class="skolem">q'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> p_def b_def q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_mult of_rat_divide<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real_of_rat <span class="main">(</span>of_nat <span class="skolem">b'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p'</span> <span class="main">/</span> <span class="skolem">q'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p'</span> <span class="main">/</span> <span class="skolem">q'</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="skolem">b'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> of_rat_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> b False <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> sqrt_irrat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>real_of_rat <span class="skolem">p'</span> <span class="main">+</span> real_of_rat <span class="skolem">q'</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       real_of_rat <span class="main">(</span><span class="skolem">p'</span> <span class="main">*</span> inverse <span class="main">(</span><span class="skolem">p'</span> <span class="main">*</span> <span class="skolem">p'</span> <span class="main">-</span> of_nat <span class="skolem">b'</span> <span class="main">*</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="skolem">q'</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
       real_of_rat <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">q'</span> <span class="main">*</span> inverse <span class="main">(</span><span class="skolem">p'</span> <span class="main">*</span> <span class="skolem">p'</span> <span class="main">-</span> of_nat <span class="skolem">b'</span> <span class="main">*</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="skolem">q'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="skolem">b'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> of_rat_mult of_rat_divide of_rat_diff of_rat_minus b_def p_def q_def
             <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Real_Impl-ma_sqrt_main"><span class="command">lemma</span></span> ma_sqrt_main<span class="main">:</span> <span class="quoted"><span class="quoted">"ma_rat <span class="free">r</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> ma_coeff <span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> sqrt <span class="main">(</span>real_of <span class="free">r</span><span class="main">)</span> <span class="main">=</span> real_of <span class="main">(</span>ma_sqrt <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">rat</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> abs<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> pab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> of_int <span class="skolem">a</span> <span class="main">/</span> of_int <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> quotient_of_div<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ab <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> quotient_of_denom_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> p pab <span class="keyword1"><span class="command">have</span></span> abpos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_int_0_le_iff of_int_le_0_iff zero_le_divide_iff zero_le_mult_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rab<span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>nat <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> real_of_int <span class="skolem">a</span> <span class="main">*</span> real_of_int <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abpos
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>of_int <span class="skolem">a</span> <span class="main">/</span> of_int <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="keyword1">case</span> quotient_of <span class="skolem">p</span> <span class="keyword1">of</span>
               <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> sqrt_int <span class="main">¦</span><span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span><span class="main">¦</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> inverse <span class="main">(</span>of_int <span class="bound">b</span><span class="main">)</span><span class="main">,</span> nat <span class="main">¦</span><span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span><span class="main">¦</span><span class="main">)</span>
                 <span class="main">|</span> <span class="bound">s</span> <span class="main">#</span> <span class="bound">x</span> <span class="main">⇒</span> <span class="main">(</span>of_int <span class="bound">s</span> <span class="main">/</span> of_int <span class="bound">b</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">of</span>
          <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⇒</span> of_rat <span class="bound">p</span> <span class="main">+</span> of_rat <span class="bound">q</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>real_of_rat <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="var">?lhs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pab
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_rat_divide of_rat_of_int_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sqrt_int <span class="main">¦</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">¦</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">sb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sb</span> <span class="main">=</span> sqrt <span class="main">(</span>of_int <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">sa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="main">=</span> sqrt <span class="main">(</span>of_int <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> b sb_def <span class="keyword1"><span class="command">have</span></span> sb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sb</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> sbb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sb</span> <span class="main">*</span> <span class="skolem">sb</span> <span class="main">=</span> real_of_int <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sb_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sqrt_sqrt<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> b<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Nil <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">sa</span> <span class="main">/</span> <span class="skolem">sb</span> <span class="main">=</span>
      inverse <span class="main">(</span>of_int <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">sa</span> <span class="main">*</span> <span class="skolem">sb</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ab sa_def sb_def <span class="keyword1"><span class="command">using</span></span> abpos
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rab of_rat_divide real_sqrt_mult real_sqrt_divide of_rat_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">sa</span> <span class="main">=</span> inverse <span class="main">(</span>of_int <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">sa</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">sb</span> <span class="main">*</span> <span class="skolem">sb</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sb
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b divide_real_def eq_divide_imp inverse_divide inverse_inverse_eq inverse_mult_distrib less_int_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> of_int_eq_0_iff real_sqrt_eq_zero_cancel_iff sb_def sbb times_divide_eq_right<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> sb<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> sbb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">s</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Cons sqrt_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">=</span> abs <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> sqrt_int_pos<span class="main">[</span><span class="operator">OF</span> Cons<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>real_of_int <span class="main">(</span>abs <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> of_int <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_of_nonneg of_int_mult of_int_abs real_sqrt_abs2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> abpos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">s</span> <span class="main">=</span> sqrt <span class="main">(</span>real_of_int <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ab split <span class="keyword1"><span class="command">using</span></span> Cons b
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_divide <span class="dynamic"><span class="dynamic">field_simps</span></span> real_sqrt_divide real_sqrt_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>real_of_rat <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Real_Impl-ma_sqrt"><span class="command">lemma</span></span> ma_sqrt<span class="main">:</span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>real_of <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> ma_coeff <span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span>
  <span class="main">(</span><span class="keyword1">if</span> ma_rat <span class="free">r</span> <span class="main">≥</span> <span class="main">0</span> <span class="keyword1">then</span> real_of <span class="main">(</span>ma_sqrt <span class="free">r</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">-</span> real_of <span class="main">(</span>ma_sqrt <span class="main">(</span>ma_uminus <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1">else</span> Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''cannot represent sqrt of irrational number''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> sqrt <span class="main">(</span>real_of <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ma_coeff <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> 0 <span class="main">=</span> this
  <span class="keyword1"><span class="command">hence</span></span> 00<span class="main">:</span> <span class="quoted"><span class="quoted">"ma_coeff <span class="main">(</span>ma_uminus <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ma_rat <span class="free">r</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> ma_sqrt_main<span class="main">[</span><span class="operator">OF</span> this 0<span class="main">]</span> 0 True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ma_rat <span class="main">(</span>ma_uminus <span class="free">r</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> ma_sqrt_main<span class="main">[</span><span class="operator">OF</span> this 00<span class="main">,</span> <span class="operator">folded</span> ma_uminus<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> False 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_sqrt_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Real_Impl-ma_plus"><span class="command">lemma</span></span> ma_plus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of <span class="free">r1</span> <span class="main">+</span> real_of <span class="free">r2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> ma_compatible <span class="free">r1</span> <span class="free">r2</span>
    <span class="keyword1">then</span> real_of <span class="main">(</span>ma_plus <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="keyword1">else</span>
    Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''different base''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> real_of <span class="free">r1</span> <span class="main">+</span> real_of <span class="free">r2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> of_rat_add<span class="main">)</span>

<span class="keyword1" id="Real_Impl-ma_times"><span class="command">lemma</span></span> ma_times<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of <span class="free">r1</span> <span class="main">*</span> real_of <span class="free">r2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> ma_compatible <span class="free">r1</span> <span class="free">r2</span>
    <span class="keyword1">then</span> real_of <span class="main">(</span>ma_times <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="keyword1">else</span>
    Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''different base''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> real_of <span class="free">r1</span> <span class="main">*</span> real_of <span class="free">r2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> of_rat_mult of_rat_add<span class="main">)</span>

<span class="keyword1" id="Real_Impl-ma_equal"><span class="command">lemma</span></span> ma_equal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"HOL.equal <span class="main">(</span>real_of <span class="free">r1</span><span class="main">)</span> <span class="main">(</span>real_of <span class="free">r2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> ma_compatible <span class="free">r1</span> <span class="free">r2</span>
    <span class="keyword1">then</span> ma_equal <span class="free">r1</span> <span class="free">r2</span> <span class="keyword1">else</span>
    Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''different base''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> HOL.equal <span class="main">(</span>real_of <span class="free">r1</span><span class="main">)</span> <span class="main">(</span>real_of <span class="free">r2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> equal_real_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p1</span> <span class="skolem">q1</span> <span class="skolem">p2</span> <span class="skolem">q2</span> <span class="main">::</span> <span class="quoted">rat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b1</span> <span class="skolem">b2</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">b1</span> <span class="main">∈</span> sqrt_irrat"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">b2</span> <span class="main">∈</span> sqrt_irrat"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">q2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">b1</span> <span class="main">=</span> <span class="skolem">b2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">p1</span> <span class="main">+</span> real_of_rat <span class="skolem">q1</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="skolem">b1</span><span class="main">)</span> <span class="main">=</span>
      real_of_rat <span class="skolem">p2</span> <span class="main">+</span> real_of_rat <span class="skolem">q2</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="skolem">b2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">q1</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="skolem">b1</span><span class="main">)</span> <span class="main">=</span> real_of_rat <span class="main">(</span><span class="skolem">p2</span> <span class="main">-</span> <span class="skolem">p1</span><span class="main">)</span> <span class="main">+</span> real_of_rat <span class="skolem">q2</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="skolem">b2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">=</span> <span class="skolem">p2</span> <span class="main">∧</span> <span class="skolem">q1</span> <span class="main">=</span> <span class="skolem">q2</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">q1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">b1</span> <span class="main">=</span> <span class="skolem">b2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> real_of_rat <span class="skolem">q1</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="skolem">b1</span><span class="main">)</span> <span class="main">=</span> real_of_rat <span class="main">(</span><span class="skolem">p2</span> <span class="main">-</span> <span class="skolem">p1</span><span class="main">)</span> <span class="main">+</span> real_of_rat <span class="skolem">q2</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="skolem">b2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_add of_rat_diff of_rat_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">p1</span> <span class="main">=</span> <span class="skolem">p2</span> <span class="main">∧</span> <span class="skolem">q1</span> <span class="main">=</span> <span class="skolem">q2</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">q1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">b1</span> <span class="main">=</span> <span class="skolem">b2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span>
    <span class="keyword1"><span class="command">from</span></span> base <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">q1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">q2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">q1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">q2</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">b1</span> <span class="main">=</span> <span class="skolem">b2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">=</span> <span class="skolem">p2</span> <span class="main">∧</span> <span class="skolem">q1</span> <span class="main">=</span> <span class="skolem">q2</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">q1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">b1</span> <span class="main">=</span> <span class="skolem">b2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> q1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span><span class="skolem">p2</span> <span class="main">-</span> <span class="skolem">p1</span><span class="main">)</span> <span class="main">+</span> real_of_rat <span class="skolem">q2</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="skolem">b2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> sqrt_irrat b2 <span class="keyword1"><span class="command">have</span></span> q2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> q1 <span class="quoted"><span class="quoted">‹<span class="var">?m</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">q2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">q1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">q2</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">b1</span> <span class="main">=</span> <span class="skolem">b2</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">q2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span><span class="skolem">p1</span> <span class="main">-</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">+</span> real_of_rat <span class="skolem">q1</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="skolem">b1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> b1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sqrt_irrat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">q2</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">b1</span> <span class="main">=</span> <span class="skolem">b2</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span><span class="skolem">p2</span> <span class="main">-</span> <span class="skolem">p1</span><span class="main">)</span> <span class="main">+</span> real_of_rat <span class="main">(</span><span class="skolem">q2</span> <span class="main">-</span> <span class="skolem">q1</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="skolem">b2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> of_rat_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">-</span> <span class="skolem">q1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sqrt_irrat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ *<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> ass b2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> * ass <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Real_Impl-ma_floor"><span class="command">lemma</span></span> ma_floor<span class="main">:</span> <span class="quoted"><span class="quoted">"floor <span class="main">(</span>real_of <span class="free">r</span><span class="main">)</span> <span class="main">=</span> ma_floor <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">::</span> <span class="quoted">rat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="keyword2"><span class="keyword">where</span></span> qp<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z1</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z2</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="keyword2"><span class="keyword">where</span></span> qq<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z2</span><span class="main">,</span><span class="skolem">n2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> qp<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> qq<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> qp<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> of_int <span class="skolem">z1</span> <span class="main">/</span> of_int <span class="skolem">n1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> qq<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> of_int <span class="skolem">z2</span> <span class="main">/</span> of_int <span class="skolem">n2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">z1</span> <span class="main">*</span> <span class="skolem">n2</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="skolem">n1</span> <span class="main">*</span> <span class="skolem">n2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">using</span></span> n2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="skolem">n1</span> <span class="main">*</span> <span class="skolem">n2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q <span class="keyword1"><span class="command">using</span></span> n1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z1n2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1n2</span> <span class="main">=</span> <span class="skolem">z1</span> <span class="main">*</span> <span class="skolem">n2</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z2n1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z2n1</span> <span class="main">=</span> <span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n12</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n12</span> <span class="main">=</span> <span class="skolem">n1</span> <span class="main">*</span> <span class="skolem">n2</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r_add</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r_add</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">z2n1</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span>real_of_int <span class="main">(</span>int <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> n1 n2 <span class="keyword1"><span class="command">have</span></span> n120<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n12</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n12_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"floor <span class="main">(</span>of_rat <span class="skolem">p</span> <span class="main">+</span> of_rat <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="main">(</span>real_of_nat <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> floor <span class="main">(</span><span class="main">(</span>of_int <span class="skolem">z1n2</span> <span class="main">+</span> <span class="skolem">r_add</span><span class="main">)</span> <span class="main">/</span> of_int <span class="skolem">n12</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> r_add_def n12_def z1n2_def z2n1_def
    <span class="keyword1"><span class="command">unfolding</span></span> p q add_divide_distrib of_rat_divide of_rat_of_int_eq of_int_of_nat_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> floor <span class="main">(</span>of_int <span class="skolem">z1n2</span> <span class="main">+</span> <span class="skolem">r_add</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">n12</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> floor_div_pos_int<span class="main"><span class="main">[</span></span><span class="operator">OF</span> n120<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">z1n2</span> <span class="main">+</span> <span class="skolem">r_add</span> <span class="main">=</span> <span class="skolem">r_add</span> <span class="main">+</span> of_int <span class="skolem">z1n2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"floor <span class="main">(</span><span class="main">…</span><span class="main">)</span> <span class="main">=</span> floor <span class="skolem">r_add</span> <span class="main">+</span> <span class="skolem">z1n2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">z1n2</span> <span class="main">+</span> floor <span class="skolem">r_add</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span>of_rat <span class="skolem">p</span> <span class="main">+</span> of_rat <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="skolem">b</span><span class="main">)</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z1n2</span> <span class="main">+</span> <span class="main">⌊</span><span class="skolem">r_add</span><span class="main">⌋</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">n12</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span>of_rat <span class="skolem">p</span> <span class="main">+</span> of_rat <span class="skolem">q</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="skolem">b</span><span class="main">)</span><span class="main">⌋</span> <span class="main">=</span>
              <span class="main">(</span><span class="keyword1">case</span> quotient_of <span class="skolem">p</span> <span class="keyword1">of</span>
               <span class="main">(</span><span class="bound">z1</span><span class="main">,</span> <span class="bound">n1</span><span class="main">)</span> <span class="main">⇒</span>
                 <span class="keyword1">case</span> quotient_of <span class="skolem">q</span> <span class="keyword1">of</span>
                 <span class="main">(</span><span class="bound">z2</span><span class="main">,</span> <span class="bound">n2</span><span class="main">)</span> <span class="main">⇒</span>
                 <span class="main">(</span><span class="bound">z1</span> <span class="main">*</span> <span class="bound">n2</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">z2</span> <span class="main">*</span> <span class="bound">n1</span> <span class="keyword1">then</span> sqrt_int_floor_pos <span class="main">(</span><span class="bound">z2</span> <span class="main">*</span> <span class="bound">n1</span> <span class="main">*</span> <span class="main">(</span><span class="bound">z2</span> <span class="main">*</span> <span class="bound">n1</span><span class="main">)</span> <span class="main">*</span> int <span class="skolem">b</span><span class="main">)</span> <span class="keyword1">else</span>
                    <span class="main">-</span> sqrt_int_ceiling_pos <span class="main">(</span><span class="bound">z2</span> <span class="main">*</span> <span class="bound">n1</span> <span class="main">*</span> <span class="main">(</span><span class="bound">z2</span> <span class="main">*</span> <span class="bound">n1</span><span class="main">)</span> <span class="main">*</span> int <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="bound">n1</span> <span class="main">*</span> <span class="bound">n2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> qp qq split id n12_def z1n2_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">z1</span></span> <span class="main"><span class="main">*</span></span> <span class="skolem"><span class="skolem">n2</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span> <span class="keyword1"><span class="keyword1">div</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">n1</span></span> <span class="main"><span class="main">*</span></span> <span class="skolem"><span class="skolem">n2</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ge_int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span><span class="main">)</span> <span class="main">*</span> int <span class="skolem">b</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_nonneg_nonneg zero_le_square of_nat_0_le_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="skolem">r_add</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span> <span class="keyword1">then</span> sqrt_int_floor_pos <span class="main">(</span><span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span><span class="main">)</span> <span class="main">*</span> int <span class="skolem">b</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">-</span> sqrt_int_ceiling_pos <span class="main">(</span><span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span><span class="main">)</span> <span class="main">*</span> int <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> ge<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span><span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_int_0_le_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> radd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r_add</span> <span class="main">=</span> sqrt <span class="main">(</span>of_int <span class="main">(</span><span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span><span class="main">)</span> <span class="main">*</span> int <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> r_add_def z2n1_def <span class="keyword1"><span class="command">using</span></span> sqrt_sqrt<span class="main">[</span><span class="operator">OF</span> ge<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> real_sqrt_mult<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> radd sqrt_int_floor_pos<span class="main">[</span><span class="operator">OF</span> ge_int<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> ge<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_zero_left neg_0_le_iff_le of_int_0_le_iff order_refl zero_le_mult_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r_add</span> <span class="main">=</span> <span class="main">-</span> sqrt <span class="main">(</span>of_int <span class="main">(</span><span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span><span class="main">)</span> <span class="main">*</span> int <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> r_add_def z2n1_def <span class="keyword1"><span class="command">using</span></span> sqrt_sqrt<span class="main">[</span><span class="operator">OF</span> ge<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_minus minus_mult_commute minus_mult_right of_int_minus of_int_mult real_sqrt_minus real_sqrt_mult z2n1_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> radd<span class="main">:</span> <span class="quoted"><span class="quoted">"floor <span class="skolem">r_add</span> <span class="main">=</span> <span class="main">-</span> ceiling <span class="main">(</span>sqrt <span class="main">(</span>of_int <span class="main">(</span><span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">z2</span> <span class="main">*</span> <span class="skolem">n1</span><span class="main">)</span> <span class="main">*</span> int <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ceiling_def minus_minus<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> radd sqrt_int_ceiling_pos<span class="main">[</span><span class="operator">OF</span> ge_int<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Real_Impl-comparison_impl"><span class="command">lemma</span></span> comparison_impl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> ge_0 <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">y</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">∧</span> ge_0 <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ge_0_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="Real_Impl-ma_of_rat"><span class="command">lemma</span></span> ma_of_rat<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">r</span> <span class="main">=</span> real_of <span class="main">(</span>ma_of_rat <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_rat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code_abbrev</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_rat</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>

<span class="keyword1" id="Real_Impl-ma_is_rat"><span class="command">lemma</span></span> ma_is_rat<span class="main">:</span> <span class="quoted"><span class="quoted">"is_rat <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> ma_is_rat <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> is_rat_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">::</span> <span class="quoted">rat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_nat <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span>of_nat <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="main">∈</span> sqrt_irrat"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?p</span> <span class="main">+</span> <span class="var">?q</span> <span class="main">*</span> sqrt <span class="var">?b</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> False b <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> sqrt_irrat"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">+</span> <span class="var">?q</span> <span class="main">*</span> sqrt <span class="var">?b</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> Rats_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">+</span> <span class="var">?q</span> <span class="main">*</span> sqrt <span class="var">?b</span> <span class="main">=</span> real_of_rat <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">+</span> <span class="var">?q</span> <span class="main">*</span> sqrt <span class="var">?b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_diff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sqrt_irrat<span class="main">[</span><span class="operator">OF</span> disjI2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> b<span class="main"><span class="main">]</span></span> this<span class="main">]</span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* compute all numbers y for which y * y = x, if x ∈ ℚ, otherwise return empty list.
   of course, one could have returned [-sqrt x, sqrt x], but this might result in runtime errors,
   e.g., if sqrt_real (sqrt 2) would be invoked. The current formulation is guaranteed to not crash. *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">sqrt_real</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≥</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">sx</span> <span class="main">=</span> sqrt <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">in</span> <span class="main">[</span><span class="bound">sx</span><span class="main">,</span><span class="main">-</span><span class="bound">sx</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Real_Impl-sqrt_real"><span class="command">lemma</span></span> sqrt_real<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>sqrt_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sqrt_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> x
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def sqrt_real_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">code_datatype</span></span> <span class="quoted">real_of</span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">drop</span><span class="main"><span class="main">:</span></span>
  <span class="quoted"><span class="quoted">"plus <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted"><span class="quoted">"uminus <span class="main">::</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted"><span class="quoted">"times <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted"><span class="quoted">"inverse <span class="main">::</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted"><span class="quoted">"floor <span class="main">::</span> real <span class="main">⇒</span> int"</span></span>
  <span class="quoted">sqrt</span>
  <span class="quoted"><span class="quoted">"HOL.equal <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span>
<span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Ratreal <span class="main">=</span> real_of <span class="main">∘</span> ma_of_rat"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> ma_code_eqns <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">equation</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">]</span> <span class="main">=</span> ma_ge_0 ma_floor ma_0 ma_1 ma_uminus ma_inverse ma_sqrt ma_plus ma_times ma_equal ma_is_rat
  comparison_impl

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">equation</span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">y</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> inverse <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">y</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some tests with small numbers. To work on larger number, one should
  additionally import the theories for efficient calculation on numbers›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="numeral">101.1</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> sqrt <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">6</span> <span class="main">*</span> sqrt <span class="numeral">0.5</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="numeral">606.2</span> <span class="main">*</span> sqrt <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">0.001</span><span class="main">⌋</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">101.1</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> sqrt <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">6</span> <span class="main">*</span> sqrt <span class="numeral">0.5</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">606.2</span> <span class="main">*</span> sqrt <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">0.001</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">101.1</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> sqrt <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">6</span> <span class="main">*</span> sqrt <span class="numeral">0.5</span><span class="main">)</span> <span class="main">&gt;</span> <span class="numeral">606.2</span> <span class="main">*</span> sqrt <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">0.001</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt <span class="numeral">0.1</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">,</span> sqrt <span class="main">(</span><span class="main">-</span> <span class="numeral">0.09</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Real_Unique_Impl">
<div class="head">
<h1>Theory Real_Unique_Impl</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Implementing field extensions of the form Q[sqrt(b)]
    Author:      René Thiemann       &lt;rene.thiemann@uibk.ac.at&gt;
    Maintainer:  René Thiemann
    License:     LGPL
*)</span>

<span class="comment1">(*
Copyright 2009-2014 René Thiemann

This file is part of IsaFoR/CeTA.

IsaFoR/CeTA is free software: you can redistribute it and/or modify it under the
terms of the GNU Lesser General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any later
version.

IsaFoR/CeTA is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License along
with IsaFoR/CeTA. If not, see &lt;http://www.gnu.org/licenses/&gt;.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹A unique representation of real numbers via triples›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Real_Unique_Impl
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#Prime_Product">Prime_Product</a>
  <a href="#Real_Impl">Real_Impl</a>
  <a href="../../show/theories/#Show_Instances">Show.Show_Instances</a>
  <a href="../../show/theories/#Show_Real">Show.Show_Real</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We implement the real numbers again using triples, but now we require an additional
 invariant on the triples, namely that the base has to be a prime product. This has the consequence
 that the mapping of triples into $\reals$ is injective. Hence, equality on reals is now equality
 on triples, which can even be executed in case of different bases. Similarly, we now also allow
 different basis in comparisons. Ultimately, injectivity allows us to define a show-function for
 real numbers, which pretty prints real numbers into strings.›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> mini_alg_unique <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">r</span> <span class="main">::</span> mini_alg <span class="main">.</span> ma_coeff <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> ma_base <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> ma_coeff <span class="bound">r</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> prime_product <span class="main">(</span>ma_base <span class="bound">r</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_mini_alg_unique

<span class="keyword1"><span class="command">lift_definition</span></span> real_of_u <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg_unique <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">real_of</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> mau_floor <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg_unique <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">ma_floor</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> mau_of_rat <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> mini_alg_unique"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">ma_of_rat</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">lift_definition</span></span> mau_rat <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg_unique <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">ma_rat</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> mau_base <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg_unique <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">ma_base</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> mau_coeff <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg_unique <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">ma_coeff</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> mau_uminus <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg_unique <span class="main">⇒</span> mini_alg_unique"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">ma_uminus</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">lift_definition</span></span> mau_compatible <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg_unique <span class="main">⇒</span> mini_alg_unique <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">ma_compatible</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> mau_ge_0 <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg_unique <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">ma_ge_0</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> mau_inverse <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg_unique <span class="main">⇒</span> mini_alg_unique"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">ma_inverse</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ma_normalize_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">lift_definition</span></span> mau_plus <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg_unique <span class="main">⇒</span> mini_alg_unique <span class="main">⇒</span> mini_alg_unique"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">ma_plus</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ma_normalize_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">lift_definition</span></span> mau_times <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg_unique <span class="main">⇒</span> mini_alg_unique <span class="main">⇒</span> mini_alg_unique"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">ma_times</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ma_normalize_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">lift_definition</span></span> ma_identity <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> mini_alg <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(=)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> mau_equal <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg_unique <span class="main">⇒</span> mini_alg_unique <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">ma_identity</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> mau_is_rat <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg_unique <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">ma_is_rat</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Real_Unique_Impl-Ratreal_code"><span class="command">lemma</span></span> Ratreal_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Ratreal <span class="main">=</span> real_of_u <span class="main">∘</span> mau_of_rat"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Real_Unique_Impl-mau_floor"><span class="command">lemma</span></span> mau_floor<span class="main">:</span> <span class="quoted"><span class="quoted">"floor <span class="main">(</span>real_of_u <span class="free">r</span><span class="main">)</span> <span class="main">=</span> mau_floor <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ma_floor <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1" id="Real_Unique_Impl-mau_inverse"><span class="command">lemma</span></span> mau_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>real_of_u <span class="free">r</span><span class="main">)</span> <span class="main">=</span> real_of_u <span class="main">(</span>mau_inverse <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ma_inverse <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1" id="Real_Unique_Impl-mau_uminus"><span class="command">lemma</span></span> mau_uminus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span>real_of_u <span class="free">r</span><span class="main">)</span> <span class="main">=</span> real_of_u <span class="main">(</span>mau_uminus <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ma_uminus <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1" id="Real_Unique_Impl-mau_times"><span class="command">lemma</span></span> mau_times<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_u <span class="free">r1</span> <span class="main">*</span> real_of_u <span class="free">r2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> mau_compatible <span class="free">r1</span> <span class="free">r2</span>
    <span class="keyword1">then</span> real_of_u <span class="main">(</span>mau_times <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="keyword1">else</span>
    Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''different base''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> real_of_u <span class="free">r1</span> <span class="main">*</span> real_of_u <span class="free">r2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ma_times <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1" id="Real_Unique_Impl-mau_plus"><span class="command">lemma</span></span> mau_plus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_u <span class="free">r1</span> <span class="main">+</span> real_of_u <span class="free">r2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> mau_compatible <span class="free">r1</span> <span class="free">r2</span>
    <span class="keyword1">then</span> real_of_u <span class="main">(</span>mau_plus <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="keyword1">else</span>
    Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''different base''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> real_of_u <span class="free">r1</span> <span class="main">+</span> real_of_u <span class="free">r2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ma_plus <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Real_Unique_Impl-real_of_u_inj"><span class="command">lemma</span></span> real_of_u_inj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_u <span class="free">x</span> <span class="main">=</span> real_of_u <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span> of_rat_diff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"real_of_u <span class="free">x</span> <span class="main">=</span> real_of_u <span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ma_coeff <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> ma_base <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> ma_coeff <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> prime_product <span class="main">(</span>ma_base <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"ma_coeff <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> ma_base <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> ma_coeff <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> prime_product <span class="main">(</span>ma_base <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"real_of <span class="skolem">x</span> <span class="main">=</span> real_of <span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p1</span> <span class="skolem">q1</span> <span class="skolem">p2</span> <span class="skolem">q2</span> <span class="main">::</span> <span class="quoted">rat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b1</span> <span class="skolem">b2</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">p1</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">p2</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">q1</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">q2</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_nat <span class="skolem">b1</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_nat <span class="skolem">b2</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> q1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">b1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">q1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> prime_product <span class="skolem">b1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> q2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">b2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">q2</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> prime_product <span class="skolem">b2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">b1</span> <span class="main">∈</span> sqrt_irrat"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">b2</span> <span class="main">∈</span> sqrt_irrat"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p1</span> <span class="main">+</span> <span class="var">?q1</span> <span class="main">*</span> sqrt <span class="var">?b1</span> <span class="main">=</span> <span class="var">?p2</span> <span class="main">+</span> <span class="var">?q2</span> <span class="main">*</span> sqrt <span class="var">?b2</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">=</span> <span class="skolem">p2</span> <span class="main">∧</span> <span class="skolem">q1</span> <span class="main">=</span> <span class="skolem">q2</span> <span class="main">∧</span> <span class="skolem">b1</span> <span class="main">=</span> <span class="skolem">b2</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sqrt_irrat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i2<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">p2</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">p1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> eq True q1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> True q1 q2 eq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"prime_product <span class="skolem">b1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sqrt_irrat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i1<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">p1</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">p2</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> eq * q2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"prime_product <span class="skolem">b2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> 1 i1 <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sqrt_irrat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">b1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 2 i2 <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sqrt_irrat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">b2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q3</span> <span class="main">=</span> <span class="skolem">p2</span> <span class="main">-</span> <span class="skolem">p1</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">q3</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_rat <span class="main">(</span><span class="skolem">q2</span> <span class="main">*</span> <span class="skolem">q2</span> <span class="main">*</span> of_nat <span class="skolem">b2</span> <span class="main">+</span> <span class="var">?sq</span> <span class="skolem">q3</span>  <span class="main">-</span> <span class="var">?sq</span> <span class="skolem">q1</span> <span class="main">*</span> of_nat <span class="skolem">b1</span><span class="main">)</span> <span class="main">+</span> of_rat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">q2</span> <span class="main">*</span> <span class="skolem">q3</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="var">?b2</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> eq <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q1</span> <span class="main">*</span> sqrt <span class="var">?b1</span> <span class="main">=</span> <span class="var">?q2</span> <span class="main">*</span> sqrt <span class="var">?b2</span> <span class="main">+</span> <span class="var">?q3</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q3_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?sq</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span>real_of_rat <span class="numeral">2</span> <span class="main">*</span> <span class="var">?q2</span> <span class="main">*</span> <span class="var">?q3</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="var">?b2</span> <span class="main">+</span>
          <span class="main">(</span><span class="var">?sq</span> <span class="var">?q2</span> <span class="main">*</span> <span class="var">?b2</span> <span class="main">+</span>  <span class="var">?sq</span> <span class="var">?q3</span> <span class="main">-</span> <span class="var">?sq</span> <span class="var">?q1</span> <span class="main">*</span> <span class="var">?b1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?e</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_mult of_rat_add of_rat_minus<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> sqrt_irrat<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span> 2 i2 <span class="keyword1"><span class="command">have</span></span> q3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">=</span> <span class="skolem">p2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rat_of_nat <span class="skolem">b1</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rat_of_nat <span class="skolem">b2</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> eq<span class="main">[</span><span class="operator">unfolded</span> q3<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?sq</span> <span class="skolem">q2</span> <span class="main">*</span> <span class="var">?b2</span> <span class="main">=</span> <span class="var">?sq</span> <span class="skolem">q1</span> <span class="main">*</span> <span class="var">?b1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="keyword2"><span class="keyword">where</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="skolem">q1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z1</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z2</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="keyword2"><span class="keyword">where</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="skolem">q2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z2</span><span class="main">,</span><span class="skolem">n2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">note</span></span> id <span class="main">=</span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> d1<span class="main">]</span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> d2<span class="main">]</span>
        <span class="keyword1"><span class="command">note</span></span> pos <span class="main">=</span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> d1<span class="main">]</span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> d2<span class="main">]</span>
        <span class="keyword1"><span class="command">from</span></span> id<span class="main">(</span>1<span class="main">)</span> 1<span class="main">(</span>1<span class="main">)</span> pos<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> z1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> id<span class="main">(</span>2<span class="main">)</span> 2<span class="main">(</span>1<span class="main">)</span> pos<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> z2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rat_of_int <span class="skolem">n1</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rat_of_int <span class="skolem">n2</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rat_of_int <span class="skolem">z1</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rat_of_int <span class="skolem">z2</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> eq<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> id<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="var">?sq</span> <span class="var">?n1</span> <span class="main">*</span> <span class="var">?sq</span> <span class="var">?n2</span>"</span></span><span class="main">,</span>
          <span class="operator">simplified</span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sq</span> <span class="main">(</span><span class="var">?n1</span> <span class="main">*</span> <span class="var">?z2</span><span class="main">)</span> <span class="main">*</span> <span class="var">?b2</span> <span class="main">=</span> <span class="var">?sq</span> <span class="main">(</span><span class="var">?n2</span> <span class="main">*</span> <span class="var">?z1</span><span class="main">)</span> <span class="main">*</span> <span class="var">?b1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n1</span> <span class="main">*</span> <span class="var">?z2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n2</span> <span class="main">*</span> <span class="var">?z1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z1 z2 pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"rat_of_int <span class="skolem">i1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="skolem">i2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?sq</span> <span class="main">(</span>rat_of_int <span class="skolem">i2</span><span class="main">)</span> <span class="main">*</span> <span class="var">?b2</span> <span class="main">=</span> <span class="var">?sq</span> <span class="main">(</span>rat_of_int <span class="skolem">i1</span><span class="main">)</span> <span class="main">*</span> <span class="var">?b1</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> of_int_mult<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"int <span class="skolem">b1</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"int <span class="skolem">b2</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> eq <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?sq</span> <span class="skolem">i1</span> <span class="main">*</span> <span class="var">?b1</span> <span class="main">=</span> <span class="var">?sq</span> <span class="skolem">i2</span> <span class="main">*</span> <span class="var">?b2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> of_int_eq_iff of_int_mult of_int_of_nat_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> eq<span class="main">,</span> <span class="operator">of</span> <span class="quoted">nat</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sq</span> <span class="main">(</span>nat <span class="main">(</span>abs <span class="skolem">i1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">b1</span> <span class="main">=</span> <span class="var">?sq</span> <span class="main">(</span>nat <span class="main">(</span>abs <span class="skolem">i2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">b2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_of_nat eq nat_abs_mult_distrib nat_int<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span>abs <span class="skolem">i1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span>abs <span class="skolem">i2</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?sq</span> <span class="skolem">n1</span> <span class="main">*</span> <span class="skolem">b1</span> <span class="main">=</span> <span class="var">?sq</span> <span class="skolem">n2</span> <span class="main">*</span> <span class="skolem">b2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> b1 0 <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">*</span> <span class="skolem">n1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> b2 0 <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span> <span class="main">*</span> <span class="skolem">n2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="main">(</span><span class="var">?sq</span> <span class="skolem">n1</span> <span class="main">*</span> <span class="skolem">b1</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="skolem">b1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> multiplicity <span class="skolem">p</span> <span class="skolem">n1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> b1 p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_elem_multiplicity_mult_distrib<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="skolem">b1</span> <span class="keyword1">mod</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> id1<span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="main">(</span><span class="var">?sq</span> <span class="skolem">n1</span> <span class="main">*</span> <span class="skolem">b1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="skolem">b1</span> <span class="keyword1">mod</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="main">(</span><span class="var">?sq</span> <span class="skolem">n2</span> <span class="main">*</span> <span class="skolem">b2</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="skolem">b2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> multiplicity <span class="skolem">p</span> <span class="skolem">n2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> b2 p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_elem_multiplicity_mult_distrib<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="skolem">b2</span> <span class="keyword1">mod</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="main">(</span><span class="var">?sq</span> <span class="skolem">n2</span> <span class="main">*</span> <span class="skolem">b2</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="skolem">b2</span> <span class="keyword1">mod</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">from</span></span> id1 id2 eq <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="skolem">b1</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="skolem">b2</span> <span class="keyword1">mod</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">)</span> 2<span class="main">(</span>2<span class="main">)</span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="skolem">b1</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="skolem">b2</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> prime_product_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="skolem">b1</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="skolem">b2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">with</span></span> b1<span class="main">(</span>1<span class="main">)</span> b2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">=</span> <span class="skolem">b2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicity_eq_nat<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> *<span class="main">[</span><span class="operator">unfolded</span> b q3<span class="main">]</span> b1<span class="main">(</span>1<span class="main">)</span> b2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> <span class="skolem">q2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> p q b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> mau_sqrt <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg_unique <span class="main">⇒</span> mini_alg_unique"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">ma</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">=</span> quotient_of <span class="main">(</span>ma_rat <span class="bound">ma</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="bound">sq</span><span class="main">,</span><span class="bound">fact</span><span class="main">)</span> <span class="main">=</span> prime_product_factor <span class="main">(</span>nat <span class="main">(</span>abs <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="bound">ma'</span> <span class="main">=</span> ma_of_rat <span class="main">(</span>of_int <span class="main">(</span>sgn<span class="main">(</span><span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="bound">sq</span> <span class="main">/</span> of_int <span class="bound">b</span><span class="main">)</span>
      <span class="keyword1">in</span> ma_times <span class="bound">ma'</span> <span class="main">(</span>ma_sqrt <span class="main">(</span>ma_of_rat <span class="main">(</span>of_nat <span class="bound">fact</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ma</span> <span class="main">::</span> <span class="quoted">mini_alg</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?num</span></span></span> <span class="main">=</span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> quotient_of <span class="main">(</span>ma_rat <span class="skolem">ma</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="bound">sq</span><span class="main">,</span> <span class="bound">fact</span><span class="main">)</span> <span class="main">=</span> prime_product_factor <span class="main">(</span>nat <span class="main">(</span><span class="main">¦</span><span class="bound">a</span><span class="main">¦</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
       <span class="bound">ma'</span> <span class="main">=</span> ma_of_rat <span class="main">(</span>rat_of_int <span class="main">(</span>sgn <span class="bound">a</span><span class="main">)</span> <span class="main">*</span> rat_of_nat <span class="bound">sq</span> <span class="main">/</span> of_int <span class="bound">b</span><span class="main">)</span>
     <span class="keyword1">in</span> ma_times <span class="bound">ma'</span> <span class="main">(</span>ma_sqrt <span class="main">(</span>ma_of_rat <span class="main">(</span>rat_of_nat <span class="bound">fact</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="main">(</span>ma_rat <span class="skolem">ma</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sq</span></span> <span class="skolem"><span class="skolem">fact</span></span> <span class="keyword2"><span class="keyword">where</span></span> ppf<span class="main">:</span> <span class="quoted"><span class="quoted">"prime_product_factor <span class="main">(</span>nat <span class="main">(</span>abs <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">sq</span><span class="main">,</span><span class="skolem">fact</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">asq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">asq</span> <span class="main">=</span> rat_of_int <span class="main">(</span>sgn <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="skolem">sq</span> <span class="main">/</span> of_int <span class="skolem">b</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ma'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ma'</span> <span class="main">=</span> ma_of_rat <span class="skolem">asq</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">sqrt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sqrt</span> <span class="main">=</span> ma_sqrt <span class="main">(</span>ma_of_rat <span class="main">(</span>rat_of_nat <span class="skolem">fact</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> num<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?num</span> <span class="main">=</span> ma_times <span class="skolem">ma'</span> <span class="skolem">sqrt</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q ppf asq_def Let_def split ma'_def sqrt_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?inv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">ma</span><span class="main">.</span> ma_coeff <span class="bound">ma</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> ma_base <span class="bound">ma</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> ma_coeff <span class="bound">ma</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> prime_product <span class="main">(</span>ma_base <span class="bound">ma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ma'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?inv</span> <span class="skolem">ma'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ma'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> int <span class="bound">i</span> <span class="main">*</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="main">::</span> rat<span class="main">.</span> <span class="bound">i</span> <span class="main">/</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">i</span>"</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="main">1</span> <span class="main">::</span> rat<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span><span class="main">.</span> nat <span class="main">¦</span>int <span class="bound">n</span><span class="main">¦</span> <span class="main">=</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> prime_product_factor<span class="main">[</span><span class="operator">OF</span> ppf<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_product <span class="skolem">fact</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> sqrt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?inv</span> <span class="skolem">sqrt</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sqrt_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> split quotient_of_nat Let_def id<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"sqrt_int <span class="main">¦</span>int <span class="improper">facta</span><span class="main">¦</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?inv</span> <span class="var">?num</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> num <span class="keyword1"><span class="command">using</span></span> ma' sqrt
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ma_normalize_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>  <span class="comment1">(* slow *)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Real_Unique_Impl-sqrt_sgn"><span class="command">lemma</span></span> sqrt_sgn<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>of_int <span class="main">(</span>sgn <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span>sgn <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_sqrt_minus<span class="main">)</span>

<span class="keyword1" id="Real_Unique_Impl-mau_sqrt_main"><span class="command">lemma</span></span> mau_sqrt_main<span class="main">:</span> <span class="quoted"><span class="quoted">"mau_coeff <span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> sqrt <span class="main">(</span>real_of_u <span class="free">r</span><span class="main">)</span> <span class="main">=</span> real_of_u <span class="main">(</span>mau_sqrt <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ma_coeff <span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of <span class="skolem">r</span> <span class="main">=</span> of_rat <span class="main">(</span>ma_rat <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="main">(</span>ma_rat <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> q<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"ma_rat <span class="skolem">r</span> <span class="main">=</span> of_int <span class="skolem">a</span> <span class="main">/</span> of_int <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> q<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sq</span></span> <span class="skolem"><span class="skolem">fact</span></span> <span class="keyword2"><span class="keyword">where</span></span> ppf<span class="main">:</span> <span class="quoted"><span class="quoted">"prime_product_factor <span class="main">(</span>nat <span class="main">(</span><span class="main">¦</span><span class="skolem">a</span><span class="main">¦</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">sq</span><span class="main">,</span> <span class="skolem">fact</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> prime_product_factor<span class="main">[</span><span class="operator">OF</span> ppf<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="main">¦</span><span class="skolem">a</span><span class="main">¦</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">sq</span> <span class="main">*</span> <span class="skolem">sq</span> <span class="main">*</span> <span class="skolem">fact</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>real_of <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> sqrt<span class="main">(</span>of_int <span class="skolem">a</span> <span class="main">/</span> of_int <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rr r
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_rat_divide of_rat_of_int_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">a</span> <span class="main">/</span> of_int <span class="skolem">b</span> <span class="main">=</span> of_int <span class="skolem">a</span> <span class="main">*</span> of_int <span class="skolem">b</span> <span class="main">/</span> <span class="main">(</span>of_int <span class="skolem">b</span> <span class="main">*</span> of_int <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">…</span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span>of_int <span class="skolem">a</span> <span class="main">*</span> of_int <span class="skolem">b</span><span class="main">)</span> <span class="main">/</span> of_int <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sqrt_sqrt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">b</span>"</span></span><span class="main">]</span> b
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_real_def of_int_0_less_iff real_sqrt_divide real_sqrt_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">a</span> <span class="main">*</span> of_int <span class="skolem">b</span> <span class="main">=</span> real_of_int <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> sgn <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span>abs <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> mult_sgn_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span><span class="main">…</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span>sgn <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> real_of_int <span class="main">(</span><span class="main">¦</span><span class="skolem">a</span><span class="main">¦</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> of_int_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sgn <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span><span class="main">¦</span><span class="skolem">a</span><span class="main">¦</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="main">(</span>nat <span class="main">(</span>abs <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_sgn mult_pos_pos mult_zero_left nat_int of_int_of_nat_eq of_nat_0 zero_less_abs_iff zero_less_imp_eq_int<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_nat <span class="skolem">fact</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="skolem">sq</span> <span class="main">*</span> of_nat <span class="skolem">sq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ab of_nat_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>of_int <span class="main">(</span>sgn <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="skolem">fact</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="skolem">sq</span> <span class="main">*</span> of_nat <span class="skolem">sq</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    of_int <span class="main">(</span>sgn <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span>of_nat <span class="skolem">fact</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="skolem">sq</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> real_sqrt_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>real_of <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> real_of_int <span class="main">(</span>sgn <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> real_of_nat <span class="skolem">sq</span> <span class="main">/</span> real_of_int <span class="skolem">b</span> <span class="main">*</span> sqrt <span class="main">(</span>real_of_nat <span class="skolem">fact</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?asqb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ma_of_rat <span class="main">(</span>rat_of_int <span class="main">(</span>sgn <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> rat_of_nat <span class="skolem">sq</span> <span class="main">/</span> rat_of_int <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ma_of_rat <span class="main">(</span>rat_of_nat <span class="skolem">fact</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ma_sqrt <span class="var">?f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> sq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> ma_rat <span class="var">?f</span>"</span></span> <span class="quoted"><span class="quoted">"ma_coeff <span class="var">?f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> compat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span>ma_compatible <span class="var">?asqb</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>real_of <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span>
         real_of
          <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> quotient_of <span class="main">(</span>ma_rat <span class="skolem">r</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="bound">sq</span><span class="main">,</span> <span class="bound">fact</span><span class="main">)</span> <span class="main">=</span> prime_product_factor <span class="main">(</span>nat <span class="main">(</span><span class="main">¦</span><span class="bound">a</span><span class="main">¦</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
               <span class="bound">ma'</span> <span class="main">=</span> ma_of_rat <span class="main">(</span>rat_of_int <span class="main">(</span>sgn <span class="bound">a</span><span class="main">)</span> <span class="main">*</span> rat_of_nat <span class="bound">sq</span> <span class="main">/</span> rat_of_int <span class="bound">b</span><span class="main">)</span>
           <span class="keyword1">in</span> ma_times <span class="bound">ma'</span> <span class="main">(</span>ma_sqrt <span class="main">(</span>ma_of_rat <span class="main">(</span>rat_of_nat <span class="bound">fact</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> q ppf Let_def split
    <span class="keyword1"><span class="command">unfolding</span></span> r
    <span class="keyword1"><span class="command">unfolding</span></span> ma_times<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?asqb</span></span></span><span class="main">,</span> <span class="operator">unfolded</span> compat if_True<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> ma_sqrt_main<span class="main">[</span><span class="operator">OF</span> sq<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> ma_of_rat<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_divide of_rat_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Real_Unique_Impl-mau_sqrt"><span class="command">lemma</span></span> mau_sqrt<span class="main">:</span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>real_of_u <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> mau_coeff <span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span>
  real_of_u <span class="main">(</span>mau_sqrt <span class="free">r</span><span class="main">)</span>
  <span class="keyword1">else</span> Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''cannot represent sqrt of irrational number''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> sqrt <span class="main">(</span>real_of_u <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mau_sqrt_main<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"mau_coeff <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Real_Unique_Impl-mau_0"><span class="command">lemma</span></span> mau_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> real_of_u <span class="main">(</span>mau_of_rat <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ma_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Real_Unique_Impl-mau_1"><span class="command">lemma</span></span> mau_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> real_of_u <span class="main">(</span>mau_of_rat <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ma_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Real_Unique_Impl-mau_equal"><span class="command">lemma</span></span> mau_equal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"HOL.equal <span class="main">(</span>real_of_u <span class="free">r1</span><span class="main">)</span> <span class="main">(</span>real_of_u <span class="free">r2</span><span class="main">)</span> <span class="main">=</span> mau_equal <span class="free">r1</span> <span class="free">r2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> equal_real_def
  <span class="keyword1"><span class="command">using</span></span> real_of_u_inj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">r2</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Real_Unique_Impl-mau_ge_0"><span class="command">lemma</span></span> mau_ge_0<span class="main">:</span> <span class="quoted"><span class="quoted">"ge_0 <span class="main">(</span>real_of_u <span class="free">x</span><span class="main">)</span> <span class="main">=</span> mau_ge_0 <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ma_ge_0
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_lt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">real_lt</span> <span class="main">=</span> <span class="main">(&lt;)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following code equation terminates if it is started on two
  different inputs.›</span></span>
<span class="keyword1" id="Real_Unique_Impl-real_lt"><span class="command">lemma</span></span> real_lt <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">equation</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"real_lt <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">fx</span> <span class="main">=</span> floor <span class="free">x</span><span class="main">;</span> <span class="bound">fy</span> <span class="main">=</span> floor <span class="free">y</span> <span class="keyword1">in</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="bound">fx</span> <span class="main">&lt;</span> <span class="bound">fy</span> <span class="keyword1">then</span> True <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">fx</span> <span class="main">&gt;</span> <span class="bound">fy</span> <span class="keyword1">then</span> False <span class="keyword1">else</span> real_lt <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="numeral">1024</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">1024</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"floor <span class="free">x</span> <span class="main">&lt;</span> floor <span class="free">y</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_lt_def floor_less_cancel<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> nless <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"floor <span class="free">x</span> <span class="main">&gt;</span> floor <span class="free">y</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> floor_less_cancel<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> True nless <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_lt_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> nless <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> real_lt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For comparisons we first check for equality. Then, if the bases are
  compatible we can just compare the differences with 0. Otherwise, we start
  the recursive algorithm <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> real_lt<span class="antiquote"><span class="antiquote">}</span></span></span></span> which works on arbitrary bases.
  In this way, we have an implementation of comparisons which can compare
  all representable numbers.

  Note that in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="Real_Impl.html"></a><a href="Real_Impl.html">Real_Impl.Real_Impl</a><span class="antiquote"><span class="antiquote">}</span></span></span></span> we did not use <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> real_lt<span class="antiquote"><span class="antiquote">}</span></span></span></span> as there
  the code-equations for equality already require identical bases.
›</span></span>
<span class="keyword1" id="Real_Unique_Impl-comparison_impl"><span class="command">lemma</span></span> comparison_impl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"real_of_u <span class="free">x</span> <span class="main">≤</span> real_of_u <span class="free">y</span> <span class="main">⟷</span> real_of_u <span class="free">x</span> <span class="main">=</span> real_of_u <span class="free">y</span> <span class="main">∨</span>
    <span class="main">(</span><span class="keyword1">if</span> mau_compatible <span class="free">x</span> <span class="free">y</span> <span class="keyword1">then</span> ge_0 <span class="main">(</span>real_of_u <span class="free">y</span> <span class="main">-</span> real_of_u <span class="free">x</span><span class="main">)</span> <span class="keyword1">else</span> real_lt <span class="main">(</span>real_of_u <span class="free">x</span><span class="main">)</span> <span class="main">(</span>real_of_u <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"real_of_u <span class="free">x</span> <span class="main">&lt;</span> real_of_u <span class="free">y</span> <span class="main">⟷</span> real_of_u <span class="free">x</span> <span class="main">≠</span> real_of_u <span class="free">y</span> <span class="main">∧</span>
    <span class="main">(</span><span class="keyword1">if</span> mau_compatible <span class="free">x</span> <span class="free">y</span> <span class="keyword1">then</span> ge_0 <span class="main">(</span>real_of_u <span class="free">y</span> <span class="main">-</span> real_of_u <span class="free">x</span><span class="main">)</span> <span class="keyword1">else</span> real_lt <span class="main">(</span>real_of_u <span class="free">x</span><span class="main">)</span> <span class="main">(</span>real_of_u <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ge_0_def real_lt_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> real_of_u_inj<span class="main">)</span>

<span class="keyword1" id="Real_Unique_Impl-mau_is_rat"><span class="command">lemma</span></span> mau_is_rat<span class="main">:</span> <span class="quoted"><span class="quoted">"is_rat <span class="main">(</span>real_of_u <span class="free">x</span><span class="main">)</span> <span class="main">=</span> mau_is_rat <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ma_is_rat
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> ma_show_real <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">let</span> <span class="bound">sb</span> <span class="main">=</span> shows <span class="inner_quoted">''sqrt(''</span> <span class="main">∘</span> shows <span class="bound">b</span> <span class="main">∘</span> shows <span class="inner_quoted">'')''</span><span class="main">;</span>
      <span class="bound">qb</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">q</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">sb</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">q</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">then</span> shows <span class="inner_quoted">''-''</span> <span class="main">∘</span> <span class="bound">sb</span> <span class="keyword1">else</span> shows <span class="bound">q</span> <span class="main">∘</span> shows <span class="inner_quoted">''*''</span> <span class="main">∘</span> <span class="bound">sb</span><span class="main">)</span> <span class="keyword1">in</span>
      <span class="keyword1">if</span> <span class="bound">q</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> shows <span class="bound">p</span> <span class="main">[]</span> <span class="keyword1">else</span>
      <span class="keyword1">if</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">qb</span> <span class="main">[]</span> <span class="keyword1">else</span>
      <span class="keyword1">if</span> <span class="bound">q</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">(</span>shows <span class="bound">p</span> <span class="main">∘</span> <span class="bound">qb</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="main">(</span><span class="main">(</span>shows <span class="bound">p</span> <span class="main">∘</span> shows <span class="inner_quoted">''+''</span> <span class="main">∘</span> <span class="bound">qb</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> mau_show_real <span class="main">::</span> <span class="quoted"><span class="quoted">"mini_alg_unique <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">ma_show_real</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">overloading</span></span> show_real <span class="main">≡</span> <span class="quoted">show_real</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">show_real</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">show_real</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> real_of_u <span class="bound">y</span><span class="main">)</span> <span class="keyword1">then</span> mau_show_real <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> real_of_u <span class="bound">y</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Real_Unique_Impl-mau_show_real"><span class="command">lemma</span></span> mau_show_real<span class="main">:</span> <span class="quoted"><span class="quoted">"show_real <span class="main">(</span>real_of_u <span class="free">x</span><span class="main">)</span> <span class="main">=</span> mau_show_real <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> show_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">code_datatype</span></span> <span class="quoted">real_of_u</span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">drop</span><span class="main"><span class="main">:</span></span>
  <span class="quoted"><span class="quoted">"plus <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted"><span class="quoted">"uminus <span class="main">::</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted"><span class="quoted">"times <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted"><span class="quoted">"inverse <span class="main">::</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted"><span class="quoted">"floor <span class="main">::</span> real <span class="main">⇒</span> int"</span></span>
  <span class="quoted">sqrt</span>
  <span class="quoted"><span class="quoted">"HOL.equal <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span>
  <span class="quoted">ge_0</span>
  <span class="quoted">is_rat</span>
  <span class="quoted"><span class="quoted">"less <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> 
  <span class="quoted"><span class="quoted">"less_eq <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> 
<span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> mau_code_eqns <span class="main">[</span><span class="operator">code</span><span class="main">]</span> <span class="main">=</span> mau_floor mau_0 mau_1 mau_uminus mau_inverse mau_sqrt mau_plus mau_times mau_equal mau_ge_0 mau_is_rat
  mau_show_real comparison_impl

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some tests with small numbers. To work on larger number, one should
  additionally import the theories for efficient calculation on numbers›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="numeral">101.1</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">18</span> <span class="main">+</span> <span class="numeral">6</span> <span class="main">*</span> sqrt <span class="numeral">0.5</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="numeral">324</span> <span class="main">*</span> sqrt <span class="numeral">7</span> <span class="main">+</span> <span class="numeral">0.001</span><span class="main">⌋</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">101.1</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">18</span> <span class="main">+</span> <span class="numeral">6</span> <span class="main">*</span> sqrt <span class="numeral">0.5</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">324</span> <span class="main">*</span> sqrt <span class="numeral">7</span> <span class="main">+</span> <span class="numeral">0.001</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">101.1</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">18</span> <span class="main">+</span> <span class="numeral">6</span> <span class="main">*</span> sqrt <span class="numeral">0.5</span><span class="main">)</span> <span class="main">&gt;</span> <span class="numeral">324</span> <span class="main">*</span> sqrt <span class="numeral">7</span> <span class="main">+</span> <span class="numeral">0.001</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"show <span class="main">(</span><span class="numeral">101.1</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">18</span> <span class="main">+</span> <span class="numeral">6</span> <span class="main">*</span> sqrt <span class="numeral">0.5</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt <span class="numeral">0.1</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">,</span> sqrt <span class="main">(</span><span class="main">-</span> <span class="numeral">0.09</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>